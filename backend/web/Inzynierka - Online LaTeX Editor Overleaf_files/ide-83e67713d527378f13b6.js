"use strict";!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Frontend=t():(e.Frontend=e.Frontend||{},e.Frontend["pages/ide"]=t())}(self,(()=>(self.webpackChunkFrontend=self.webpackChunkFrontend||[]).push([[1320],{309:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(14041);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const[n,i]=(0,r.useState)(e);return(0,r.useEffect)((()=>{const n=window.setTimeout((()=>{i(e)}),t);return()=>{window.clearTimeout(n)}}),[e,t]),n}},2567:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(56447),i=n(90214),s=n(14041),o=n(31085);const a=(0,s.lazy)((()=>Promise.all([n.e(4695),n.e(9777),n.e(9509),n.e(85),n.e(6623),n.e(188),n.e(3147),n.e(5246)]).then(n.bind(n,85246))));const l=function(){const{view:e}=(0,r.LV)();return"history"!==e?null:(0,o.jsx)(s.Suspense,{fallback:(0,o.jsx)(i.e,{delay:500}),children:(0,o.jsx)(a,{})})}},3518:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(22046),i=n(31085);function s(e){let{children:t}=e;return(0,i.jsx)(r.A,{type:"error",content:t})}},4816:(e,t,n)=>{n.d(t,{n:()=>o});var r=n(69687),i=n(64932);let s;const o=(e,t)=>(s||(s=new r.VR((0,i.A)("ol-ExposedSettings").fileIgnorePattern,{nocase:!0,dot:!0})),!!e&&(!t||!s.match(t+"/"+e)))},4941:(e,t,n)=>{n.d(t,{i:()=>l});var r=n(14041),i=n(37858),s=n(45857),o=n(52155);const a=(e,t)=>s.h.compare(e.path,t.path);function l(e){const[t,n]=(0,r.useState)(!1),[s,l]=(0,r.useState)(null),[c,d]=(0,r.useState)(!1),{signal:u}=(0,o.A)();return(0,r.useEffect)((()=>{e&&(n(!0),d(!1),l(null),(0,i.hm)(`/project/${e}/entities`,{signal:u}).then((e=>{l(e.entities.sort(a))})).catch((e=>d(e))).finally((()=>n(!1))))}),[e,u]),{loading:t,data:s,error:c}}},5080:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(97434),i=n(31085);function s(){const{t:e}=(0,r.Bd)();return(0,i.jsx)("div",{className:"no-file-selection",children:(0,i.jsx)("div",{className:"no-file-selection-message",children:(0,i.jsx)("h3",{children:e("no_selection_select_file")})})})}},5175:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var r=n(14041),i=n(28812);const s=n.p+"images/check-circle-53e6dae9ecf88000b906.svg";var o=n(64840),a=n(71627),l=n(6638);const c=n.p+"images/overleaf-green-c9aabd0b98bdbcc32972.svg",d=n.p+"images/writefull-logo-292e482d1b060164ce39.png";var u=n(64932),p=n(97434),m=n(7260),f=n(69954),h=n(31085);const g=e=>{let{show:t,origin:n,onHide:s}=e;const{t:g}=(0,p.Bd)(),_=(0,u.A)("ol-user"),v="personal"===_.planCode||_.isMemberOfGroupSubscription||_.hasInstitutionLicence,[b,y]=(0,r.useState)("personal"===_.planCode||v||_.isAnnualPlan),C=(0,u.A)("ol-addonPrices"),{hasRecurlySubscription:w}=_;(0,r.useEffect)((()=>{t&&(0,f._)("add-on-plans-view",{addOnType:"assistant",referrer:n})}),[t,n]);const k=(0,r.useCallback)((()=>{if((0,f._)("add-on-plans-click",{addOnType:"assistant",origin:n}),w)window.open(`/user/subscription/addon/${m.xx}/add?purchaseReferrer=${n}`);else{const e=b?m.VQ:m.h$;window.open(`/user/subscription/new?planCode=${e}&purchaseReferrer=${n}`)}}),[b,w,n]);return(_.planCode||_.isMemberOfGroupSubscription||_.hasInstitutionLicence)&&C?.assistant?(0,h.jsxs)(i.Ay,{className:"overleaf-assist-paywall-modal",size:"sm",show:t,onHide:s,centered:!0,children:[(0,h.jsx)(i.IK,{className:"border-0 pb-0",children:(0,h.jsx)("div",{className:"d-flex align-items-center justify-content-center w-100",children:(0,h.jsxs)("div",{className:"d-flex flex-column align-items-center",children:[(0,h.jsxs)("div",{className:"d-flex align-items-center justify-content-center gap-3 mb-2",children:[(0,h.jsx)("img",{alt:"Overleaf",src:c,"aria-hidden":"true"}),(0,h.jsx)("img",{alt:"Writefull",className:"writefull-logo",src:d,"aria-hidden":"true"})]}),(0,h.jsx)(i.rA,{className:"",children:(0,h.jsx)(x,{})})]})})}),(0,h.jsxs)(i.$8,{children:[(0,h.jsx)("p",{className:"text-center mb-4 px-4",children:g("write_faster_smarter_with_overleaf_and_writefull_ai_tools")}),(0,h.jsxs)("div",{className:"overleaf-assist-paywall-content",children:[(0,h.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("span",{className:"overleaf-assist-paywall-price",children:b?C.assistant.annualDividedByTwelve:C.assistant.monthly}),(0,h.jsx)("div",{className:"small",children:b?g("per_month_x_annually",{price:C.assistant?.annual}):g("per_month")})]}),v&&(0,h.jsxs)("div",{className:"d-flex",children:[(0,h.jsx)("span",{className:"small",children:g("annual_discount")}),(0,h.jsx)(o.A,{className:"d-flex",checked:b,onChange:()=>y(!b)})]})]}),(0,h.jsxs)("div",{className:"d-flex justify-content-between mb-3",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("strong",{children:"Overleaf LaTeX AI"}),(0,h.jsxs)("div",{className:"overleaf-assist-feature-list",children:[(0,h.jsx)(j,{children:(0,h.jsx)("strong",{children:g("error_assist")})}),(0,h.jsx)(j,{children:(0,h.jsx)("strong",{children:g("table_generator")})}),(0,h.jsx)(j,{children:(0,h.jsx)("strong",{children:g("equation_generator")})})]})]}),(0,h.jsxs)("div",{className:"feature-column w-50",children:[(0,h.jsx)("strong",{children:"Writefull language AI"}),(0,h.jsxs)("div",{className:"overleaf-assist-feature-list",children:[(0,h.jsx)(j,{children:(0,h.jsx)("strong",{children:g("language_suggestions")})}),(0,h.jsx)(j,{children:(0,h.jsx)("strong",{children:g("editing_tools")})}),(0,h.jsx)(j,{children:(0,h.jsx)("strong",{children:g("texgpt")})})]})]})]}),(0,h.jsxs)("div",{className:"d-flex flex-column align-items-center gap-1",children:[(0,h.jsxs)(a.A,{variant:"premium",type:"button",size:"lg",onClick:k,className:"w-100",children:[(0,h.jsx)("span",{children:g("add_ai_assist")}),(0,h.jsx)("img",{alt:"sparkle",className:"ai-error-assistant-sparkle",src:l,"aria-hidden":"true"})]}),(0,h.jsx)(a.A,{className:"overleaf-assist-paywall-secondary",variant:"link",onClick:s,children:g("maybe_later")})]})]}),(0,h.jsxs)("div",{className:"text-center mt-3",children:[(0,h.jsxs)("span",{className:"small",children:["*",g("fair_usage_policy_applies")]}),(0,h.jsx)(a.A,{className:"small px-1",variant:"link",href:"/learn/latex/Error_Assist#Daily_use_limits",children:g("learn_more")})]})]})]}):null};function x(){const{t:e}=(0,p.Bd)(),t=(0,u.A)("ol-user");return t.planName&&"personal"!==t.planName?(0,h.jsx)(h.Fragment,{children:e("add_unlimited_ai_to_your_overleaf_plan",{planName:t.planName})}):t.hasInstitutionLicence||t.isMemberOfGroupSubscription?(0,h.jsx)(h.Fragment,{children:e("add_unlimited_ai_to_overleaf")}):(0,h.jsx)(h.Fragment,{children:e("add_unlimited_ai_to_your_overleaf_plan",{planName:t.planName})})}function j(e){let{children:t}=e;return(0,h.jsxs)("div",{className:"overleaf-assist-paywall-list-item",children:[(0,h.jsx)("img",{className:"list-item-check-icon",alt:"check",src:s,"aria-hidden":"true"}),(0,h.jsx)("span",{children:t})]})}var _=n(89139),v=n(17112),b=n(10646);const y=()=>{const e=(0,v.u)("overleaf-assist-bundle"),t=(0,u.A)("ol-addonPrices"),[n,i]=(0,r.useState)(!1),{setAssistantUpgraded:s,writefullInstance:o}=(0,b.mi)(),[a,l]=(0,r.useState)(null);(0,_.A)("aiAssist:showPaywall",(0,r.useCallback)((e=>{l(e.detail.origin||"overleaf"),i(!0)}),[])),(0,r.useEffect)((()=>{const e=e=>{l(e?.origin||"writefull"),i(!0)};return o?.addEventListener("writefull-ai-assist-show-paywall",e),()=>{o?.removeEventListener("writefull-ai-assist-show-paywall",e)}}),[o]),(0,r.useEffect)((()=>{n&&s(!0)}),[s,n]);const c=(0,r.useCallback)((()=>i(!1)),[]);return t&&e?(0,h.jsx)(g,{show:n,origin:a,onHide:c}):null},C=(0,r.memo)(y)},5383:(e,t,n)=>{n.r(t),n.d(t,{AffilCtrlSeq:()=>ie,AffiliationCtrlSeq:()=>se,Ampersand:()=>St,AuthorCtrlSeq:()=>re,BareFilePathArgument:()=>Tt,Begin:()=>h,BibKeyArgument:()=>ht,BibliographyCtrlSeq:()=>te,BibliographyStyleCtrlSeq:()=>ne,BlankLine:()=>Ke,Book:()=>dn,BookCtrlSeq:()=>z,BottomRuleCtrlSeq:()=>me,BracketMath:()=>Yt,CaptionCtrlSeq:()=>R,CenteringCtrlSeq:()=>ee,Chapter:()=>pn,ChapterCtrlSeq:()=>V,CiteCtrlSeq:()=>_,CiteStarrableCtrlSeq:()=>v,CloseBrace:()=>Xe,CloseBracket:()=>st,CloseBracketCtrlSym:()=>qe,CloseBracketMath:()=>Qt,CloseParenCtrlSym:()=>$e,CloseParenMath:()=>Jt,ColorBoxCtrlSeq:()=>ce,Command:()=>tt,Comment:()=>Ue,Csname:()=>l,CtrlSeq:()=>Ct,CtrlSym:()=>gt,DateCtrlSeq:()=>oe,DefCtrlSeq:()=>L,DefinitionArgument:()=>_t,DefinitionFragment:()=>bt,DefinitionFragmentArgument:()=>wt,DefinitionFragmentCommand:()=>yt,DisplayMath:()=>Kt,DocumentClassCtrlSeq:()=>k,DocumentEnvName:()=>Fe,DocumentEnvironment:()=>We,Dollar:()=>At,DollarMath:()=>It,EmphasisCtrlSeq:()=>ke,End:()=>g,EndnoteCtrlSeq:()=>Ne,EnvName:()=>at,Environment:()=>ot,EquationArrayEnvName:()=>Le,EquationArrayEnvironment:()=>nn,EquationEnvName:()=>Re,EquationEnvironment:()=>tn,FigureEnvName:()=>De,FigureEnvironment:()=>an,FilePathArgument:()=>pt,FootnoteCtrlSeq:()=>Se,HLineCtrlSeq:()=>de,HboxCtrlSeq:()=>C,HrefCtrlSeq:()=>E,IncludeCtrlSeq:()=>Q,IncludeGraphicsCtrlSeq:()=>T,InlineMath:()=>Dt,InputCtrlSeq:()=>W,ItemCtrlSeq:()=>X,KnownCtrlSym:()=>kt,KnownEnvironment:()=>Ye,LaTeX:()=>He,LabelArgument:()=>mt,LabelCtrlSeq:()=>b,LeftCtrlSeq:()=>I,LetCtrlSeq:()=>P,LineBreakCtrlSym:()=>Ve,ListEnvName:()=>Oe,ListEnvironment:()=>ln,LiteralArgContent:()=>s,LongArg:()=>it,LstInlineContent:()=>i,LstInlineCtrlSeq:()=>F,MacroParameter:()=>xt,MaketitleCtrlSeq:()=>ae,Math:()=>Ot,MathArgument:()=>Mt,MathChar:()=>Gt,MathClosing:()=>Vt,MathCommand:()=>Bt,MathDelimitedGroup:()=>$t,MathDelimiter:()=>qt,MathOpening:()=>zt,MathSpecialChar:()=>Ut,MathTextCtrlSeq:()=>y,MidRuleCtrlSeq:()=>pe,MultiColumnCtrlSeq:()=>fe,NewCommandCtrlSeq:()=>O,NewEnvironmentCtrlSeq:()=>M,NewLine:()=>vt,NewTheoremCtrlSeq:()=>Z,Normal:()=>Et,Number:()=>Ht,OpenBrace:()=>Qe,OpenBracket:()=>Je,OpenBracketCtrlSym:()=>ze,OpenBracketMath:()=>Wt,OpenParenCtrlSym:()=>Me,OpenParenMath:()=>Zt,OptionalArgument:()=>Ze,OptionalMacroParameter:()=>jt,PackageArgument:()=>dt,ParBoxCtrlSeq:()=>he,Paragraph:()=>gn,ParagraphCtrlSeq:()=>K,ParenMath:()=>Xt,Part:()=>un,PartCtrlSeq:()=>q,RefArgument:()=>ft,RefCtrlSeq:()=>x,RefStarrableCtrlSeq:()=>j,RenewCommandCtrlSeq:()=>B,RenewEnvironmentCtrlSeq:()=>$,RightCtrlSeq:()=>D,Section:()=>mn,SectionCtrlSeq:()=>U,SectioningArgument:()=>Ft,SetLengthCtrlSeq:()=>Ee,ShortArg:()=>ct,ShortOptionalArg:()=>et,ShortTextArgument:()=>lt,SpaceDelimitedLiteralArgContent:()=>o,SubParagraph:()=>xn,SubParagraphCtrlSeq:()=>Y,SubSection:()=>fn,SubSectionCtrlSeq:()=>H,SubSubSection:()=>hn,SubSubSectionCtrlSeq:()=>G,TableEnvName:()=>Be,TableEnvironment:()=>cn,TabularArgument:()=>Rt,TabularContent:()=>Lt,TabularEnvName:()=>Te,TabularEnvironment:()=>en,Text:()=>Ge,TextArgument:()=>rt,TextBoldCtrlSeq:()=>ge,TextColorCtrlSeq:()=>le,TextItalicCtrlSeq:()=>xe,TextMediumCtrlSeq:()=>ve,TextSansSerifCtrlSeq:()=>be,TextSmallCapsCtrlSeq:()=>je,TextStrikeOutCtrlSeq:()=>we,TextSubscriptCtrlSeq:()=>Ce,TextSuperscriptCtrlSeq:()=>ye,TextTeletypeCtrlSeq:()=>_e,TheoremStyleCtrlSeq:()=>J,TikzPictureContent:()=>on,TikzPictureEnvName:()=>Ie,TikzPictureEnvironment:()=>sn,Tilde:()=>Nt,TitleCtrlSeq:()=>w,TopRuleCtrlSeq:()=>ue,TrailingContent:()=>d,TrailingWhitespaceOnly:()=>c,UnderlineCtrlSeq:()=>Ae,UnknownCommand:()=>Pt,UrlArgument:()=>ut,UrlCtrlSeq:()=>S,UsePackageCtrlSeq:()=>A,VerbContent:()=>r,VerbCtrlSeq:()=>N,VerbatimContent:()=>a,VerbatimEnvName:()=>Pe,VerbatimEnvironment:()=>rn,Whitespace:()=>nt,endOfArguments:()=>p,endOfArgumentsAndOptionals:()=>f,hasMoreArguments:()=>u,hasMoreArgumentsOrOptionals:()=>m});const r=1,i=2,s=3,o=4,a=5,l=6,c=7,d=8,u=382,p=383,m=384,f=385,h=9,g=10,x=11,j=12,_=13,v=14,b=15,y=16,C=17,w=18,k=19,A=20,E=21,S=22,N=23,F=24,T=25,R=26,L=27,P=28,I=29,D=30,O=31,B=32,M=33,$=34,z=35,q=36,V=37,U=38,H=39,G=40,K=41,Y=42,W=43,Q=44,X=45,Z=46,J=47,ee=48,te=49,ne=50,re=51,ie=52,se=53,oe=54,ae=55,le=56,ce=57,de=58,ue=59,pe=60,me=61,fe=62,he=63,ge=64,xe=65,je=66,_e=67,ve=68,be=69,ye=70,Ce=71,we=72,ke=73,Ae=74,Ee=75,Se=76,Ne=77,Fe=78,Te=79,Re=80,Le=81,Pe=82,Ie=83,De=84,Oe=85,Be=86,Me=87,$e=88,ze=89,qe=90,Ve=91,Ue=92,He=93,Ge=94,Ke=95,Ye=96,We=97,Qe=100,Xe=101,Ze=102,Je=103,et=104,tt=105,nt=108,rt=109,it=110,st=111,ot=113,at=116,lt=123,ct=124,dt=133,ut=137,pt=145,mt=148,ft=150,ht=152,gt=154,xt=155,jt=156,_t=157,vt=158,bt=159,yt=160,Ct=162,wt=163,kt=164,At=167,Et=168,St=169,Nt=170,Ft=172,Tt=181,Rt=191,Lt=192,Pt=209,It=210,Dt=211,Ot=212,Bt=213,Mt=228,$t=278,zt=279,qt=280,Vt=281,Ut=282,Ht=283,Gt=284,Kt=285,Yt=286,Wt=287,Qt=288,Xt=289,Zt=290,Jt=291,en=294,tn=299,nn=304,rn=308,sn=313,on=317,an=320,ln=324,cn=328,dn=333,un=336,pn=339,mn=342,fn=345,hn=348,gn=351,xn=354},6468:(e,t,n)=>{n.d(t,{F:()=>o,Y:()=>s});var r=n(99420),i=n.n(r);function s(e,t){return e?(null==t&&(t="Do MMM YYYY, h:mm a"),i()(e).format(t)):"N/A"}function o(e){return i()(e).fromNow()}},6539:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(14041),i=n(79184),s=n(11326);function o(){const{fileTreeExpanded:e,toggleFileTreeExpanded:t}=(0,s.r)(),n=(0,r.useRef)(null);return(0,i.A)(e,n),{fileTreeExpanded:e,fileTreePanelRef:n,toggleFileTreeExpanded:t}}},7260:(e,t,n)=>{n.d(t,{E8:()=>s,VQ:()=>o,f$:()=>l,h$:()=>r,sq:()=>a,xx:()=>i});n(82438),n(34840);const r="assistant",i="assistant",s="Error Assist",o="assistant-annual";function a(e){return e===r||e===o}function l(e){const t=e.pendingPlan,n=e.addOns?.some((e=>e.addOnCode===i));return!(!n||t)||n&&!t.addOns?.some((e=>e.code===i))}},7725:(e,t,n)=>{n.d(t,{GR:()=>l,xx:()=>a});n(97107);var r=n(14041),i=n(89139),s=n(31085);const o=(0,r.createContext)(void 0),a=e=>{let{children:t}=e;const[n,a]=(0,r.useState)((()=>({settingToFocus:void 0})));return(0,i.A)("ui.focus-setting",(0,r.useCallback)((e=>{a((t=>({...t,settingToFocus:e.detail})))}),[])),(0,s.jsx)(o.Provider,{value:n,children:t})},l=()=>{const e=(0,r.useContext)(o);if(!e)throw new Error("useEditorLeftMenuContext is only available inside EditorLeftMenuProvider");return e}},8881:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(14041),i=n(90214),s=n(67984),o=n(45330),a=n(31085);const l=(0,r.lazy)((()=>Promise.all([n.e(4695),n.e(9777),n.e(9509),n.e(5982),n.e(85),n.e(3497),n.e(6623),n.e(188),n.e(3147),n.e(3015),n.e(7565)]).then(n.bind(n,97190))));function c(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)(i.e,{delay:500}),children:(0,a.jsx)(l,{})})}const d=(0,s.A)((0,r.memo)(c),(()=>(0,a.jsx)(o.j,{})))},10800:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(14041),i=n(53373),s=n.n(i),o=n(96713),a=n(4166),l=n(31085);const c=(0,r.forwardRef)(((e,t)=>{let{accessibilityLabel:n,icon:r,isLoading:i=!1,size:c,className:d,unfilled:u,...p}=e;const m=s()(d,{"icon-button":!c,"icon-button-small":"sm"===c,"icon-button-large":"lg"===c}),f="lg"===c?"icon-large":"icon-small",h=s()(f,{"button-content-hidden":i,unfilled:u});return(0,l.jsx)(a.A,{className:m,isLoading:i,"aria-label":n,...p,ref:t,children:(0,l.jsx)(o.A,{className:h,type:r})})}));c.displayName="IconButton";const d=c},11283:(e,t,n)=>{n.d(t,{Pp:()=>o,fU:()=>s,mp:()=>a});var r=n(99420),i=n.n(r);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"h:mm a";return i()(e).format(t)}function o(e){return i()(e).calendar()}function a(e){return i()().diff(e,"years")>0?s(e,"D MMMM YYYY, h:mm a"):s(e,"D MMMM, h:mm a")}i().updateLocale("en",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"ddd, Do MMM YY",nextWeek:"ddd, Do MMM YY",sameElse:"ddd, Do MMM YY"}})},11787:(e,t,n)=>{n.d(t,{e:()=>o,r:()=>a});n(97107);var r=n(14041),i=n(31085);const s=(0,r.createContext)(void 0);function o(){const e=(0,r.useContext)(s);if(!e)throw new Error("useFileTreeMainContext is only available inside FileTreeMainProvider");return e}const a=e=>{let{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:o,children:a}=e;const[l,c]=(0,r.useState)(null);return(0,i.jsx)(s.Provider,{value:{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:o,contextMenuCoords:l,setContextMenuCoords:c},children:a})}},15428:(e,t,n)=>{n.d(t,{F:()=>l});var r=n(73613),i=n(97434),s=n(53373),o=n.n(s),a=n(31085);function l(e){const{t}=(0,i.Bd)();return(0,a.jsx)(r.TW,{...e,children:(0,a.jsx)("div",{className:o()("vertical-resize-handle",{"vertical-resize-handle-enabled":!e.disabled}),title:t("resize")})})}},15947:(e,t,n)=>{n.d(t,{By:()=>l,QV:()=>c,zP:()=>o});n(82438),n(12266);var r=n(57195);const i=r.Pe.define(),s=r.Pe.define(),o=()=>[a],a=r.sU.define({create:()=>[],update(e,t){for(const n of t.effects){n.is(i)&&e.push(n.value),n.is(s)&&(e=e.filter((e=>!(e.effect===n.value.effect&&e.callback===n.value.callback))));for(let t=0;t<e.length;++t){const r=e[t];n.is(r.effect)&&(setTimeout((()=>r.callback(n.value))),r.options?.once&&(e.splice(t,1),--t))}}return e}}),l=(e,t,n,r)=>{e.dispatch({effects:i.of({effect:t,callback:n,options:r})})},c=(e,t,n)=>{e.dispatch({effects:s.of({effect:t,callback:n})})}},17484:(e,t,n)=>{n(82438),n(34840);var r=n(64932),i=n(60961);const{hotjarId:s,hotjarVersion:o}=(0,r.A)("ol-ExposedSettings"),a=(0,r.A)("ol-shouldLoadHotjar");let l=!1;if(s&&o&&a){const e=()=>{document.cookie.split("; ").some((e=>"oa=1"===e))&&(/^\d+$/.test(s)&&/^\d+$/.test(o)?l||(i.$.log("Loading Hotjar"),l=!0,((e,t)=>{return n=window,r=document,n.hj=n.hj||function(){(n.hj.q=n.hj.q||[]).push(arguments)},n._hjSettings={hjid:e,hjsv:t},i=r.getElementsByTagName("head")[0],(s=r.createElement("script")).async=1,s.src="https://static.hotjar.com/c/hotjar-"+n._hjSettings.hjid+".js?sv="+n._hjSettings.hjsv,void i.appendChild(s);var n,r,i,s})(s,o)):i.$.error("Invalid Hotjar id or version"))};"function"==typeof window.requestIdleCallback?window.requestIdleCallback(e):e(),window.addEventListener("cookie-consent",(t=>{t.detail&&e()}))}},17905:(e,t,n)=>{n.d(t,{w:()=>s});n(82438),n(50020);var r=n(14041),i=n(7707);const s=(e,t)=>{const{register:n,unregister:s}=(0,i.W)();(0,r.useEffect)((()=>{const t=e();if(t)return n(...t),()=>{s(...t.map((e=>e.id)))}}),t)}},18730:(e,t,n)=>{n.d(t,{J:()=>o});var r=n(14041),i=n(37858),s=n(52155);function o(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[n,o]=(0,r.useState)(!1),[a,l]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),{signal:u}=(0,s.A)();return(0,r.useEffect)((()=>{t&&(o(!0),d(null),l(null),(0,i.hm)(`/${e}/groups`,{signal:u}).then((e=>{l(e.groups)})).catch((e=>{400===e.response.status?e.data.relink&&d("relink"):d("loading_groups")})).finally((()=>{o(!1)})))}),[t,e,u]),{loading:n,data:a,error:c}}},19405:(e,t,n)=>{var r={};n.r(r),n.d(r,{default:()=>R});var i={};n.r(i),n.d(i,{default:()=>qe});var s={};n.r(s),n.d(s,{default:()=>Yt});n(22108),n(9155),n(17484);var o=n(25873),a=n(14041),l=n(36266),c=n(67984),d=n(97434),u=n(3218),p=n(22046),m=n(71627),f=n(31085);function h(e){let{reconnectAt:t,tryReconnectNow:n}=e;const{t:r}=(0,d.Bd)(),[i,s]=(0,a.useState)((0,u.C)(t));return(0,a.useEffect)((()=>{const e=window.setInterval((()=>{s((0,u.C)(t))}),1e3);return()=>window.clearInterval(e)}),[t]),(0,f.jsx)(p.A,{type:"warning",content:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("strong",{children:r("lost_connection")})," ",r("reconnecting_in_x_secs",{seconds:i}),"."]}),action:(0,f.jsx)(m.A,{id:"try-reconnect-now-button",onClick:()=>n(),size:"sm",variant:"secondary",children:r("try_now")})})}var g=n(16896),x=n(60961),j=n(43144),_=n(36471);function v(){const{t:e}=(0,d.Bd)(),{connectionState:t,isConnected:n,isStillReconnecting:r,tryReconnectNow:i,secondsUntilReconnect:s}=(0,g.FX)(),o=(0,_.J)();return o?(0,j.createPortal)((0,f.jsxs)(f.Fragment,{children:[t.forceDisconnected&&"out-of-sync"!==t.error?(0,f.jsx)(p.A,{type:"error",content:(0,f.jsx)("strong",{children:e("disconnected")})}):null,t.reconnectAt?(0,f.jsx)(h,{reconnectAt:t.reconnectAt,tryReconnectNow:i}):null,r?(0,f.jsx)(p.A,{type:"warning",content:(0,f.jsxs)("strong",{children:[e("reconnecting"),"…"]})}):null,t.inactiveDisconnect||t.readyState===WebSocket.CLOSED&&("rate-limited"===t.error||"unable-to-connect"===t.error)&&!s()?(0,f.jsx)(p.A,{type:"warning",content:(0,f.jsx)("strong",{children:e("editor_disconected_click_to_reconnect")})}):null,x.v?(0,f.jsx)(p.A,{type:"warning",content:(0,f.jsxs)("strong",{children:["Connected: ",n.toString()]})}):null]}),o):null}var b=n(5175),y=n(73613),C=n(77934),w=n(53373),k=n.n(w),A=n(56447),E=n(52036),S=n(68543),N=n(69954),F=(n(61412),n(91883),n(70286),n(96713)),T=n(65982);function R(){const{fileTreeFromHistory:e,snapshotLoadingState:t,setFileTreeFromHistory:n}=(0,T.P4)();let r="sync_disabled";if(e)switch(t){case"":r="cloud_sync";break;case"loading":r="hourglass_top";break;case"error":r="sync_problem"}return(0,f.jsx)("div",{className:"toolbar-item",children:(0,f.jsx)("button",{className:"btn btn-full-height",onClick:()=>n(!e),children:(0,f.jsx)(F.A,{type:r})})})}var L=n(66513);const P=function(e){let{onClick:t}=e;const{t:n}=(0,d.Bd)();return(0,f.jsx)("div",{className:"toolbar-item",children:(0,f.jsxs)("button",{type:"button",className:"btn btn-full-height",onClick:t,children:[(0,f.jsx)(F.A,{type:"menu",className:"editor-menu-icon align-middle"}),(0,f.jsx)("p",{className:"toolbar-label",children:n("menu")})]})})};const I=function(e){let{brandVariationHomeUrl:t,brandVariationName:n,logoImgUrl:r}=e;return(0,f.jsx)("a",{className:"btn btn-full-height header-cobranding-logo-container",href:t,target:"_blank",rel:"noreferrer noopener",children:(0,f.jsx)("img",{src:r,className:"header-cobranding-logo",alt:n})})};var D=n(59162);const O=function(){const{t:e}=(0,d.Bd)();return(0,f.jsx)(D.A,{id:"back-to-projects",description:e("back_to_your_projects"),overlayProps:{placement:"right"},children:(0,f.jsx)("div",{className:"toolbar-item",children:(0,f.jsx)("a",{className:"btn btn-full-height",draggable:"false",href:"/project",onClick:()=>{N._("navigation-clicked-home")},children:(0,f.jsx)(F.A,{type:"home",className:"align-text-bottom",accessibilityLabel:e("back_to_your_projects")})})})})};const B=function(){const{t:e}=(0,d.Bd)();return(0,f.jsx)(m.A,{variant:"primary",size:"sm",className:"toolbar-header-upgrade-prompt",href:"/user/subscription/plans?itm_referrer=editor-header-upgrade-prompt",target:"_blank",onClick:function(){N.tN("subscription-funnel","code-editor","upgrade"),N._("upgrade-button-click",{source:"code-editor"})},children:e("upgrade")})};var M=n(35722);const $=function(e){let{chatIsOpen:t,unreadMessageCount:n,onClick:r}=e;const{t:i}=(0,d.Bd)(),s=k()("btn","btn-full-height",{active:t}),o=n>0;return(0,f.jsx)("div",{className:"toolbar-item",children:(0,f.jsxs)("button",{type:"button",className:s,onClick:r,children:[(0,f.jsx)(F.A,{type:"chat",className:k()("align-middle",{bounce:o})}),o&&(0,f.jsx)(M.A,{bg:"info",children:n}),(0,f.jsx)("p",{className:"toolbar-label",children:i("chat")})]})})};var z=n(237),q=n(61160),V=n(89139);const U=e=>{let{iconFor:t,pdfLayout:n,view:r,detachRole:i}=e;return"detacher"!==i&&"history"!==r&&("editorOnly"===t&&"flat"===n&&("editor"===r||"file"===r)||("pdfOnly"===t&&"flat"===n&&"pdf"===r||"sideBySide"===t&&"sideBySide"===n))};function H(e){let{active:t,...n}=e;return(0,f.jsx)(q.tJ,{active:t,"aria-current":t,trailingIcon:t?"check":null,...n})}const G=(0,a.forwardRef)(((e,t)=>{let{onClick:n,...r}=e;return(0,f.jsx)(q.fu,{...r,ref:t,onClick:e=>{N._("navigation-clicked-layout"),n(e)}})}));function K(){const{t:e}=(0,d.Bd)();return(0,f.jsx)(D.A,{id:"detach-disabled",description:e("your_browser_does_not_support_this_feature"),overlayProps:{placement:"left"},children:(0,f.jsx)("span",{children:(0,f.jsx)(H,{disabled:!0,leadingIcon:"select_window",children:e("pdf_in_separate_tab")})})})}function Y(){const{reattach:e,detach:t,detachIsLinked:n,detachRole:r,changeLayout:i,view:s,pdfLayout:o}=(0,A.LV)(),l=(0,a.useCallback)((()=>{t(),N._("project-layout-detach")}),[t]),c=(0,a.useCallback)((()=>{"detacher"===r&&(e(),N._("project-layout-reattach"))}),[r,e]);(0,V.A)("ui:pdf-open",c);const d=(0,a.useCallback)(((e,t)=>{c(),i(e,t),N._("project-layout-change",{layout:e,view:t})}),[i,c]);return(0,f.jsx)(W,{processing:!n&&"detacher"===r,handleChangeLayout:d,handleDetach:l,detachIsLinked:n,detachRole:r,pdfLayout:o,view:s,detachable:"BroadcastChannel"in window})}G.displayName="LayoutDropdownToggleButton";const W=e=>{let{processing:t,handleChangeLayout:n,handleDetach:r,detachIsLinked:i,detachRole:s,view:o,pdfLayout:a,detachable:l}=e;const{t:c}=(0,d.Bd)();return(0,f.jsxs)(f.Fragment,{children:[t&&(0,f.jsx)("div",{"aria-live":"assertive",className:"sr-only",children:c("layout_processing")}),(0,f.jsxs)(q.ms,{className:"toolbar-item layout-dropdown",align:"end",children:[(0,f.jsxs)(q.C,{id:"layout-dropdown-btn",className:"btn-full-height",as:G,children:[t?(0,f.jsx)(z.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"}):(0,f.jsx)(F.A,{type:"dock_to_right",className:"align-middle"}),(0,f.jsx)("span",{className:"toolbar-label",children:c("layout")})]}),(0,f.jsxs)(q.rI,{children:[(0,f.jsx)(H,{onClick:()=>n("sideBySide"),active:U({iconFor:"sideBySide",pdfLayout:a,view:o,detachRole:s}),leadingIcon:"dock_to_right",children:c("editor_and_pdf")}),(0,f.jsx)(H,{onClick:()=>n("flat","editor"),active:U({iconFor:"editorOnly",pdfLayout:a,view:o,detachRole:s}),leadingIcon:"code",children:(0,f.jsx)("div",{className:"d-flex flex-column",children:(0,f.jsx)(d.x6,{i18nKey:"editor_only_hide_pdf",components:[(0,f.jsx)("span",{className:"subdued"},"editor_only_hide_pdf")]})})}),(0,f.jsx)(H,{onClick:()=>n("flat","pdf"),active:U({iconFor:"pdfOnly",pdfLayout:a,view:o,detachRole:s}),leadingIcon:"picture_as_pdf",children:(0,f.jsx)("div",{className:"d-flex flex-column",children:(0,f.jsx)(d.x6,{i18nKey:"pdf_only_hide_editor",components:[(0,f.jsx)("span",{className:"subdued"},"pdf_only_hide_editor")]})})}),l?(0,f.jsx)(H,{onClick:()=>r(),active:"detacher"===s&&i,trailingIcon:"detacher"===s?i?"check":(0,f.jsxs)("span",{className:"spinner-container",children:[(0,f.jsx)(z.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"}),(0,f.jsx)("span",{className:"visually-hidden",children:c("loading")})]}):null,leadingIcon:"select_window",children:c("pdf_in_separate_tab")}):(0,f.jsx)(K,{})]})]})]})},Q=(0,a.memo)(Y);var X=n(60520),Z=n(7829);const J=function(e){let{projectName:t,hasRenamePermissions:n,onChange:r,className:i}=e;const{t:s}=(0,d.Bd)(),[o,l]=(0,a.useState)(!1),c=n&&!o,[u,p]=(0,a.useState)(t),m=(0,a.useRef)(null);function h(){c&&(p(t),l(!0))}function g(){l(!1),r(u)}return(0,a.useEffect)((()=>{o&&m.current?.select()}),[o]),(0,f.jsxs)("div",{className:k()("project-name",i),children:[!o&&(0,f.jsx)("span",{className:"name",onDoubleClick:h,children:t}),o&&(0,f.jsx)(Z.A,{ref:m,type:"text",onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),g())},onChange:function(e){p(e.target.value)},onBlur:function(){o&&g()},value:u}),c&&(0,f.jsx)(D.A,{id:"online-user",description:s("rename"),overlayProps:{placement:"bottom",trigger:["hover","focus"]},children:(0,f.jsx)("a",{className:"rename",role:"button",onClick:h,children:(0,f.jsx)(F.A,{type:"edit",className:"align-text-bottom"})})})]})};const ee=function(e){let{trackChangesIsOpen:t,disabled:n,onMouseDown:r}=e;const{t:i}=(0,d.Bd)(),s=k()("btn","btn-full-height",{active:t&&!n,disabled:n});return(0,f.jsxs)("div",{className:"toolbar-item",children:[(0,f.jsxs)("button",{type:"button",disabled:n,className:s,onMouseDown:r,children:[(0,f.jsx)(F.A,{type:"rate_review",className:"align-middle"}),(0,f.jsx)("p",{className:"toolbar-label",children:i("review")})]}),(0,f.jsx)("div",{id:"toolbar-cio-review",className:"toolbar-cio-tooltip"})]})};const te=function(e){let{onClick:t}=e;const{t:n}=(0,d.Bd)();return(0,f.jsxs)("div",{className:"toolbar-item",children:[(0,f.jsxs)("button",{type:"button",className:"btn btn-full-height",onClick:t,children:[(0,f.jsx)(F.A,{type:"history",className:"align-middle"}),(0,f.jsx)("p",{className:"toolbar-label",children:n("history")})]}),(0,f.jsx)("div",{id:"toolbar-cio-history",className:"toolbar-cio-tooltip"})]})};const ne=function(e){let{onClick:t}=e;const{t:n}=(0,d.Bd)();return(0,f.jsxs)("div",{className:"toolbar-item",children:[(0,f.jsxs)("button",{type:"button",className:"btn btn-full-height",onClick:t,children:[(0,f.jsx)(F.A,{type:"group_add",className:"align-middle"}),(0,f.jsx)("p",{className:"toolbar-label",children:n("share")})]}),(0,f.jsx)("div",{id:"toolbar-cio-share",className:"toolbar-cio-tooltip"})]})};var re=n(43137),ie=n(64932),se=n(58528),oe=n(97536),ae=n(86040);const le=()=>{const{t:e}=(0,d.Bd)(),{setShowSwitcherModal:t}=(0,ae.vO)(),n=(0,a.useCallback)((()=>{t(!0)}),[t]);return(0,f.jsx)("div",{className:"d-flex align-items-center",children:(0,f.jsx)(m.A,{className:"toolbar-experiment-button",onClick:n,size:"sm",leadingIcon:(0,f.jsx)(F.A,{type:"experiment",unfilled:!0}),variant:"secondary",children:e("try_the_new_editor")})})},[ce]=[{import:L,path:"/overleaf/services/web/modules/publish-modal/frontend/js/components/publish-toolbar-button"}],de=ce?.import.default,ue=[{import:r,path:"/overleaf/services/web/modules/offline-mode/frontend/js/components/editor-toolbar/file-tree-from-history-button"}],pe=(0,se.g9)("ro-mirror-on-client")&&"enabled"===new URLSearchParams(window.location.search).get("ro-mirror-on-client"),me=a.memo((function(e){let{cobranding:t,onShowLeftMenuClick:n,chatIsOpen:r,toggleChatOpen:i,reviewPanelOpen:s,toggleReviewPanelOpen:o,historyIsOpen:a,toggleHistoryOpen:l,unreadMessageCount:c,onlineUsers:u,goToUser:p,isRestrictedTokenMember:m,hasPublishPermissions:h,chatVisible:g,projectName:x,renameProject:j,hasRenamePermissions:_,openShareModal:v,trackChangesVisible:b}=e;const y=(0,ie.A)("ol-chatEnabled"),{t:C}=(0,d.Bd)(),w=h&&de;return(0,f.jsxs)("header",{className:"toolbar toolbar-header",role:"navigation","aria-label":C("project_layout_sharing_submission"),children:[(0,f.jsxs)("div",{className:"toolbar-left",children:[(0,f.jsx)(P,{onClick:n}),t&&t.logoImgUrl&&(0,f.jsx)(I,{...t}),(0,f.jsx)(O,{}),pe&&ue.map((e=>{let{path:t,import:{default:n}}=e;return(0,f.jsx)(n,{},t)}))]}),(0,ie.A)("ol-showUpgradePrompt")&&(0,f.jsx)("div",{className:"d-flex align-items-center",children:(0,f.jsx)(B,{})}),(0,f.jsx)(J,{className:"toolbar-center",projectName:x,hasRenamePermissions:_,onChange:j}),(0,f.jsxs)("div",{className:"toolbar-right",children:[(0,oe.x)()&&(0,f.jsx)(le,{}),(0,f.jsx)(X.A,{onlineUsers:u,goToUser:p}),a?(0,f.jsx)("div",{className:"d-flex align-items-center",children:(0,f.jsx)(re.A,{onClick:l})}):(0,f.jsxs)(f.Fragment,{children:[b&&(0,f.jsx)(ee,{onMouseDown:o,disabled:a,trackChangesIsOpen:s}),(0,f.jsx)(ne,{onClick:v}),w&&(0,f.jsx)(de,{cobranding:t}),!m&&(0,f.jsx)(te,{onClick:l}),(0,f.jsx)(Q,{}),y&&g&&(0,f.jsx)($,{chatIsOpen:r,onClick:i,unreadMessageCount:c})]})]})]})}));var fe=n(10646),he=n(99806),ge=n(86316);function xe(e){return e?"open":"close"}const je=a.memo((function(e){let{onlineUsersArray:t,openDoc:n,openShareProjectModal:r}=e;const{name:i,features:{trackChangesVisible:s}}=(0,ge.O)(),{cobranding:o,isRestrictedTokenMember:l,renameProject:c,permissionsLevel:d}=(0,fe.mi)(),{chatIsOpen:u,setChatIsOpen:p,reviewPanelOpen:m,setReviewPanelOpen:h,view:g,setView:x,setLeftMenuShown:j}=(0,A.LV)(),{markMessagesAsRead:_,unreadMessageCount:v}=(0,he.vd)(),b=(0,a.useCallback)((()=>{u||_(),N._("navigation-clicked-chat",{action:xe(!u)}),p(!u)}),[u,p,_]),y=(0,a.useCallback)((e=>{e.preventDefault(),N._("navigation-clicked-review",{action:xe(!m)}),h((e=>!e))}),[m,h]),[C,w]=(0,a.useState)(u),k=(0,a.useCallback)((()=>{const e="history"===g?"close":"open";N._("navigation-clicked-history",{action:e}),u&&"open"===e&&(w(!0),b()),C&&"close"===e&&(w(!1),b()),x("history"===g?"editor":"history")}),[g,u,C,x,b]),E=(0,a.useCallback)((()=>{N._("navigation-clicked-share"),r()}),[r]),S=(0,a.useCallback)((()=>{N._("navigation-clicked-menu"),j((e=>!e))}),[j]),F=(0,a.useCallback)((e=>{e.doc&&"number"==typeof e.row&&n(e.doc,{gotoLine:e.row+1})}),[n]);return(0,f.jsx)(me,{cobranding:o,onShowLeftMenuClick:S,chatIsOpen:u,unreadMessageCount:v,toggleChatOpen:b,reviewPanelOpen:m,toggleReviewPanelOpen:y,historyIsOpen:"history"===g,toggleHistoryOpen:k,onlineUsers:t,goToUser:F,isRestrictedTokenMember:l,hasPublishPermissions:"owner"===d||"readAndWrite"===d,chatVisible:!l,projectName:i,renameProject:c,hasRenamePermissions:"owner"===d,openShareModal:E,trackChangesVisible:s})}));var _e=n(30158),ve=(n(82438),n(12266),n(43480)),be=n(28812);function ye(e){let{handleHide:t}=e;const{t:n}=(0,d.Bd)();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(be.IK,{closeButton:!0,children:(0,f.jsx)(be.rA,{children:n("do_you_need_edit_access")})}),(0,f.jsxs)(be.$8,{children:[(0,f.jsx)("p",{children:n("this_project_has_more_than_max_collabs",{linkSharingDate:ve.V})}),(0,f.jsx)("p",{children:n("to_keep_edit_access")})]}),(0,f.jsxs)(be.E9,{children:[(0,f.jsx)(m.A,{variant:"secondary",href:"/blog/changes-to-project-sharing",target:"_blank",rel:"noreferrer",onClick:()=>{(0,N._)("notification-click",{name:"link-sharing-collaborator-limit",button:"learn"})},children:n("learn_more")}),(0,f.jsx)(m.A,{variant:"primary",onClick:()=>{(0,N._)("notification-click",{name:"link-sharing-collaborator-limit",button:"ok"}),t()},children:n("ok")})]})]})}var Ce=n(37664);const we=()=>{const[e,t]=(0,a.useState)(!1),{isProjectOwner:n,permissionsLevel:r}=(0,fe.mi)(),{members:i,features:s,_id:o}=(0,ge.O)(),l=()=>{t(!1)};return(0,a.useEffect)((()=>{if(!(n||!s||"readOnly"===r)&&-1!==s.collaborators&&i.filter((e=>"readAndWrite"===e.privileges)).length>(s.collaborators??1)){const e=`last-shown-need-edit-modal.${o}`,n=Ce.A.getItem(e);(!n||n+864e5<Date.now())&&(t(!0),Ce.A.setItem(e,Date.now()),(0,N._)("notification-prompt",{name:"link-sharing-collaborator-limit"}))}}),[s,n,i,r,o]),e?(0,f.jsx)(be.Ay,{animation:!0,show:e,onHide:()=>{(0,N._)("notification-dismiss",{name:"link-sharing-collaborator-limit"}),l()},id:"editor-over-limit-modal",children:(0,f.jsx)(ye,{handleHide:l})}):null};function ke(e){let{handleHide:t}=e;const{t:n}=(0,d.Bd)();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(be.IK,{closeButton:!0,children:(0,f.jsx)(be.rA,{children:n("view_only_access")})}),(0,f.jsxs)(be.$8,{children:[(0,f.jsx)("p",{children:n("this_project_already_has_maximum_collaborators")}),(0,f.jsx)("p",{children:n("please_ask_the_project_owner_to_upgrade_more_collaborators")})]}),(0,f.jsxs)(be.E9,{children:[(0,f.jsx)(m.A,{variant:"secondary",href:"/blog/changes-to-project-sharing",target:"_blank",rel:"noreferrer",onClick:()=>{(0,N._)("notification-click",{name:"link-sharing-collaborator-limit",button:"learn"})},children:n("learn_more")}),(0,f.jsx)(m.A,{variant:"primary",onClick:()=>{(0,N._)("notification-click",{name:"link-sharing-collaborator-limit",button:"ok"}),t()},children:n("ok")})]})]})}const Ae=()=>{const[e,t]=(0,a.useState)(!1),{isProjectOwner:n,isPendingEditor:r,permissionsLevel:i}=(0,fe.mi)(),{members:s,features:o,_id:l}=(0,ge.O)(),c=()=>{t(!1)};return(0,a.useEffect)((()=>{if(!(n||!o)&&-1!==o.collaborators&&r){const e=`last-shown-view-only-access-modal.${l}`,n=Ce.A.getItem(e);(!n||n+6048e5<Date.now())&&(t(!0),Ce.A.setItem(e,Date.now()),(0,N._)("notification-prompt",{name:"link-sharing-collaborator-limit"}))}}),[o,n,r,s,i,l]),e?(0,f.jsx)(be.Ay,{animation:!0,show:e,onHide:()=>{(0,N._)("notification-dismiss",{name:"link-sharing-collaborator-limit"}),c()},id:"editor-over-limit-modal",children:(0,f.jsx)(ke,{handleHide:c})}):null};const Ee=function(){const[e,t]=(0,a.useState)(!1),{onlineUsersArray:n}=(0,E.E1)(),{openDoc:r}=(0,S.TS)(),i=(0,a.useCallback)((()=>{N.JY("ide-open-share-modal-once"),t(!0)}),[]),s=(0,a.useCallback)((()=>{t(!1)}),[]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(je,{onlineUsersArray:n,openDoc:r,openShareProjectModal:i}),(0,f.jsx)(we,{}),(0,f.jsx)(Ae,{}),(0,f.jsx)(_e.A,{show:e,handleOpen:i,handleHide:s})]})};n(74786);var Se=n(79563),Ne=n(21923),Fe=n(88929),Te=n(85960),Re=n(37858),Le=n(90214);const Pe=(0,a.lazy)((()=>n.e(9829).then(n.bind(n,49829)))),Ie=()=>(0,f.jsx)(Le.e,{delay:500,className:"pt-4"}),De=a.memo((function(){const{t:e}=(0,d.Bd)(),{chatIsOpen:t}=(0,A.LV)(),n=(0,Te.ur)(),{status:r,messages:i,initialMessagesLoaded:s,atEnd:o,loadInitialMessages:l,loadMoreMessages:c,reset:u,sendMessage:p,markMessagesAsRead:m,error:h}=(0,he.vd)();(0,a.useEffect)((()=>{t&&!s&&l()}),[t,l,s]);const g="pending"!==r&&0===i.length,x=i.reduce(((e,t)=>{let{contents:n}=t;return e+n.length}),0),[j,_]=(0,a.useState)(t);if((0,a.useEffect)((()=>{t&&_(!0)}),[t]),h){if(h instanceof Re.fk)return(0,f.jsx)(Fe.A,{reconnect:u});throw h}return n&&j?(0,f.jsxs)("aside",{className:"chat",children:[(0,f.jsx)(Ne.A,{atEnd:o,className:"messages",fetchData:c,isLoading:"pending"===r,itemCount:x,children:(0,f.jsxs)("div",{children:[(0,f.jsx)("h2",{className:"visually-hidden",children:e("chat")}),(0,f.jsxs)(a.Suspense,{fallback:(0,f.jsx)(Ie,{}),children:["pending"===r&&(0,f.jsx)(Ie,{}),g&&(0,f.jsx)(Oe,{}),(0,f.jsx)(Pe,{messages:i,resetUnreadMessages:m})]})]})}),(0,f.jsx)(Se.A,{resetUnreadMessages:m,sendMessage:p})]}):null}));function Oe(){const{t:e}=(0,d.Bd)();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"no-messages text-center small",children:e("no_messages")}),(0,f.jsxs)("div",{className:"first-message text-center",children:[e("send_first_message"),(0,f.jsx)("br",{}),(0,f.jsx)(F.A,{type:"arrow_downward"})]})]})}const Be=(0,c.A)(De,(()=>(0,f.jsx)(Fe.A,{})));var Me=n(73743),$e=n(64430);const ze=(0,a.lazy)((()=>Promise.all([n.e(9509),n.e(6697)]).then(n.bind(n,66697)))),qe=()=>{const{projectSearchIsOpen:e}=(0,A.LV)();return e?(0,f.jsx)(a.Suspense,{fallback:null,children:(0,f.jsx)(ze,{})}):null};var Ve=n(15428),Ue=n(77528),He=n(57533),Ge=n(61564);const Ke=[{import:i,path:"/overleaf/services/web/modules/full-project-search/frontend/js/components/full-project-search.tsx"}];function Ye(){const{view:e}=(0,A.LV)(),{outlineEnabled:t,outlinePanelRef:n}=(0,Ge.C)();return(0,f.jsxs)("aside",{className:k()("ide-react-editor-sidebar",{hidden:"history"===e}),children:[Ke.map((e=>{let{import:{default:t},path:n}=e;return(0,f.jsx)(t,{},n)})),(0,f.jsxs)(y.YZ,{autoSaveId:"ide-editor-sidebar-layout",direction:"vertical",children:[(0,f.jsx)(y.Zk,{defaultSize:50,minSize:25,className:"ide-react-file-tree-panel",id:"panel-file-tree",order:1,children:(0,f.jsx)(Ue.h,{})}),(0,f.jsx)(Ve.F,{disabled:!t}),(0,f.jsx)(y.Zk,{defaultSize:50,maxSize:75,id:"panel-outline",order:2,collapsible:!0,ref:n,style:{minHeight:32},children:(0,f.jsx)(He.S,{})})]})]})}var We=n(79184);var Qe=n(309);var Xe=n(5080),Ze=n(89027),Je=n(68059),et=n(44167),tt=n(59084),nt=n(55904),rt=n(39891),it=n(11326),st=n(14936),ot=n(8881),at=n(41260);const lt=(0,a.lazy)((()=>n.e(744).then(n.bind(n,50744)))),ct=()=>{const[e]=(0,st.A)("editor"),{selectedEntityCount:t,openEntity:n}=(0,it.r)(),{currentDocumentId:r,isLoading:i}=(0,S.TS)();return r?(0,f.jsx)("div",{className:k()("ide-react-editor-content","full-size",{hidden:"doc"!==n?.type||1!==t}),children:(0,f.jsxs)(y.YZ,{autoSaveId:"ide-editor-layout",direction:"vertical",children:[(0,f.jsxs)(y.Zk,{id:"panel-source-editor",order:1,className:"ide-react-editor-panel",children:[(0,f.jsx)(ot.A,{}),i&&(0,f.jsx)(at.R,{})]}),e.showSymbolPalette&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Ve.F,{id:"editor-symbol-palette"}),(0,f.jsx)(y.Zk,{id:"panel-symbol-palette",order:2,defaultSize:25,minSize:10,maxSize:50,children:(0,f.jsx)(a.Suspense,{fallback:(0,f.jsx)(Le.e,{delay:500}),children:(0,f.jsx)(lt,{})})})]})]})}):null},dt=()=>{const[e,t]=(0,a.useState)(!1),{t:n}=(0,d.Bd)(),{togglePdfPane:r,handlePdfPaneExpand:i,handlePdfPaneCollapse:s,setPdfIsOpen:o,pdfIsOpen:l,pdfPanelRef:c}=(0,nt.A)(),{view:u,pdfLayout:p}=(0,A.LV)(),{selectedEntityCount:m,openEntity:h}=(0,it.r)(),g="editor"===u||"file"===u||"sideBySide"===p;return(0,f.jsxs)(y.YZ,{autoSaveId:"ide-editor-pdf-layout",direction:"horizontal",className:k()({"ide-panel-group-resizing":e,hidden:"history"===u}),children:[(0,f.jsxs)(y.Zk,{id:"panel-ide",order:1,defaultSize:50,minSize:5,className:k()("ide-react-panel",{"ide-panel-group-resizing":e,hidden:!g}),children:[0===m&&(0,f.jsx)(Xe.A,{}),1===m&&"fileRef"===h?.type&&(0,f.jsx)(Ze.A,{file:(0,rt.g)(h.entity)}),m>1&&(0,f.jsx)(Je.A,{selectedEntityCount:m}),(0,f.jsx)(ct,{})]}),(0,f.jsxs)(C.j,{resizable:"sideBySide"===p,onDoubleClick:r,onDragging:t,className:k()({hidden:!g}),hitAreaMargins:{coarse:0,fine:0},children:[(0,f.jsx)(Me.$,{id:"editor-pdf",togglerType:"east",isOpen:l,setIsOpen:o,tooltipWhenOpen:n("tooltip_hide_pdf"),tooltipWhenClosed:n("tooltip_show_pdf")}),"sideBySide"===p&&(0,f.jsx)("div",{className:"synctex-controls",children:(0,f.jsx)(et.Xq,{})})]}),(0,f.jsxs)(y.Zk,{ref:c,id:"panel-pdf",order:2,defaultSize:50,minSize:5,collapsible:!0,onCollapse:s,onExpand:i,className:"ide-react-panel",children:[(0,f.jsx)(tt.A,{}),"flat"===p&&"pdf"===u&&(0,f.jsx)("div",{className:"synctex-controls",hidden:!0,children:(0,f.jsx)(et.Xq,{})})]})]})};var ut=n(2567);const pt=[{import:b,path:"/overleaf/services/web/modules/ai/frontend/js/components/promotions/overleaf-assist-paywall"}],mt=()=>{const{view:e}=(0,A.LV)(),{isRestrictedTokenMember:t}=(0,fe.mi)(),{isOpen:n,setIsOpen:r,panelRef:i,togglePane:s,handlePaneExpand:o,handlePaneCollapse:l,resizing:c,setResizing:u}=(()=>{const[e,t]=(0,a.useState)(!0),[n,r]=(0,a.useState)(!1),i=(0,a.useRef)(null);(0,We.A)(e,i);const s=(0,a.useCallback)((()=>{t((e=>!e))}),[]),o=(0,a.useCallback)((()=>{t(!0)}),[]),l=(0,a.useCallback)((()=>{t(!1)}),[]);return{isOpen:e,setIsOpen:t,panelRef:i,togglePane:s,handlePaneExpand:o,handlePaneCollapse:l,resizing:n,setResizing:r}})(),{isOpen:p,panelRef:m,togglePane:h,resizing:g,setResizing:x,handlePaneCollapse:j,handlePaneExpand:_}=(()=>{const{chatIsOpen:e,setChatIsOpen:t}=(0,A.LV)(),[n,r]=(0,a.useState)(!1),i=(0,a.useRef)(null),[s,o]=(0,a.useState)(e),l=(0,Qe.A)(s,100);(0,We.A)(e,i);const c=(0,a.useCallback)((()=>{t((e=>!e))}),[t]),d=(0,a.useCallback)((()=>{o(!0)}),[]),u=(0,a.useCallback)((()=>{o(!1)}),[]);return(0,a.useEffect)((()=>{t(l)}),[l,t]),{isOpen:e,panelRef:i,resizing:n,setResizing:r,togglePane:c,handlePaneExpand:d,handlePaneCollapse:u}})(),v=(0,ie.A)("ol-chatEnabled")&&!t,{t:b}=(0,d.Bd)();return(0,f.jsxs)("div",{className:"ide-react-main",children:[(0,f.jsx)(Ee,{}),(0,f.jsx)("div",{className:"ide-react-body",children:(0,f.jsxs)(y.YZ,{autoSaveId:"ide-outer-layout",direction:"horizontal",className:k()({"ide-panel-group-resizing":c||g}),children:[(0,f.jsxs)(y.Zk,{ref:i,id:"panel-sidebar",order:1,defaultSize:15,minSize:5,maxSize:80,collapsible:!0,onCollapse:l,onExpand:o,children:[(0,f.jsx)(Ye,{}),"history"===e&&(0,f.jsx)($e.N,{})]}),(0,f.jsx)(C.j,{onDoubleClick:s,resizable:n,onDragging:u,hitAreaMargins:{coarse:0,fine:0},children:(0,f.jsx)(Me.$,{id:"panel-sidebar",togglerType:"west",isOpen:n,setIsOpen:r,tooltipWhenOpen:b("tooltip_hide_filetree"),tooltipWhenClosed:b("tooltip_show_filetree")})}),(0,f.jsx)(y.Zk,{id:"panel-outer-main",order:2,children:(0,f.jsxs)(y.YZ,{autoSaveId:"ide-inner-layout",direction:"horizontal",children:[(0,f.jsxs)(y.Zk,{className:"ide-react-panel",id:"panel-main",order:1,children:[(0,f.jsx)(ut.A,{}),(0,f.jsx)(dt,{})]}),v&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(C.j,{onDoubleClick:h,resizable:p,onDragging:x,hitAreaMargins:{coarse:0,fine:0}}),(0,f.jsx)(y.Zk,{ref:m,id:"panel-chat",order:2,defaultSize:20,minSize:5,maxSize:30,collapsible:!0,onCollapse:j,onExpand:_,children:(0,f.jsx)(Be,{})})]})]})})]})}),pt.map((e=>{let{import:{default:t},path:n}=e;return(0,f.jsx)(t,{},n)}))]})};var ft=n(66020);const ht=(0,a.memo)((function(){const{setLeftMenuShown:e}=(0,A.LV)(),{userSettings:t}=(0,ft.dk)(),{editorTheme:n,overallTheme:r}=t,[i]=(0,a.useState)({editorTheme:n,overallTheme:r}),s=(0,a.useRef)(null);return(0,a.useEffect)((()=>{s.current&&(n===i.editorTheme&&r===i.overallTheme||(s.current.style.opacity="0"))}),[n,r,i]),(0,f.jsx)("div",{id:"left-menu-mask",ref:s,onClick:()=>e(!1)})}));var gt=n(52423),xt=n(7725);const jt=(0,a.lazy)((()=>Promise.all([n.e(4686),n.e(4695),n.e(6623),n.e(6002),n.e(8945)]).then(n.bind(n,8945)))),_t=(0,c.A)((()=>(0,f.jsx)(a.Suspense,{fallback:(0,f.jsx)(Le.e,{delay:500}),children:(0,f.jsx)(jt,{})})),(()=>{const{t:e}=(0,d.Bd)();return(0,f.jsx)(p.A,{type:"error",content:e("something_went_wrong")})}));function vt(){const{leftMenuShown:e,setLeftMenuShown:t}=(0,A.LV)();return(0,f.jsxs)(xt.xx,{children:[(0,f.jsx)(gt.A,{show:e,onHide:()=>{t(!1)},backdropClassName:"left-menu-modal-backdrop",id:"left-menu-offcanvas",children:(0,f.jsx)(gt.A.Body,{className:k()("full-size","left-menu",{shown:e}),id:"left-menu",children:(0,f.jsx)(_t,{})})}),e&&(0,f.jsx)(ht,{})]})}const bt=(0,a.memo)(vt);var yt=n(6599),Ct=n(31622),wt=n(13271),kt=n(83096),At=n(89753);const Et=function(){const{t:e}=(0,d.Bd)(),{socket:t}=(0,g.FX)(),{projectId:n}=(0,wt.yn)(),{showGenericMessageModal:r}=(0,kt.T)(),{permissionsLevel:i}=(0,fe.mi)(),[,s]=(0,st.A)("project.publicAccesLevel"),[,o]=(0,st.A)("project.members"),[,l]=(0,st.A)("project.invites"),c=(0,At.z)();(0,yt.A)(t,"project:access:revoked",(0,a.useCallback)((()=>{r(e("removed_from_project"),e("you_have_been_removed_from_this_project_and_will_be_redirected_to_project_dashboard"));const t=window.setTimeout((()=>{c.assign("/project")}),5e3);return()=>{window.clearTimeout(t)}}),[r,e,c])),(0,yt.A)(t,"project:publicAccessLevel:changed",(0,a.useCallback)((e=>{e.newAccessLevel&&s(e.newAccessLevel)}),[s])),(0,yt.A)(t,"project:collaboratorAccessLevel:changed",(0,a.useCallback)((()=>{(0,Ct.hu)(n).then((e=>{let{members:t}=e;t&&o(t)})).catch((e=>{x.$.error("Error fetching members for project",e)}))}),[n,o])),(0,yt.A)(t,"project:membership:changed",(0,a.useCallback)((e=>{e.members&&(0,Ct.hu)(n).then((e=>{let{members:t}=e;t&&o(t)})).catch((e=>{x.$.error("Error fetching members for project",e)})),e.invites&&"owner"===i&&(0,Ct.kn)(n).then((e=>{let{invites:t}=e;t&&l(t)})).catch((e=>{x.$.error("Error fetching invites for project",e)}))}),[n,l,o,i]))};function St(e,t,n){(0,a.useEffect)((()=>(e.addEventListener(t,n),()=>{e.removeEventListener(t,n)})),[e,t,n])}function Nt(){const{projectId:e}=(0,wt.yn)(),{getEditorType:t}=(0,S.TS)(),n=(0,a.useRef)(0),r=(0,a.useRef)(!1),i=(0,a.useRef)();(0,a.useEffect)((()=>()=>{window.clearTimeout(i.current)}),[]);const s=(0,a.useCallback)((()=>{x.$.log("[Event] heartbeat trigger");const s=t();if(null===s)return;if(r.current)return;r.current=!0;const o=function(e){return{editorType:e}}(s);x.$.log("[Event] send heartbeat request",o),function(e,t){(0,Re.mI)(`/editingSession/${e}`,{body:{segmentation:t}}).catch(x.$.error)}(e,o);const a=n.current;n.current++;const l=a<=2?30:a<=6?60*(a-2):300;i.current=window.setTimeout((()=>{r.current=!1}),1e3*l)}),[t,e]);(0,V.A)("cursor:editor:update",s),(0,V.A)("scroll:editor:update",s),St(document,"click",s)}var Ft=n(80760);function Tt(){const{connectionState:e}=(0,g.FX)(),{t}=(0,d.Bd)(),[n,r]=(0,a.useState)(0),[i,s]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{e.forceDisconnected&&"out-of-sync"!==e.error&&s(!0)}),[e.forceDisconnected,e.error]),(0,a.useEffect)((()=>{e.forceDisconnected&&r(e.forcedDisconnectDelay)}),[e.forceDisconnected,e.forcedDisconnectDelay]),(0,a.useEffect)((()=>{if(i){const e=window.setInterval((()=>{r((e=>Math.max(0,e-1)))}),1e3);return()=>{window.clearInterval(e)}}}),[i]),i?(0,f.jsxs)(be.Ay,{show:!0,onHide:()=>{},className:"lock-editor-modal",backdrop:!1,keyboard:!1,children:[(0,f.jsx)(be.IK,{children:(0,f.jsx)(be.rA,{children:t("please_wait")})}),(0,f.jsx)(be.$8,{children:t("were_performing_maintenance",{seconds:n})})]}):null}const Rt=(0,a.memo)(Tt),Lt=()=>{const{t:e}=(0,d.Bd)();return(0,f.jsx)(p.A,{type:"warning",content:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("strong",{children:e("connection_lost_with_unsaved_changes")})," ",e("dont_reload_or_close_this_tab")," ",e("your_changes_will_save")]})})};var Pt=n(89997);const It=e=>{let{unsavedDocs:t}=e;return(0,f.jsx)(f.Fragment,{children:[...t.entries()].map((e=>{let[t,n]=e;return n>=15&&(0,f.jsx)(Dt,{docId:t,seconds:n},t)}))})},Dt=e=>{let{docId:t,seconds:n}=e;const{pathInFolder:r,findEntityByPath:i}=(0,Pt.m8)(),{socket:s}=(0,g.FX)(),{t:o}=(0,d.Bd)(),l=(0,a.useRef)(!1);(0,a.useEffect)((()=>{l.current||(l.current=!0,(0,N._)("unsaved-doc-alert-shown",{docId:t,transport:s.socket.transport?.name}))}),[t,s]);const c=(0,a.useMemo)((()=>{const e=r(t);return e?i(e):null}),[t,i,r]);return c?(0,f.jsx)(p.A,{type:"warning",content:o("saving_notification_with_seconds",{docname:c.entity.name,seconds:n})}):null},Ot=()=>{const{openDocs:e,debugTimers:t}=(0,S.TS)(),{permissionsLevel:n,setPermissionsLevel:r}=(0,fe.mi)(),[i,s]=(0,a.useState)(!1),[o,l]=(0,a.useState)(new Map),c=(0,_.J)(),d=(0,a.useRef)(o),u=(0,a.useRef)(n);(0,a.useEffect)((()=>{u.current=n}),[n]),(0,V.A)("beforeunload",(0,a.useCallback)((t=>{e.hasUnsavedChanges()&&t.preventDefault()}),[e])),(0,a.useEffect)((()=>{const n=window.setInterval((()=>{t.current.CheckUnsavedDocs=Date.now();const n=new Map,r=e.unsavedDocs();for(const e of r){const t=e.getInflightOpCreatedAt()??e.getPendingOpCreatedAt();if(t){const r=Math.floor((performance.now()-t)/1e3);n.set(e.doc_id,r)}}(n.size>0||d.current.size>0)&&(d.current=n,l(n))}),1e3);return()=>{window.clearInterval(n)}}),[e,t]);const p=Math.max(0,...o.values());(0,a.useEffect)((()=>{s(p>30)}),[p]);const m=(0,a.useRef)(null);return(0,a.useEffect)((()=>{i?(m.current=u.current,r("readOnly"),s(!0)):m.current&&r(m.current)}),[i,r]),(0,a.useEffect)((()=>{0===o.size&&"readOnly"===u.current&&s(!1)}),[o]),c?(0,f.jsxs)(f.Fragment,{children:[i&&(0,j.createPortal)((0,f.jsx)(Lt,{}),c),o.size>0&&(0,j.createPortal)((0,f.jsx)(It,{unsavedDocs:o}),c)]}):null};var Bt=n(37318),Mt=n(79953),$t=n(84826);const zt=()=>{const{t:e}=(0,d.Bd)(),{showSwitcherModal:t,setShowSwitcherModal:n}=(0,ae.vO)(),r=(0,a.useCallback)((()=>n(!1)),[n]),{loading:i,error:s,setEditorRedesignStatus:o}=(0,$t.Z)(),l=(0,oe.G)();if(!(0,oe.x)())return null;const c=l?qt:Vt;return(0,f.jsxs)(be.Ay,{show:t,onHide:r,className:"ide-redesign-switcher-modal",children:[(0,f.jsx)(be.IK,{closeButton:!0,children:(0,f.jsx)(be.rA,{children:e("the_new_overleaf_editor")})}),s&&(0,f.jsx)(Mt.A,{type:"error",content:s,isDismissible:!0}),(0,f.jsx)(c,{setEditorRedesignStatus:o,hide:r,loading:i})]})},qt=e=>{let{setEditorRedesignStatus:t,hide:n,loading:r}=e;const{t:i}=(0,d.Bd)(),s=(0,a.useCallback)((()=>{t(!1).then(n).catch((()=>{}))}),[t,n]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(be.$8,{children:[(0,f.jsx)("h3",{children:i("youre_helping_us_shape_the_future_of_overleaf")}),(0,f.jsx)("p",{children:i("thanks_for_being_part_of_this_labs_experiment_your_feedback_will_help_us_make_the_new_editor_the_best_yet")}),(0,f.jsx)(Ut,{}),(0,f.jsx)(Ht,{})]}),(0,f.jsxs)(be.E9,{children:[(0,f.jsx)(m.A,{onClick:s,variant:"secondary",className:"me-auto",disabled:r,children:i("switch_to_old_editor")}),(0,f.jsx)(m.A,{onClick:n,variant:"secondary",children:i("cancel")}),(0,f.jsx)(m.A,{href:"https://forms.gle/soyVStc5qDx9na1Z6",target:"_blank",rel:"noopener noreferrer",variant:"primary",children:i("give_feedback")})]})]})},Vt=e=>{let{setEditorRedesignStatus:t,hide:n,loading:r}=e;const{t:i}=(0,d.Bd)(),s=(0,a.useCallback)((()=>{t(!0).then(n).catch((()=>{}))}),[t,n]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(be.$8,{children:[(0,f.jsx)("h3",{children:i("help_shape_the_future_of_overleaf")}),(0,f.jsx)("p",{children:i("were_redesigning_our_editor_to_make_it_easier_to_use")}),(0,f.jsx)(Ut,{}),(0,f.jsx)(Ht,{})]}),(0,f.jsxs)(be.E9,{children:[(0,f.jsx)(m.A,{onClick:n,variant:"secondary",children:i("cancel")}),(0,f.jsx)(m.A,{onClick:s,variant:"primary",disabled:r,children:i("switch_to_new_editor")})]})]})},Ut=()=>{const{t:e}=(0,d.Bd)();return(0,f.jsxs)("div",{className:"ide-redesign-switcher-modal-whats-new",children:[(0,f.jsx)("h4",{children:e("latest_updates")}),(0,f.jsx)("ul",{children:(0,f.jsx)("li",{children:e("double_clicking_on_the_pdf_shows")})}),(0,f.jsx)("hr",{}),(0,f.jsx)("h4",{children:e("whats_different_in_the_new_editor")}),(0,f.jsxs)("ul",{children:[(0,f.jsx)("li",{children:e("new_look_and_feel")}),(0,f.jsx)("li",{children:e("new_navigation_introducing_left_hand_side_rail_and_top_menus")}),(0,f.jsx)("li",{children:e("new_look_and_placement_of_the_settings")}),(0,f.jsx)("li",{children:e("improved_dark_mode")}),(0,f.jsx)("li",{children:e("review_panel_and_error_logs_moved_to_the_left")})]})]})},Ht=()=>(0,f.jsx)("p",{className:"ide-redesign-switcher-modal-leave-text",children:(0,f.jsx)(d.x6,{i18nKey:"you_can_leave_the_experiment_from_your_account_settings_at_any_time",components:[(0,f.jsx)("a",{href:"/user/settings"})],shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})}),Gt=(0,a.memo)((()=>(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Rt,{}),(0,f.jsx)(Ot,{}),(0,f.jsx)(Bt.A,{}),(0,f.jsx)(zt,{})]})));Gt.displayName="Modals";n(50020);const Kt=e=>{let{data:t}=e;const{t:n}=(0,d.Bd)();return t?.filePath||t.providerName?t?.filePath?t.providerName?(0,f.jsx)("span",{children:(0,f.jsx)(d.x6,{i18nKey:"a_new_reference_was_added_to_file_from_provider",shouldUnescape:!0,values:{filePath:t.filePath,provider:t.providerName},tOptions:{interpolation:{escapeValue:!0}},components:[(0,f.jsx)("strong",{})]})}):(0,f.jsx)("span",{children:(0,f.jsx)(d.x6,{i18nKey:"a_new_reference_was_added_to_file",shouldUnescape:!0,values:{filePath:t.filePath},tOptions:{interpolation:{escapeValue:!0}},components:[(0,f.jsx)("strong",{})]})}):(0,f.jsx)("span",{children:n("a_new_reference_was_added_from_provider",{provider:t.providerName})}):(0,f.jsx)("span",{children:n("a_new_reference_was_added")})},Yt=[{key:"write-and-cite:entry-added",generator:e=>({content:(0,f.jsx)(Kt,{data:e}),type:"success",autoHide:!0,delay:4e3,isDismissible:!0})}];var Wt=n(14875),Qt=n(93657);const Xt=e=>{let{type:t="info",className:n="",content:r,title:i,isDismissible:s,onDismiss:o,autoHide:l,delay:c}=e;const{t:u}=(0,d.Bd)(),[p,m]=(0,a.useState)(!0),h=k()("notification",`notification-type-${t}`,n,"toast-content"),g=(0,a.useCallback)((()=>{m(!1)}),[]),x=(0,a.useCallback)((()=>{o&&o()}),[o]),j=(0,f.jsxs)("div",{className:h,children:[(0,f.jsx)(Mt.H,{notificationType:t}),(0,f.jsx)("div",{className:"notification-content-and-cta",children:(0,f.jsxs)("div",{className:"notification-content",children:[i&&(0,f.jsx)("p",{children:(0,f.jsx)("b",{children:i})}),r]})}),s&&(0,f.jsx)("div",{className:"notification-close-btn",children:(0,f.jsx)("button",{"aria-label":u("close"),"data-bs-dismiss":"toast",onClick:g,children:(0,f.jsx)(F.A,{type:"close"})})})]});return(0,f.jsx)(Qt.A,{onClose:g,autohide:l,onExited:x,delay:c,show:p,children:j})};var Zt=n(78640);const Jt=e=>{let{children:t,className:n,style:r}=e;return(0,f.jsx)(Zt.A,{className:n,style:r,children:t})},en=[{import:s,path:"/overleaf/services/web/modules/references-search/frontend/js/toasts"},{import:Wt,path:"/overleaf/services/web/frontend/js/features/pdf-preview/components/synctex-toasts"}].map((e=>{let{import:{default:t}}=e;return t})).flat(),tn=new Map(en.map((e=>{let{key:t,generator:n}=e;return[t,n]})));let nn=1;const rn=()=>{const[e,t]=(0,a.useState)([]),n=(0,a.useCallback)((e=>{t((t=>t.filter((t=>t.id!==e))))}),[]),r=(0,a.useCallback)(((e,t,r)=>{const i=tn.get(t);if(!i)return x.$.error("No toast generator found for key:",t),null;const s=i(r);return s.autoHide||s.isDismissible||(s.isDismissible=!0),s.autoHide&&!s.isDismissible&&void 0!==s.delay&&(s.delay=Math.min(s.delay,6e4)),(0,f.jsx)(Xt,{...s,onDismiss:()=>n(e)})}),[n]),i=(0,a.useCallback)(((e,n)=>{const i="toast-"+nn++,s=r(i,e,n);s&&t((e=>[...e,{id:i,component:s}]))}),[r]),s=(0,a.useCallback)((e=>{if(!e.detail?.key)return void x.$.error("No key provided for toast");const{key:t,...n}=e.detail;i(t,n)}),[i]);return(0,V.A)("ide:show-toast",s),(0,f.jsx)(Jt,{className:"global-toasts",children:e.map((e=>{let{component:t,id:n}=e;return(0,f.jsx)(a.Fragment,{children:t},n)}))})};var sn=n(1705),on=n(63003),an=n(12327),ln=n(24639),cn=n(35447);function dn(){return(0,f.jsx)(Jt,{className:"editor-survey-toast",children:(0,f.jsx)(pn,{})})}const un="editor-popup-ux-survey",pn=()=>{const[e,t]=(0,a.useState)(null),[n,r]=(0,a.useState)(null),[i,s]=(0,a.useState)("ease-of-use"),{inactiveTutorials:o}=(0,fe.mi)(),l=o.includes(un),c=(0,oe.G)(),{t:u}=(0,d.Bd)(),{tryShowingPopup:p,showPopup:m,dismissTutorial:h,completeTutorial:g}=(0,cn.A)(un,{name:un});(0,a.useEffect)((()=>{l||p()}),[l,p]);const x=(0,a.useCallback)((()=>{(0,N._)("editor-survey-submit",{easeOfUse:e,meetsMyNeeds:n,newEditor:c}),s("thank-you"),g({event:"promo-click",action:"complete"})}),[e,n,g,c]);return m||"thank-you"===i?"ease-of-use"===i?(0,f.jsx)(Xt,{className:"editor-survey-question-toast",content:(0,f.jsx)(mn,{questionText:u("overleaf_is_easy_to_use"),name:"ease-of-use",buttonText:u("next"),onButtonClick:()=>s("meets-my-needs"),value:e,onValueChange:t,onDismiss:h}),type:"info"}):"meets-my-needs"===i?(0,f.jsx)(Xt,{className:"editor-survey-question-toast",content:(0,f.jsx)(mn,{questionText:u("overleafs_functionality_meets_my_needs"),name:"meets-my-needs",buttonText:u("submit_title"),onButtonClick:x,value:n,onValueChange:r,onDismiss:h}),type:"info"}):(0,f.jsx)(Xt,{type:"info",content:u("thank_you"),autoHide:!0,delay:3e3}):null},mn=e=>{let{onDismiss:t,name:n,questionText:r,buttonText:i,onButtonClick:s,value:o,onValueChange:l}=e;const{t:c}=(0,d.Bd)(),u=(0,a.useMemo)((()=>[{value:1,description:c("strongly_disagree")},{value:2,description:c("disagree")},{value:3,description:c("neither_agree_nor_disagree")},{value:4,description:c("agree")},{value:5,description:c("strongly_agree")}]),[c]),p=(0,a.useCallback)((e=>{const t=e.target.value;t&&l(Number(t))}),[l]);return(0,f.jsxs)("div",{className:"editor-survey-question",children:[(0,f.jsxs)("div",{className:"editor-survey-question-top-line",children:[(0,f.jsx)("div",{children:c("your_feedback_matters_answer_two_quick_questions")}),(0,f.jsx)(ln.A,{variant:"ghost",size:"sm",icon:"close",accessibilityLabel:c("close"),onClick:t})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"editor-survey-question-label",htmlFor:n,children:r}),(0,f.jsx)(sn.A,{className:"editor-survey-question-form",children:(0,f.jsx)(an.A,{className:"editor-survey-question-options",children:u.map((e=>{let{value:t,description:r}=e;return(0,f.jsx)(on.A,{name:n,type:"radio",value:t,id:t.toString(),label:t,checked:t===o,onChange:p,"aria-label":`${t} ${r}`},t)}))})}),(0,f.jsxs)("div",{className:"editor-survey-option-labels",children:[(0,f.jsx)("div",{children:c("strongly_disagree")}),(0,f.jsx)("div",{children:c("strongly_agree")})]})]}),(0,f.jsx)(m.A,{size:"sm",variant:"secondary",onClick:s,disabled:!o,children:i})]})};var fn=n(17112);const hn=(0,a.lazy)((()=>Promise.all([n.e(4686),n.e(4695),n.e(9673),n.e(6623),n.e(6002),n.e(1601)]).then(n.bind(n,71601)))),gn=(0,a.lazy)((()=>Promise.all([n.e(8947),n.e(481)]).then(n.bind(n,10481))));function xn(){!function(){const{view:e,leftMenuShown:t,chatIsOpen:n}=(0,A.LV)();(0,a.useEffect)((()=>{e&&"editor"!==e&&"pdf"!==e&&(0,N.JY)(`ide-open-view-${e}-once`)}),[e]),(0,a.useEffect)((()=>{t&&(0,N.JY)("ide-open-left-menu-once")}),[t]),(0,a.useEffect)((()=>{n&&(0,N.JY)("ide-open-chat-once")}),[n])}(),Et(),Nt(),function(){const{registerUserActivity:e}=(0,g.FX)();(0,V.A)("cursor:editor:update",e),St(document.body,"click",e)}(),function useHasLintingError(){const{setHasLintingError:e}=(0,Ft.tB)();(0,V.A)("editor:lint",(0,a.useCallback)((t=>{e(t.detail.hasLintingError)}),[e]))}();const e=(0,oe.G)(),t=(0,oe.x)(),n=(0,fn.u)("editor-popup-ux-survey")&&!t;return(0,f.jsxs)(_.a,{children:[(0,f.jsx)(v,{}),(0,f.jsx)(Gt,{}),e?(0,f.jsxs)(a.Suspense,{fallback:null,children:[(0,f.jsx)(gn,{}),(0,f.jsx)(hn,{})]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(bt,{}),(0,f.jsx)(mt,{})]}),(0,f.jsx)(rn,{}),n&&(0,f.jsx)(dn,{})]})}var jn=n(10228),_n=(n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539),n(80997)),vn=n(27602);const bn={"io-not-loaded":"ol-translationIoNotLoaded","unable-to-join":"ol-translationUnableToJoin","i18n-error":"ol-translationLoadErrorMessage"},LoadingError=e=>{let{errorCode:t}=e;return t in bn?(0,f.jsx)("p",{className:"loading-screen-error",children:(0,ie.A)(bn[t])}):null},yn=new Set(["initial"]),Cn=new Set(["initial","render","connection","translations","project"]),wn=e=>{let{setLoaded:t}=e;const[n,r]=(0,a.useState)(yn),i=n.size/Cn.size*100;(0,a.useEffect)((()=>{t(100===i)}),[i,t]);const{connectionState:s,isConnected:o}=(0,g.FX)(),l=(0,vn.A)(),{projectJoined:c}=(0,wt.yn)();(0,a.useEffect)((()=>{r((e=>new Set(e).add("render")))}),[]),(0,a.useEffect)((()=>{o&&r((e=>new Set(e).add("connection")))}),[o]),(0,a.useEffect)((()=>{l.isReady&&r((e=>new Set(e).add("translations")))}),[l.isReady]),(0,a.useEffect)((()=>{c&&r((e=>new Set(e).add("project")))}),[c]);const d=(0,ie.A)("ol-loadingText"),u=s.error??(l.error?"i18n-error":"");return(0,f.jsx)(kn,{progress:i,label:d,errorCode:u})},kn=e=>{let{progress:t,label:n,errorCode:r}=e;return(0,f.jsxs)("div",{className:"loading-screen",children:[(0,f.jsx)(_n.A,{loadProgress:t,label:n,hasError:Boolean(r)}),Boolean(r)&&(0,f.jsx)(LoadingError,{errorCode:r})]})},An=()=>{const[e,t]=(0,a.useState)(!1);return(0,f.jsx)(jn.F,{children:e?(0,f.jsx)(xn,{}):(0,f.jsx)(wn,{setLoaded:t})})},En=(0,c.A)((0,a.memo)(An),(()=>(0,f.jsx)(l.s,{}))),Sn=document.getElementById("ide-root");if(Sn){(0,o.H)(Sn).render((0,f.jsx)(En,{}))}try{if(document.body.parentElement&&document.body.parentElement?.clientHeight<document.body.clientHeight){const e=document.querySelector("#ide-root");e&&(e.style.height="100vh")}}catch{}},21923:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(14041),i=n(45250),s=n.n(i),o=n(31085);const a=function(e){let{atEnd:t,children:n,className:i="",fetchData:a,itemCount:l,isLoading:c}=e;const d=(0,r.useRef)(null),u=(0,r.useRef)(0);function p(){d.current&&(d.current.scrollTop=d.current.scrollHeight-d.current.clientHeight-u.current)}return(0,r.useLayoutEffect)(p,[l]),(0,r.useEffect)((()=>{const e=s().debounce(p,400);return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,o.jsx)("div",{ref:d,onScroll:function(e){if(d.current){if(n=d.current.scrollHeight-d.current.scrollTop-d.current.clientHeight,u.current=n,e.target!==e.currentTarget)return;(function(){if(!d.current)return!1;const e=d.current.children[0].clientHeight<d.current.clientHeight;return!(t||c||e)&&d.current.scrollTop<30})()&&a()}var n},className:`infinite-scroll ${i}`,children:n})}},21947:(e,t,n)=>{n.d(t,{$2:()=>c,E9:()=>u,ee:()=>a,hN:()=>d,l_:()=>o,ob:()=>l,qI:()=>p});var r=n(29587),i=n(97900),s=(n(47200),n(83290));const o=(e,t,n,r)=>{if(t.type.is("EnvNameGroup")){if(!r(t.node))return!1;if(!t.node.prevSibling?.type.is("Begin"))return!1;const i=t.node.getChild("OpenBrace");if(!i)return!1;const s=i.node.nextSibling;if(!s)return!1;const o=e.doc.sliceString(s.from,s.to);if(o.length<1)return!1;const a={title:o,from:s.from,to:s.to,line:e.doc.lineAt(s.from).number,type:"usage",raw:e.sliceDoc(t.from,t.to)};n.push(a)}else if(t.type.is("NewEnvironment")||t.type.is("RenewEnvironment")){if(!r(t.node))return!1;const i=t.node.getChild("LiteralArgContent");if(!i)return;const s=e.doc.sliceString(i.from,i.to);if(!s)return;const o={title:s,from:i.from,to:i.to,line:e.doc.lineAt(i.from).number,type:"definition",raw:e.sliceDoc(t.from,t.to)};n.push(o)}},a=(e,t)=>{const n=(0,r.a_)(e,t,100);if(!n)return;let s=n.resolve(t);if(s){if(s.type.is("EnvNameGroup")&&(0,i.I8)(e,t,"Begin"))return!0;if(s.type.is("$Environment")||s.type.is("LaTeX")&&t===e.doc.length){if(s=n.resolve(t,-1),!s)return;if(s.type.is("OpenBrace")||s.type.is("$EnvName"))return!0}}},l=(e,t)=>{const n=(0,r.a_)(e,t,100);if(!n)return;let s=n.resolve(t);if(s){if(s.type.is("EnvNameGroup")&&(0,i.I8)(e,t,"End"))return!0;if(s.type.is("$Environment")||s.type.is("Content")){if(s=n.resolve(t,-1),!s)return;if(s.type.is("OpenBrace")||s.type.is("EnvName"))return!0}}};function c(e,t){if(e?.type.is("$Environment")&&(e=e.getChild("BeginEnv")),!e?.type.is("BeginEnv")&&!e?.type.is("EndEnv"))return null;const n=e?.getChild("EnvNameGroup")?.getChild("OpenBrace")?.nextSibling;return n?n.type.is("CloseBrace")?null:t.sliceDoc(n.from,n.to):null}const d=(e,t)=>c(e,t)?.replace(/\*$/,"");function u(e){return e.getChild("BeginEnv")?.getChildren("TextArgument")}function p(e,t){let n,r,i,o,a=null,l=null,c=null;const d=e.from,u=e.to;let p=!1;return e.cursor().iterate((e=>{if(p)return!1;if(e.type.is("Caption")){if(a)return p=!0,!1;a={from:e.from,to:e.to}}if(e.type.is("Label")){if(l)return p=!0,!1;l={from:e.from,to:e.to}}if(e.type.is("IncludeGraphics")){if(n)return p=!0,!1;o={from:e.from,to:e.to};const s=e.node.getChild("IncludeGraphicsArgument")?.getChild("FilePathArgument")?.getChild("LiteralArgContent");if(!s)return p=!0,!1;n={from:s.from,to:s.to,path:t.sliceDoc(s.from,s.to)};const a=e.node.getChild("OptionalArgument")?.getChild("ShortOptionalArg");if(!a)return r=void 0,!1;c={from:a.from,to:a.to};const l=t.sliceDoc(a.from,a.to),d=l.match(/^width=([0-9]|(?:[0-9]*\.[0-9]+)|(?:[0-9]+\.))\\(linewidth|pagewidth|textwidth|hsize|columnwidth)$/);d?(r=parseFloat(d[1]),"linewidth"!==d[2]&&(i=l)):i=l}})),p||void 0===o||void 0===n?null:new s.Nw({caption:a,label:l,file:n,from:d,to:u,width:r,unknownGraphicsArguments:i,graphicsCommand:o,graphicsCommandArguments:c})}},23823:(e,t,n)=>{n.d(t,{A:()=>i,o:()=>r});const r=e=>{let t=e.split(".").pop();return t=t?t.toLowerCase():t,t&&["png","pdf","jpg","jpeg","gif"].includes(t)?"image":t&&["csv","xls","xlsx"].includes(t)?"table_chart":t&&["py","r"].includes(t)?"code":t&&["bib"].includes(t)?"book_5":"description"};function i(e){let t=e.split(".").pop();return t=t?t.toLowerCase():t,t&&["png","pdf","jpg","jpeg","gif"].includes(t)?"image":t&&["csv","xls","xlsx"].includes(t)?"table_chart":t&&["py","r"].includes(t)?"code":t&&["bib"].includes(t)?"menu_book":"description"}},24639:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(14041),i=n(10800),s=n(31085);const o=(0,r.forwardRef)(((e,t)=>(0,s.jsx)(i.A,{...e,ref:t})));o.displayName="OLIconButton";const a=o},27916:(e,t,n)=>{n.d(t,{Lc:()=>DuplicateFilenameError,di:()=>InvalidFilenameError,ui:()=>DuplicateFilenameMoveError,yG:()=>BlockedFilenameError});n(97107);class InvalidFilenameError extends Error{constructor(){super("invalid filename")}}class BlockedFilenameError extends Error{constructor(){super("blocked filename")}}class DuplicateFilenameError extends Error{constructor(){super("duplicate filename")}}class DuplicateFilenameMoveError extends Error{constructor(){super("duplicate filename on move")}}},30158:(e,t,n)=>{n.d(t,{A:()=>C,h:()=>y});n(97107),n(82438),n(12266),n(34840);var r=n(14041),i=n(97434),s=n(10646),o=n(90214),a=n(88342),l=n(28812),c=n(22046),d=n(71627),u=n(237),p=n(31085);const m=(0,r.lazy)((()=>n.e(4903).then(n.bind(n,64903)).then((e=>{let{ReadOnlyTokenLink:t}=e;return{default:t}})))),f=(0,r.lazy)((()=>Promise.all([n.e(9777),n.e(330)]).then(n.bind(n,9030))));function h(e){let{show:t,cancel:n,animation:h,inFlight:x,error:j}=e;const{t:_}=(0,i.Bd)(),{isRestrictedTokenMember:v}=(0,s.mi)();return(0,p.jsxs)(l.Ay,{show:t,onHide:n,animation:h,children:[(0,p.jsx)(l.IK,{closeButton:!0,children:(0,p.jsx)(l.rA,{children:_("share_project")})}),(0,p.jsx)(l.$8,{className:"modal-body-share modal-link-share",children:(0,p.jsxs)("div",{className:"container-fluid",children:[(0,p.jsx)(r.Suspense,{fallback:(0,p.jsx)(o.e,{minHeight:"15rem"}),children:v?(0,p.jsx)(m,{}):(0,p.jsx)(f,{})}),j&&(0,p.jsx)(c.A,{type:"error",content:(0,p.jsx)(g,{error:j}),className:"mb-0 mt-3"})]})}),(0,p.jsxs)(l.E9,{children:[(0,p.jsx)("div",{className:"me-auto",children:x&&(0,p.jsx)(u.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})}),(0,p.jsx)(a.A,{onClick:n,as:d.A,variant:"secondary",disabled:x,children:_("close")})]})]})}function g(e){let{error:t}=e;const{t:n}=(0,i.Bd)();switch(t){case"cannot_invite_non_user":return(0,p.jsx)(p.Fragment,{children:n("cannot_invite_non_user")});case"cannot_verify_user_not_robot":return(0,p.jsx)(p.Fragment,{children:n("cannot_verify_user_not_robot")});case"cannot_invite_self":return(0,p.jsx)(p.Fragment,{children:n("cannot_invite_self")});case"invalid_email":return(0,p.jsx)(p.Fragment,{children:n("invalid_email")});case"too_many_requests":return(0,p.jsx)(p.Fragment,{children:n("too_many_requests")});case"invite_expired":return(0,p.jsx)(p.Fragment,{children:n("invite_expired")});case"invite_resend_limit_hit":return(0,p.jsx)(p.Fragment,{children:n("invite_resend_limit_hit")});default:return(0,p.jsx)(p.Fragment,{children:n("generic_something_went_wrong")})}}var x=n(86316),j=n(17112),_=n(69954),v=n(37664);const b=(0,r.createContext)(void 0);function y(){const e=(0,r.useContext)(b);if(!e)throw new Error("useShareProjectContext is only available inside ShareProjectProvider");return e}const C=r.memo((function(e){let{handleHide:t,show:n,handleOpen:i,animation:o=!0}=e;const[a,l]=(0,r.useState)(!1),[c,d]=(0,r.useState)(),u=(0,x.O)(),{isProjectOwner:m}=(0,s.mi)(),{splitTestVariants:f}=(0,j.d1)();(0,r.useEffect)((()=>{if(!(!m||!u.features)&&-1!==u.features.collaborators&&(u.members.filter((e=>["readAndWrite","review"].includes(e.privileges))).length>(u.features.collaborators??1)||u.members.some((e=>e.pendingEditor||e.pendingReviewer)))){const e=`last-shown-share-modal.${u._id}`,t=v.A.getItem(e);(!t||t+864e5<Date.now())&&(i(),v.A.setItem(e,Date.now()))}}),[u,m,i]),(0,r.useEffect)((()=>{n&&(0,_._)("share-modal-opened",{splitTestVariant:f["null-test-share-modal"],project_id:u._id})}),[f,u._id,n]),(0,r.useEffect)((()=>{n&&d(void 0)}),[n]);const g=(0,r.useCallback)((()=>{a||t()}),[t,a]),y=(0,r.useCallback)((e=>{d(void 0),l(!0);const t=e();return t.catch((e=>{d(e.data?.errorReason||e.data?.error||"generic_something_went_wrong")})),t.finally((()=>{l(!1)})),t}),[]),C=(0,r.useCallback)((e=>Object.assign(u,e)),[u]);return u?(0,p.jsx)(b.Provider,{value:{updateProject:C,monitorRequest:y,inFlight:a,setInFlight:l,error:c,setError:d},children:(0,p.jsx)(h,{animation:o,cancel:g,error:c,inFlight:a,show:n})}):null}))},30789:(e,t,n)=>{n.d(t,{e:()=>i});var r=n(29587);const i=[r.t$.of({name:"latex",extensions:["tex","sty","cls","clo","bst","bbl","pdf_tex","pdf_t","map","fd","enc","def","mf","pgf","tikz","bbx","cbx","dbx","lbx","lco","ldf","xmpdata","Rnw","rnw","lyx","inc","dtx","hak","eps_tex","brf","ins","hva","Rtex","rtex","pstex","pstex_t","gin","fontspec","pygstyle","pygtex","ps_tex","ltx"],load:()=>Promise.all([n.e(4695),n.e(5982),n.e(6623),n.e(188),n.e(3015),n.e(7685)]).then(n.bind(n,63655)).then((e=>e.latex()))}),r.t$.of({name:"bibtex",extensions:["bib"],load:()=>Promise.all([n.e(4695),n.e(5982),n.e(2279)]).then(n.bind(n,9065)).then((e=>e.bibtex()))}),r.t$.of({name:"markdown",extensions:["md","markdown"],load:()=>Promise.all([n.e(4695),n.e(2348),n.e(188),n.e(7751)]).then(n.bind(n,14075)).then((e=>e.markdown()))})]},31352:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(61160),i=n(85886),s=n(31085);const o=function(e){return(0,s.jsx)(i.A,{children:(0,s.jsx)(r.tJ,{...e})})}},31622:(e,t,n)=>{n.d(t,{kn:()=>h,hu:()=>f,ee:()=>u,$S:()=>l,eb:()=>c,kw:()=>a,u6:()=>m,mI:()=>p,ON:()=>d});var r=n(37858);let i,s;var o=n(64932);function a(e,t,n){return function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(((t,n)=>{if(e||!window.grecaptcha)return t();try{i||(i=window.grecaptcha.render("recaptcha",{callback:e=>{s&&(s(e),s=void 0),window.grecaptcha.reset()}})),s=t}catch(e){n(e)}}))}((0,o.A)("ol-ExposedSettings").recaptchaDisabled?.invite).then((i=>(0,r.TB)(`/project/${e}/invite`,{body:{email:t,privileges:n,"g-recaptcha-response":i}})))}function l(e,t){return(0,r.TB)(`/project/${e}/invite/${t._id}/resend`)}function c(e,t){return(0,r.Un)(`/project/${e}/invite/${t._id}`)}function d(e,t,n){return(0,r.mI)(`/project/${e}/users/${t._id}`,{body:n})}function u(e,t){return(0,r.Un)(`/project/${e}/users/${t._id}`)}function p(e,t){return(0,r.TB)(`/project/${e}/transfer-ownership`,{body:{user_id:t._id}})}function m(e,t){return(0,r.TB)(`/project/${e}/settings/admin`,{body:{publicAccessLevel:t}})}function f(e){return(0,r.hm)(`/project/${e}/members`)}function h(e){return(0,r.hm)(`/project/${e}/invites`)}},35545:(e,t,n)=>{n.d(t,{A:()=>r});n(82438),n(50020);function r(e){return(e||[]).map((e=>r(e.children).concat(e.line))).flat()}},36266:(e,t,n)=>{n.d(t,{s:()=>c});var r=n(97434),i=n(89753),s=n(29295),o=n(96713),a=n(71627),l=n(31085);const c=e=>{let{children:t}=e;const{t:n}=(0,r.Bd)(),{reload:c}=(0,i.z)();return(0,l.jsxs)("div",{className:"error-boundary-container",children:[(0,l.jsx)(o.A,{accessibilityLabel:`${n("generic_something_went_wrong")} ${n("please_refresh")}`,type:"warning",size:"2x"}),t||(0,l.jsx)("div",{className:"error-message",children:(0,l.jsx)(s.f,{className:"small",style:{fontWeight:"bold"}})}),(0,l.jsx)(a.A,{variant:"primary",onClick:c,children:n("refresh")})]})}},36471:(e,t,n)=>{n.d(t,{J:()=>a,a:()=>o});n(97107);var r=n(14041),i=n(31085);const s=(0,r.createContext)(void 0),o=e=>{let{children:t}=e;const[n,o]=(0,r.useState)(null),a=(0,r.useCallback)((e=>{o(e)}),[]);return(0,i.jsxs)(s.Provider,{value:n,children:[(0,i.jsx)("div",{className:"global-alerts",ref:a}),t]})},a=()=>{const e=(0,r.useContext)(s);if(void 0===e)throw new Error("useGlobalAlertsContainer is only available inside GlobalAlertsProvider");return e}},37e3:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(14041),i=n(90274);const s={status:"idle",data:null,error:null};const o=function(e){const t=r.useRef({...s,...e}),[{status:n,data:o,error:a},l]=r.useReducer(((e,t)=>({...e,...t})),t.current),c=(0,i.A)(l),d=r.useCallback((e=>c({data:e,status:"resolved"})),[c]),u=r.useCallback((e=>c({error:e,status:"rejected"})),[c]),p=r.useCallback((()=>c(t.current)),[c]),m=r.useCallback((e=>(c({status:"pending"}),e.then((e=>(d(e),e)),(e=>(u(e),Promise.reject(e)))))),[c,d,u]);return{isIdle:"idle"===n,isLoading:"pending"===n,isError:"rejected"===n,isSuccess:"resolved"===n,setData:d,setError:u,error:a,status:n,data:o,runAsync:m,reset:p}}},37318:(e,t,n)=>{n.d(t,{A:()=>f});n(82438),n(50020);var r=n(14041),i=n(75962),s=n(42093),o=n(31085);const a=function(e){let{id:t,children:n}=e;const[r,a]=(0,s.A)(`systemMessage.hide.${t}`,!1);return r?null:(0,o.jsxs)("li",{className:"system-message",children:["protected"!==t?(0,o.jsx)(i.A,{onDismiss:()=>a(!0),variant:"dark"}):null,n]})};var l=n(97434),c=n(64932);const d=function(){const{t:e}=(0,l.Bd)(),[t,n]=(0,s.A)("hide-i18n-notification",!1),r=(0,c.A)("ol-suggestedLanguage"),a=(0,c.A)("ol-currentUrl");return t?null:(0,o.jsxs)("li",{className:"system-message",children:[(0,o.jsx)(i.A,{onDismiss:()=>n(!0)}),(0,o.jsx)("div",{className:"text-center",children:(0,o.jsxs)("a",{href:r.url+a,children:[(0,o.jsx)(l.x6,{i18nKey:"click_here_to_view_sl_in_lng",components:[(0,o.jsx)("strong",{})],values:{lngName:r.lngName},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}}),(0,o.jsx)("img",{className:"ms-1",src:r.imgUrl,alt:e("country_flag",{country:r.lngName}),"aria-hidden":!0})]})})]})};var u=n(37e3),p=n(37858),m=n(60961);const f=function(){const{data:e,runAsync:t}=(0,u.A)(),n=(0,c.A)("ol-suggestedLanguage");return(0,r.useEffect)((()=>{const e=()=>{!document.hidden&&navigator.onLine&&t((0,p.hm)("/system/messages")).catch(m.$.error)};e();const n=setInterval(e,9e5);return()=>{clearInterval(n)}}),[t]),e?.length||n?(0,o.jsxs)("ul",{className:"system-messages",children:[e?.map(((e,t)=>(0,o.jsx)(a,{id:e._id,children:e.content},t))),n?(0,o.jsx)(d,{}):null]}):null}},38188:(e,t,n)=>{n.d(t,{B8:()=>c,BH:()=>m,HT:()=>u,TY:()=>g,Tm:()=>l,_X:()=>j,jC:()=>_,kq:()=>x,xC:()=>h});var r=n(57195),i=n(30789),s=n(83173),o=n(29587),a=n(45197);const l=r.Pe.define(),c=(0,a.v)(l),d=new r.xx,u=r.sU.define({create:()=>{},update:(e,t)=>{for(const e of t.effects)if(e.is(g))return e.value;return e}}),p=new r.xx,m=(e,t,n)=>{let{syntaxValidation:r}=n;return p.of(f(e,t,r))},f=(e,t,n)=>{const r=o.t$.matchFilename(i.e,e);return r?[d.of(o.Xt.of("    ")),u,s.Z9.define((e=>(r.load().then((r=>{e.dispatch({effects:[d.reconfigure(r),l.of(null)]}),e.dispatch({effects:[g.of(t),j.of(n)]})})),{}))),u]:[]},h=(e,t,n)=>({effects:p.reconfigure(f(e,t,n))}),g=r.Pe.define(),x=e=>({effects:g.of(e)}),j=r.Pe.define(),_=e=>({effects:j.of(e)})},41260:(e,t,n)=>{n.d(t,{R:()=>s});var r=n(90214),i=n(31085);const s=()=>(0,i.jsx)("div",{className:"loading-panel",children:(0,i.jsx)(r.A,{})})},43137:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(97434),i=n(96713),s=n(71627),o=n(31085);const a=function(e){let{onClick:t}=e;const{t:n}=(0,r.Bd)();return(0,o.jsxs)(s.A,{variant:"secondary",size:"sm",onClick:t,className:"back-to-editor-btn",children:[(0,o.jsx)(i.A,{type:"arrow_back",className:"toolbar-btn-secondary-icon"}),(0,o.jsx)("span",{className:"toolbar-label",children:n("back_to_editor")})]})}},43480:(e,t,n)=>{n.d(t,{V:()=>r});const r=(0,n(6468).Y)(new Date(2024,7,26),"MMMM Do")},45197:(e,t,n)=>{n.d(t,{u:()=>r,v:()=>i});n(82438),n(34840);const r=e=>t=>t.effects.some((t=>t.is(e))),i=e=>t=>t.transactions.some((t=>t.effects.some((t=>t.is(e)))))},45524:(e,t,n)=>{n.d(t,{r:()=>l});var r=n(14041),i=n(37858),s=n(45857),o=n(52155);const a=(e,t)=>s.h.compare(e.name,t.name);function l(){const[e,t]=(0,r.useState)(!0),[n,s]=(0,r.useState)(null),[l,c]=(0,r.useState)(!1),{signal:d}=(0,o.A)();return(0,r.useEffect)((()=>{(0,i.hm)("/user/projects",{signal:d}).then((e=>{s(e.projects.sort(a))})).catch((e=>c(e))).finally((()=>t(!1)))}),[d]),{loading:e,data:n,error:l}}},45857:(e,t,n)=>{n.d(t,{h:()=>r});const r=new Intl.Collator("en",{numeric:!0,sensitivity:"variant",caseFirst:"upper"})},47200:(e,t,n)=>{n.d(t,{CN:()=>a,P4:()=>c});n(82438),n(12266),n(50020);var r=n(29587),i=n(79066);const s=20,o=500;let a=function(e){return e[e.Pending=0]="Pending",e[e.Partial=1]="Partial",e[e.Complete=2]="Complete",e}({});const l=(e,t,n,r)=>!(t<n||e>r);function c(e,t,n,c,d){let u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6?arguments[6]:void 0,m=arguments.length>7?arguments[7]:void 0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{items:[],status:a.Pending};const h=f.status===a.Complete?f.items.filter((e=>!l(e.from,e.to,t,n))).map((e=>function(e,t){if(!t)return e;const{from:n,to:r}=e,i=t.changes.mapPos(n),s=t.changes.mapPos(r),o=t.state.doc.lineAt(i).number;return i===n&&s===r&&o===e.line?e:{...e,from:i,to:s,line:o}}(e,m))):[];f.status!==a.Complete&&(d=e.doc.length,c=0);const g=(0,r.a_)(e,d,u?o:s);return g?(g.iterate({from:c,to:d,enter:t=>p(e,t,h,(e=>l(e.from,e.to,c,d))),mode:i.Qj.IgnoreMounts|i.Qj.IgnoreOverlays}),{status:a.Complete,items:h.sort(((e,t)=>e.from-t.from))}):f.status!==a.Pending?{status:a.Partial,items:f.items}:{items:[],status:a.Pending}}},47475:(e,t,n)=>{n.d(t,{A:()=>p});var r=n(97434),i=n(37858),s=n(14041),o=n(86316),a=n(89753);function l(){const{t:e}=(0,r.Bd)(),{_id:t}=(0,o.O)(),[n,i]=(0,s.useState)(10),l=(0,a.z)();return(0,s.useEffect)((()=>{i(10);const e=window.setInterval((()=>{i((n=>0===n?(window.clearInterval(e),l.assign(`/login?redir=/project/${t}`),0):n-1))}),1e3);return()=>{window.clearInterval(e)}}),[t,l]),e("session_expired_redirecting_to_login",{seconds:n})}var c=n(27916),d=n(3518),u=n(31085);function p(e){let{error:t}=e;const{t:n}=(0,r.Bd)();if("string"==typeof t)switch(t){case"name-exists":return(0,u.jsx)(d.A,{children:n("file_already_exists")});case"too-many-files":return(0,u.jsx)(d.A,{children:n("project_has_too_many_files")});case"remote-service-error":return(0,u.jsx)(d.A,{children:n("remote_service_error")});case"folder_not_found":return(0,u.jsx)(d.A,{children:n("the_target_folder_could_not_be_found")});case"invalid_filename":return(0,u.jsx)(d.A,{children:n("invalid_filename",{nameLimit:150})});case"duplicate_file_name":return(0,u.jsx)(d.A,{children:n("file_or_folder_name_already_exists")});case"rate-limit-hit":return(0,u.jsx)(d.A,{children:n("too_many_files_uploaded_throttled_short_period")});case"not-logged-in":return(0,u.jsx)(d.A,{children:(0,u.jsx)(l,{})});case"linked-project-compile-error":return(0,u.jsx)(d.A,{children:n("generic_linked_file_compile_error")});default:return(0,u.jsx)(d.A,{children:n("generic_something_went_wrong")})}switch(t.constructor){case i.fk:{const e=t.data?.message;if(e)return(0,u.jsx)(d.A,{children:e.text||e});switch(t.response?.status){case 400:return(0,u.jsx)(d.A,{children:n("invalid_request")});case 403:return(0,u.jsx)(d.A,{children:n("session_error")});case 429:return(0,u.jsx)(d.A,{children:n("too_many_attempts")});default:return(0,u.jsx)(d.A,{children:n("something_went_wrong_server")})}}case c.Lc:case c.di:case c.yG:return null;default:return(0,u.jsx)(d.A,{children:n("generic_something_went_wrong")})}}},55904:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(14041),i=n(79184),s=n(56447);const o=()=>{const{view:e,pdfLayout:t,changeLayout:n,detachRole:o,reattach:a}=(0,s.LV)(),l=(0,r.useRef)(null),c="sideBySide"===t||"pdf"===e;(0,i.A)(c,l);const d=(0,r.useCallback)((()=>{c?n("flat","editor"):n("sideBySide")}),[n,c]),u=(0,r.useCallback)((e=>{e?("detacher"===o&&a(),n("sideBySide")):n("flat","editor")}),[n,o,a]);return{togglePdfPane:d,handlePdfPaneExpand:(0,r.useCallback)((()=>{"flat"===t&&"editor"===e&&n("sideBySide","editor")}),[n,t,e]),handlePdfPaneCollapse:(0,r.useCallback)((()=>{"sideBySide"===t&&n("flat","editor")}),[n,t]),setPdfIsOpen:u,pdfIsOpen:c,pdfPanelRef:l}}},57533:(e,t,n)=>{n.d(t,{S:()=>C});var r=n(14041),i=n(53373),s=n.n(i),o=n(97434),a=(n(82438),n(50020),n(14935)),l=n(96713),c=n(31085);const d=(0,r.memo)((e=>{let{expanded:t,setExpanded:n}=e;const{t:r}=(0,o.Bd)();return(0,c.jsx)("button",{className:"outline-item-expand-collapse-btn",onClick:()=>n((e=>!e)),"aria-label":r(t?"collapse":"expand"),children:(0,c.jsx)(l.A,{type:t?"keyboard_arrow_down":"keyboard_arrow_right",className:"outline-caret-icon"})})}));d.displayName="OutlineItemToggleButton";const u=(0,r.memo)((function(e){let{outlineItem:t,jumpToLine:n,highlightedLine:i,matchesHighlightedLine:o,containsHighlightedLine:l}=e;const[u,p]=(0,r.useState)(!0),f=(0,r.useRef)(null),h=(0,r.useRef)(!1),g=s()("outline-item",{"outline-item-no-children":!t.children}),x=o||!u&&l,j=s()("outline-item-link",{"outline-item-link-highlight":x});(0,r.useEffect)((()=>{const e=h.current;h.current=!!x,!e&&x&&f.current&&(0,a.A)(f.current,{scrollMode:"if-needed",block:"center"})}),[x,f,h]);const _=t.children?u:void 0;return(0,c.jsxs)("li",{className:g,"aria-expanded":_,role:"treeitem","aria-current":x,"aria-label":t.title,children:[(0,c.jsxs)("div",{className:"outline-item-row",children:[!!t.children&&(0,c.jsx)(d,{expanded:u,setExpanded:p}),(0,c.jsx)("button",{className:j,onClick:function(e){const r=2===e.detail;n(t.line,r)},ref:f,children:t.title})]}),u&&t.children?(0,c.jsx)(m,{outline:t.children,jumpToLine:n,isRoot:!1,highlightedLine:l?i:null,containsHighlightedLine:l}):null]})}));var p=n(35545);const m=(0,r.memo)((function(e){let{outline:t,jumpToLine:n,isRoot:r,highlightedLine:i,containsHighlightedLine:o}=e;const a=s()("outline-item-list",{"outline-item-list-root":r});return(0,c.jsx)("ul",{className:a,role:r?"tree":"group",children:t.map(((e,t)=>{const r=o&&i===e.line,s=null!=i&&o&&(0,p.A)(e.children).includes(i);return(0,c.jsx)(u,{outlineItem:e,jumpToLine:n,highlightedLine:r||s?i:null,matchesHighlightedLine:r,containsHighlightedLine:s},`${e.level}-${t}`)}))})}));const f=function(e){let{outline:t,jumpToLine:n,highlightedLine:r}=e;const{t:i}=(0,o.Bd)();return(0,c.jsx)("div",{children:t.length?(0,c.jsx)(m,{outline:t,jumpToLine:n,isRoot:!0,highlightedLine:r,containsHighlightedLine:!0}):(0,c.jsxs)("div",{className:"outline-body-no-elements",children:[i("we_cant_find_any_sections_or_subsections_in_this_file"),"."," ",(0,c.jsx)("a",{href:"/learn/how-to/Using_the_File_Outline_feature",className:"outline-body-link",target:"_blank",rel:"noopener noreferrer",children:i("find_out_more_about_the_file_outline")})]})})};var h=n(67984),g=n(59162);const x=(0,r.memo)((e=>{let{isTexFile:t,toggleExpanded:n,expanded:r,isOpen:i,isPartial:s}=e;const{t:a}=(0,o.Bd)();return(0,c.jsxs)("button",{className:"outline-header-expand-collapse-btn",disabled:!t,onClick:n,"aria-label":a(r?"hide_outline":"show_outline"),children:[(0,c.jsx)(l.A,{type:i?"keyboard_arrow_down":"keyboard_arrow_right",className:"outline-caret-icon"}),(0,c.jsx)("h4",{className:"outline-header-name",children:a("file_outline")}),s&&(0,c.jsx)(g.A,{id:"partial-outline",description:a("partial_outline_warning"),overlayProps:{placement:"top"},children:(0,c.jsx)("span",{role:"status",style:{display:"flex"},children:(0,c.jsx)(l.A,{type:"warning",accessibilityLabel:a("partial_outline_warning")})})})]})}));x.displayName="OutlineToggleButton";const j=r.memo((function(e){let{isTexFile:t,outline:n,jumpToLine:i,onToggle:o,highlightedLine:a,isPartial:l=!1,expanded:d,toggleExpanded:u}=e;const p=Boolean(t&&d);(0,r.useEffect)((()=>{o(p)}),[p,o]);const m=s()("outline-pane",{"outline-pane-disabled":!t});return(0,c.jsxs)("div",{className:m,children:[(0,c.jsx)("header",{className:"outline-header",children:(0,c.jsx)(x,{toggleExpanded:u,expanded:d,isOpen:p,isPartial:l,isTexFile:t})}),p&&(0,c.jsx)("div",{className:"outline-body",children:(0,c.jsx)(f,{outline:n,jumpToLine:i,highlightedLine:a})})]})})),_=(0,h.A)(j);var v=n(54830),b=n(37766),y=n(98843);const C=(0,r.memo)((()=>{const{highlightedLine:e,canShowOutline:t,jumpToLine:n,outlineExpanded:r,toggleOutlineExpanded:i}=(0,v.X)(),s=(0,b.A)("outline-toggled"),o=(0,y.A)();return(0,c.jsx)("div",{className:"outline-container",children:(0,c.jsx)(_,{outline:o.items,onToggle:s,isTexFile:t,jumpToLine:n,highlightedLine:e,isPartial:o.partial,expanded:r,toggleExpanded:i})})}));C.displayName="OutlineContainer"},60166:(e,t,n)=>{n.d(t,{_:()=>r});const r=async(e,t)=>{const n=[];for(const r of e)n.push(await t(r));return n}},60347:(e,t,n)=>{n.d(t,{l_:()=>d,z_:()=>p});n(82438),n(50020),n(47200);var r=n(5383),i=n(21947),s=n(94355);var o=function(e){return e[e.Book=1]="Book",e[e.Part=2]="Part",e[e.Chapter=3]="Chapter",e[e.Section=4]="Section",e[e.SubSection=5]="SubSection",e[e.SubSubSection=6]="SubSubSection",e[e.Paragraph=7]="Paragraph",e[e.SubParagraph=8]="SubParagraph",e[e.Frame=9]="Frame",e[e.Invalid=-1]="Invalid",e}(o||{});const a={book:o.Book,part:o.Part,chapter:o.Part,section:o.Section,subsection:o.SubSection,subsubsection:o.SubSubSection,paragraph:o.Paragraph,subparagraph:o.SubParagraph,frame:o.Frame},l=e=>{if("string"==typeof e)return a[e]??o.Invalid;switch(e){case r.Book:return o.Book;case r.Part:return o.Part;case r.Chapter:return o.Chapter;case r.Section:return o.Section;case r.SubSection:return o.SubSection;case r.SubSubSection:return o.SubSubSection;case r.Paragraph:return o.Paragraph;case r.SubParagraph:return o.SubParagraph;default:return o.Invalid}},c=(e,t)=>{const n=[];return t.node.cursor().iterate((r=>{if(r.from>=t.to)return!1;if(r.type.is("Label"))return!1;if(r.type.is("UnknownCommand")){const t=(0,s.Kn)(e,r.node,"pdf");if(t)return n.push(t),!1}if(r.node.firstChild)return!0;n.push(e.doc.sliceString(r.from,r.to))})),n.join("")},d=(e,t,n,r)=>{if(t.type.is("SectioningCommand")){const i=t.node,s=i.parent;if(!r(i))return;const o=i.getChild("SectioningArgument")?.getChild("LongArg");if(!o)return;for(let e=s;e;e=e.parent)if(e.type.is("NewCommand")||e.type.is("RenewCommand"))return!1;const a=()=>{const t=i.firstChild;return t?e.doc.sliceString(t.from+1,t.to):""},d=s?.type.is("$Section")?l(s.type.id):l(a()),u={line:e.doc.lineAt(i.from).number,title:c(e,o),from:i.from,to:i.to,level:d};n.push(u)}if(t.type.is("$Environment")){const s=t.node;if("frame"===(0,i.$2)(s,e)){const t=s.getChild("BeginEnv");if(!r(t))return;const a=(0,i.E9)(s)?.map((e=>e.getChild("LongArg")));if(a?.length){const r=a[0],i=r?e.sliceDoc(r.from,r.to):"",s={line:e.doc.lineAt(t.from).number,title:i,from:t.from,to:t.to,level:o.Frame};n.push(s)}}}},u=e=>({title:e.title,line:e.line,level:e.level}),p=e=>{const t=[],n=[];for(const r of e){const e=u(r);for(;t.length&&t[t.length-1].level>=e.level;)t.pop();if(t.length){const n=t[t.length-1];n.children?n.children.push(e):n.children=[e],t.push(e)}else t.push(e),n.push(e)}return n}},60520:(e,t,n)=>{n.d(t,{A:()=>p});n(82438),n(50020);var r=n(14041),i=n(97434),s=n(61160),o=n(14020),a=n(59162),l=n(96713),c=n(31085);function d(e){let{user:t,showName:n,onClick:r}=e;const i=(0,o.lr)(t.user_id);const[s]=[...t.name];return(0,c.jsxs)("span",{onClick:function(){r?.(t)},children:[(0,c.jsx)("span",{className:"online-user",style:{backgroundColor:i},children:s}),n&&t.name]})}const u=r.forwardRef(((e,t)=>{const{t:n}=(0,i.Bd)();return(0,c.jsx)(a.A,{id:"connected-users",description:n("connected_users"),overlayProps:{placement:"left"},children:(0,c.jsxs)("button",{type:"button",className:"online-user online-user-multi",onClick:e.onClick,ref:t,children:[(0,c.jsx)("strong",{children:e.onlineUserCount})," ",(0,c.jsx)(l.A,{type:"groups"})]})})}));u.displayName="DropDownToggleButton";const p=function(e){let{onlineUsers:t,goToUser:n}=e;const{t:r}=(0,i.Bd)();return t.length>=4?(0,c.jsxs)(s.ms,{className:"online-users",align:"end",children:[(0,c.jsx)(s.C,{id:"online-users",as:u,onlineUserCount:t.length}),(0,c.jsxs)(s.rI,{children:[(0,c.jsx)(s.hO,{"aria-hidden":"true",children:r("connected_users")}),t.map(((e,t)=>(0,c.jsx)("li",{role:"none",children:(0,c.jsx)(s.tJ,{as:"button",tabIndex:-1,onClick:()=>n(e),children:(0,c.jsx)(d,{user:e,showName:!0})})},`${e.user_id}_${t}`)))]})]}):(0,c.jsx)("div",{className:"online-users",children:t.map(((e,t)=>(0,c.jsx)(a.A,{id:"online-user",description:e.name,overlayProps:{placement:"bottom",trigger:["hover","focus"]},children:(0,c.jsx)("span",{children:(0,c.jsx)(d,{user:e,onClick:n})})},`${e.user_id}_${t}`)))})}},61564:(e,t,n)=>{n.d(t,{C:()=>o});var r=n(54830),i=n(79184),s=n(14041);const o=()=>{const{canShowOutline:e,outlineExpanded:t}=(0,r.X)(),n=(0,s.useRef)(null),o=e&&t;return(0,i.A)(o,n),{outlineEnabled:o,outlinePanelRef:n}}},64430:(e,t,n)=>{n.d(t,{N:()=>i});n(14041);var r=n(31085);function i(){return(0,r.jsx)("aside",{id:"history-file-tree",className:"ide-react-editor-sidebar history-file-tree"})}},64840:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(9638),i=n(45688),s=n(31085);const o=function(e){const{inputRef:t,label:n,id:o,...a}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.A,{type:"switch",ref:t,id:o,...a}),(0,s.jsx)(i.A,{htmlFor:o,visuallyHidden:!0,children:n})]})}},66513:(e,t,n)=>{n.r(t),n.d(t,{NewPublishToolbarButton:()=>F,default:()=>T});var r=n(14041),i=n(39067),s=n.n(i),o=n(53373),a=n.n(o),l=n(97434),c=n(96713),d=(n(97107),n(10646)),u=n(85960),p=n(8164),m=n(69475),f=n(86316),h=n(60440),g=n(37858),x=n(68543),j=n(31085);const _=(0,r.createContext)(void 0),v=e=>{let{children:t}=e;const{first_name:n,last_name:i}=(0,u.ur)(),{_id:s,name:o,rootDocId:a}=(0,f.O)(),{hasFolders:l}=(0,h.Q)(),{getCurrentDocumentId:c,getCurrentDocValue:v}=(0,x.TS)(),{cobranding:b}=(0,d.mi)(),{pdfDownloadUrl:y,pdfUrl:C,logEntries:w}=(0,p.Rf)(),{uncompiled:k}=(0,p.Rf)();let A,E,S;b&&(b.publishGuideHtml||b.partner)?b.brandedMenu?(E=`/journals/${b.brandId}`,A="branded"):b.partner?(E=`/journals/${b.brandId}`,A="export",S=b.brandVariationId):(E=`/journals/${b.brandId}`,A="guide",S=b.brandVariationId):(E="/journals",A="basic");const[N,F]=(0,r.useState)(null),[T,R]=(0,r.useState)(null),L=(0,m.A)(),P=(0,r.useCallback)((()=>{const e=`/latest_template/${s}`;return Promise.all([(0,g.hm)(e),(0,g.hm)(E)]).then((e=>{let[t,n]=e;if(L.current){const e=t.title?{title:t.title}:{};e.description=t.description,e.author=t.author,e.license=t.license,R(t),F(n)}}))}),[L,E,s]),I=(0,r.useCallback)((()=>{const e=a;if(c()===e)return!1;const t=v();if(null==t)return!1;for(const e of t.split("\n"))if(/^[^%]*\\documentclass/.test(e))return!0;return!1}),[c,v,a]),D={entries:N,initialShown:A,brandVariationId:S,fetchData:P,initParams:{projectId:s,pdfUrl:C?y:void 0,logs:w,uncompiled:k,hasFolders:l,rootDocOverridden:I(),firstName:n,lastName:i,title:o,...T}};return(0,j.jsx)(_.Provider,{value:D,children:t})};class DestinationsError extends r.Component{render(){return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("p",{children:["Sorry, we had trouble retrieving our list of submission destinations. If you give us a minute, retry, and still find this error, please notify support at"," ",(0,j.jsx)("a",{href:"mailto:support@overleaf.com?subject=Unable to submit",children:"support@overleaf.com"})]})})}}var b=n(28812),y=n(71627),C=n(90214);const w=(0,r.lazy)((()=>Promise.all([n.e(4651),n.e(5196)]).then(n.bind(n,85196))));function k(e){let{handleHide:t}=e;const{t:i}=(0,l.Bd)(),{entries:s,initialShown:o,initParams:a,fetchData:c,brandVariationId:d}=function(){const e=(0,r.useContext)(_);if(!e)throw new Error("usePublishContext is only available inside PublishProvider");return e}(),[u,p]=(0,r.useState)(!0),[f,h]=(0,r.useState)(!1),[g,x]=(0,r.useState)(!1),v=(0,m.A)();let k;function A(){t(),p(!1)}return(0,r.useEffect)((()=>{Promise.all([n.e(4651),n.e(5196)]).then(n.bind(n,85196)).catch((()=>x(!0))),f||(c().catch((()=>{v.current&&x(!0)})),h(!0))}),[v,f,c]),k=s&&a?.logs?(0,j.jsx)(r.Suspense,{fallback:(0,j.jsx)(C.A,{}),children:(0,j.jsx)(w,{entries:s,initialShown:o,initParams:a,brandVariationId:d})}):g?(0,j.jsx)(DestinationsError,{}):(0,j.jsx)(C.A,{}),(0,j.jsxs)(b.Ay,{size:"lg",show:u,onHide:A,children:[(0,j.jsx)(b.IK,{closeButton:!0,children:(0,j.jsx)(b.rA,{children:i("submit_title")})}),(0,j.jsx)(b.$8,{children:(0,j.jsx)("div",{className:"modal-body-publish",children:k})}),(0,j.jsx)(b.E9,{children:(0,j.jsx)(y.A,{variant:"secondary",onClick:A,children:i("close")})})]})}var A=n(67984),E=n(69954),S=n(31352);function N(e){let{cobranding:t}=e;const{t:n}=(0,l.Bd)(),[i,s]=(0,r.useState)(!1);const o=a()("btn","btn-full-height");return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:"toolbar-item",children:(0,j.jsxs)("button",{type:"button",id:"publishButton",className:o,onClick:function(){E._("navigation-clicked-submit"),s(!0)},children:[(0,j.jsx)(c.A,{type:"public",className:"align-middle"}),t?.submitBtnHtml?(0,j.jsx)("p",{className:"toolbar-label toolbar-label-multiline",dangerouslySetInnerHTML:{__html:t.submitBtnHtml}}):(0,j.jsx)("p",{className:"toolbar-label",children:n("submit_title")})]})}),i&&(0,j.jsx)(v,{children:(0,j.jsx)(k,{handleHide:function(){s(!1)}})})]})}N.propTypes={cobranding:s().shape({submitBtnHtml:s().string})};const F=(0,A.A)((function(){const{t:e}=(0,l.Bd)(),[t,n]=(0,r.useState)(!1);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(S.A,{onClick:function(){E._("navigation-clicked-submit"),n(!0)},children:e("submit_title")}),t&&(0,j.jsx)(v,{children:(0,j.jsx)(k,{handleHide:function(){n(!1)}})})]})})),T=(0,A.A)(N)},68059:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(97434),i=n(31085);function s(e){let{selectedEntityCount:t}=e;const{t:n}=(0,r.Bd)();return(0,i.jsx)("div",{className:"multi-selection-ongoing",children:(0,i.jsx)("div",{className:"multi-selection-message",children:(0,i.jsx)("h4",{children:`${t} ${n("files_selected")}`})})})}},68723:(e,t,n)=>{n.d(t,{Dl:()=>s,Mb:()=>i,r_:()=>o,xy:()=>a});var r=n(37858);function i(e,t,n,i){return(0,r.TB)(`/project/${e}/${l(t)}/${n}/rename`,{body:{name:i}})}function s(e,t,n){return(0,r.Un)(`/project/${e}/${l(t)}/${n}`)}function o(e,t,n,i){return(0,r.TB)(`/project/${e}/${l(t)}/${n}/move`,{body:{folder_id:i}})}function a(e,t,n){const{endpoint:i,...s}=n;return(0,r.TB)(`/project/${e}/${i}`,{body:{parent_folder_id:t,...s}})}function l(e){return"fileRef"===e?"file":e}},71735:(e,t,n)=>{n.d(t,{MS:()=>i,Ro:()=>s,tL:()=>o});n(82438),n(99819);var r=n(6896);function i(e,t,n){return!(s(e,t,n)||o(e,t,n))}function s(e,t,n){return e._id!==t&&(e=(0,r.k3)(e,t).entity),e.docs.find((e=>e.name===n))||e.fileRefs.find((e=>e.name===n))}function o(e,t,n){return e._id!==t&&(e=(0,r.k3)(e,t).entity),e.folders.find((e=>e.name===n))}},73743:(e,t,n)=>{n.d(t,{$:()=>a});var r=n(53373),i=n.n(r),s=n(59162),o=n(31085);function a(e){let{id:t,isOpen:n,setIsOpen:r,togglerType:a,tooltipWhenOpen:l,tooltipWhenClosed:c}=e;const d=n?l:c;return(0,o.jsx)(s.A,{id:t,description:d,overlayProps:{placement:"east"===a?"left":"right"},children:(0,o.jsx)("button",{className:i()("custom-toggler",`custom-toggler-${a}`,{"custom-toggler-open":n,"custom-toggler-closed":!n}),"aria-label":d,title:"",onClick:()=>r(!n)})})}},77528:(e,t,n)=>{n.d(t,{h:()=>Kt});var r={};n.r(r),n.d(r,{default:()=>de});var i={};n.r(i),n.d(i,{CreateFileMode:()=>gt,CreateFilePane:()=>xt});var s={};n.r(s),n.d(s,{CreateFileMode:()=>jt,CreateFilePane:()=>_t});var o={};n.r(o),n.d(o,{CreateFileMode:()=>vt,CreateFilePane:()=>bt});var a=n(14041),l=n(85960),c=n(13271),d=n(16896),u=n(67984),p=n(86316),m=n(60440),f=n(11787),h=n(92902),g=n(88588),x=(n(82438),n(12266),n(50020),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539),n(97434)),j=n(95014),_=n(52924),v=n(97484),b=n(81257),y=n(3762),C=n(24480),w=n(45186),k=n(6896),A=n(4816),E=n(31085);const S="ENTITY",N=e=>{let{fileTreeContainer:t,children:n}=e;const r=(0,a.useMemo)((()=>({rootElement:t})),[t]);return(0,E.jsx)(_.Q,{backend:y.t2,options:r,children:n})};function F(e){const{t}=(0,x.Bd)(),{fileTreeData:n,fileTreeReadOnly:r}=(0,m.Q)(),{selectedEntityIds:i,isRootFolderSelected:s}=(0,g.G1)(),{finishMoving:o}=(0,h.m)(),[l,c]=(0,a.useState)(!0),[,d,u]=(0,v.i)({type:S,item(){const r=function(e,t){return e.size>1&&e.has(t)?new Set(e):new Set([t])}(s?new Set:i,e),o=(0,k.jr)(n,r);return{type:S,title:R(o,t),forbiddenFolderIds:L(o),draggedEntityIds:r}},canDrag:()=>!r&&l,end(e,t){if(t.didDrop()){const n=t.getDropResult();n&&o(n.targetEntityId,e.draggedEntityIds)}}});return(0,a.useEffect)((()=>{u((0,C.n)())}),[u]),{dragRef:d,setIsDraggable:c}}function T(e){const{setDroppedFiles:t,startUploadingDocOrFile:n}=(0,h.m)(),[{isOver:r},i]=(0,b.H)({accept:[S,w.FILE],canDrop:(t,n)=>!!n.isOver({shallow:!0})&&!(t.type===S&&t.forbiddenFolderIds.has(e)),drop(r,i){if(!i.didDrop())return r.type===S?{targetEntityId:e}:void(0,j.A)(r).then((e=>e.filter((e=>(0,A.n)(e.name,e.relativePath))))).then((r=>{t({files:r,targetFolderId:e}),n()}))},collect:e=>({isOver:e.canDrop()})});return{dropRef:i,isOver:r}}function R(e,t){if(1===e.size){return Array.from(e)[0].entity.name}return t("n_items",{count:e.size})}function L(e){const t=Array.from(e).filter((e=>"folder"===e.type)).map((e=>e.entity)),n=new Set(t);return(0,k.b_)(n)}const P=e=>{let{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,onSelect:i,fileTreeContainer:s,children:o}=e;return(0,E.jsx)(f.r,{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,children:(0,E.jsx)(g.k2,{onSelect:i,children:(0,E.jsx)(h.g,{children:(0,E.jsx)(N,{fileTreeContainer:s,children:o})})})})};var I=n(53373),D=n.n(I);function O(e){let{title:t}=e;return(0,E.jsx)("div",{className:"dnd-draggable-preview-item",children:t})}function B(e,t){if(!t||!e)return{display:"none"};const{x:n,y:r}=t,{x:i,y:s}=e,o=`translate(${i-n-15}px, ${s-r-15}px)`;return{transform:o,WebkitTransform:o}}const M=function(e){let{isOver:t,isDragging:n,item:r,clientOffset:i}=e;const s=(0,a.useRef)(null);return(0,E.jsx)("div",{ref:s,className:D()("dnd-draggable-preview-layer",{"dnd-droppable-hover":t}),children:n&&r?.title&&(0,E.jsx)("div",{style:B(i,s.current?.getBoundingClientRect()),children:(0,E.jsx)(O,{title:r.title})})})};var $=n(23823),z=n(96713),q=n(97536);const V=function(e){let{isLinkedFile:t,name:n}=e;const{t:r}=(0,x.Bd)(),i=D()("file-tree-icon",{"linked-file-icon":t});return(0,q.G)()?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(z.A,{unfilled:!0,type:(0,$.o)(n),className:i}),t&&(0,E.jsx)(z.A,{type:"open_in_new",modifier:"rotate-180",className:"linked-file-highlight",accessibilityLabel:r("linked_file")})]}):(0,E.jsxs)(E.Fragment,{children:[" ",(0,E.jsx)(z.A,{type:(0,$.A)(n),className:i}),t&&(0,E.jsx)(z.A,{type:"open_in_new",modifier:"rotate-180",className:"linked-file-highlight",accessibilityLabel:r("linked_file")})]})};var U=n(14935),H=n(93045);function G(e){let{name:t,isSelected:n,startRenaming:r}=e;const[i,s]=(0,a.useState)(0);return(0,E.jsx)("button",{className:"item-name-button",onClick:function(){s(i+1),n||s(0)},onDoubleClick:function(){i<2||r()},children:(0,E.jsx)("span",{children:t})})}function K(e){let{initialValue:t,finishRenaming:n,cancel:r}=e;const[i,s]=(0,a.useState)(t),{autoFocusedRef:o}=(0,H.U)();return(0,E.jsx)("span",{className:"rename-input",children:(0,E.jsx)("input",{type:"text",value:i,onKeyDown:function(e){"Enter"===e.key&&n(i),"Escape"===e.key&&r()},onChange:function(e){s(e.target.value)},onBlur:function(){n(i)},onFocus:function(e){const t=e.target.value.lastIndexOf(".");e.target.setSelectionRange(0,t)},ref:o})})}const Y=function(e){let{name:t,isSelected:n,setIsDraggable:r}=e;const{isRenaming:i,startRenaming:s,finishRenaming:o,error:l,cancel:c}=(0,h.m)(),d=i&&n&&!l;return(0,a.useEffect)((()=>{r(!d)}),[r,d]),d?(0,E.jsx)(K,{initialValue:t,finishRenaming:o,cancel:c}):(0,E.jsx)(G,{name:t,isSelected:n,startRenaming:s})};const W=function(e){let{id:t,name:n}=e;const{t:r}=(0,x.Bd)(),{contextMenuCoords:i,setContextMenuCoords:s}=(0,f.e)(),o=(0,a.useRef)(null),l=Boolean(i);return(0,E.jsx)("div",{className:"menu-button btn-group",children:(0,E.jsx)("button",{className:"entity-menu-toggle btn btn-sm",id:`menu-button-${t}`,onClick:function(e){if(e.stopPropagation(),!i&&o.current){const e=o.current.getBoundingClientRect();s({top:e.top+e.height/2,left:e.right})}else s(null)},ref:o,"aria-haspopup":"true","aria-expanded":l,"aria-label":r("open_action_menu",{name:n}),children:(0,E.jsx)(z.A,{type:"more_vert",accessibilityLabel:r("menu")})})})};var Q=n(5658);const X=function(e){let{id:t,name:n,type:r,isSelected:i,icons:s}=e;const{fileTreeReadOnly:o}=(0,m.Q)(),{setContextMenuCoords:l}=(0,f.e)(),{isRenaming:c}=(0,h.m)(),{selectedEntityIds:d}=(0,g.G1)(),u=!o&&i&&1===d.size,{dragRef:p,setIsDraggable:x}=F(t),j=(0,Q.u)().getMonitor().getItem(),_=(0,a.useRef)(null);return(0,a.useEffect)((()=>{const e=_.current;i&&e&&setTimeout((()=>{e&&(0,U.A)(e,{scrollMode:"if-needed"})}),100)}),[i,_]),(0,E.jsx)("div",{className:D()("entity",{"file-tree-entity-dragging":j?.draggedEntityIds?.has(t)}),role:"presentation",ref:p,draggable:!c,onContextMenu:function(e){e.preventDefault(),l({top:e.pageY,left:e.pageX})},"data-file-id":t,"data-file-type":r,children:(0,E.jsxs)("div",{className:"entity-name entity-name-react",role:"presentation",ref:_,children:[s,(0,E.jsx)(Y,{name:n,isSelected:i,setIsDraggable:x}),u?(0,E.jsx)(W,{id:t,name:n}):null]})})};const Z=function(e){let{name:t,id:n,isFile:r,isLinkedFile:i}=e;const s=r?"file":"doc",{isSelected:o,props:a}=(0,g.hj)(n,s);return(0,E.jsx)("li",{role:"treeitem",...a,"aria-label":t,tabIndex:0,children:(0,E.jsx)(X,{id:n,name:t,type:s,isSelected:o,icons:(0,E.jsx)(V,{isLinkedFile:i,name:t})})})};var J=n(42093);const ee=function(e){let{expanded:t,onExpandCollapseClick:n}=e;const{t:r}=(0,x.Bd)();return(0,q.G)()?(0,E.jsx)(E.Fragment,{children:(0,E.jsx)("button",{className:"folder-expand-collapse-button",onClick:n,"aria-label":r(t?"collapse":"expand"),children:(0,E.jsx)(z.A,{type:t?"expand_more":"chevron_right",className:"file-tree-expand-icon"})})}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("button",{onClick:n,"aria-label":r(t?"collapse":"expand"),children:(0,E.jsx)(z.A,{type:t?"expand_more":"chevron_right",className:"file-tree-expand-icon"})}),(0,E.jsx)(z.A,{type:t?"folder_open":"folder",className:"file-tree-folder-icon"})]})};const te=function(e){let{name:t,id:n,folders:r,docs:i,files:s}=e;const{isSelected:o,props:l}=(0,g.hj)(n,"folder"),{selectedEntityParentIds:c}=(0,g.G1)(),[d,u]=(0,J.A)(`folder.${n}.expanded`,!1);(0,a.useEffect)((()=>{c.has(n)&&u(!0)}),[n,c,u]);const{isOver:p,dropRef:m}=T(n),{isOver:f,dropRef:h}=T(n);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("li",{role:"treeitem",...l,"aria-expanded":d,"aria-label":t,tabIndex:0,ref:m,className:D()(l.className,{"dnd-droppable-hover":p||f}),children:(0,E.jsx)(X,{id:n,name:t,type:"folder",isSelected:o,icons:(0,E.jsx)(ee,{expanded:d,onExpandCollapseClick:function(){u(!d)}})})}),d?(0,E.jsx)(ie,{folders:r,docs:i,files:s,dropRef:h}):null]})};var ne=n(45857);function re(e,t){return ne.h.compare(e.name,t.name)}const ie=function(e){let{folders:t,docs:n,files:r,classes:i={},dropRef:s=null,children:o,dataTestId:a}=e;r=r.map((e=>({...e,isFile:!0})));const l=[...n,...r];return(0,E.jsx)("ul",{className:D()("list-unstyled","file-tree-folder-list",i.root),role:"tree",ref:s,"data-testid":a,children:(0,E.jsxs)("div",{className:"file-tree-folder-list-inner",children:[t.sort(re).map((e=>(0,E.jsx)(te,{name:e.name,id:e._id,folders:e.folders,docs:e.docs,files:e.fileRefs},e._id))),l.sort(re).map((e=>"isFile"in e?(0,E.jsx)(Z,{name:e.name,id:e._id,isFile:e.isFile,isLinkedFile:e.linkedFileData&&!!e.linkedFileData.provider},e._id):(0,E.jsx)(Z,{name:e.name,id:e._id},e._id))),o]})})};var se=n(58528),oe=n(59162),ae=n(56447),le=n(94857),ce=n(22440);const de=()=>{const{projectSearchIsOpen:e,setProjectSearchIsOpen:t}=(0,ae.LV)(),{t:n}=(0,x.Bd)(),r=(0,a.useMemo)((()=>({id:"search",description:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{children:n("search_project")}),(0,E.jsx)("div",{children:le.c?"⇧⌘F":"Ctrl+Shift+F"})]}),overlayProps:{placement:"bottom"}})),[n]);return(0,se.g9)("full-project-search")?(0,E.jsx)(oe.A,{...r,children:(0,E.jsx)("button",{className:D()("btn",{active:e}),onClick:()=>{e||(0,ce.T)("search-open",{searchType:"full-project",method:"button",location:"toolbar"}),t((e=>!e))},tabIndex:-1,"data-active":e,children:(0,E.jsx)(z.A,{type:"search",accessibilityLabel:n("search")})})}):null};var ue=n(69954),pe=n(98509);const me=[{import:r,path:"/overleaf/services/web/modules/full-project-search/frontend/js/components/full-project-search-button.tsx"}];function fe(){const{t:e}=(0,x.Bd)(),{canCreate:t,startCreatingFolder:n,startCreatingDocOrFile:r,startUploadingDocOrFile:i}=(0,h.m)();return t?(0,E.jsxs)("div",{className:"toolbar-left",children:[(0,E.jsx)(oe.A,{id:"new-file",description:e("new_file"),overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn",onClick:()=>{ue._("new-file-click",{location:"toolbar"}),r()},children:(0,E.jsx)(z.A,{type:"description",accessibilityLabel:e("new_file")})})}),(0,E.jsx)(oe.A,{id:"new-folder",description:e("new_folder"),overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn",onClick:n,tabIndex:-1,children:(0,E.jsx)(z.A,{type:"folder",accessibilityLabel:e("new_folder")})})}),(0,E.jsx)(oe.A,{id:"upload",description:e("upload"),overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn",onClick:()=>{ue._("upload-click",{location:"toolbar"}),i()},tabIndex:-1,children:(0,E.jsx)(z.A,{type:"upload",accessibilityLabel:e("upload")})})})]}):null}function he(){const{t:e}=(0,x.Bd)(),{canRename:t,canDelete:n,startRenaming:r,startDeleting:i}=(0,h.m)();return(0,E.jsxs)("div",{className:"toolbar-right",children:[me.map((e=>{let{import:{default:t},path:n}=e;return(0,E.jsx)(t,{},n)})),t?(0,E.jsx)(oe.A,{id:"rename",description:e("rename"),overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn",onClick:r,tabIndex:-1,children:(0,E.jsx)(z.A,{type:"edit",accessibilityLabel:e("rename")})})}):null,n?(0,E.jsx)(oe.A,{id:"delete",description:e("delete"),overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn",onClick:i,tabIndex:-1,children:(0,E.jsx)(z.A,{type:"delete",accessibilityLabel:e("delete")})})}):null]})}const ge=function(){const{fileTreeReadOnly:e}=(0,m.Q)(),{t}=(0,x.Bd)();return e?null:(0,E.jsxs)(pe.A,{className:"toolbar toolbar-filetree","aria-label":t("project_files"),children:[(0,E.jsx)(fe,{}),(0,E.jsx)(he,{})]})};var xe=n(6539),je=n(17905),_e=n(58516);function ve(){const{t:e}=(0,x.Bd)(),{fileTreeReadOnly:t}=(0,m.Q)(),{write:n}=(0,_e.Tg)(),{canCreate:r,startCreatingFolder:i,startCreatingDocOrFile:s,startUploadingDocOrFile:o}=(0,h.m)();if((0,je.w)((()=>{if(r&&!t&&n)return[{label:e("new_file"),id:"new_file",handler:e=>{let{location:t}=e;ue._("new-file-click",{location:t}),s()}},{label:e("new_folder"),id:"new_folder",handler:i},{label:e("upload_file"),id:"upload_file",handler:e=>{let{location:t}=e;ue._("upload-click",{location:t}),o()}}]}),[r,t,s,e,i,o,n]),!r||t)return null;return(0,E.jsxs)("div",{className:"file-tree-toolbar-action-buttons",children:[(0,E.jsx)(be,{id:"new-file",description:e("new_file"),onClick:()=>{ue._("new-file-click",{location:"toolbar"}),s()},iconType:"note_add"}),(0,E.jsx)(be,{id:"new-folder",description:e("new_folder"),onClick:i,iconType:"create_new_folder"}),(0,E.jsx)(be,{id:"upload",description:e("upload"),onClick:()=>{ue._("upload-click",{location:"toolbar"}),o()},iconType:"upload_file"})]})}function be(e){let{id:t,description:n,onClick:r,iconType:i}=e;return(0,E.jsx)(oe.A,{id:t,description:n,overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn file-tree-toolbar-action-button",onClick:r,children:(0,E.jsx)(z.A,{unfilled:!0,type:i,accessibilityLabel:n})})})}const ye=function(){const{t:e}=(0,x.Bd)(),{fileTreeExpanded:t,toggleFileTreeExpanded:n}=(0,xe.A)();return(0,E.jsxs)("div",{className:"file-tree-toolbar",children:[(0,E.jsxs)("button",{className:"file-tree-expand-collapse-button",onClick:n,"aria-label":e(t?"hide_file_tree":"show_file_tree"),children:[(0,E.jsx)(z.A,{type:t?"keyboard_arrow_down":"keyboard_arrow_right"}),(0,E.jsx)("h4",{children:e("file_tree")})]}),(0,E.jsx)(ve,{})]})};var Ce=n(28812),we=n(71627),ke=n(22046);const Ae=function(){const{t:e}=(0,x.Bd)(),{isDeleting:t,inFlight:n,finishDeleting:r,actionedEntities:i,cancel:s,error:o}=(0,h.m)();if(!t)return null;function a(){s()}return(0,E.jsxs)(Ce.Ay,{show:!0,onHide:a,children:[(0,E.jsx)(Ce.IK,{children:(0,E.jsx)(Ce.rA,{children:e("delete")})}),(0,E.jsxs)(Ce.$8,{children:[(0,E.jsx)("p",{children:e("sure_you_want_to_delete")}),(0,E.jsx)("ul",{children:i.map((e=>(0,E.jsx)("li",{children:e.name},e._id)))}),o&&(0,E.jsx)(ke.A,{type:"error",content:e("generic_something_went_wrong")})]}),(0,E.jsx)(Ce.E9,{children:n?(0,E.jsx)(we.A,{variant:"danger",disabled:!0,isLoading:!0}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(we.A,{variant:"secondary",onClick:a,children:e("cancel")}),(0,E.jsx)(we.A,{variant:"danger",onClick:function(){r()},children:e("delete")})]})})]})};var Ee=n(27916),Se=n(89761);function Ne(e){let{name:t,setName:n,validName:r,setValidName:i,handleCreateFolder:s}=e;const{autoFocusedRef:o}=(0,H.U)();return(0,E.jsx)("input",{ref:o,className:"form-control",type:"text",value:t,onKeyDown:function(e){"Enter"===e.key&&r&&s()},onChange:function(e){i((0,Se.tL)(e.target.value.trim())),n(e.target.value)},onFocus:function(e){e.target.setSelectionRange(0,-1)}})}const Fe=function(){const{t:e}=(0,x.Bd)(),[t,n]=(0,a.useState)(""),[r,i]=(0,a.useState)(!0),{isCreatingFolder:s,inFlight:o,finishCreatingFolder:l,cancel:c,error:d}=(0,h.m)();if((0,a.useEffect)((()=>{s||n("")}),[s]),!s)return null;function u(){c()}function p(){l(t)}function m(){return d.constructor===Ee.Lc?e("file_already_exists"):e("generic_something_went_wrong")}return(0,E.jsxs)(Ce.Ay,{show:!0,onHide:u,children:[(0,E.jsx)(Ce.IK,{children:(0,E.jsx)(Ce.rA,{children:e("new_folder")})}),(0,E.jsxs)(Ce.$8,{children:[(0,E.jsx)(Ne,{name:t,setName:n,validName:r,setValidName:i,handleCreateFolder:p}),r?null:(0,E.jsx)("div",{role:"alert","aria-label":e("files_cannot_include_invalid_characters"),className:"alert alert-danger file-tree-modal-alert",children:e("files_cannot_include_invalid_characters")}),d?(0,E.jsx)("div",{role:"alert","aria-label":m(),className:"alert alert-danger file-tree-modal-alert",children:m()}):null]}),(0,E.jsx)(Ce.E9,{children:o?(0,E.jsx)(we.A,{variant:"primary",disabled:!0,isLoading:o}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(we.A,{variant:"secondary",onClick:u,children:e("cancel")}),(0,E.jsx)(we.A,{variant:"primary",onClick:p,disabled:!r,children:e("create")})]})})]})};const Te=function FileTreeModalError(){const{t:e}=(0,x.Bd)(),{isRenaming:t,isMoving:n,cancel:r,error:i}=(0,h.m)();if(!i)return null;if(!t&&!n)return null;function s(){r()}function o(){switch(i.constructor){case Ee.Lc:return e("file_already_exists");case Ee.ui:return(0,E.jsx)(x.x6,{i18nKey:"file_already_exists_in_this_location",components:[(0,E.jsx)("strong",{})],values:{fileName:i.entityName},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}});case Ee.di:return e("files_cannot_include_invalid_characters");case Ee.yG:return e("blocked_filename");default:return e("generic_something_went_wrong")}}return(0,E.jsxs)(Ce.Ay,{show:!0,onHide:s,children:[(0,E.jsx)(Ce.IK,{children:(0,E.jsx)(Ce.rA,{children:function(){switch(i.constructor){case Ee.Lc:case Ee.ui:return e("duplicate_file");case Ee.di:case Ee.yG:return e("invalid_file_name");default:return e("error")}}()})}),(0,E.jsx)(Ce.$8,{children:(0,E.jsx)("div",{role:"alert","aria-label":o(),children:o()})}),(0,E.jsx)(Ce.E9,{children:(0,E.jsx)(we.A,{onClick:s,variant:"primary",children:e("ok")})})]})};var Re=n(43144),Le=n(61160);const Pe=function(){const{t:e}=(0,x.Bd)(),{canRename:t,canDelete:n,canCreate:r,startRenaming:i,startDeleting:s,startCreatingFolder:o,startCreatingDocOrFile:l,startUploadingDocOrFile:c,downloadPath:d,selectedFileName:u}=(0,h.m)(),{owner:m}=(0,p.O)(),f=(0,a.useCallback)((()=>{u?.endsWith(".bib")&&ue._("download-bib-file",{projectOwner:m._id})}),[u,m]),g=(0,a.useCallback)((()=>{ue._("new-file-click",{location:"file-menu"}),l()}),[l]),j=(0,a.useCallback)((()=>{ue._("upload-click",{location:"file-menu"}),c()}),[c]);return(0,E.jsxs)(E.Fragment,{children:[t?(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{onClick:i,children:e("rename")})}):null,d?(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{href:d,onClick:f,download:u??void 0,children:e("download")})}):null,n?(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{onClick:s,children:e("delete")})}):null,r?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(Le.rx,{}),(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{onClick:g,children:e("new_file")})}),(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{onClick:o,children:e("new_folder")})}),(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{onClick:j,children:e("upload")})})]}):null]})};const Ie=function(){const{fileTreeReadOnly:e}=(0,m.Q)(),{contextMenuCoords:t,setContextMenuCoords:n}=(0,f.e)(),r=(0,a.useRef)(null),i=(0,a.useRef)(!1);function s(){t&&(n(null),r.current&&r.current.focus())}(0,a.useEffect)((()=>{t&&(r.current=document.querySelector(".entity-menu-toggle"))}),[t]),(0,a.useEffect)((()=>{if(t&&i.current){const e=document.querySelector("#dropdown-file-tree-context-menu .dropdown-item:not([disabled])");e&&e.focus()}}),[t]);const o=(0,a.useCallback)((()=>{i.current=!0}),[]),l=(0,a.useCallback)((()=>{i.current=!1}),[]);return(0,a.useEffect)((()=>(document.addEventListener("keydown",o),document.addEventListener("mousedown",l),()=>{document.removeEventListener("keydown",o),document.removeEventListener("mousedown",l)})),[o,l]),!t||e?null:Re.createPortal((0,E.jsx)("div",{style:t,className:"context-menu",children:(0,E.jsx)(Le.ms,{show:!0,drop:document.body.offsetHeight/t.top<2&&document.body.offsetHeight-t.top<250?"up":"down",onKeyDown:function(e){"Tab"!==e.key&&"Escape"!==e.key||(e.preventDefault(),s())},onToggle:function(e){e||s()},children:(0,E.jsx)(Le.rI,{className:"dropdown-menu-sm-width",id:"dropdown-file-tree-context-menu",children:(0,E.jsx)(Pe,{})})})}),document.body)};var De=n(89753);const Oe=function FileTreeError(){const{t:e}=(0,x.Bd)(),{reload:t}=(0,De.z)();return(0,E.jsxs)("div",{className:"file-tree-error",children:[(0,E.jsx)("p",{children:e("generic_something_went_wrong")}),(0,E.jsx)("p",{children:e("please_refresh")}),(0,E.jsx)(we.A,{variant:"primary",onClick:t,children:e("refresh")})]})};var Be=n(67353),Me=n(65982);n(97107);const $e=(0,a.createContext)(void 0),ze=()=>{const e=(0,a.useContext)($e);if(!e)throw new Error("useFileTreeCreateForm is only available inside FileTreeCreateFormProvider");return e},qe=e=>{let{children:t}=e;const[n,r]=(0,a.useState)(!1);return(0,E.jsx)($e.Provider,{value:{valid:n,setValid:r},children:t})};function Ve(e){let{mode:t,icon:n,label:r}=e;const{newFileCreateMode:i,startCreatingFile:s}=(0,h.m)();return(0,E.jsx)("li",{className:D()({active:i===t}),children:(0,E.jsxs)(we.A,{variant:"link",onClick:()=>{s(t),ue._("file-modal-click",{method:t})},className:"modal-new-file-mode",children:[(0,E.jsx)(z.A,{type:n})," ",r]})})}const Ue=(0,a.createContext)(void 0),He=()=>{const e=(0,a.useContext)(Ue);if(!e)throw new Error("useFileTreeCreateName is only available inside FileTreeCreateNameProvider");return e},Ge=e=>{let{children:t,initialName:n=""}=e;const[r,i]=(0,a.useReducer)(((e,t)=>({name:t,touchedName:!0})),{name:n,touchedName:!1}),s=(0,a.useMemo)((()=>(0,Se.tL)(r.name.trim())),[r]);return(0,E.jsx)(Ue.Provider,{value:{...r,setName:i,validName:s},children:t})};var Ke=n(18730),Ye=n(12327),We=n(96700),Qe=n(7829);function Xe(e){let{label:t,focusName:n=!1,classes:r={},placeholder:i,error:s,inFlight:o}=e;const{t:l}=(0,x.Bd)(),{name:c,setName:d,touchedName:u,validName:p}=He(),m=(0,a.useRef)(null);return(0,a.useEffect)((()=>{m.current&&n&&window.requestAnimationFrame((()=>{m.current&&(m.current.focus(),m.current.setSelectionRange(0,m.current.value.lastIndexOf(".")))}))}),[n]),(0,E.jsxs)(Ye.A,{controlId:"new-doc-name",className:r.formGroup,children:[(0,E.jsx)(We.A,{children:t||l("file_name")}),(0,E.jsx)(Qe.A,{type:"text",placeholder:i||l("file_name"),required:!0,value:c,onChange:e=>d(e.target.value),ref:m,disabled:o}),u&&!p&&(0,E.jsx)(ke.A,{type:"error",className:"row-spaced-small",content:l("files_cannot_include_invalid_characters")}),s&&(0,E.jsx)(Ze,{error:s})]})}function Ze(e){let{error:t}=e;const{t:n}=(0,x.Bd)();switch(t.constructor){case Ee.Lc:return(0,E.jsx)(ke.A,{type:"error",className:"row-spaced-small",content:n("file_already_exists")});case Ee.di:return(0,E.jsx)(ke.A,{type:"error",className:"row-spaced-small",content:n("files_cannot_include_invalid_characters")});case Ee.yG:return(0,E.jsx)(ke.A,{type:"error",className:"row-spaced-small",content:n("blocked_filename")});default:return null}}var Je=n(47475),et=n(3518),tt=n(4607),nt=n(39067),rt=n.n(nt),it=n(85868);function st(e){let{provider:t,data:n,selectedGroupId:r,setSelectedGroupId:i}=e;const{t:s}=(0,x.Bd)();switch(t){case"mendeley":return(0,E.jsxs)(Ye.A,{controlId:"group-select",children:[(0,E.jsx)(We.A,{children:s("select_a_group_optional")}),(0,E.jsxs)(Qe.A,{as:it.A,placeholder:s("select_a_group_optional"),value:r||"",onChange:e=>i(e.target.value),children:[(0,E.jsxs)("option",{disabled:!0,value:"",children:["- ",s("select_a_group_optional")]}),n.map((e=>(0,E.jsx)("option",{value:e.id,children:e.name},e.id)))]})]});case"papers":case"zotero":return(0,E.jsxs)(Ye.A,{controlId:"group-select",children:[(0,E.jsx)(We.A,{children:s("library")}),(0,E.jsxs)(Qe.A,{as:it.A,value:r||"",onChange:e=>i(e.target.value),children:[(0,E.jsx)("option",{value:"",children:s("my_library")}),(0,E.jsx)("option",{disabled:!0,value:"_",children:s("group_libraries")}),n.map((e=>(0,E.jsx)("option",{value:e.id,children:e.name},e.id)))]})]});default:throw new Error(`Unknown reference provider "${t}"`)}}st.propTypes={provider:rt().string.isRequired,data:rt().arrayOf(rt().object).isRequired,selectedGroupId:rt().string,setSelectedGroupId:rt().func.isRequired};const ot=n.p+"images/stack-of-books-rotated-9dc2167881c1d6492232.svg";var at=n(13653),lt=n(94012),ct=n(237),dt=n(79953);function ut(e){let{provider:t,providerName:n,supportsGroups:r=!1,supportsFormat:i=!1,separatePersonalLibrary:s=!0}=e;const{t:o}=(0,x.Bd)(),{name:c,validName:d}=He(),{setValid:u}=ze(),{features:p}=(0,l.ur)(),{refProviders:m,setStartedFreeTrial:g,setRefProviderEnabled:j}=(0,f.e)(),{error:_,finishCreatingLinkedFile:v,inFlight:b}=(0,h.m)(),{indexAllReferences:y}=(0,lt.B4)(),[C,w]=(0,a.useState)(""),[k,A]=(0,a.useState)("bibtex");(0,at.Q)((0,a.useCallback)((e=>{e.refProviders&&t in e.refProviders&&(j(t,!1),window.setTimeout((()=>{j(t,e.refProviders[t])})))}),[t,j]));const S=p?.references||p?.[t]||!1,N=S&&m[t],F=(0,a.useCallback)((()=>{ue._("link-integration-click",{integration:t,location:"Editor"}),window.open(`/${t}/oauth`,"reference-auth","width=700,height=500")}),[t]),T=(0,Ke.J)(t,r&&N),R=s||""!==C;(0,a.useEffect)((()=>{u(d&&N&&!T.error&&R)}),[u,d,N,T.error,R]);const L=(0,a.useCallback)((e=>{e.preventDefault();const n={};C&&(n.group_id=C),i&&(n.format=k),v({name:c,provider:t,data:n}).then((()=>{y(!0)})),ue._("new-file-created",{method:t,extension:c.split(".").length>1?c.split(".").pop():""})}),[c,C,t,v,k,y,i]);return S?(0,E.jsxs)("div",{className:"referencesImportModal",children:[N?(0,E.jsxs)("div",{children:[T.loading?(0,E.jsx)("div",{children:(0,E.jsx)("h2",{className:"text-center mt-4",children:(0,E.jsxs)("small",{children:[(0,E.jsx)(ct.A,{animation:"border","aria-hidden":"true",role:"status",className:"align-bottom"})," ",o("loading"),"…"]})})}):(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{children:o("import_a_bibtex_file_from_your_provider_account",{provider:n})}),(0,E.jsxs)("form",{noValidate:!0,id:"create-file",onSubmit:L,children:[T.error&&(0,E.jsx)(mt,{provider:t,error:T.error,linkAccount:F}),T.data&&T.data.length>0&&(0,E.jsx)("div",{className:"row-spaced-small",children:(0,E.jsx)(st,{provider:t,data:T.data,selectedGroupId:C,setSelectedGroupId:w})}),(0,E.jsx)("div",{className:"row-spaced-small",children:(0,E.jsx)(Xe,{label:o("file_name_in_this_project"),focusName:!0,error:_,inFlight:b})}),i&&(0,E.jsx)("div",{className:"row-spaced-small",children:(0,E.jsxs)(Ye.A,{controlId:"format",children:[(0,E.jsx)(We.A,{children:o("format")}),(0,E.jsxs)(it.A,{value:k,onChange:e=>A(e.target.value),children:[(0,E.jsx)("option",{value:"bibtex",children:"BibTeX"}),(0,E.jsx)("option",{value:"biblatex",children:"BibLaTeX"})]})]})})]})]}),b&&(0,E.jsx)("h3",{className:"text-center mt-4",children:(0,E.jsxs)("small",{children:[(0,E.jsx)(ct.A,{animation:"border","aria-hidden":"true",role:"status",className:"align-bottom"})," ",o("importing"),"…"]})})]}):(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{children:pt[t].dynamic_sync_description(o)}),(0,E.jsx)("p",{children:(0,E.jsx)(we.A,{type:"button",onClick:F,children:pt[t].link_to(o)})})]}),_&&(0,E.jsx)(E.Fragment,{children:"string"==typeof _?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)("div",{className:"text-center",children:[(0,E.jsx)("hr",{}),(0,E.jsx)(mt,{error:_,provider:t,linkAccount:F})]}),(0,E.jsx)(ht,{error:_,provider:t,linkAccount:F})]}):_.data?.relink?(0,E.jsx)(ft,{provider:t,linkAccount:F}):(0,E.jsx)(Je.A,{error:_})})]}):(0,E.jsx)("div",{children:(0,E.jsx)(dt.A,{type:"info",customIcon:(0,E.jsx)("img",{src:ot,alt:"","aria-hidden":"true"}),title:pt[t].upgrade_prompt_title(o),content:(0,E.jsx)("p",{children:pt[t].upgrade_prompt_content(o)}),isActionBelowContent:!0,action:(0,E.jsx)(tt.A,{buttonProps:{variant:"premium"},source:t,handleClick:()=>g(!0),children:o("try_it_for_free")})})})}const pt={mendeley:{default:e=>e("mendeley_reference_loading_error"),expired:e=>e("mendeley_reference_loading_error_expired"),forbidden:e=>e("mendeley_reference_loading_error_forbidden"),"refresh-failed":e=>e("mendeley_reference_loading_error_expired"),sync_description:e=>e("mendeley_sync_description"),dynamic_sync_description:e=>e("mendeley_dynamic_sync_description"),link_to:e=>e("link_to_mendeley"),is_premium:e=>e("mendeley_is_premium"),loading_groups:e=>e("mendeley_groups_loading_error"),relink:e=>e("mendeley_groups_relink"),upgrade_prompt_title:e=>e("mendeley_upgrade_prompt_title"),upgrade_prompt_content:e=>e("mendeley_upgrade_prompt_content")},papers:{default:e=>e("papers_reference_loading_error"),expired:e=>e("papers_reference_loading_error_expired"),forbidden:e=>e("papers_reference_loading_error_forbidden"),"refresh-failed":e=>e("papers_reference_loading_error_expired"),sync_description:e=>e("papers_sync_description"),dynamic_sync_description:e=>e("papers_dynamic_sync_description"),link_to:e=>e("link_to_papers"),is_premium:e=>e("papers_is_premium"),loading_groups:e=>e("papers_groups_loading_error"),relink:e=>e("papers_groups_relink"),upgrade_prompt_title:e=>e("papers_upgrade_prompt_title"),upgrade_prompt_content:e=>e("papers_upgrade_prompt_content")},zotero:{default:e=>e("zotero_reference_loading_error"),expired:e=>e("zotero_reference_loading_error_expired"),forbidden:e=>e("zotero_reference_loading_error_forbidden"),"refresh-failed":e=>e("zotero_reference_loading_error_expired"),sync_description:e=>e("zotero_sync_description"),dynamic_sync_description:e=>e("zotero_dynamic_sync_description"),link_to:e=>e("link_to_zotero"),is_premium:e=>e("zotero_is_premium"),loading_groups:e=>e("zotero_groups_loading_error"),relink:e=>e("zotero_groups_relink"),upgrade_prompt_title:e=>e("zotero_upgrade_prompt_title"),upgrade_prompt_content:e=>e("zotero_upgrade_prompt_content")}};function mt(e){let{provider:t,error:n,linkAccount:r}=e;const{t:i}=(0,x.Bd)();return"relink"===n?(0,E.jsx)(ft,{provider:t,linkAccount:r}):n in pt[t]?(0,E.jsx)(et.A,{children:pt[t][n](i)}):(0,E.jsx)(Je.A,{error:n})}function ft(e){let{provider:t,linkAccount:n}=e;const{t:r}=(0,x.Bd)();return(0,E.jsxs)(et.A,{children:[(0,E.jsx)("div",{children:pt[t].relink(r)}),(0,E.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:10},children:(0,E.jsx)(we.A,{variant:"danger",type:"button",onClick:n,children:r("relink_your_account")})})]})}function ht(e){let{error:t,provider:n,linkAccount:r}=e;const{t:i}=(0,x.Bd)();switch(t){case"refresh-failed":return(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{children:pt[n].dynamic_sync_description(i)}),(0,E.jsx)("p",{children:(0,E.jsx)(we.A,{type:"button",onClick:r,children:pt[n].link_to(i)})})]});case"default":case"expired":case"forbidden":return(0,E.jsxs)("div",{children:[(0,E.jsxs)("div",{children:[i("reference_error_relink_hint"),"  "]}),(0,E.jsx)("div",{children:(0,E.jsx)("a",{href:"/user/settings",target:"_blank",rel:"noopener",style:{fontWeight:"bold"},children:i("account_settings")})})]});default:return null}}function gt(){const{t:e}=(0,x.Bd)();return(0,E.jsx)(Ve,{mode:"papers",icon:"menu_book",label:e("from_provider",{provider:"Papers"})})}function xt(){const{newFileCreateMode:e}=(0,h.m)();return"papers"!==e?null:(0,E.jsx)(Ge,{initialName:"references.bib",children:(0,E.jsx)(ut,{provider:"papers",providerName:"Papers",supportsGroups:!0})})}function jt(){const{t:e}=(0,x.Bd)();return(0,E.jsx)(Ve,{mode:"zotero",icon:"menu_book",label:e("from_provider",{provider:"Zotero"})})}function _t(){const{newFileCreateMode:e}=(0,h.m)();return"zotero"!==e?null:(0,E.jsx)(Ge,{initialName:"references.bib",children:(0,E.jsx)(ut,{provider:"zotero",providerName:"Zotero",supportsGroups:!0,supportsFormat:!0})})}function vt(){const{t:e}=(0,x.Bd)();return(0,E.jsx)(Ve,{mode:"mendeley",icon:"menu_book",label:e("from_provider",{provider:"Mendeley"})})}function bt(){const{newFileCreateMode:e}=(0,h.m)();return"mendeley"!==e?null:(0,E.jsx)(Ge,{initialName:"references.bib",children:(0,E.jsx)(ut,{provider:"mendeley",providerName:"Mendeley",supportsGroups:!0})})}function yt(){const{name:e,validName:t}=He(),{setValid:n}=ze(),{error:r,finishCreatingDoc:i,inFlight:s}=(0,h.m)();(0,a.useEffect)((()=>{n(t)}),[n,t]);const o=(0,a.useCallback)((t=>{t.preventDefault(),i({name:e}),ue._("new-file-created",{method:"doc",extension:e.split(".").length>1?e.split(".").pop():""})}),[i,e]);return(0,E.jsxs)("form",{noValidate:!0,id:"create-file",onSubmit:o,children:[(0,E.jsx)(Xe,{focusName:!0,error:r,inFlight:s}),r&&(0,E.jsx)(Je.A,{error:r})]})}function Ct(){const{t:e}=(0,x.Bd)(),{name:t,setName:n,validName:r}=He(),{setValid:i}=ze(),{finishCreatingLinkedFile:s,error:o,inFlight:l}=(0,h.m)(),[c,d]=(0,a.useState)(""),u=(0,a.useCallback)((e=>{d(e.target.value)}),[]);(0,a.useEffect)((()=>{if(c){const e=c.match(/^\s*https?:\/\/.+\/([^/]+\.(\w+))\s*$/);n(e?e[1]:"")}}),[n,c]),(0,a.useEffect)((()=>{i(r&&!!c)}),[i,r,c]);return(0,E.jsxs)("form",{className:"form-controls",id:"create-file",noValidate:!0,onSubmit:e=>{e.preventDefault(),ue._("new-file-created",{method:"url",extension:t.split(".").length>1?t.split(".").pop():""}),s({name:t,provider:"url",data:{url:c.trim()}})},children:[(0,E.jsxs)(Ye.A,{controlId:"import-from-url",children:[(0,E.jsx)(We.A,{children:e("url_to_fetch_the_file_from")}),(0,E.jsx)(Qe.A,{type:"url",placeholder:"https://example.com/my-file.png",required:!0,value:c,onChange:u})]}),(0,E.jsx)(Xe,{label:e("file_name_in_this_project"),placeholder:"my_file",error:o,inFlight:l}),o&&(0,E.jsx)(Je.A,{error:o})]})}n(99819);var wt=n(45524),kt=n(4941),At=n(87833),Et=n(64932),St=n(1705);function Nt(){const{t:e}=(0,x.Bd)(),{hasLinkedProjectFileFeature:t,hasLinkedProjectOutputFileFeature:n}=(0,Et.A)("ol-ExposedSettings"),r=t&&n,{name:i,setName:s,validName:o}=He(),{setValid:l}=ze(),{error:c,finishCreatingLinkedFile:d,inFlight:u}=(0,h.m)(),[p,m]=(0,a.useState)(),[f,g]=(0,a.useState)(),[j,_]=(0,a.useState)(),[v,b]=(0,a.useState)(!t),y=(0,a.useCallback)((e=>{const t=e.split("/").pop();t&&s(t)}),[s]);(0,a.useEffect)((()=>{j&&("output.pdf"===j.path&&p.name?s(`${p.name}.pdf`):y(j.path))}),[p,j,s,y]),(0,a.useEffect)((()=>{f&&y(f.path)}),[f,y]),(0,a.useEffect)((()=>{const e=Boolean(v?j:f);l(o&&e)}),[l,o,v,f,j]);return(0,E.jsxs)(St.A,{id:"create-file",onSubmit:e=>{e.preventDefault(),ue._("new-file-created",{method:"project",extension:i.split(".").length>1?i.split(".").pop():""}),d(v?{name:i,provider:"project_output_file",data:{source_project_id:p._id,source_output_file_path:j.path,build_id:j.build,clsiServerId:j.clsiServerId}}:{name:i,provider:"project_file",data:{source_project_id:p._id,source_entity_path:f.path}})},children:[(0,E.jsx)(Ft,{selectedProject:p,setSelectedProject:m}),v?(0,E.jsx)(Tt,{selectedProjectId:p?._id,selectedProjectOutputFile:j,setSelectedProjectOutputFile:_}):(0,E.jsx)(Rt,{selectedProjectId:p?._id,selectedProjectEntity:f,setSelectedProjectEntity:g}),r&&(0,E.jsxs)("div",{className:"toggle-file-type-button",children:["or ",(0,E.jsx)(we.A,{variant:"link",type:"button",onClick:()=>b((e=>!e)),children:(0,E.jsx)("span",{children:e(v?"select_from_source_files":"select_from_output_files")})})]}),(0,E.jsx)(Xe,{label:e("file_name_in_this_project"),classes:{formGroup:"form-controls row-spaced-small"},placeholder:"example.tex",error:c,inFlight:u}),c&&(0,E.jsx)(Je.A,{error:c})]})}function Ft(e){let{selectedProject:t,setSelectedProject:n}=e;const{t:r}=(0,x.Bd)(),{_id:i}=(0,p.O)(),{data:s,error:o,loading:l}=(0,wt.r)(),c=(0,a.useMemo)((()=>s?s.filter((e=>e._id!==i)):null),[s,i]);return o?(0,E.jsx)(Je.A,{error:o}):(0,E.jsxs)(Ye.A,{controlId:"project-select",children:[(0,E.jsx)(We.A,{children:r("select_a_project")}),l&&(0,E.jsxs)("span",{children:[" ",(0,E.jsx)(ct.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})]}),(0,E.jsxs)(it.A,{disabled:!s,value:t?t._id:"",onChange:e=>{const t=e.target.value,r=s.find((e=>e._id===t));n(r)},children:[(0,E.jsxs)("option",{disabled:!0,value:"",children:["- ",r("please_select_a_project")]}),c&&c.map((e=>(0,E.jsx)("option",{value:e._id,children:e.name},e._id)))]}),c&&!c.length&&(0,E.jsx)("small",{children:r("no_other_projects_found")})]})}function Tt(e){let{selectedProjectId:t,selectedProjectOutputFile:n,setSelectedProjectOutputFile:r}=e;const{t:i}=(0,x.Bd)(),{data:s,error:o,loading:a}=(0,At.z)(t);return o?(0,E.jsx)(Je.A,{error:o}):(0,E.jsxs)(Ye.A,{className:"row-spaced-small",controlId:"project-output-file-select",children:[(0,E.jsx)(We.A,{children:i("select_an_output_file")}),a&&(0,E.jsxs)("span",{children:[" ",(0,E.jsx)(ct.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})]}),(0,E.jsxs)(it.A,{disabled:!s,value:n?.path||"",onChange:e=>{const t=e.target.value,n=s?.find((e=>e.path===t));r(n)},children:[(0,E.jsxs)("option",{disabled:!0,value:"",children:["- ",i("please_select_an_output_file")]}),s&&s.map((e=>(0,E.jsx)("option",{value:e.path,children:e.path},e.path)))]})]})}function Rt(e){let{selectedProjectId:t,selectedProjectEntity:n,setSelectedProjectEntity:r}=e;const{t:i}=(0,x.Bd)(),{data:s,error:o,loading:a}=(0,kt.i)(t);return o?(0,E.jsx)(Je.A,{error:o}):(0,E.jsxs)(Ye.A,{className:"row-spaced-small",controlId:"project-entity-select",children:[(0,E.jsx)(We.A,{children:i("select_a_file")}),a&&(0,E.jsxs)("span",{children:[" ",(0,E.jsx)(ct.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})]}),(0,E.jsxs)(it.A,{disabled:!s,value:n?.path||"",onChange:e=>{const t=e.target.value,n=s.find((e=>e.path===t));r(n)},children:[(0,E.jsxs)("option",{disabled:!0,value:"",children:["- ",i("please_select_a_file")]}),s&&s.map((e=>(0,E.jsx)("option",{value:e.path,children:e.path.slice(1)},e.path)))]})]})}var Lt=n(90214);const Pt=[{import:i,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/create-file-mode-papers"},{import:s,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/create-file-mode-zotero"},{import:o,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/create-file-mode-mendeley"}],It=(0,a.lazy)((()=>Promise.all([n.e(1865),n.e(5758),n.e(5380)]).then(n.bind(n,22159))));function Dt(){const{t:e}=(0,x.Bd)(),{newFileCreateMode:t}=(0,h.m)(),{fileCount:n}=(0,m.Q)(),{hasLinkedProjectFileFeature:r,hasLinkedProjectOutputFileFeature:i,hasLinkUrlFeature:s}=(0,Et.A)("ol-ExposedSettings");return n&&"error"!==n.status?(0,E.jsx)("table",{children:(0,E.jsx)("tbody",{children:(0,E.jsxs)("tr",{children:[(0,E.jsx)("td",{className:"modal-new-file-list",children:(0,E.jsxs)("ul",{className:"list-unstyled",children:[(0,E.jsx)(Ve,{mode:"doc",icon:"description",label:e("new_file")}),(0,E.jsx)(Ve,{mode:"upload",icon:"upload",label:e("upload")}),(r||i)&&(0,E.jsx)(Ve,{mode:"project",icon:"folder_open",label:e("from_another_project")}),s&&(0,E.jsx)(Ve,{mode:"url",icon:"globe",label:e("from_external_url")}),Pt.map((e=>{let{import:{CreateFileMode:t},path:n}=e;return(0,E.jsx)(t,{},n)}))]})}),(0,E.jsxs)("td",{className:`modal-new-file-body modal-new-file-body-${t}`,children:["doc"===t&&(0,E.jsx)(Ge,{initialName:"name.tex",children:(0,E.jsx)(yt,{})}),"url"===t&&(0,E.jsx)(Ge,{children:(0,E.jsx)(Ct,{})}),"project"===t&&(0,E.jsx)(Ge,{children:(0,E.jsx)(Nt,{})}),"upload"===t&&(0,E.jsx)(a.Suspense,{fallback:(0,E.jsx)(Lt.e,{delay:500}),children:(0,E.jsx)(It,{})}),Pt.map((e=>{let{import:{CreateFilePane:t},path:n}=e;return(0,E.jsx)(t,{},n)}))]})]})})}):null}function Ot(){const{valid:e}=ze(),{newFileCreateMode:t,inFlight:n,cancel:r}=(0,h.m)(),{fileCount:i}=(0,m.Q)();return(0,E.jsx)(Bt,{valid:e,cancel:r,newFileCreateMode:t,inFlight:n,fileCount:i})}function Bt(e){let{valid:t,fileCount:n,inFlight:r,cancel:i,newFileCreateMode:s}=e;const{t:o}=(0,x.Bd)();return(0,E.jsxs)(E.Fragment,{children:["number"!=typeof n&&"warning"===n.status&&(0,E.jsxs)("div",{className:"modal-footer-left approaching-file-limit",children:[o("project_approaching_file_limit")," (",n.value,"/",n.limit,")"]}),"number"!=typeof n&&"error"===n.status&&(0,E.jsx)(ke.A,{type:"error",className:"at-file-limit",content:o("project_has_too_many_files")}),(0,E.jsx)(we.A,{variant:"secondary",type:"button",disabled:r,onClick:i,children:o("cancel")}),"upload"!==s&&(0,E.jsx)(we.A,{variant:"primary",type:"submit",form:"create-file",disabled:r||!t,isLoading:r,children:o("create")})]})}function Mt(){const{t:e}=(0,x.Bd)(),{isCreatingFile:t,cancel:n}=(0,h.m)();return t?(0,E.jsx)(qe,{children:(0,E.jsxs)(Ce.Ay,{size:"lg",onHide:n,show:!0,children:[(0,E.jsx)(Ce.IK,{closeButton:!0,children:(0,E.jsx)(Ce.rA,{children:e("add_files")})}),(0,E.jsx)(Ce.$8,{className:"modal-new-file",children:(0,E.jsx)(Dt,{})}),(0,E.jsx)(Ce.E9,{children:(0,E.jsx)(Ot,{})})]})}):null}const $t=e=>{let{children:t}=e;const{setIsRootFolderSelected:n,selectedEntityIds:r,select:i}=(0,g.G1)(),s=(0,a.useCallback)((()=>{n(!0),r.size>1&&i([])}),[i,r.size,n]);return(0,E.jsx)("div",{className:"file-tree-inner",onClick:s,"data-testid":"file-tree-inner",children:t})};var zt=n(15043),qt=n(35287);const Vt=a.memo((function(e){let{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,onSelect:i,onInit:s,onDelete:o,isConnected:l}=e;const[c,d]=(0,a.useState)(null),{_id:u}=(0,p.O)(),{fileTreeData:f}=(0,m.Q)(),h=Boolean(u&&f),g=(0,q.G)();return(0,a.useEffect)((()=>{if(c){const e=e=>{if(e.dataTransfer){const{dataset:t}=e.target;if(t.fileId&&t.fileType&&"folder"!==t.fileType){e.dataTransfer.setData("application/x-overleaf-file-id",t.fileId);const n=(0,qt.$X)(f,t.fileId);n&&e.dataTransfer.setData("application/x-overleaf-file-path",n)}}};return c.addEventListener("dragstart",e),()=>{c.removeEventListener("dragstart",e)}}}),[c,f]),(0,a.useEffect)((()=>{h&&s()}),[h,s]),h?(0,E.jsx)("div",{className:"file-tree","data-testid":"file-tree",ref:d,children:c&&(0,E.jsxs)(P,{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,onSelect:i,fileTreeContainer:c,children:[l?null:(0,E.jsx)("div",{className:"disconnected-overlay"}),g?(0,E.jsx)(ye,{}):(0,E.jsx)(ge,{}),(0,E.jsx)(Ie,{}),(0,E.jsx)($t,{children:(0,E.jsx)(Ut,{onDelete:o})}),(0,E.jsx)(Ae,{}),(0,E.jsx)(Mt,{}),(0,E.jsx)(Fe,{}),(0,E.jsx)(Te,{})]})}):null}));function Ut(e){let{onDelete:t}=e;!function(e){const t=(0,l.ur)(),{dispatchRename:n,dispatchDelete:r,dispatchMove:i,dispatchCreateFolder:s,dispatchCreateDoc:o,dispatchCreateFile:c,fileTreeData:d}=(0,m.Q)(),{selectedEntityIds:u,selectedEntityParentIds:p,select:f,unselect:h}=(0,g.G1)(),{socket:x}=(0,Be.nK)(),{fileTreeFromHistory:j}=(0,Me.P4)(),_=(0,a.useCallback)(((e,n,r)=>{r&&t?.id===r&&window.expectingLinkedFileRefreshedSocketFor===n&&(f(e),window.expectingLinkedFileRefreshedSocketFor=null)}),[t,f]);(0,a.useEffect)((()=>{if(!j)return x&&x.on("reciveEntityRename",e),()=>{x&&x.removeListener("reciveEntityRename",e)};function e(e,t){n(e,t)}}),[x,n,j]),(0,a.useEffect)((()=>{if(!j)return x&&x.on("removeEntity",t),()=>{x&&x.removeListener("removeEntity",t)};function t(t){const n=(0,k.lE)(d,t);if(h(t),p.has(t))for(const e of u)(0,k.k3)(d,e).path.includes(t)&&h(e);r(t),e&&e(n)}}),[x,h,r,d,u,p,e,j]),(0,a.useEffect)((()=>{if(!j)return x&&x.on("reciveEntityMove",e),()=>{x&&x.removeListener("reciveEntityMove",e)};function e(e,t){i(e,t)}}),[x,i,j]),(0,a.useEffect)((()=>{if(!j)return x&&x.on("reciveNewFolder",e),()=>{x&&x.removeListener("reciveNewFolder",e)};function e(e,t){s(e,t)}}),[x,s,j]),(0,a.useEffect)((()=>{if(!j)return x&&x.on("reciveNewDoc",e),()=>{x&&x.removeListener("reciveNewDoc",e)};function e(e,t,n){o(e,t)}}),[x,o,j]),(0,a.useEffect)((()=>{if(!j)return x&&x.on("reciveNewFile",e),()=>{x&&x.removeListener("reciveNewFile",e)};function e(e,t,n,r,i){c(e,t),r&&_(t._id,t.name,i)}}),[x,c,_,j])}(t);const{fileTreeData:n}=(0,m.Q)(),{isOver:r,dropRef:i}=T(n._id),s=(0,zt.V)((e=>({isDragging:e.isDragging(),item:e.getItem(),clientOffset:e.getClientOffset()})));return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(M,{isOver:r,...s}),(0,E.jsx)(ie,{folders:n.folders,docs:n.docs,files:n.fileRefs,classes:{root:D()("file-tree-list",{"file-tree-dragging":s.isDragging})},dropRef:i,dataTestId:"file-tree-list-root"})]})}const Ht=(0,u.A)(Vt,Oe);var Gt=n(11326);const Kt=(0,a.memo)((function(){const e=(0,l.ur)(),{setStartedFreeTrial:t}=(0,c.yn)(),{isConnected:n,connectionState:r}=(0,d.FX)(),{handleFileTreeInit:i,handleFileTreeSelect:s,handleFileTreeDelete:o}=(0,Gt.r)(),[u,p]=(0,a.useState)((()=>e.refProviders||{})),m=(0,a.useCallback)((function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];p((n=>({...n,[e]:t})))}),[]);return(0,E.jsx)(Ht,{refProviders:u,setRefProviderEnabled:m,setStartedFreeTrial:t,isConnected:n||null!==r.reconnectAt,onInit:i,onSelect:s,onDelete:o})}))},77934:(e,t,n)=>{n.d(t,{j:()=>c});var r=n(73613),i=n(14041),s=n(97434),o=n(53373),a=n.n(o),l=n(31085);const c=e=>{let{children:t,resizable:n=!0,onDoubleClick:o,...c}=e;const{t:d}=(0,s.Bd)(),[u,p]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{if(u){const e=()=>{c.onDragging?.(!0)};return document.addEventListener("pointermove",e),()=>{document.removeEventListener("pointermove",e)}}c.onDragging?.(!1)}),[u,c]),(0,l.jsx)(r.TW,{disabled:!n&&!u,...c,onDragging:function(e){(u||n)&&p(e)},children:(0,l.jsx)("div",{className:a()("horizontal-resize-handle",{"horizontal-resize-handle-enabled":n}),title:d("resize"),onDoubleClick:()=>o?.(),children:t})})}},79563:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(97434),i=n(31085);const s=function(e){let{resetUnreadMessages:t,sendMessage:n}=e;const{t:s}=(0,r.Bd)();return(0,i.jsxs)("form",{className:"new-message",children:[(0,i.jsx)("label",{htmlFor:"chat-input",className:"visually-hidden",children:s("your_message_to_collaborators")}),(0,i.jsx)("textarea",{id:"chat-input",placeholder:`${s("your_message_to_collaborators")}…`,onKeyDown:function(e){const t=e.nativeEvent.isComposing;if("Enter"===e.key&&!t){e.preventDefault();const t=e.target;n(t.value),window.setTimeout((()=>{t.blur(),t.closest("form")?.reset(),t.focus()}),0)}},onClick:t})]})}},80997:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(31085);function i(e){let{loadProgress:t,label:n,hasError:i=!1}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"loading-screen-brand-container",children:(0,r.jsx)("div",{className:"loading-screen-brand",style:{height:`${t}%`}})}),!i&&(0,r.jsxs)("div",{className:"h3 loading-screen-label","aria-live":"polite",children:[n,(0,r.jsx)("span",{className:"loading-screen-ellip","aria-hidden":"true",children:"."}),(0,r.jsx)("span",{className:"loading-screen-ellip","aria-hidden":"true",children:"."}),(0,r.jsx)("span",{className:"loading-screen-ellip","aria-hidden":"true",children:"."})]})]})}},83290:(e,t,n)=>{n.d(t,{FW:()=>u,Ib:()=>m,Nw:()=>c,a9:()=>p,nE:()=>h,sp:()=>d});n(82438),n(50020),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539);var r=n(57195),i=n(83173),s=n(15947),o=n(38188),a=n(60961);function l(e,t){return e?{...e,from:t.mapPos(e.from),to:t.mapPos(e.to)}:e}class c{constructor(e){this.props=e}get from(){return this.props.from}get to(){return this.props.to}get caption(){return this.props.caption}get label(){return this.props.label}get width(){return this.props.width}get unknownGraphicsArguments(){return this.props.unknownGraphicsArguments}get graphicsCommandArguments(){return this.props.graphicsCommandArguments}get graphicsCommand(){return this.props.graphicsCommand}get file(){return this.props.file}map(e){return new c({from:e.mapPos(this.from),to:e.mapPos(this.to),caption:l(this.caption,e),label:l(this.label,e),graphicsCommand:l(this.graphicsCommand,e),width:this.width,file:l(this.file,e),graphicsCommandArguments:l(this.graphicsCommandArguments,e),unknownGraphicsArguments:this.unknownGraphicsArguments})}}const d=r.Pe.define(),u=r.sU.define({create:()=>null,update:(e,t)=>{let n;for(const e of t.effects)e.is(d)&&(n=e.value);return void 0!==n?n:e?e.map(t.changes):e}}),p=()=>[u];function m(e){const t=new AbortController,n=new Promise((n=>{const r=()=>{a.$.warn("Aborting wait for file tree update"),(0,s.QV)(e,o.TY,i),n()};function i(){t.signal.aborted||(t.signal.removeEventListener("abort",r),n())}t.signal.addEventListener("abort",r,{once:!0}),(0,s.By)(e,o.TY,i,{once:!0})}));return{withTimeout(){return setTimeout((()=>t.abort()),arguments.length>0&&void 0!==arguments[0]?arguments[0]:500),n},promise:n}}const f=new Set(["image/jpeg","image/png","application/pdf"]),h=()=>i.Lz.domEventHandlers({drop:e=>{if(!e.dataTransfer||0===e.dataTransfer.files.length)return;const t=e.dataTransfer.files[0];f.has(t.type)&&window.dispatchEvent(new CustomEvent("figure-modal:paste-image",{detail:{name:t.name,type:t.type,data:t}}))},paste:e=>{if(!e.clipboardData||0===e.clipboardData.files.length)return;if(e.clipboardData.types.includes("text/plain"))return;const t=e.clipboardData.files[0];f.has(t.type)&&window.dispatchEvent(new CustomEvent("figure-modal:paste-image",{detail:{name:t.name,type:t.type,data:t}}))}})},84826:(e,t,n)=>{n.d(t,{Z:()=>o});var r=n(37858),i=n(66020),s=n(14041);const o=()=>{const[e,t]=(0,s.useState)(!1),[n,o]=(0,s.useState)(""),{setUserSettings:a}=(0,i.dk)();return{loading:e,error:n,setEditorRedesignStatus:(0,s.useCallback)((e=>(t(!0),o(""),new Promise(((n,i)=>{(0,r.TB)("/user/settings",{body:{enableNewEditor:e}}).then((()=>{a((t=>({...t,enableNewEditor:e}))),n()})).catch((e=>{o("Failed to update settings"),i(e)})).finally((()=>{t(!1)}))})))),[a])}}},85868:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(14041),i=n(21881),s=n(31085);const o=(0,r.forwardRef)(((e,t)=>(0,s.jsx)(i.A.Select,{ref:t,...e})));o.displayName="OLFormSelect";const a=o},85886:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(31085);function i(e){let{children:t}=e;return(0,r.jsx)("li",{role:"none",children:t})}},87833:(e,t,n)=>{n.d(t,{z:()=>l});n(82438),n(12266),n(57327);var r=n(14041),i=n(37858),s=n(45857),o=n(52155);const a=(e,t)=>s.h.compare(e.path,t.path);function l(e){const[t,n]=(0,r.useState)(!1),[s,l]=(0,r.useState)(null),[c,d]=(0,r.useState)(!1),{signal:u}=(0,o.A)();return(0,r.useEffect)((()=>{e&&(n(!0),d(!1),l(null),(0,i.TB)(`/project/${e}/compile`,{body:{check:"silent",draft:!1,incrementalCompilesEnabled:!1},signal:u}).then((e=>{if("success"===e.status){const t=e.outputFiles.filter((e=>e.path.match(/.*\.(pdf|png|jpeg|jpg|gif)/)));e.outputFiles.forEach((t=>{t.clsiServerId=e.clsiServerId,t.compileGroup=e.compileGroup})),l(t.sort(a))}else d("linked-project-compile-error")})).catch((e=>d(e))).finally((()=>n(!1))))}),[e,u]),{loading:t,data:s,error:c}}},88342:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(14041),i=n(31085);const s=function(e){let{as:t,...n}=e;const r=t||"div";return(0,i.jsx)(r,{...n})};const o=function(e){let{onClick:t,onMouseDown:n,offset:o=50,...a}=e;const l=(0,r.useRef)(!1),c=(0,r.useRef)(),d=a;return(0,r.useEffect)((()=>{const e=e=>{if(l.current){if(l.current=!1,!c.current)return;const n=c.current.width/2,r=c.current.height/2,i=c.current.x+n,s=c.current.y+r,a=Math.abs(e.clientX-i),d=Math.abs(e.clientY-s);a<n+o&&d<r+o&&t()}};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}}),[t,o]),(0,i.jsx)(s,{onMouseDown:e=>{l.current=!0,c.current=e.target.getBoundingClientRect(),n?.(e)},...d})}},88588:(e,t,n)=>{n.d(t,{G1:()=>k,hj:()=>w,k2:()=>C});n(97107),n(82438),n(12266),n(57327),n(50020),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539);var r=n(14041),i=n(53373),s=n.n(i),o=n(45250),a=n.n(o),l=n(6896),c=n(60440),d=n(86316),u=n(56447),p=n(42093),m=n(28699),f=n(11787),h=n(45857),g=n(94857),x=n(89139),j=n(31085);const _=(0,r.createContext)(void 0);var v=function(e){return e.SELECT="SELECT",e.MULTI_SELECT="MULTI_SELECT",e.UNSELECT="UNSELECT",e}(v||{});function b(e,t){switch(t.type){case v.SELECT:return new Set(Array.isArray(t.id)?t.id:[t.id]);case v.MULTI_SELECT:{const n=new Set(e);return n.has(t.id)?n.size>1&&n.delete(t.id):n.add(t.id),n}case v.UNSELECT:{const n=new Set(e);return n.delete(t.id),n}default:throw new Error(`Unknown selectable action type: ${t.type}`)}}function y(e,t){switch(t.type){case v.SELECT:return new Set([t.id]);case v.MULTI_SELECT:case v.UNSELECT:return e;default:throw new Error(`Unknown selectable action type: ${t.type}`)}}const C=e=>{let{onSelect:t,children:n}=e;const{_id:i,rootDocId:s}=(0,d.O)(),[o]=(0,p.A)(`doc.open_id.${i}`,s),{fileTreeData:u,setSelectedEntities:f,fileTreeReadOnly:h}=(0,c.Q)(),[g,C]=(0,r.useState)(!1),[w,k]=(0,r.useReducer)(h?y:b,null,(()=>o&&(0,l.lE)(u,o)?new Set([o]):new Set)),[A,E]=(0,r.useState)(new Set);(0,r.useEffect)((()=>{const e=new Set;w.forEach((t=>{const n=(0,l.lE)(u,t);n&&n.path.forEach((t=>e.add(t)))})),E(e)}),[u,w]);const S=(0,m.A)(w);(0,r.useEffect)((()=>{if(a().isEqual(w,S))return;const e=Array.from(w).map((e=>(0,l.lE)(u,e))).filter((e=>null!==e));t(e),f(e)}),[u,w,S,t,f]),(0,x.A)("entity:opened",(0,r.useCallback)((e=>{const t=(0,l.lE)(u,e.detail);t&&k({type:v.SELECT,id:t.entity._id})}),[u]));const N=(0,r.useCallback)((e=>{k({type:v.SELECT,id:e})}),[]),F=(0,r.useCallback)((e=>{k({type:v.UNSELECT,id:e})}),[]),T=(0,r.useCallback)(((e,t)=>{const n=t?v.MULTI_SELECT:v.SELECT;k({type:n,id:e})}),[]),R={selectedEntityIds:w,selectedEntityParentIds:A,select:N,unselect:F,selectOrMultiSelectEntity:T,isRootFolderSelected:g,setIsRootFolderSelected:C};return(0,j.jsx)(_.Provider,{value:R,children:n})};function w(e,t){const{view:n,setView:i}=(0,u.LV)(),{setContextMenuCoords:o}=(0,f.e)(),{fileTreeData:a}=(0,c.Q)(),{selectedEntityIds:d,selectOrMultiSelectEntity:p,isRootFolderSelected:m,setIsRootFolderSelected:h}=k(),x=d.has(e),j=(0,r.useCallback)((e=>{const t=[];let n=!1;for(const r of E(a))if(r===e){if(t.push(r),n)break;n=!0}else if(d.has(r)){if(t.push(r),n)break;n=!0}else n&&t.push(r);return t}),[a,d]),_=(0,r.useCallback)((()=>{for(const e of d){const t=(0,l.k3)(a,e);if("doc"===t.type)return"editor";if("fileRef"===t.type)return"file";if("folder"===t.type)return n}return null}),[a,d,n]),v=(0,r.useCallback)((n=>{n.stopPropagation();const r=!m&&(g.c?n.metaKey:n.ctrlKey);h(!1),n.shiftKey?p(j(e)):p(e,r),"file"===t?i("file"):"doc"===t?i("editor"):"folder"===t&&i(_())}),[e,m,h,p,i,t,j,_]),b=(0,r.useCallback)((e=>{v(e),e.ctrlKey||e.metaKey||o(null)}),[v,o]),y=(0,r.useCallback)((e=>{"Enter"!==e.key&&" "!==e.key||v(e)}),[v]),C=(0,r.useCallback)((t=>{d.has(e)||v(t)}),[e,v,d]),w=!m&&x&&"pdf"!==n;return{isSelected:x,props:(0,r.useMemo)((()=>({className:s()({selected:w}),"aria-selected":w,onClick:b,onContextMenu:C,onKeyPress:y})),[b,C,y,w])}}function k(){const e=(0,r.useContext)(_);if(!e)throw new Error("useFileTreeSelectable is only available inside FileTreeSelectableProvider");return e}const A=(e,t)=>h.h.compare(e.name,t.name);function*E(e){yield e._id;const t=[...e.folders].sort(A);for(const e of t)for(const t of E(e))yield t;const n=[...e.docs,...e.fileRefs].sort(A);for(const e of n)yield e._id}},88929:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(97434),i=n(22046),s=n(71627),o=n(31085);const a=function ChatFallbackError(e){let{reconnect:t}=e;const{t:n}=(0,r.Bd)();return(0,o.jsx)("aside",{className:"chat",children:(0,o.jsxs)("div",{className:"chat-error",children:[(0,o.jsx)(i.A,{type:"error",content:n("chat_error")}),t&&(0,o.jsx)("p",{className:"text-center",children:(0,o.jsx)(s.A,{variant:"secondary",onClick:t,children:n("reconnect")})})]})})}},89027:(e,t,n)=>{n.d(t,{A:()=>re});var r={};n.r(r),n.d(r,{TPRFileViewNotOriginalImporter:()=>h});var i={};n.r(i),n.d(i,{TPRFileViewInfo:()=>_});var s={};n.r(s),n.d(s,{TPRFileViewRefreshButton:()=>E});var o={};n.r(o),n.d(o,{TPRFileViewRefreshError:()=>TPRFileViewRefreshError});var a=n(14041),l=n(39067),c=n.n(l),d=n(97434),u=n(45250),p=n(85960);const m=(e,t)=>e.linkedFileData?.provider===t;var f=n(31085);function h(e){let{file:t}=e;const{t:n}=(0,d.Bd)(),{id:r}=(0,p.ur)();if(!(m(t,"mendeley")||m(t,"zotero")||m(t,"papers")))return null;return t.linkedFileData.importer_id===r?null:(0,f.jsx)("div",{className:"row",children:(0,f.jsx)("div",{className:"p-3 mb-4",children:n("only_importer_can_refresh",{provider:(0,u.capitalize)(t.linkedFileData.provider)})})})}var g=n(11283),x=n(96713);const j=e=>(0,f.jsx)(x.A,{type:"open_in_new",modifier:"rotate-180",className:"align-middle linked-file-icon",...e});function _(e){let{file:t}=e;const{t:n}=(0,d.Bd)();if("mendeley"!==t.linkedFileData.provider&&"papers"!==t.linkedFileData.provider&&"zotero"!==t.linkedFileData.provider)return null;const r={formattedDate:(0,g.fU)(t.created),relativeDate:(0,g.Pp)(t.created)};return(0,f.jsxs)("p",{children:[(0,f.jsx)(j,{})," ","mendeley"===t.linkedFileData.provider?n("imported_from_mendeley_at_date",r):"zotero"===t.linkedFileData.provider?n("imported_from_zotero_at_date",r):n("imported_from_papers_at_date",r)]})}_.propTypes={file:c().shape({created:c().string,linkedFileData:c().shape({provider:c().string})})};var v=n(93852),b=n(60440),y=n(86316);const C=(e,t)=>e.linkedFileData?.provider===t;var w=n(53373),k=n.n(w),A=n(71627);function E(e){let{file:t,refreshing:n,refreshFile:r}=e;const{t:i}=(0,d.Bd)(),{id:s}=(0,p.ur)(),o=m(t,"mendeley")||m(t,"zotero")||m(t,"papers");let a;o&&(a=t.linkedFileData.importer_id===s);const l=!o||a;return(0,f.jsx)(A.A,{className:k()("btn",{"btn-primary":l,"btn-secondary":!l}),onClick:()=>r(o),disabled:n||!l,isLoading:n,loadingLabel:i("refreshing"),children:i("refresh")})}var S=n(37858),N=n(69954),F=n(69475);const T=[{import:s,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-refresh-button"}];function R(e){let{setRefreshError:t,file:n}=e;const{_id:r}=(0,y.O)(),[i,s]=(0,a.useState)(!1),o=(0,F.A)(),l=(0,a.useCallback)((e=>{s(!0),window.expectingLinkedFileRefreshedSocketFor=n.name;const i={shouldReindexReferences:e||/\.bib$/.test(n.name)};(0,S.TB)(`/project/${r}/linked_file/${n.id}/refresh`,{body:i}).then((()=>{o.current&&s(!1),(0,N._)("refresh-linked-file",{provider:n.linkedFileData?.provider})})).catch((e=>{o.current&&(s(!1),t(e.data?.message||e.message))}))}),[n,r,t,o]);return T.length>0?T.map((e=>{let{import:{TPRFileViewRefreshButton:t},path:r}=e;return(0,f.jsx)(t,{file:n,refreshFile:l,refreshing:i},r)}))[0]:(0,f.jsx)(L,{refreshFile:l,refreshing:i})}function L(e){let{refreshFile:t,refreshing:n}=e;const{t:r}=(0,d.Bd)();return(0,f.jsx)(A.A,{variant:"primary",onClick:()=>t(null),disabled:n,isLoading:n,loadingLabel:r("refreshing"),children:r("refresh")})}var P=n(22046);function TPRFileViewRefreshError(e){let{file:t,refreshError:n}=e;const r=m(t,"mendeley")||m(t,"zotero")||m(t,"papers");return(0,f.jsx)("div",{className:"file-view-error",children:r?(0,f.jsx)(FileViewThirdPartyReferenceRefreshError,{file:t}):(0,f.jsx)(FileViewDefaultRefreshError,{refreshError:n})})}function FileViewThirdPartyReferenceRefreshError(e){let{file:t}=e;const{t:n}=(0,d.Bd)();return(0,f.jsx)(P.A,{type:"error",content:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{children:[n("something_not_right"),"! ",(0,f.jsx)("span",{children:t.linkedFileData&&n("try_relinking_provider",{provider:(0,u.capitalize)(t.linkedFileData.provider)})})]}),(0,f.jsx)(A.A,{variant:"secondary",size:"sm",className:"mt-2",href:"/user/settings",target:"_blank",children:n("go_to_settings")})]})})}function FileViewDefaultRefreshError(e){let{refreshError:t}=e;const{t:n}=(0,d.Bd)();return(0,f.jsx)(P.A,{type:"error",content:`${n("access_denied")}: ${t}`})}const I=[{import:o,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-refresh-error"}];function FileViewRefreshError(e){let{file:t,refreshError:n}=e;const{t:r}=(0,d.Bd)();return I.length>0?I.map((e=>{let{import:{TPRFileViewRefreshError:r},path:i}=e;return(0,f.jsx)(r,{file:t,refreshError:n},i)}))[0]:(0,f.jsx)("div",{className:"file-view-error",children:(0,f.jsx)(P.A,{type:"error",content:(0,f.jsxs)("span",{children:[r("access_denied"),": ",n]})})})}const D=[{import:i,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-info"}],O=[{import:r,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-not-original-importer"}],B=60,M=35,$="...",z=B-M-$.length;function q(e){if(e){if(e.length>B){const t=e.slice(0,M),n=e.slice(e.length-z);return t+$+n}return e}}function V(e){let{file:t}=e;const{_id:n}=(0,y.O)(),{fileTreeReadOnly:r}=(0,b.Q)(),{t:i}=(0,d.Bd)(),[s,o]=(0,a.useState)(null);let l;return t.linkedFileData&&(C(t,"url")?l=(0,f.jsx)(U,{file:t}):C(t,"project_file")?l=(0,f.jsx)(H,{file:t}):C(t,"project_output_file")&&(l=(0,f.jsx)(G,{file:t}))),(0,f.jsxs)(f.Fragment,{children:[t.linkedFileData&&l,t.linkedFileData&&D.map((e=>{let{import:{TPRFileViewInfo:n},path:r}=e;return(0,f.jsx)(n,{file:t},r)})),(0,f.jsxs)("div",{className:"file-view-buttons",children:[t.linkedFileData&&!r&&(0,f.jsx)(R,{file:t,setRefreshError:o}),(0,f.jsxs)(A.A,{variant:"secondary",download:t.name,href:(0,v.i)(n,t.id,t.hash),children:[(0,f.jsx)(x.A,{type:"download",className:"align-middle"})," ",(0,f.jsx)("span",{children:i("download")})]})]}),t.linkedFileData&&O.map((e=>{let{import:{TPRFileViewNotOriginalImporter:n},path:r}=e;return(0,f.jsx)(n,{file:t},r)}))[0],s&&(0,f.jsx)(FileViewRefreshError,{file:t,refreshError:s}),(0,f.jsx)("textarea",{autoFocus:!0,"aria-label":"Invisible element to manage focus and prevent unintended behavior",tabIndex:-1,style:{position:"absolute",left:"-9999px"}})]})}function U(e){let{file:t}=e;return(0,f.jsxs)("p",{children:[(0,f.jsx)(j,{})," ",(0,f.jsx)(d.x6,{i18nKey:"imported_from_external_provider_at_date",components:[(0,f.jsx)("a",{href:t.linkedFileData.url})],values:{shortenedUrl:q(t.linkedFileData.url),formattedDate:(0,g.fU)(t.created),relativeDate:(0,g.Pp)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function H(e){let{file:t}=e;return(0,f.jsxs)("p",{children:[(0,f.jsx)(j,{})," ",(0,f.jsx)(d.x6,{i18nKey:"imported_from_another_project_at_date",components:t.linkedFileData.v1_source_doc_id?[(0,f.jsx)("span",{})]:[(0,f.jsx)("a",{href:`/project/${t.linkedFileData.source_project_id}`,target:"_blank",rel:"noopener"})],values:{sourceEntityPath:t.linkedFileData.source_entity_path.slice(1),formattedDate:(0,g.fU)(t.created),relativeDate:(0,g.Pp)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function G(e){let{file:t}=e;return(0,f.jsxs)("p",{children:[(0,f.jsx)(j,{})," ",(0,f.jsx)(d.x6,{i18nKey:"imported_from_the_output_of_another_project_at_date",components:t.linkedFileData.v1_source_doc_id?[(0,f.jsx)("span",{})]:[(0,f.jsx)("a",{href:`/project/${t.linkedFileData.source_project_id}`,target:"_blank",rel:"noopener"})],values:{sourceOutputFilePath:t.linkedFileData.source_output_file_path,formattedDate:(0,g.fU)(t.created),relativeDate:(0,g.Pp)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function K(e){let{file:t,onLoad:n,onError:r}=e;const{_id:i}=(0,y.O)();return(0,f.jsx)("img",{src:(0,v.i)(i,t.id,t.hash),onLoad:n,onError:r,alt:t.name})}var Y=n(89997);const W=e=>{let{fileId:t,onLoad:r,onError:i}=e;const s=(0,F.A)(),{previewByPath:o,pathInFolder:l}=(0,Y.m8)(),c=(0,a.useCallback)((async e=>{if(e){const{loadPdfDocumentFromUrl:a}=await Promise.all([n.e(1865),n.e(6597),n.e(2404)]).then(n.bind(n,62404));if(!s.current)return;const c=l(t),d=c?o(c):null;if(!d)return void i();const u=await a(d.url).promise;if(!s.current)return;e.textContent="";const p=window.devicePixelRatio||1;for(let t=1;t<=u.numPages;t++){const n=await u.getPage(t);if(!s.current)return;const r=n.getViewport({scale:p}),i=document.createElement("canvas");i.classList.add("pdf-page"),i.width=r.width,i.height=r.height,i.style.width=r.width/p+"px",i.style.height=r.height/p+"px",e.append(i),n.render({canvasContext:i.getContext("2d"),viewport:r})}r()}}),[s,l,t,o,r,i]);return(0,f.jsx)("div",{className:"file-view-pdf",ref:c})};n(97107);var Q=n(60961),X=n(52155);const Z=2097152;function J(e){let{file:t,onLoad:n,onError:r}=e;const{_id:i}=(0,y.O)(),[s,o]=(0,a.useState)(""),[l,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!1),p=(0,X.A)(),m=(0,X.A)();return(0,a.useEffect)((()=>{if(d)return;const e=(0,v.i)(i,t.id,t.hash),s=setTimeout((()=>p.abort()),1e4);let a;fetch(e,{method:"HEAD",signal:p.signal}).then((e=>{if(!e.ok)throw new Error("HTTP Error Code: "+e.status);return e.headers.get("Content-Length")})).then((t=>{let r=!1;const i=new Headers;t&&Number(t)>Z&&(r=!0,i.set("Range",`bytes=0-${Z}`)),a=window.setTimeout((()=>m.abort()),6e4);const s=m.signal;return fetch(e,{signal:s,headers:i}).then((e=>e.text().then((e=>{r&&(e=e.replace(/\n.*$/,"")),o(e),n(),c(r)}))))})).catch((e=>{Q.$.error("Error fetching file contents",e),r()})).finally((()=>{u(!1),clearTimeout(s),clearTimeout(a)}))}),[i,t.id,t.hash,r,n,d,p,m]),Boolean(s)&&(0,f.jsx)("div",{className:"text-preview",children:(0,f.jsxs)("div",{className:"scroll-container",children:[(0,f.jsx)("p",{children:s}),l&&(0,f.jsx)("p",{children:"..."})]})})}var ee=n(90214),te=n(64932);const ne=["png","jpg","jpeg","gif"];function re(e){let{file:t}=e;const[n,r]=(0,a.useState)(!0),[i,s]=(0,a.useState)(!1),{t:o}=(0,d.Bd)(),{textExtensions:l,editableFilenames:c}=(0,te.A)("ol-ExposedSettings"),u=t.name.split(".").pop().toLowerCase(),p=l.includes(u)||c.includes(t.name.toLowerCase()),m=ne.includes(u),h="pdf"===u,g=!p&&!m&&!h,x=(0,a.useCallback)((()=>{r(!1)}),[]),j=(0,a.useCallback)((()=>{i||(r(!1),s(!0))}),[i]),_=(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(V,{file:t}),m&&(0,f.jsx)(K,{file:t,onLoad:x,onError:j}),p&&(0,f.jsx)(J,{file:t,onLoad:x,onError:j}),h&&(0,f.jsx)(W,{fileId:t.id,onLoad:x,onError:j})]});return(0,f.jsxs)("div",{className:"file-view full-size",children:[!i&&_,!g&&n&&(0,f.jsx)(ie,{}),(g||i)&&(0,f.jsx)("p",{className:"no-preview",children:o("no_preview_available")})]})}function ie(){return(0,f.jsx)("div",{className:"loading-panel loading-panel-file-view","data-testid":"loading-panel-file-view",children:(0,f.jsx)(ee.A,{})})}re.propTypes={file:c().shape({id:c().string,name:c().string,hash:c().string}).isRequired}},89761:(e,t,n)=>{n.d(t,{kW:()=>l,tL:()=>a});const r=new RegExp("[\\/\\\\\\*\\u0000-\\u001F\\u007F\\u0080-\\u009F\\uD800-\\uDFFF]","g"),i=new RegExp("(^\\.$)|(^\\.\\.$)|(^\\s+)|(\\s+$)","g"),s=new RegExp("^(prototype|constructor|toString|toLocaleString|valueOf|hasOwnProperty|isPrototypeOf|propertyIsEnumerable|__defineGetter__|__lookupGetter__|__defineSetter__|__lookupSetter__|__proto__)$"),o=1024;function a(e){return(t=e).length>0&&t.length<=o&&!e.match(r)&&!e.match(i);var t}function l(e){return s.test(e)}},90274:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(14041),i=n(69475);const s=function(e){const t=(0,i.A)();return r.useCallback((n=>{t.current&&e(n)}),[e,t])}},92902:(e,t,n)=>{n.d(t,{g:()=>y,m:()=>C});n(97107),n(82438),n(12266),n(99819),n(57327),n(50020);var r=n(14041),i=n(60166),s=n(68723),o=n(6896),a=n(71735),l=n(89761),c=n(86316),d=n(60440),u=n(88588),p=n(27916),m=n(94012),f=n(58516),h=n(93852),g=n(31085);const x=(0,r.createContext)(void 0);var j=function(e){return e.START_RENAME="START_RENAME",e.START_DELETE="START_DELETE",e.DELETING="DELETING",e.START_CREATE_FILE="START_CREATE_FILE",e.START_CREATE_FOLDER="START_CREATE_FOLDER",e.CREATING_FILE="CREATING_FILE",e.CREATING_FOLDER="CREATING_FOLDER",e.MOVING="MOVING",e.CANCEL="CANCEL",e.CLEAR="CLEAR",e.ERROR="ERROR",e}(j||{});const _={isDeleting:!1,isRenaming:!1,isCreatingFile:!1,isCreatingFolder:!1,isMoving:!1,inFlight:!1,actionedEntities:null,newFileCreateMode:null,error:null};function v(e){return e}function b(e,t){switch(t.type){case j.START_RENAME:return{..._,isRenaming:!0};case j.START_DELETE:return{..._,isDeleting:!0,actionedEntities:t.actionedEntities};case j.START_CREATE_FILE:return{..._,isCreatingFile:!0,newFileCreateMode:t.newFileCreateMode};case j.START_CREATE_FOLDER:return{..._,isCreatingFolder:!0};case j.CREATING_FILE:return{..._,isCreatingFile:!0,newFileCreateMode:e.newFileCreateMode,inFlight:!0};case j.CREATING_FOLDER:return{..._,isCreatingFolder:!0,inFlight:!0};case j.DELETING:return{..._,isDeleting:!0,inFlight:!0,actionedEntities:e.actionedEntities};case j.MOVING:return{..._,isMoving:!0,inFlight:!0};case j.CLEAR:return{..._};case j.CANCEL:return e.inFlight?e:{..._};case j.ERROR:return{...e,inFlight:!1,error:t.error};default:throw new Error(`Unknown user action type: ${t.type}`)}}const y=e=>{let{children:t}=e;const{_id:n}=(0,c.O)(),{fileTreeReadOnly:y}=(0,d.Q)(),{indexAllReferences:C}=(0,m.B4)(),{write:w}=(0,f.Tg)(),[k,A]=(0,r.useReducer)(y?v:b,_),{fileTreeData:E,dispatchRename:S,dispatchMove:N}=(0,d.Q)(),{selectedEntityIds:F,isRootFolderSelected:T}=(0,u.G1)(),[R,L]=(0,r.useState)(null),P=(0,r.useCallback)((()=>{A({type:j.START_RENAME})}),[]),I=(0,r.useCallback)((e=>{const t=Array.from(F)[0],r=(0,o.k3)(E,t),i=r.entity.name;if(e===i)return A({type:j.CLEAR});const c=function(e,t,n){if(!(0,l.tL)(n))return new p.di;if(!(0,a.MS)(e,t.parentFolderId,n))return new p.Lc;const r=1===t.path.length,i="folder"===t.type;if(r&&!i&&(0,l.kW)(n))return new p.yG}(E,r,e);return c?A({type:j.ERROR,error:c}):(A({type:j.CLEAR}),S(t,e),(0,s.Mb)(n,r.type,r.entity._id,e).catch((e=>{S(t,i),A({type:j.ERROR,error:e})})))}),[S,E,n,F]),D=(0,r.useCallback)(((e,t)=>!(0,a.MS)(E,e,t)),[E]),O=(0,r.useCallback)((()=>{const e=Array.from(F).map((e=>(0,o.k3)(E,e).entity));A({type:j.START_DELETE,actionedEntities:e})}),[E,F]),B=(0,r.useCallback)((()=>{A({type:j.DELETING});let e=!1;return(0,i._)(Array.from(F),(t=>{const r=(0,o.k3)(E,t);return e=e||/\.bib$/.test(r.entity.name),(0,s.Dl)(n,r.type,r.entity._id).catch((e=>{if(404!==e.info.statusCode)throw e}))})).then((()=>{e&&C(!0),A({type:j.CLEAR})})).catch((e=>{A({type:j.ERROR,error:e})}))}),[E,n,F,C]),M=(0,r.useCallback)(((e,t)=>{A({type:j.MOVING});const r=Array.from(t).map((e=>(0,o.k3)(E,e))).filter((n=>n.parentFolderId!==e&&!t.has(n.parentFolderId))),c=e===E._id,d=r.map((t=>function(e,t,n,r){if(!(0,a.MS)(e,t,n.entity.name)){const e=new p.ui;return e.entityName=n.entity.name,e}const i="folder"===n.type;if(r&&!i&&(0,l.kW)(n.entity.name))return new p.yG}(E,e,t,c))).find((e=>e));if(d)return A({type:j.ERROR,error:d});const u={};let m=!1;return r.forEach((t=>{u[t.entity._id]=t.parentFolderId,N(t.entity._id,e)})),(0,i._)(r,(async t=>{try{await(0,s.r_)(n,t.type,t.entity._id,e)}catch(e){m=!0,N(t.entity._id,u[t.entity._id]),A({type:j.ERROR,error:e})}})).then((()=>{m||A({type:j.CLEAR})}))}),[N,E,n]),$=(0,r.useCallback)((()=>{A({type:j.START_CREATE_FOLDER})}),[]),z=(0,r.useMemo)((()=>function(e,t,n){if(n)return e._id;const r=Array.from(t)[0];if(!r)return e._id;const i=(0,o.lE)(e,r);if(!i)return e._id;return"folder"===i.type?i.entity._id:i.parentFolderId}(E,F,T)),[E,F,T]),q=(0,r.useMemo)((()=>{if(1===F.size){const[e]=F,t=(0,o.lE)(E,e);return t?.entity?.name}return null}),[E,F]),V=(0,r.useCallback)((e=>{const t=function(e,t,n){if(!(0,l.tL)(n.name))return new p.di;if(!(0,a.MS)(e,t,n.name))return new p.Lc;const r=t===e._id,i="folder"===n.endpoint;if(r&&!i&&(0,l.kW)(n.name))return new p.yG}(E,z,e);return t?Promise.reject(t):(0,s.xy)(n,z,e)}),[E,z,n]),U=(0,r.useCallback)((e=>(A({type:j.CREATING_FOLDER}),V({endpoint:"folder",name:e}).then((()=>{A({type:j.CLEAR})})).catch((e=>{A({type:j.ERROR,error:e})})))),[V]),H=(0,r.useCallback)((e=>{A({type:j.START_CREATE_FILE,newFileCreateMode:e})}),[]),G=(0,r.useCallback)((()=>{H("doc")}),[H]),K=(0,r.useCallback)((()=>{H("upload")}),[H]),Y=(0,r.useCallback)((e=>(A({type:j.CREATING_FILE}),V(e).then((()=>{A({type:j.CLEAR})})).catch((e=>{A({type:j.ERROR,error:e})})))),[V]),W=(0,r.useCallback)((e=>(e.endpoint="doc",Y(e))),[Y]),Q=(0,r.useCallback)((e=>(e.endpoint="linked_file",Y(e))),[Y]),X=(0,r.useCallback)((()=>{A({type:j.CANCEL})}),[]);(0,r.useEffect)((()=>{function e(e){A({type:j.START_CREATE_FILE,newFileCreateMode:e.detail.mode})}return window.addEventListener("file-tree.start-creating",e),()=>{window.removeEventListener("file-tree.start-creating",e)}}),[]);const Z=(0,r.useMemo)((()=>{if(1===F.size){const[e]=F,t=(0,o.lE)(E,e);if("fileRef"===t?.type)return(0,h.i)(n,e,t.entity.hash);if("doc"===t?.type)return`/project/${n}/doc/${e}/download`}}),[E,n,F]),J=(0,r.useMemo)((()=>({canDelete:w&&F.size>0&&!T,canRename:w&&1===F.size&&!T,canCreate:w&&F.size<2,...k,parentFolderId:z,selectedFileName:q,isDuplicate:D,startRenaming:P,finishRenaming:I,startDeleting:O,finishDeleting:B,finishMoving:M,startCreatingFile:H,startCreatingFolder:$,finishCreatingFolder:U,startCreatingDocOrFile:G,startUploadingDocOrFile:K,finishCreatingDoc:W,finishCreatingLinkedFile:Q,cancel:X,droppedFiles:R,setDroppedFiles:L,downloadPath:Z})),[X,Z,R,W,U,Q,B,M,I,D,T,z,F.size,q,G,H,$,O,P,K,k,w]);return(0,g.jsx)(x.Provider,{value:J,children:t})};function C(){const e=(0,r.useContext)(x);if(!e)throw new Error("useFileTreeActionable is only available inside FileTreeActionableProvider");return e}},93045:(e,t,n)=>{n.d(t,{U:()=>i});var r=n(14041);function i(){const e=(0,r.useRef)(null),[t,n]=(0,r.useState)(!1),i=(0,r.useCallback)((()=>n(!1)),[]);return(0,r.useEffect)((()=>{if(t)return;let r=null;return e.current&&(r=window.requestAnimationFrame((()=>{e.current&&(e.current.focus(),n(!0),r=null)}))),()=>{null!==r&&window.cancelAnimationFrame(r)}})),{autoFocusedRef:e,resetAutoFocus:i}}},94355:(e,t,n)=>{n.d(t,{Kn:()=>a,l_:()=>s});var r=n(97900);n(47200);const i=(e,t,n)=>{const i=(0,r.G2)(e,...n);if(i){const e=t.doc.sliceString(i.from,i.to);if(e.length>0)return e}return null},s=(e,t,n,s)=>{if(t.type.is("NewCommand")||t.type.is("RenewCommand")){if(!s(t.node))return;const o=i(t.node,e,["LiteralArgContent","Csname"]);if(null===o)return;const a=t.node.getChildren("OptionalArgument");let l=0;if(a.length>0){const t=a[0],n=(0,r.H)(e,t);if(n)try{l=parseInt(n,10)}catch(e){}}const c=2===a.length;c&&l>0&&l--,n.push({line:e.doc.lineAt(t.from).number,title:o,from:t.from,to:t.to,optionalArgCount:c?1:0,requiredArgCount:l,type:"definition",raw:e.sliceDoc(t.from,t.to)})}else if(t.type.is("Def")){if(!s(t.node))return;const r=i(t.node,e,["Csname","CtrlSym"]);if(null===r)return;const o=t.node.getChildren("MacroParameter").length,a=t.node.getChildren("OptionalMacroParameter").length;n.push({line:e.doc.lineAt(t.from).number,title:r,from:t.from,to:t.to,optionalArgCount:a,requiredArgCount:o,type:"definition",raw:e.sliceDoc(t.from,t.to)})}else if(t.type.is("Let")){if(!s(t.node))return;const r=i(t.node,e,["Csname"]);if(null===r)return;n.push({line:e.doc.lineAt(t.from).number,title:r,from:t.from,to:t.to,ignoreInAutocomplete:!0,optionalArgCount:void 0,requiredArgCount:void 0,type:"definition",raw:e.sliceDoc(t.from,t.to)})}else if(t.type.is("UnknownCommand")||t.type.is("KnownCommand")||t.type.is("MathUnknownCommand")||t.type.is("DefinitionFragmentUnknownCommand")){if(!s(t.node))return;let r=t.node;if(t.type.is("KnownCommand")&&(r=r.firstChild),!r)return;const i=r.getChild("$CtrlSeq");if(!i)return;if(i.type.is("$CtrlSym"))return;const o=r.getChildren("OptionalArgument"),a=r.getChildren("$Argument"),l=e.doc.sliceString(i.from,i.to);n.push({line:e.doc.lineAt(r.from).number,title:l,from:r.from,to:r.to,optionalArgCount:o.length,requiredArgCount:a.length-o.length,type:"usage",raw:void 0})}},o={tex:0,pdf:1},a=(e,t,n)=>{if("\\texorpdfstring"===i(t.node,e,["CtrlSeq"])){const r=t.getChildren("TextArgument")[o[n]]?.getChild("LongArg");if(r)return e.doc.sliceString(r.from,r.to)}}},97900:(e,t,n)=>{n.d(t,{B9:()=>nodeHasError,G2:()=>o,H:()=>s,I8:()=>i});n(82438),n(34840);var r=n(29587);const i=(e,t,n)=>{const i=(0,r.a_)(e,t,100);if(!i)return null;const s=i.resolve(t),o=s?.prevSibling;return o?.type.name===n},s=(e,t)=>{const n=t.getChild("ShortOptionalArg");if(n)return e.doc.sliceString(n.from,n.to)},nodeHasError=e=>{let t=!1;return e.cursor().iterate((e=>{let{type:n}=e;return!t&&(!n.isError||(t=!0,!1))})),t},o=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let i=null;return e.cursor().iterate((e=>{if(null!==i)return!1;for(const t of n)if(e.type.is(t))return i=e.node,!1;return!0})),i}},98843:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(14041),i=n(54830),s=n(60347),o=n(60961);const a=(e,t)=>{if(!e)return!0;if(e.length!==t.length)return!0;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];if(r.level!==i.level||r.line!==i.line||r.title!==i.title)return!0}return!1};function l(){const{flatOutline:e}=(0,i.X)(),[t,n]=(0,r.useState)((()=>({items:[],partial:!1}))),l=(0,r.useRef)(void 0);return(0,r.useEffect)((()=>{const t=l.current;l.current=e,e?a(t?.items,e.items)&&(o.$.log("Rebuilding changed outline"),n({items:(0,s.z_)(e.items),partial:e.partial})):n({items:[],partial:!1})}),[e]),t}}},e=>(e.O(0,[7582,277,6259,7774,613,5250,4159,6713,4120,3199,9420,1178,3173,6366,7011,3397,4746,3772,6230,3025],(()=>{return t=19405,e(e.s=t);var t})),e.O())])));