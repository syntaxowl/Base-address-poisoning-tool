(self.webpackChunkFrontend=self.webpackChunkFrontend||[]).push([[3025],{1651:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(33101);class s{constructor(e){r.instance(e,o),this.chunk=e}toRaw(){return{chunk:this.chunk.toRaw()}}static fromRaw(e){return e?new s(o.fromRaw(e.chunk)):null}getChunk(){return this.chunk}}e.exports=s},2058:(e,t)=>{"use strict";t.containsNonBmpChars=function(e){return/[\uD800-\uDBFF]/.test(e)}},2085:(e,t,n)=>{n(97107);const r=n(37603);class o{constructor(e,t){if(e<0||t<0)throw new r("Invalid range",{pos:e,length:t});this.pos=e,this.length=t}get start(){return this.pos}get end(){return this.pos+this.length}equals(e){return this.pos===e.pos&&this.length===e.length}startsAfter(e){return this.start>=e.end}startIsAfter(e){return this.start>e}isEmpty(){return 0===this.length}contains(e){return this.start<=e.start&&this.end>=e.end}containsCursor(e){return this.start<=e&&this.end>=e}overlaps(e){return this.start<e.end&&this.end>e.start}touches(e){return this.end===e.start||this.start===e.end}subtract(e){if(this.contains(e))return this.shrinkBy(e.length);if(e.contains(this))return new o(this.pos,0);if(e.overlaps(this)){if(e.start<this.start){const t=e.end-this.start;return new o(e.pos,this.length-t)}{const t=this.end-e.start;return new o(this.pos,this.length-t)}}return new o(this.pos,this.length)}canMerge(e){return this.overlaps(e)||this.touches(e)}merge(e){if(!this.canMerge(e))throw new Error("Ranges cannot be merged");const t=Math.min(this.pos,e.pos),n=Math.max(this.end,e.end);return new o(t,n-t)}moveBy(e){return new o(this.pos+e,this.length)}extendBy(e){return new o(this.pos,this.length+e)}shrinkBy(e){const t=this.length-e;if(t<0)throw new Error("Cannot shrink range by more than its length");return new o(this.pos,t)}insertAt(e,t){if(!this.containsCursor(e))throw new Error("The cursor must be contained in the range");const n=new o(this.pos,e-this.pos);return[n,new o(e,t),new o(e+t,this.length-n.length)]}toRaw(){return{pos:this.pos,length:this.length}}static fromRaw(e){return new o(e.pos,e.length)}splitAt(e){if(!this.containsCursor(e))throw new Error("The cursor must be contained in the range");const t=new o(this.pos,e-this.pos);return[t,new o(e,this.length-t.length)]}}e.exports=o},3218:(e,t,n)=>{"use strict";function r(e){if(!e)return 0;const t=Math.ceil((e-performance.now())/1e3);return t>0?t:0}n.d(t,{C:()=>r})},5804:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});n(82438),n(50020);function r(e){const t=(new TextEncoder).encode(e),n=function(e){const t=[];for(let n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t}(t),r=8*t.length,o=[];let s=1732584193,i=-271733879,a=-1732584194,c=271733878,l=-1009589776;n[r>>5]|=128<<24-r%32,n[15+(r+64>>>9<<4)]=r;for(let e=0;e<n.length;e+=16){const t=s,r=i,h=a,d=c,u=l;for(let t=0;t<80;t++){if(t<16)o[t]=n[e+t];else{const e=o[t-3]^o[t-8]^o[t-14]^o[t-16];o[t]=e<<1|e>>>31}const r=(s<<5|s>>>27)+l+(o[t]>>>0)+(t<20?1518500249+(i&a|~i&c):t<40?1859775393+(i^a^c):t<60?(i&a|i&c|a&c)-1894007588:(i^a^c)-899497514);l=c,c=a,a=i<<30|i>>>2,i=s,s=r}s+=t,i+=r,a+=h,c+=d,l+=u}return function(e){const t=[];for(let n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t}([s,i,a,c,l]).map((e=>e.toString(16).padStart(2,"0"))).join("")}},5805:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(10646);const o=function(){const{permissionsLevel:e}=(0,r.mi)();return"readOnly"===e}},6203:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(97277),s=n(12628);class i extends s{constructor(e,t){super(),r.match(e,o.HEX_HASH_RX,"BinaryFileData: bad hash"),r.integer(t,"BinaryFileData: bad byteLength"),r.greaterOrEqual(t,0,"BinaryFileData: low byteLength"),this.hash=e,this.byteLength=t}static fromRaw(e){return new i(e.hash,e.byteLength)}toRaw(){return{hash:this.hash,byteLength:this.byteLength}}getHash(){return this.hash}isEditable(){return!1}getByteLength(){return this.byteLength}async toEager(){return this}async toLazy(){return this}async toHollow(){return s.createHollow(this.byteLength,null)}async store(){return{hash:this.hash}}}e.exports=i},6599:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(14041);function o(e,t,n){(0,r.useEffect)((()=>(e.on(t,n),()=>{e.removeListener(t,n)})),[t,n,e])}},6638:(e,t,n)=>{"use strict";e.exports=n.p+"images/sparkle-small-white-65edf3aa0af0ec40e8b5.svg"},6896:(e,t,n)=>{"use strict";n.d(t,{b_:()=>c,jr:()=>i,k3:()=>s,lE:()=>l});n(82438),n(57327),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539);var r=n(37603),o=n.n(r);function s(e,t){const n=l(e,t);if(n)return n;throw new(o())("Entity not found in tree",{entityId:t})}function i(e,t){const n=new Set;return t.forEach((t=>{n.add(s(e,t))})),n}function a(e){const t=new Set([e._id]);for(const n in e.folders){a(e.folders[n]).forEach((e=>{t.add(e)}))}return t}function c(e){const t=new Set;return e.forEach((e=>{a(e).forEach((e=>{t.add(e)}))})),t}function l(e,t,n){n||(n=[e._id]);for(const r in e.docs){const o=e.docs[r];if(o._id===t)return{entity:o,type:"doc",parent:e.docs,parentFolderId:e._id,path:n,index:Number(r)}}for(const r in e.fileRefs){const o=e.fileRefs[r];if(o._id===t)return{entity:o,type:"fileRef",parent:e.fileRefs,parentFolderId:e._id,path:n,index:Number(r)}}for(const r in e.folders){const o=e.folders[r];if(o._id===t)return{entity:o,type:"folder",parent:e.folders,parentFolderId:e._id,path:n,index:Number(r)};const s=l(o,t,n.concat(o._id));if(s)return s}return null}},7174:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(97434),o=n(45330),s=n(31085);const i=function(e){let{type:t}=e;const{t:n}=(0,r.Bd)(),i=(0,s.jsx)(r.x6,{i18nKey:"try_recompile_project_or_troubleshoot",components:[(0,s.jsx)("a",{href:"/learn/how-to/Resolving_access%2C_loading%2C_and_display_problems",target:"_blank"},"troubleshooting-link")]});switch(t){case"pdf":return(0,s.jsxs)(o.j,{children:[(0,s.jsx)("p",{children:n("pdf_viewer_error")}),(0,s.jsx)("p",{children:i})]});case"logs":return(0,s.jsxs)(o.j,{children:[(0,s.jsx)("p",{children:n("log_viewer_error")}),(0,s.jsx)("p",{children:i})]});default:return(0,s.jsxs)(o.j,{children:[(0,s.jsx)("p",{children:n("pdf_preview_error")}),(0,s.jsx)("p",{children:i})]})}}},7707:(e,t,n)=>{"use strict";n.d(t,{K:()=>i,W:()=>a});n(97107),n(82438),n(50020);var r=n(14041),o=n(31085);const s=(0,r.createContext)(void 0),i=e=>{let{children:t}=e;const[n,i]=(0,r.useState)(new Map),a=(0,r.useCallback)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i((e=>new Map([...e,...t.map((e=>[e.id,e]))])))}),[]),c=(0,r.useCallback)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i((e=>new Map([...e].filter((e=>{let[n]=e;return!t.includes(n)})))))}),[]);return(0,o.jsx)(s.Provider,{value:{registry:n,register:a,unregister:c},children:t})},a=()=>{const e=(0,r.useContext)(s);if(!e)throw new Error("useCommandRegistry must be used within a CommandRegistryProvider");return e}},7881:(e,t,n)=>{"use strict";n.d(t,{e4:()=>s});const r={monaco:["Monaco","Menlo","Ubuntu Mono","Consolas","monospace"],lucida:["Lucida Console","Source Code Pro","monospace"],opendyslexicmono:["OpenDyslexic Mono","monospace"]},o={compact:1.33,normal:1.6,wide:2},s=e=>{let{fontFamily:t,fontSize:n,lineHeight:s}=e;return{fontFamily:r[t]?.join(","),fontSize:`${n}px`,lineHeight:o[s]}}},8010:(e,t,n)=>{"use strict";n(97107);const r=n(45250),o=n(64347).assert,s=n(65734);let i=null,a=null,c=null,l=null,h=null;class d{static fromRaw(e){if("file"in e)return a.fromRaw(e);if("textOperation"in e||"commentId"in e||"deleteComment"in e)return l.fromRaw(e);if("newPathname"in e)return new c(e.pathname,e.newPathname);if("metadata"in e)return new h(e.pathname,e.metadata);if(r.isEmpty(e))return new i;throw new Error("invalid raw operation "+JSON.stringify(e))}toRaw(){return{}}isNoOp(){return!1}findBlobHashes(e){}async loadFiles(e,t){}async store(e){return this.toRaw()}applyTo(e){o.object(e,"bad snapshot")}canBeComposedWithForUndo(e){return!1}canBeComposedWith(e){return!1}compose(e){throw new Error("not implemented")}static transform(e,t){if(e.isNoOp()||t.isNoOp())return[e,t];function n(n){return n(t,e).reverse()}const r=t instanceof a,o=t instanceof l,i=t instanceof c,w=t instanceof h;if(e instanceof a){if(r)return function(e,t){if(e.getPathname()===t.getPathname())return[d.NO_OP,t];return[e,t]}(e,t);if(i)return u(e,t);if(o)return p(e,t);if(w)return g(e,t);throw new Error("bad op b")}if(e instanceof c){if(r)return n(u);if(i)return function(e,t){const n=e.getPathname(),r=t.getPathname(),o=e.getNewPathname(),s=t.getNewPathname();if(n===r&&o===s)return[d.NO_OP,d.NO_OP];if(n===o&&r===s)return[d.NO_OP,d.NO_OP];if(n===o)return[d.NO_OP,t];if(r===s)return[e,d.NO_OP];if(n===s&&r===o)return[d.removeFile(n),d.removeFile(r)];if(n===r&&o!==s)return[d.NO_OP,d.moveFile(o,s)];if(o===s&&n!==r)return[d.removeFile(n),t];if(n===s&&o!==r)return[d.moveFile(s,o),d.moveFile(r,o)];if(o===r&&n!==s)return[d.moveFile(n,s),d.moveFile(o,s)];return[e,t]}(e,t);if(o)return m(e,t);if(w)return f(e,t);throw new Error("bad op b")}if(e instanceof l){if(r)return n(p);if(i)return n(m);if(o)return function(e,t){if(e.getPathname()===t.getPathname()){const n=s.transform(e.getOperation(),t.getOperation());return[d.editFile(e.getPathname(),n[0]),d.editFile(t.getPathname(),n[1])]}return[e,t]}(e,t);if(w)return _(e,t);throw new Error("bad op b")}if(e instanceof h){if(r)return n(g);if(i)return n(f);if(o)return n(_);if(w)return function(e,t){if(e.getPathname()===t.getPathname())return[d.NO_OP,t];return[e,t]}(e,t);throw new Error("bad op b")}throw new Error("bad op a")}static transformMultiple(e,t){for(let n=0;n<e.length;++n)for(let r=0;r<t.length;++r){const o=d.transform(e[n],t[r]);e[n]=o[0],t[r]=o[1]}}static addFile(e,t){return new a(e,t)}static editFile(e,t){return new l(e,t)}static moveFile(e,t){return new c(e,t)}static removeFile(e){return new c(e,"")}static setFileMetadata(e,t){return new h(e,t)}}function u(e,t){function n(){return new a(t.getNewPathname(),e.getFile().clone())}return e.getPathname()===t.getPathname()?t.isRemoveFile()?[e,d.NO_OP]:[n(),new c(e.getPathname(),t.getNewPathname())]:e.getPathname()===t.getNewPathname()?[n(),new c(t.getPathname(),"")]:[e,t]}function p(e,t){return e.getPathname()===t.getPathname()?[e,d.NO_OP]:[e,t]}function g(e,t){if(e.getPathname()===t.getPathname()){const n=e.getFile().clone();return n.setMetadata(t.getMetadata()),[new a(e.getPathname(),n),t]}return[e,t]}function m(e,t){return e.getPathname()===t.getPathname()?e.isRemoveFile()?[e,d.NO_OP]:[e,d.editFile(e.getNewPathname(),t.getOperation())]:e.getNewPathname()===t.getPathname()?[e,d.NO_OP]:[e,t]}function f(e,t){return e.getPathname()===t.getPathname()?[e,d.setFileMetadata(e.getNewPathname(),t.getMetadata())]:e.getNewPathname()===t.getPathname()?[e,d.NO_OP]:[e,t]}function _(e,t){return[e,t]}e.exports=d,i=n(27673),a=n(87520),c=n(84140),l=n(82927),h=n(63821),d.NO_OP=new i},8164:(e,t,n)=>{"use strict";n.d(t,{oG:()=>u,Rf:()=>p});n(97107);var r=n(14041),o=n(80760),s=n(37939);const i=function(e,t,n,o){const[i,a]=(0,s.A)(e,t,n,o);return(0,r.useEffect)((()=>{a(t)}),[a,t]),[i,a]};var a=n(94234),c=n(88495),l=n(56447);var h=n(31085);const d=(0,r.createContext)(void 0),u=e=>{let{children:t}=e;const n=(0,o.tB)();if(!n)throw new Error("DetachCompileProvider is only available inside LocalCompileProvider");const{animateCompileDropdownArrow:s,autoCompile:u,clearingCache:p,clsiServerId:g,codeCheckFailed:m,compiling:f,deliveryLatencies:_,draft:w,editedSinceCompileStarted:v,error:b,fileList:y,hasChanges:x,hasShortCompileTimeout:k,highlights:C,isProjectOwner:E,lastCompileOptions:T,logEntries:j,logEntryAnnotations:I,pdfFile:S,pdfViewer:A,position:L,rawLog:O,setAnimateCompileDropdownArrow:R,setAutoCompile:P,setDraft:M,setError:F,setHasLintingError:D,setHighlights:N,setPosition:X,setShowCompileTimeWarning:$,setShowLogs:U,toggleLogs:V,setStopOnFirstError:B,setStopOnValidationError:H,showLogs:W,showCompileTimeWarning:z,stopOnFirstError:J,stopOnValidationError:q,stoppedOnFirstError:K,uncompiled:G,validationIssues:Y,firstRenderDone:Q,cleanupCompileResult:Z,recompileFromScratch:ee,setCompiling:te,startCompile:ne,stopCompile:re,setChangedAt:oe,clearCache:se,syncToEntry:ie,recordAction:ae}=n,[ce]=i("animateCompileDropdownArrow",s,"detacher","detached"),[le]=i("autoCompile",u,"detacher","detached"),[he]=i("clearingCache",p,"detacher","detached"),[de]=i("clsiServerId",g,"detacher","detached"),[ue]=i("codeCheckFailed",m,"detacher","detached"),[pe]=i("compiling",f,"detacher","detached"),[ge]=i("deliveryLatencies",_,"detacher","detached"),[me]=i("draft",w,"detacher","detached"),[fe]=i("error",b,"detacher","detached"),[_e]=i("fileList",y,"detacher","detached"),[we]=i("hasChanges",x,"detacher","detached"),[ve]=i("hasShortCompileTimeout",k,"detacher","detached"),[be]=i("highlights",C,"detacher","detached"),[ye]=i("isProjectOwner",E,"detacher","detached"),[xe]=i("lastCompileOptions",T,"detacher","detached"),[ke]=i("logEntries",j,"detacher","detached"),[Ce]=i("logEntryAnnotations",I,"detacher","detached"),[Ee]=i("pdfFile",S,"detacher","detached"),[Te]=i("pdfViewer",A,"detacher","detached"),[je]=i("position",L,"detacher","detached"),[Ie]=i("rawLog",O,"detacher","detached"),[Se]=i("showCompileTimeWarning",z,"detacher","detached"),[Ae]=i("showLogs",W,"detacher","detached"),[Le]=i("stopOnFirstError",J,"detacher","detached"),[Oe]=i("stopOnValidationError",q,"detacher","detached"),[Re]=i("stoppedOnFirstError",K,"detacher","detached"),[Pe]=i("uncompiled",G,"detacher","detached"),[Me]=i("editedSinceCompileStarted",v,"detacher","detached"),[Fe]=i("validationIssues",Y,"detacher","detached"),De=(0,a.A)("setAnimateCompileDropdownArrow",R,"detached","detacher"),Ne=(0,a.A)("setAutoCompile",P,"detached","detacher"),Xe=(0,a.A)("setDraft",M,"detached","detacher"),$e=(0,a.A)("setError",F,"detacher","detached"),Ue=(0,a.A)("setPosition",X,"detached","detacher"),Ve=(0,a.A)("firstRenderDone",Q,"detached","detacher"),Be=(0,a.A)("setHasLintingError",D,"detacher","detached"),He=(0,a.A)("setHighlights",N,"detacher","detached"),We=(0,a.A)("setShowCompileTimeWarning",$,"detached","detacher"),ze=(0,a.A)("setShowLogs",U,"detached","detacher"),Je=(0,a.A)("toggleLogs",V,"detached","detacher"),qe=(0,a.A)("setStopOnFirstError",B,"detached","detacher"),Ke=(0,a.A)("setStopOnValidationError",H,"detached","detacher"),Ge=(0,a.A)("cleanupCompileResult",Z,"detached","detacher"),Ye=(0,a.A)("recompileFromScratch",ee,"detached","detacher"),Qe=(0,a.A)("setCompiling",te,"detacher","detached"),Ze=(0,a.A)("startCompile",ne,"detached","detacher"),et=(0,a.A)("stopCompile",re,"detached","detacher"),tt=(0,a.A)("setChangedAt",oe,"detached","detacher"),nt=(0,a.A)("clearCache",se,"detached","detacher"),rt=(0,a.A)("sync-to-entry",ie,"detached","detacher"),ot=(0,a.A)("record-action",ae,"detached","detacher");(0,c.A)(Ze,tt),(e=>{const{pdfLayout:t,setView:n}=(0,l.LV)();(0,r.useEffect)((()=>{const r=r=>{const{id:o,suggestFix:s}=r.detail;e(!0),"flat"===t&&n("pdf"),window.setTimeout((()=>{const e=document.querySelector(`.log-entry[data-log-entry-id="${o}"]`);if(e&&(e.scrollIntoView({block:"start",inline:"nearest"}),s)){const t=document.querySelector('button[data-action="assistant-paywall-show"]');t?(t.scrollIntoView({block:"start",inline:"nearest"}),t.click()):e.querySelector('button[data-action="suggest-fix"]')?.click()}}))};return window.addEventListener("editor:view-compile-log-entry",r),()=>{window.removeEventListener("editor:view-compile-log-entry",r)}}),[t,n,e])})(ze);const st=(0,r.useMemo)((()=>({animateCompileDropdownArrow:ce,autoCompile:le,clearCache:nt,clearingCache:he,clsiServerId:de,codeCheckFailed:ue,compiling:pe,deliveryLatencies:ge,draft:me,editedSinceCompileStarted:Me,error:fe,fileList:_e,hasChanges:we,hasShortCompileTimeout:ve,highlights:be,isProjectOwner:ye,lastCompileOptions:xe,logEntryAnnotations:Ce,logEntries:ke,pdfDownloadUrl:Ee?.pdfDownloadUrl,pdfFile:Ee,pdfUrl:Ee?.pdfUrl,pdfViewer:Te,position:je,rawLog:Ie,recompileFromScratch:Ye,setAnimateCompileDropdownArrow:De,setAutoCompile:Ne,setCompiling:Qe,setDraft:Xe,setError:$e,setHasLintingError:Be,setHighlights:He,setPosition:Ue,setShowCompileTimeWarning:We,setShowLogs:ze,toggleLogs:Je,setStopOnFirstError:qe,setStopOnValidationError:Ke,showLogs:Ae,showCompileTimeWarning:Se,startCompile:Ze,stopCompile:et,stopOnFirstError:Le,stopOnValidationError:Oe,stoppedOnFirstError:Re,uncompiled:Pe,validationIssues:Fe,firstRenderDone:Ve,setChangedAt:tt,cleanupCompileResult:Ge,syncToEntry:rt,recordAction:ot})),[ce,le,nt,he,de,ue,pe,ge,me,Me,fe,_e,we,ve,be,ye,xe,Ce,ke,Ee,Te,je,Ie,Ye,De,Ne,Qe,Xe,$e,Be,He,Ue,We,ze,Je,qe,Ke,Se,Ae,Ze,et,Le,Oe,Re,Pe,Fe,Ve,tt,Ge,rt,ot]);return(0,h.jsx)(d.Provider,{value:st,children:t})};function p(){const e=(0,r.useContext)(d);if(!e)throw new Error("useDetachCompileContext is ony available inside DetachCompileProvider");return e}},10048:(e,t,n)=>{"use strict";n(82438),n(50020);const r=n(64347).assert,o=n(99568),s=n(35078),i=n(8010);class a{constructor(e,t,n,s){r.integer(e,"bad baseVersion"),r.array.of.object(t,"bad operations"),r.maybe.boolean(n,"ChangeRequest: bad untransformable"),s=s||[],o.assertV1(s,"bad authors"),this.authors=s,this.baseVersion=e,this.operations=t,this.untransformable=n||!1}toRaw(){return{baseVersion:this.baseVersion,operations:this.operations.map((function(e){return e.toRaw()})),untransformable:this.untransformable,authors:this.authors}}static fromRaw(e){return r.array.of.object(e.operations,"bad raw.operations"),new a(e.baseVersion,e.operations.map(i.fromRaw),e.untransformable,e.authors)}getBaseVersion(){return this.baseVersion}isUntransformable(){return this.untransformable}makeChange(e){return new s(this.operations,e,this.authors)}}e.exports=a},10228:(e,t,n)=>{"use strict";n.d(t,{F:()=>O});var r=n(99806),o=n(16896),s=n(8164),i=n(93588),a=n(68543),c=n(10646),l=n(60440),h=n(11326),d=n(89997),u=n(13271),p=n(56447),g=n(80760),m=n(13877),f=n(83096),_=n(52036),w=n(54830),v=n(58516),b=n(86316),y=n(70569),x=n(41416),k=n(94012),C=n(65982),E=n(17112),T=n(85960),j=n(59722),I=n(66020),S=n(86040),A=n(7707),L=n(31085);const O=e=>{let{children:t,providers:n={}}=e;const O={ChatProvider:r.k_,ConnectionProvider:o.Sg,DetachCompileProvider:s.oG,DetachProvider:i.lt,EditorManagerProvider:a.al,EditorProvider:c.zz,FileTreeDataProvider:l._,FileTreeOpenProvider:h.Q,FileTreePathProvider:d.rL,IdeReactProvider:u.HA,LayoutProvider:p.UY,LocalCompileProvider:g.eS,MetadataProvider:m.Xj,ModalsContextProvider:f.B,OnlineUsersProvider:_.VH,OutlineProvider:w.i,PermissionsProvider:v.wy,ProjectProvider:b.N,ProjectSettingsProvider:x.Gn,RailProvider:y.S,ReferencesProvider:k.iH,SnapshotProvider:C.yg,SplitTestProvider:E.M6,UserProvider:T.vu,UserSettingsProvider:I.wI,IdeRedesignSwitcherProvider:S.Wz,CommandRegistryProvider:A.K,UserFeaturesProvider:j.Wg,...n};return(0,L.jsx)(O.SplitTestProvider,{children:(0,L.jsx)(O.ModalsContextProvider,{children:(0,L.jsx)(O.ConnectionProvider,{children:(0,L.jsx)(O.IdeReactProvider,{children:(0,L.jsx)(O.UserProvider,{children:(0,L.jsx)(O.UserSettingsProvider,{children:(0,L.jsx)(O.ProjectProvider,{children:(0,L.jsx)(O.SnapshotProvider,{children:(0,L.jsx)(O.FileTreeDataProvider,{children:(0,L.jsx)(O.FileTreePathProvider,{children:(0,L.jsx)(O.ReferencesProvider,{children:(0,L.jsx)(O.DetachProvider,{children:(0,L.jsx)(O.EditorProvider,{children:(0,L.jsx)(O.UserFeaturesProvider,{children:(0,L.jsx)(O.PermissionsProvider,{children:(0,L.jsx)(O.RailProvider,{children:(0,L.jsx)(O.LayoutProvider,{children:(0,L.jsx)(O.ProjectSettingsProvider,{children:(0,L.jsx)(O.EditorManagerProvider,{children:(0,L.jsx)(O.LocalCompileProvider,{children:(0,L.jsx)(O.DetachCompileProvider,{children:(0,L.jsx)(O.ChatProvider,{children:(0,L.jsx)(O.FileTreeOpenProvider,{children:(0,L.jsx)(O.OnlineUsersProvider,{children:(0,L.jsx)(O.MetadataProvider,{children:(0,L.jsx)(O.OutlineProvider,{children:(0,L.jsx)(O.IdeRedesignSwitcherProvider,{children:(0,L.jsx)(O.CommandRegistryProvider,{children:t})})})})})})})})})})})})})})})})})})})})})})})})})})})})}},10646:(e,t,n)=>{"use strict";n.d(t,{mi:()=>f,zz:()=>m});n(97107),n(82438),n(34840);var r=n(14041),o=n(14936),s=n(30741),i=n(67353),a=n(86316),c=n(93588),l=n(64932),h=n(85960),d=n(14901),u=n(83096),p=n(31085);const g=(0,r.createContext)(void 0),m=e=>{let{children:t}=e;const{socket:n}=(0,i.nK)(),{id:m,featureUsage:f}=(0,h.ur)(),{role:_}=(0,c.Q2)(),{showGenericMessageModal:w}=(0,u.T)(),{owner:v,features:b,_id:y,members:x}=(0,a.O)(),k=(0,r.useMemo)((()=>{const e=(0,l.A)("ol-brandVariation");return e&&{logoImgUrl:e.logo_url,brandVariationName:e.name,brandVariationId:e.id,brandId:e.brand_id,brandVariationHomeUrl:e.home_url,publishGuideHtml:e.publish_guide_html,partner:e.partner,brandedMenu:e.branded_menu,submitBtnHtml:e.submit_button_html}}),[]),[C,E]=(0,o.A)("project.name"),[T,j]=(0,o.A)("permissionsLevel"),[I,S]=(0,r.useState)(!1),[A]=(0,o.A)("editor.showSymbolPalette"),[L]=(0,o.A)("editor.toggleSymbolPalette"),[O,R]=(0,r.useState)((()=>(0,l.A)("ol-inactiveTutorials")||[])),[P,M]=(0,r.useState)(null),[F,D]=(0,r.useState)(!1),[N,X]=(0,r.useState)((()=>Boolean(f?.aiErrorAssistant&&f?.aiErrorAssistant.remainingUsage>0))),[$,U]=(0,r.useState)((()=>f?.aiErrorAssistant?.resetDate?new Date(f.aiErrorAssistant.resetDate):new Date)),V=(0,r.useMemo)((()=>x?.some((e=>e._id===m&&(e.pendingEditor||e.pendingReviewer)))),[x,m]),B=(0,r.useCallback)((e=>{R([...O,e])}),[O]);(0,r.useEffect)((()=>{if(n)return n.on("projectNameUpdated",E),()=>n.removeListener("projectNameUpdated",E)}),[n,E]);const H=(0,r.useCallback)((e=>{E((t=>(t!==e&&(0,d.Y)(y,{name:e}).catch((e=>{E(t);const{data:n,status:r}=e;w("Error renaming project",400===r?n:"Please try again in a moment")})),e)))}),[E,y,w]),{setTitle:W}=(0,s.A)();(0,r.useEffect)((()=>{const e=[];"detached"===_&&e.push("[PDF]"),C&&(e.push(C),e.push("-")),e.push("Online LaTeX Editor"),e.push((0,l.A)("ol-ExposedSettings").appName);const t=e.join(" ");W(t)}),[C,W,_]);const z=(0,r.useCallback)((e=>{window.dispatchEvent(new CustomEvent("editor:insert-symbol",{detail:e}))}),[]),[J,q]=(0,r.useState)(null),K=(0,r.useMemo)((()=>({cobranding:k,hasPremiumCompile:"priority"===b?.compileGroup,renameProject:H,permissionsLevel:I?"readOnly":T,setPermissionsLevel:j,isProjectOwner:v?._id===m,isRestrictedTokenMember:(0,l.A)("ol-isRestrictedTokenMember"),isPendingEditor:V,showSymbolPalette:A,toggleSymbolPalette:L,insertSymbol:z,inactiveTutorials:O,deactivateTutorial:B,currentPopup:P,setCurrentPopup:M,setOutOfSync:S,hasPremiumSuggestion:N,setHasPremiumSuggestion:X,premiumSuggestionResetDate:$,setPremiumSuggestionResetDate:U,assistantUpgraded:F,setAssistantUpgraded:D,writefullInstance:J,setWritefullInstance:q})),[k,b?.compileGroup,v,m,H,T,j,V,A,L,z,O,B,P,M,I,S,N,X,$,U,F,D,J,q]);return(0,p.jsx)(g.Provider,{value:K,children:t})};function f(){const e=(0,r.useContext)(g);if(!e)throw new Error("useEditorContext is only available inside EditorProvider");return e}},10729:(e,t,n)=>{"use strict";const r=n(64347).assert;class o{constructor(e,t,n){r.number(e,"bad id"),r.string(t,"bad email"),r.string(n,"bad name"),this.id=e,this.email=t,this.name=n}static fromRaw(e){return e?new o(e.id,e.email,e.name):null}toRaw(){return{id:this.id,email:this.email,name:this.name}}getId(){return this.id}getEmail(){return this.email}getName(){return this.name}}e.exports=o},11326:(e,t,n)=>{"use strict";n.d(t,{Q:()=>p,r:()=>g});n(97107);var r=n(14041),o=n(86316),s=n(13271),i=n(68543),a=n(76113),c=n(60961),l=n(39891),h=n(69954),d=n(31085);const u=(0,r.createContext)(void 0),p=e=>{let{children:t}=e;const{rootDocId:n,owner:p}=(0,o.O)(),{eventEmitter:g,projectJoined:m}=(0,s.yn)(),{openDocWithId:f,currentDocumentId:_,openInitialDoc:w}=(0,i.TS)(),[,v]=(0,a.A)("openFile"),[b,y]=(0,r.useState)(null),[x,k]=(0,r.useState)(0),[C,E]=(0,r.useState)(!1),[T,j]=(0,r.useState)(!0),I=(0,r.useCallback)((()=>{j((e=>!e))}),[]),S=(0,r.useCallback)((()=>{E(!0)}),[]),A=(0,r.useCallback)((e=>{if(c.$.log("File tree selection changed",e),k(e.length),1!==e.length)return void y(null);const[t]=e;if("folder"===t.type)return;y(t),"doc"===t.type&&C&&(f(t.entity._id,{keepCurrentView:!0}),t.entity.name.endsWith(".bib")&&(0,h._)("open-bib-file",{projectOwner:p._id,isSampleFile:"sample.bib"===t.entity.name,linkedFileProvider:null}));const n="fileRef"===t.type?(0,l.D)(t.entity):null;v(n),n&&(t?.entity?.name?.endsWith(".bib")&&(0,h._)("open-bib-file",{projectOwner:p._id,isSampleFile:!1,linkedFileProvider:t.entity.linkedFileData?.provider}),window.dispatchEvent(new CustomEvent("file-view:file-opened")))}),[C,v,f,p]),L=(0,r.useCallback)((e=>{g.emit("entity:deleted",e),e.entity._id===_&&f(n)}),[g,_,f,n]),O=(0,r.useRef)(!1);(0,r.useEffect)((()=>{n&&C&&m&&!O.current&&(O.current=!0,w(n))}),[C,w,m,n]);const R=(0,r.useMemo)((()=>({selectedEntityCount:x,openEntity:b,handleFileTreeInit:S,handleFileTreeSelect:A,handleFileTreeDelete:L,fileTreeExpanded:T,toggleFileTreeExpanded:I})),[L,S,A,b,x,T,I]);return(0,d.jsx)(u.Provider,{value:R,children:t})},g=()=>{const e=(0,r.useContext)(u);if(!e)throw new Error("useFileTreeOpenContext is only available inside FileTreeOpenProvider");return e}},11485:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(35078);class s{constructor(e,t){r.integer(e,"bad baseVersion"),r.maybe.instance(t,o,"bad change"),this.baseVersion=e,this.change=t}toRaw(){return{baseVersion:this.baseVersion,change:this.change.toRaw()}}toRawWithoutChange(){return{baseVersion:this.baseVersion}}static fromRaw(e){return r.integer(e.baseVersion,"bad raw.baseVersion"),r.maybe.object(e.change,"bad raw.changes"),new s(e.baseVersion,o.fromRaw(e.change))}getBaseVersion(){return this.baseVersion}getResultVersion(){return this.baseVersion+1}getChange(){return this.change}}e.exports=s},12628:(e,t,n)=>{"use strict";n(97107);const r=n(64347).assert,o=n(97277);e.exports=class{static fromRaw(e){if(Object.prototype.hasOwnProperty.call(e,"hash"))return Object.prototype.hasOwnProperty.call(e,"byteLength")?s.fromRaw(e):Object.prototype.hasOwnProperty.call(e,"stringLength")?l.fromRaw(e):i.fromRaw(e);if(Object.prototype.hasOwnProperty.call(e,"byteLength"))return a.fromRaw(e);if(Object.prototype.hasOwnProperty.call(e,"stringLength"))return c.fromRaw(e);if(Object.prototype.hasOwnProperty.call(e,"content"))return h.fromRaw(e);throw new Error("FileData: bad raw object "+JSON.stringify(e))}static createHollow(e,t){return null==t?new a(e):new c(t)}static createLazyFromBlobs(e,t){r.instance(e,o,"FileData: bad blob");const n=e.getStringLength();return null==n?new s(e.getHash(),e.getByteLength()):new l(e.getHash(),t?.getHash(),n)}toRaw(){throw new Error("FileData: toRaw not implemented")}getHash(){return null}getRangesHash(){return null}getContent(){return null}isEditable(){return null}getByteLength(){return null}getStringLength(){return null}edit(e){throw new Error("edit not implemented for "+JSON.stringify(this))}async toEager(e){throw new Error("toEager not implemented for "+JSON.stringify(this))}async toLazy(e){throw new Error("toLazy not implemented for "+JSON.stringify(this))}async toHollow(e){throw new Error("toHollow not implemented for "+JSON.stringify(this))}async load(e,t){if("eager"===e)return await this.toEager(t);if("lazy"===e)return await this.toLazy(t);if("hollow"===e)return await this.toHollow(t);throw new Error("bad file data load kind: "+e)}async store(e){throw new Error("store not implemented for "+JSON.stringify(this))}getComments(){throw new Error("getComments not implemented for "+JSON.stringify(this))}getTrackedChanges(){throw new Error("getTrackedChanges not implemented for "+JSON.stringify(this))}};const s=n(6203),i=n(59622),a=n(96837),c=n(44285),l=n(82174),h=n(14679)},13271:(e,t,n)=>{"use strict";n.d(t,{HA:()=>E,yn:()=>T});n(97107);var r=n(14041),o=(n(82438),n(34840),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539),n(45250)),s=n.n(o),i=n(37664),a=n(60961);const c=Symbol("not found");function l(e){return null!==e&&"object"==typeof e&&!("length"in e&&"number"==typeof e.length&&e.length>0)}function h(e){const t=[];let n,r=e;for(;-1!==(n=r.lastIndexOf("."));)r=r.slice(0,n),t.push(r);return t}class d{items=(()=>new Map)();persisters=(()=>new Map)();watcherUpdates=(()=>new Map)();watcherUpdateTimer=null;allowedNonExistentPaths=[];nonExistentPathAllowed(e){return this.allowedNonExistentPaths.some((t=>t.path===e||t.deep&&e.startsWith(t.path+".")))}findInAncestors(e){for(const t of h(e)){const n=this.items.get(t);if(n&&"value"in n&&l(n.value)){const r=e.slice(t.length+1),o=s().get(n.value,r);if(o!==c)return{value:o,watchers:[]}}}return{watchers:[]}}getItem(e){const t=this.items.get(e)||this.findInAncestors(e);if(!("value"in t)){if(this.nonExistentPathAllowed(e))return a.$.log(`No value found for key '${e}'. This is allowed because the path is in allowedNonExistentPaths`),{value:void 0};throw new Error(`No value found for key '${e}'`)}return t}reassembleObjectValue(e,t){const n={...t},r=e+".";for(const[e,t]of this.items.entries())if(e.startsWith(r)){const o=e.slice(r.length);-1===o.indexOf(".")&&"value"in t&&(n[o]=t.value)}return n}flushUpdates(){this.watcherUpdateTimer&&(window.clearTimeout(this.watcherUpdateTimer),this.watcherUpdateTimer=null);const e=[...this.watcherUpdates.values()];this.watcherUpdates=new Map;for(const{value:t,watchers:n}of e)for(const e of n)e.removed||e.callback.call(null,t)}scheduleWatcherUpdate(e,t,n){const r={value:t,path:e,watchers:[...n]};this.watcherUpdates.set(e,r),this.watcherUpdateTimer||(this.watcherUpdateTimer=window.setTimeout((()=>{this.watcherUpdateTimer=null,this.flushUpdates()}),0))}get(e){return this.getItem(e).value}setValue(e,t){a.$.log("setValue",e,t);let n=this.items.get(e);if(void 0===n)n={value:t,watchers:[]},this.items.set(e,n);else if("value"in n){if(n.value===t)return;n.value=t}else n={...n,value:t},this.items.set(e,n);this.scheduleWatcherUpdate(e,t,n.watchers);const r=this.persisters.get(e);r&&i.A.setItem(r.localStorageKey,r.toPersisted?.(t)||t)}setValueAndDescendants(e,t){if(this.setValue(e,t),l(t)){const n=e+".";for(const[e,r]of this.items.entries())if(e.startsWith(n)){const o=s().get(t,e.slice(n.length),c);o===c||"value"in r&&o===r.value||this.setValue(e,o)}const r=[],o=new Set(Object.keys(t));for(const e of this.items.keys())if(e.startsWith(n)){const t=e.slice(n.length).split(".",1)[0];o.has(t)||r.push(e)}for(const e of r)this.items.delete(e)}}set(e,t){this.setValueAndDescendants(e,t);for(const t of h(e)){const e=this.items.get(t);e&&"value"in e&&(e.value=this.reassembleObjectValue(t,e.value),this.scheduleWatcherUpdate(t,e.value,e.watchers))}}watch(e,t){let n=this.items.get(e);n||(n=this.findInAncestors(e),this.items.set(e,n));const r=n.watchers,o={removed:!1,callback:t};if(n.watchers.push(o),"value"in n){const{watchers:t}=this.watcherUpdates.get(e)??{watchers:[]};this.scheduleWatcherUpdate(e,n.value,[...t,o])}return()=>{o.removed=!0,s().pull(r,o)}}persisted(e,t,n,r){const o=i.A.getItem(n);let s=t;null!==o&&(s=r?r.fromPersisted(o):o),this.set(e,s),this.persisters.set(e,{localStorageKey:n,toPersisted:r?.toPersisted})}allowNonExistentPath(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.allowedNonExistentPaths.push({path:e,deep:t})}dump(){const e=[];for(const[t,n]of this.items.entries())e.push({path:t,value:"value"in n?n.value:"[not set]",watcherCount:n.watchers.length});return e}}var u=n(64932);const p=`ui.reviewPanelOpen.${(0,u.A)("ol-project_id")}`;var g=n(67353);class m extends EventTarget{emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.dispatchEvent(new CustomEvent(e,{detail:n}))}on(e,t){this.addEventListener(e,t)}once(e,t){this.addEventListener(e,t,{once:!0})}off(e,t){this.removeEventListener(e,t)}}function f(){return new m}var _=n(16896);function w(e,t){e.set("project.name",null);e.set("editor",{showSymbolPalette:!1,toggleSymbolPalette:()=>{},sharejs_doc:null,open_doc_id:null,open_doc_name:null,opening:!0,trackChanges:!1,wantTrackChanges:!1,error_state:!1}),e.persisted("editor.showVisual",function(e){const t=`editor.mode.${e}`,n=i.A.getItem(t);n&&i.A.removeItem(t);return"rich-text"===n}(t),"editor.lastUsedMode",{toPersisted:e=>e?"visual":"code",fromPersisted:e=>"visual"===e})}var v=n(37858);class b{constructor(e){this.eventEmitter=e}emit(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];this.eventEmitter.dispatchEvent(new CustomEvent(e,{detail:r}))}on(e,t){const n=e=>{t(e,...e.detail)};return this.eventEmitter.addEventListener(e,n),()=>{this.eventEmitter.removeEventListener(e,n)}}}var y=n(31085);const x=new Date,k=(0,r.createContext)(void 0);function C(e){const t=new d;return t.set("settings",{}),w(t,e),function(e){e.set("ui.view","editor"),e.set("openFile",null),e.persisted("ui.chatOpen",!1,"ui.chatOpen"),e.persisted("ui.reviewPanelOpen",!1,p),e.set("ui.leftMenuShown",!1),e.set("ui.miniReviewPanelVisible",!1),e.set("ui.pdfLayout","sideBySide")}(t),function(e){e.allowNonExistentPath("project",!0),e.set("permissionsLevel","readOnly"),e.set("permissions",{read:!0,write:!1,admin:!1,comment:!0})}(t),function(e){e.allowNonExistentPath("pdf",!0)}(t),t.allowNonExistentPath("hasLintingError"),t}const E=e=>{let{children:t}=e;const n=(0,u.A)("ol-project_id"),[o]=(0,r.useState)((()=>C(n))),[s]=(0,r.useState)(f),[i]=(0,r.useState)((()=>new b(s))),[a,c]=(0,r.useState)(!1),l=(0,u.A)("ol-ExposedSettings")?.sentryRelease??null,[h,d]=(0,r.useState)(!1),{socket:p,getSocketDebuggingInfo:m}=(0,_.FX)(),w=(0,r.useCallback)(((e,t)=>{const r={...t,user_id:(0,u.A)("ol-user_id"),project_id:n,client_now:new Date,performance_now:performance.now(),release:l,client_load:x,spellCheckLanguage:o.get("project.spellCheckLanguage"),...m()},s={};if("object"==typeof e)for(const t of Object.getOwnPropertyNames(e))s[t]=e[t];else"string"==typeof e&&(s.message=e);return(0,v.TB)("/error/client",{body:{error:s,meta:r}})}),[l,n,m,o]);(0,r.useEffect)((()=>{function e(e){let{project:t,permissionsLevel:n}=e;o.set("project",{rootDoc_id:null,...t}),o.set("permissionsLevel",n),o.flushUpdates(),s.emit("project:joined",{project:t,permissionsLevel:n}),d(!0)}function t(e){o.set("project.mainBibliographyDoc_id",e)}return p.on("joinProjectResponse",e),p.on("mainBibliographyDocUpdated",t),()=>{p.removeListener("joinProjectResponse",e),p.removeListener("mainBibliographyDocUpdated",t)}}),[p,s,o]);const E=(0,r.useMemo)((()=>({_id:(0,u.A)("ol-project_id"),$scope:{$on:()=>{},$watch:()=>{},$applyAsync:()=>{},user:{},project:{_id:(0,u.A)("ol-project_id"),name:(0,u.A)("ol-projectName"),rootDocId:"",members:[],invites:[],features:{collaborators:0,compileGroup:"standard",trackChangesVisible:!1,references:!1,mendeley:!1,zotero:!1},publicAccessLevel:"",owner:{_id:"",email:""}},permissionsLevel:"readOnly",editor:{sharejs_doc:null,showSymbolPalette:!1,toggleSymbolPalette:()=>{}},ui:{view:"pdf",chatOpen:!1,reviewPanelOpen:!1,leftMenuShown:!1,pdfLayout:"flat"},pdf:{uncompiled:!0,logEntryAnnotations:{}},settings:{syntaxValidation:!1,pdfViewer:"pdfjs"},hasLintingError:!1},socket:p,reportError:w})),[p,w]),T=(0,r.useMemo)((()=>({eventEmitter:s,startedFreeTrial:a,setStartedFreeTrial:c,projectId:n,reportError:w,projectJoined:h})),[s,n,h,w,a]);return(0,y.jsx)(k.Provider,{value:T,children:(0,y.jsx)(g.Qi,{ide:E,scopeStore:o,scopeEventEmitter:i,children:t})})};function T(){const e=(0,r.useContext)(k);if(!e)throw new Error("useIdeReactContext is only available inside IdeReactProvider");return e}},13376:(e,t,n)=>{n(97107),n(82438),n(12266),n(99819),n(50020);const r=n(2085),o=n(26041),s=n(61210);class i{constructor(e){this._trackedChanges=e}static fromRaw(e){return new i(e.map(o.fromRaw))}toRaw(){return this._trackedChanges.map((e=>e.toRaw()))}get length(){return this._trackedChanges.length}asSorted(){return Array.from(this._trackedChanges)}inRange(e){return this._trackedChanges.filter((t=>e.contains(t.range)))}propsAtRange(e){return this._trackedChanges.find((t=>t.range.contains(e)))?.tracking}removeInRange(e){this._trackedChanges=this._trackedChanges.filter((t=>!e.contains(t.range)))}add(e){this._trackedChanges.push(e),this._mergeRanges()}_mergeRanges(){if(this._trackedChanges.length<2)return;this._trackedChanges.sort(((e,t)=>e.range.start-t.range.start));const e=[this._trackedChanges[0]];for(let t=1;t<this._trackedChanges.length;t++){const n=e[e.length-1],r=this._trackedChanges[t];if(n.range.overlaps(r.range))throw new Error("Ranges cannot overlap");if(r.range.isEmpty())throw new Error("Tracked changes range cannot be empty");n.canMerge(r)?e[e.length-1]=n.merge(r):e.push(r)}this._trackedChanges=e}applyInsert(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=[];for(const n of this._trackedChanges)if(n.range.startIsAfter(e)||e===n.range.start)s.push(new o(n.range.moveBy(t.length),n.tracking));else if(e===n.range.end)s.push(n);else if(n.range.containsCursor(e)){const[r,,i]=n.range.insertAt(e,t.length),a=new o(r,n.tracking);a.range.isEmpty()||s.push(a);const c=new o(i,n.tracking);c.range.isEmpty()||s.push(c)}else s.push(n);if(n.tracking){const i=new o(new r(e,t.length),n.tracking);s.push(i)}this._trackedChanges=s,this._mergeRanges()}applyDelete(e,t){const n=[];for(const s of this._trackedChanges){const i=new r(e,t);if(!i.contains(s.range))if(i.overlaps(s.range)){const e=s.range.subtract(i);e.isEmpty()||n.push(new o(e,s.tracking))}else s.range.startIsAfter(e)?n.push(new o(s.range.moveBy(-t),s.tracking)):n.push(s)}this._trackedChanges=n,this._mergeRanges()}applyRetain(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!n.tracking)return;const i=[],a=new r(e,t);for(const n of this._trackedChanges)if(a.contains(n.range));else if(a.overlaps(n.range))if(n.range.contains(a)){const[r,s]=n.range.splitAt(e);r.isEmpty()||i.push(new o(r,n.tracking)),!s.isEmpty()&&s.length>t&&i.push(new o(s.moveBy(t).shrinkBy(t),n.tracking))}else if(a.start<=n.range.start){const[,e]=n.range.splitAt(a.end);e.isEmpty()||i.push(new o(e,n.tracking))}else{const[t]=n.range.splitAt(e);t.isEmpty()||i.push(new o(t,n.tracking))}else i.push(n);if(n.tracking instanceof s){const e=new o(a,n.tracking);i.push(e)}this._trackedChanges=i,this._mergeRanges()}}e.exports=i},13653:(e,t,n)=>{"use strict";n.d(t,{Q:()=>s});var r=n(14041),o=n(49791);const s=e=>{const t=(0,o.M)();(0,r.useEffect)((()=>{const n=new AbortController;return t?.addEventListener("message",(t=>{let{data:n}=t;return e(n)}),{signal:n.signal}),()=>n.abort()}),[t,e])}},13877:(e,t,n)=>{"use strict";n.d(t,{Xj:()=>_,yi:()=>w});n(97107),n(82438),n(91020),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539);var r=n(14041),o=n(13271),s=n(16896),i=n(68543),a=n(37858),c=n(52036),l=n(10646),h=n(6599),d=n(89139),u=n(83096),p=n(58516),g=n(97434),m=n(31085);const f=(0,r.createContext)(void 0),_=e=>{let{children:t}=e;const{t:n}=(0,g.Bd)(),{eventEmitter:_,projectId:w}=(0,o.yn)(),{socket:v}=(0,s.FX)(),{onlineUsersCount:b}=(0,c.E1)(),{permissionsLevel:y}=(0,l.mi)(),x=(0,p.Tg)(),{currentDocument:k}=(0,i.TS)(),{showGenericMessageModal:C}=(0,u.T)(),[E,T]=(0,r.useState)({}),j=(0,r.useRef)(new Map);(0,r.useEffect)((()=>{const e=e=>{let{detail:[t]}=e;"doc"===t.type&&T((e=>(delete e[t.entity._id],{...e})))};return _.on("entity:deleted",e),()=>{_.off("entity:deleted",e)}}),[_]),(0,r.useEffect)((()=>{window.dispatchEvent(new CustomEvent("project:metadata",{detail:E}))}),[E]);const I=(0,r.useCallback)((e=>{const{docId:t,meta:n}=e;null!=t&&null!=n&&T((e=>({...e,[t]:n})))}),[]),S=(0,r.useCallback)((()=>{(0,a.hm)(`/project/${w}/metadata`).then((e=>{const{projectMeta:t}=e;t&&T(t)}))}),[w]),A=(0,r.useCallback)((e=>{const t=b>0;(0,a.TB)(`/project/${w}/doc/${e}/metadata`,{body:{broadcast:t}}).then((e=>{!t&&e&&I(e)}))}),[I,b,w]),L=(0,r.useCallback)((e=>{if("readOnly"===y)return;const t=j.current.get(e);null!=t&&(window.clearTimeout(t),j.current.delete(e)),j.current.set(e,window.setTimeout((()=>{A(e),j.current.delete(e)}),2e3))}),[A,y]),O=(0,r.useCallback)((e=>{I(e)}),[I]);(0,h.A)(v,"broadcastDocMeta",O);const R=(0,r.useCallback)((()=>{k&&L(k.doc_id)}),[k,L]);(0,d.A)("editor:metadata-outdated",R);const P=(0,r.useRef)(x);(0,r.useEffect)((()=>{P.current=x}),[x]),(0,r.useEffect)((()=>{const e=e=>{let{detail:[{project:t}]}=e;t.deletedByExternalDataSource&&C(n("project_renamed_or_deleted"),n("project_renamed_or_deleted_detail")),window.setTimeout((()=>{(P.current.write||P.current.trackedWrite)&&S()}),200)};return _.once("project:joined",e),()=>{_.off("project:joined",e)}}),[_,S,C,n]);const M=(0,r.useMemo)((()=>{const e=Object.values(E);return{commands:e.flatMap((e=>Object.values(e.packages).flat())),labels:new Set(e.flatMap((e=>e.labels))),packageNames:new Set(e.flatMap((e=>e.packageNames)))}}),[E]);return(0,m.jsx)(f.Provider,{value:M,children:t})};function w(){const e=(0,r.useContext)(f);if(!e)throw new Error("useMetadataContext is only available inside MetadataProvider");return e}},14679:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(12628),s=n(18452),i=n(13376);class a extends o{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];super(),r.string(e),this.content=e,this.comments=s.fromRaw(t),this.trackedChanges=i.fromRaw(n)}static fromRaw(e){return new a(e.content,e.comments||[],e.trackedChanges||[])}toRaw(){const e={content:this.content};return this.comments.length&&(e.comments=this.comments.toRaw()),this.trackedChanges.length&&(e.trackedChanges=this.trackedChanges.toRaw()),e}isEditable(){return!0}getContent(){let e="",t=0;if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).filterTrackedDeletes)for(const n of this.trackedChanges.asSorted())"delete"===n.tracking.type&&(t<n.range.start&&(e+=this.content.slice(t,n.range.start)),t=n.range.end);return t<this.content.length&&(e+=this.content.slice(t)),e}getLines(){return this.getContent({filterTrackedDeletes:!0}).split("\n")}getByteLength(){return Buffer.byteLength(this.content)}getStringLength(){return this.content.length}edit(e){e.apply(this)}getComments(){return this.comments}getTrackedChanges(){return this.trackedChanges}async toEager(){return this}async toHollow(){return o.createHollow(this.getByteLength(),this.getStringLength())}async store(e){const t=await e.putString(this.content);if(this.comments.comments.size||this.trackedChanges.length){const n={comments:this.getComments().toRaw(),trackedChanges:this.trackedChanges.toRaw()},r=await e.putObject(n);return{hash:t.getHash(),rangesHash:r.getHash()}}return{hash:t.getHash()}}}e.exports=a},14875:(e,t,n)=>{"use strict";n.r(t),n.d(t,{SynctexFileErrorToast:()=>i,default:()=>a,showFileErrorToast:()=>c});var r=n(97434),o=n(71627),s=n(31085);const i=()=>{const{t:e}=(0,r.Bd)();return(0,s.jsxs)("div",{className:"synctex-error-toast-content",children:[(0,s.jsx)("span",{children:e("synctex_failed")}),(0,s.jsx)(o.A,{href:"/learn/how-to/SyncTeX_Errors",target:"_blank",variant:"secondary",size:"sm",children:e("more_info")})]})},a=[{key:"synctex:file-error",generator:()=>({content:(0,s.jsx)(i,{}),type:"warning",autoHide:!0,delay:4e3,isDismissible:!0})}],c=()=>{window.dispatchEvent(new CustomEvent("ide:show-toast",{detail:{key:"synctex:file-error"}}))}},14901:(e,t,n)=>{"use strict";n.d(t,{Y:()=>a,u:()=>i});var r=n(69954),o=n(37858),s=n(60961);function i(e,t){(0,r._)("setting-changed",{changedSetting:e,changedSettingVal:t}),(0,o.TB)("/user/settings",{body:{[e]:t}}).catch(s.$.error)}const a=async(e,t)=>{await(0,o.TB)(`/project/${e}/settings`,{body:{...t}})}},14936:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(14041),o=n(45250),s=n.n(o),i=n(67353);function a(e){const{scopeStore:t}=(0,i.nK)(),[n,o]=(0,r.useState)((()=>t.get(e)));(0,r.useEffect)((()=>t.watch(e,(e=>{o((()=>e))}))),[e,t]);return[n,(0,r.useCallback)((n=>{o((r=>{const o=s().isFunction(n)?n(r):n;return t.set(e,o),o}))}),[e,t])]}},16896:(e,t,n)=>{"use strict";n.d(t,{Sg:()=>v,FX:()=>b});n(97107);var r=n(14041),o=(n(27534),n(61412),n(91883),n(70286),n(23479)),s=n(64932),i=n(60961),a=n(58528);const c=36e5,l=864e5,h=(0,s.A)("ol-maxReconnectGracefullyIntervalMs"),d=(0,a.g9)("external-socket-heartbeat"),u={readyState:WebSocket.CLOSED,forceDisconnected:!1,inactiveDisconnect:!1,lastConnectionAttempt:0,reconnectAt:null,forcedDisconnectDelay:0,error:""};class p extends CustomEvent{}class g extends EventTarget{state=(()=>u)();connectionAttempt=null;gracefullyReconnectUntil=0;protocolVersion=-1;reconnectCountdownInterval=0;websocketFailureCount=0;userIsLeavingPage=!1;externalHeartbeat={currentStart:0,lastSuccess:0,lastLatency:0};constructor(){super(),this.lastUserActivity=performance.now(),this.idleDisconnectInterval=window.setInterval((()=>{this.disconnectIfIdleSince(l)}),c),window.addEventListener("online",(()=>this.onOnline())),window.addEventListener("beforeunload",(()=>{this.userIsLeavingPage=!0,"xhr-polling"===this.socket.socket.transport?.name&&this.socket.socket.disconnect()}));const e=new URL((0,s.A)("ol-wsUrl")||"/socket.io",window.origin),t=new URLSearchParams({projectId:(0,s.A)("ol-project_id")});d&&(t.set("esh","1"),t.set("ssp","1"));const n=o.h.connect(e.origin,{resource:e.pathname.slice(1),"auto connect":!1,"connect timeout":3e4,"force new connection":!0,query:t.toString(),reconnect:!1});if(this.socket=n,"object"!=typeof window.io)return this.switchToWsFallbackIfPossible(),i.$.error("Socket.io javascript not loaded. Please check that the real-time service is running and accessible."),void this.changeState({...this.state,error:"io-not-loaded"});n.on("connect",(()=>this.onConnect())),n.on("disconnect",(()=>this.onDisconnect())),n.on("error",(e=>this.onConnectError(e))),n.on("connect_failed",(e=>this.onConnectError(e))),n.on("joinProjectResponse",(e=>this.onJoinProjectResponse(e))),n.on("connectionRejected",(e=>this.onConnectionRejected(e))),n.on("reconnectGracefully",(()=>this.onReconnectGracefully())),n.on("forceDisconnect",((e,t)=>this.onForceDisconnect(t))),n.on("serverPing",((e,t,n,r)=>this.sendPingResponse(e,t,n,r))),this.tryReconnect()}close(e){this.onForceDisconnect(0,e)}tryReconnectNow(){this.tryReconnectWithBackoff(1e3)}registerUserActivity(){this.lastUserActivity=performance.now(),this.userIsLeavingPage=!1,this.ensureIsConnected()}getSocketDebuggingInfo(){return{client_id:this.socket.socket?.sessionid,transport:this.socket.socket?.transport?.name,publicId:this.socket.publicId,lastUserActivity:this.lastUserActivity,connectionState:this.state,externalHeartbeat:this.externalHeartbeat}}changeState(e){const t=this.state;this.state=e,i.$.log("[ConnectionManager] changed state",{previousState:t,state:e}),this.dispatchEvent(new p("statechange",{detail:{state:e,previousState:t}}))}switchToWsFallbackIfPossible(){const e=new URLSearchParams(window.location.search);return!(!(0,s.A)("ol-wsUrl")||"fallback"===e.get("ws"))&&(e.set("ws","fallback"),window.location.search=e.toString(),!0)}onOnline(){this.state.inactiveDisconnect||this.ensureIsConnected()}onConnectionRejected(e){switch(e?.message){case"retry":this.startAutoReconnectCountdown(0);break;case"rate-limit hit when joining project":this.changeState({...this.state,error:"rate-limited"});break;case"not authorized":case"invalid session":this.changeState({...this.state,error:"not-logged-in",forceDisconnected:!0});break;case"project not found":this.changeState({...this.state,error:"project-deleted",forceDisconnected:!0});break;default:this.changeState({...this.state,error:"unable-to-join"})}}onConnectError(e){"websocket"===this.socket.socket.transport?.name&&e instanceof Event&&e.target instanceof WebSocket&&this.websocketFailureCount++,null!==this.connectionAttempt&&(this.connectionAttempt++<5?setTimeout((()=>{this.canReconnect()&&this.socket.socket.connect()}),(navigator.onLine?0:5e3)+this.connectionAttempt*(1+Math.random())*1e3):this.switchToWsFallbackIfPossible()||(this.disconnect(),this.changeState({...this.state,error:"unable-to-connect"})))}onConnect(){d&&(this.externalHeartbeatInterval&&window.clearInterval(this.externalHeartbeatInterval),"websocket"===this.socket.socket.transport?.name&&(this.externalHeartbeatInterval=window.setInterval((()=>this.sendExternalHeartbeat()),15e3))),this.websocketFailureCount=0}onDisconnect(){this.connectionAttempt=null,this.externalHeartbeatInterval&&window.clearInterval(this.externalHeartbeatInterval),this.externalHeartbeat.currentStart=0,this.changeState({...this.state,readyState:WebSocket.CLOSED}),this.disconnectIfIdleSince(l)||("rate-limited"===this.state.error?this.tryReconnectWithBackoff(15e3):this.startAutoReconnectCountdown(0))}onForceDisconnect(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"maintenance";clearInterval(this.idleDisconnectInterval),clearTimeout(this.reconnectCountdownInterval),window.removeEventListener("online",this.onOnline),window.setTimeout((()=>this.disconnect()),1e3*e),this.changeState({...this.state,forceDisconnected:!0,forcedDisconnectDelay:e,error:t})}onJoinProjectResponse(e){let{protocolVersion:t,publicId:n}=e;-1===this.protocolVersion||this.protocolVersion===t?(this.protocolVersion=t,this.socket.publicId=n,this.connectionAttempt=null,this.changeState({...this.state,readyState:WebSocket.OPEN,error:"",reconnectAt:null})):this.onForceDisconnect(0,"protocol-changed")}onReconnectGracefully(){this.disconnectIfIdleSince(648e5)||this.gracefullyReconnectUntil||(this.gracefullyReconnectUntil=performance.now()+h,this.tryReconnectGracefully())}canReconnect(){return this.state.readyState!==WebSocket.OPEN&&!this.state.forceDisconnected}isReconnectingSoon(e){return!!this.state.reconnectAt&&this.state.reconnectAt-performance.now()<=e}hasReconnectedRecently(e){return performance.now()-this.state.lastConnectionAttempt<e}isUserInactiveSince(e){return performance.now()-this.lastUserActivity>e}disconnectIfIdleSince(e){if(!this.isUserInactiveSince(e))return!1;const t=this.state.readyState===WebSocket.CLOSED;return this.changeState({...this.state,readyState:WebSocket.CLOSED,inactiveDisconnect:!0}),t||this.socket.disconnect(),!0}disconnect(){this.changeState({...this.state,readyState:WebSocket.CLOSED}),this.socket.disconnect()}ensureIsConnected(){this.state.readyState!==WebSocket.OPEN&&this.tryReconnectWithBackoff("rate-limited"===this.state.error?15e3:5e3)}startAutoReconnectCountdown(e){if(this.userIsLeavingPage)return;if(!this.canReconnect())return;let t;t=this.isUserInactiveSince(12e4)?60+Math.floor(2*Math.random()*60):3+Math.floor(7*Math.random());const n=e+1e3*t;this.isReconnectingSoon(n)||(this.changeState({...this.state,reconnectAt:performance.now()+n}),clearTimeout(this.reconnectCountdownInterval),this.reconnectCountdownInterval=window.setTimeout((()=>{this.isReconnectingSoon(0)&&this.tryReconnect()}),n))}tryReconnect(){this.gracefullyReconnectUntil=0,this.changeState({...this.state,reconnectAt:null}),this.canReconnect()&&(this.connectionAttempt=0,this.changeState({...this.state,readyState:WebSocket.CONNECTING,error:"",inactiveDisconnect:!1,lastConnectionAttempt:performance.now()}),this.addReconnectListeners(),this.socket.socket.transports=["xhr-polling"],this.websocketFailureCount<3&&this.socket.socket.transports.unshift("websocket"),(this.socket.socket.connecting||this.socket.socket.connected)&&this.socket.forceDisconnectWithoutEvent(),this.socket.socket.connect())}addReconnectListeners(){const e=()=>{n(),this.startAutoReconnectCountdown(navigator.onLine?0:5e3)},t=()=>{n()},n=()=>{this.socket.removeListener("error",e),this.socket.removeListener("connect",t)};this.socket.on("error",e),this.socket.on("connect",t)}tryReconnectGracefully(){this.state.readyState!==WebSocket.CLOSED&&this.gracefullyReconnectUntil&&(this.gracefullyReconnectUntil<performance.now()||this.isUserInactiveSince(5e3)?(this.disconnect(),this.tryReconnect()):setTimeout((()=>{this.tryReconnectGracefully()}),5e3))}tryReconnectWithBackoff(e){this.hasReconnectedRecently(e)?this.startAutoReconnectCountdown(e):this.tryReconnect()}sendExternalHeartbeat(){const e=performance.now();this.socket.emit("debug.getHostname",(()=>{if(this.externalHeartbeat.currentStart!==e)return;const t=performance.now();this.externalHeartbeat={currentStart:0,lastSuccess:t,lastLatency:t-e}})),this.externalHeartbeat.currentStart=e}sendPingResponse(e,t,n,r){const o=this.socket.socket.transport?.name,s=this.socket.socket.sessionid;this.socket.emit("clientPong",e,t,n,r,o,s)}}var m=n(3218),f=n(89753),_=n(31085);const w=(0,r.createContext)(void 0),v=e=>{let{children:t}=e;const n=(0,f.z)(),[o]=(0,r.useState)((()=>new g)),[s,i]=(0,r.useState)(o.state);(0,r.useEffect)((()=>{const e=e=>{i(e.detail.state)};return o.addEventListener("statechange",e),()=>{o.removeEventListener("statechange",e)}}),[o]);const a=s.readyState===WebSocket.OPEN,c=s.readyState===WebSocket.CONNECTING&&performance.now()-s.lastConnectionAttempt>1e3,l=(0,r.useCallback)((()=>(0,m.C)(s.reconnectAt)),[s.reconnectAt]),h=(0,r.useCallback)((()=>o.tryReconnectNow()),[o]),d=(0,r.useCallback)((()=>o.registerUserActivity()),[o]),u=(0,r.useCallback)((e=>o.close(e)),[o]),p=(0,r.useCallback)((()=>o.getSocketDebuggingInfo()),[o]);(0,r.useEffect)((()=>{if(s.forceDisconnected&&"out-of-sync"!==s.error){const e=window.setTimeout((()=>n.reload()),1e3*s.forcedDisconnectDelay);return()=>{window.clearTimeout(e)}}}),[s.forceDisconnected,s.forcedDisconnectDelay,s.error,n]);const v=(0,r.useMemo)((()=>({socket:o.socket,connectionState:s,isConnected:a,isStillReconnecting:c,secondsUntilReconnect:l,tryReconnectNow:h,registerUserActivity:d,closeConnection:u,getSocketDebuggingInfo:p})),[o.socket,s,a,c,d,l,h,u,p]);return(0,_.jsx)(w.Provider,{value:v,children:t})};function b(){const e=(0,r.useContext)(w);if(!e)throw new Error("useConnectionContext is only available inside ConnectionProvider");return e}},18452:(e,t,n)=>{n(82438),n(12266),n(50020),n(34840);const r=n(43921);class o{constructor(e){this.comments=new Map(e.map((e=>[e.id,e])))}[Symbol.iterator](){return this.comments.values()}toArray(){return Array.from(this)}get length(){return this.comments.size}toRaw(){const e=[];for(const t of this.comments.values())e.push(t.toRaw());return e}getComment(e){return this.comments.get(e)}add(e){this.comments.set(e.id,e)}delete(e){return this.comments.delete(e)}static fromRaw(e){return new o(e.map(r.fromRaw))}applyInsert(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{commentIds:[]};t.commentIds||(t.commentIds=[]);for(const[n,r]of this.comments){const o=r.applyInsert(e.pos,e.length,t.commentIds.includes(n));this.comments.set(n,o)}}applyDelete(e){for(const[t,n]of this.comments){const r=n.applyDelete(e);this.comments.set(t,r)}}idsCoveringRange(e){return Array.from(this.comments.entries()).filter((t=>{let[,n]=t;return n.ranges.some((t=>t.contains(e)))})).map((e=>{let[t]=e;return t}))}}e.exports=o},18860:(e,t,n)=>{"use strict";n.d(t,{A:()=>u,J:()=>d});var r=n(5804),o=n(60961),s=n(64932),i=n(37858);e=n.hmd(e);var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,s=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw s}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}const{Doc:d}=(()=>{var e,t,n,d=void 0;window.sharejs=d={};var u=d.types={};d._bt=t=function(e,t,n,r){var o=void 0;return e.transformX=e.transformX=o=function(e,s){n(e),n(s);var i,a,c,h=[],d=!0,u=!1,p=void 0;try{for(var g,m=Array.from(s)[Symbol.iterator]();!(d=(g=m.next()).done);d=!0){for(var f=g.value,_=[],w=0;w<e.length;){var v,b=[];if(i=e[w],c=b,t(_,i,a=f,"left"),t(c,a,i,"right"),w++,1!==b.length){if(0===b.length){var y=!0,x=!1,k=void 0;try{for(var C,E=Array.from(e.slice(w))[Symbol.iterator]();!(y=(C=E.next()).done);y=!0)v=C.value,r(_,v)}catch(e){x=!0,k=e}finally{try{!y&&E.return&&E.return()}finally{if(x)throw k}}f=null;break}var T=Array.from(o(e.slice(w),b)),j=l(T,2),I=j[0],S=j[1],A=!0,L=!1,O=void 0;try{for(var R,P=Array.from(I)[Symbol.iterator]();!(A=(R=P.next()).done);A=!0)v=R.value,r(_,v)}catch(e){L=!0,O=e}finally{try{!A&&P.return&&P.return()}finally{if(L)throw O}}var M=!0,F=!1,D=void 0;try{for(var N,X=Array.from(S)[Symbol.iterator]();!(M=(N=X.next()).done);M=!0){var $=N.value;r(h,$)}}catch(e){F=!0,D=e}finally{try{!M&&X.return&&X.return()}finally{if(F)throw D}}f=null;break}f=b[0]}null!=f&&r(h,f),e=_}}catch(e){u=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(u)throw p}}return[e,h]},e.transform=e.transform=function(e,n,r){if("left"!==r&&"right"!==r)throw new Error("type must be 'left' or 'right'");if(0===n.length)return e;if(1===e.length&&1===n.length)return t([],e[0],n[0],r);if("left"===r){var s,i=Array.from(o(e,n)),a=l(i,2);return s=a[0],a[1],s}var c=Array.from(o(n,e)),h=l(c,2);return h[0],h[1]}};var p={name:"text",create:function(){return""}},g=function(e,t,n){return e.slice(0,t)+n+e.slice(t)},m=function(e){if("number"!=typeof e.p)throw new Error("component missing position field");if(!("string"===c(e.i)^"string"===c(e.d)^"string"===c(e.c)))throw new Error("component needs an i, d or c field");if(!(e.p>=0))throw new Error("position cannot be negative")},f=function(e){var t=!0,n=!1,r=void 0;try{for(var o,s=Array.from(e)[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var i=o.value;m(i)}}catch(e){n=!0,r=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw r}}return!0};p.apply=function(e,t){f(t);var n=!0,r=!1,o=void 0;try{for(var s,i=Array.from(t)[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var a=s.value;if(null!=a.i)e=g(e,a.p,a.i);else if(null!=a.d){var c=e.slice(a.p,a.p+a.d.length);if(a.d!==c)throw new Error("Delete component '"+a.d+"' does not match deleted text '"+c+"'");e=e.slice(0,a.p)+e.slice(a.p+a.d.length)}else{if(null==a.c)throw new Error("Unknown op type");var l=e.slice(a.p,a.p+a.c.length);if(a.c!==l)throw new Error("Comment component '"+a.c+"' does not match commented text '"+l+"'")}}}catch(e){r=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw o}}return e};var _=function(e,t){var n=void 0,r={};for(var o in e)n=e[o],r[o]=n;for(o in t)n=t[o],r[o]=n;return r};p._append=e=function(e,t){if(""!==t.i&&""!==t.d){if(0===e.length)return e.push(t);var n=e[e.length-1];return null!=n.i&&null!=t.i&&n.p<=t.p&&t.p<=n.p+n.i.length&&n.u===t.u?e[e.length-1]=_(n,{i:g(n.i,t.p-n.p,t.i)}):null!=n.d&&null!=t.d&&t.p<=n.p&&n.p<=t.p+t.d.length&&n.u===t.u?e[e.length-1]=_(n,{d:g(t.d,n.p-t.p,n.d),p:t.p}):e.push(t)}},p.compose=function(t,n){f(t),f(n);var r=t.slice(),o=!0,s=!1,i=void 0;try{for(var a,c=Array.from(n)[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value;e(r,l)}}catch(e){s=!0,i=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw i}}return r},p.compress=function(e){return p.compose([],e)},p.normalize=function(t){var n=[];null==t.i&&null==t.p||(t=[t]);var r=!0,o=!1,s=void 0;try{for(var i,a=Array.from(t)[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var c=i.value;null==c.p&&(c.p=0),e(n,c)}}catch(e){o=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw s}}return n};var w=function(e,t,n){if(null!=t.i)return t.p<e||t.p===e&&n?e+t.i.length:e;if(null!=t.d)return e<=t.p?e:e<=t.p+t.d.length?t.p:e-t.d.length;if(null!=t.c)return e;throw new Error("unknown op type")};p.transformCursor=function(e,t,n){var r="right"===n,o=!0,s=!1,i=void 0;try{for(var a,c=Array.from(t)[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value;e=w(e,l,r)}}catch(e){s=!0,i=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw i}}return e},p._tc=n=function(t,n,r,o){var s=void 0,i=void 0,a=void 0;if(f([n]),f([r]),null!=n.i)e(t,_(n,{p:w(n.p,r,"right"===o)}));else if(null!=n.d)if(null!=r.i){var c=n.d;n.p<r.p&&(e(t,_(n,{d:c.slice(0,r.p-n.p)})),c=c.slice(r.p-n.p)),""!==c&&e(t,_(n,{d:c,p:n.p+r.i.length}))}else if(null!=r.d)if(n.p>=r.p+r.d.length)e(t,_(n,{p:n.p-r.d.length}));else if(n.p+n.d.length<=r.p)e(t,n);else{if(a=_(n,{d:""}),n.p<r.p&&(a.d=n.d.slice(0,r.p-n.p)),n.p+n.d.length>r.p+r.d.length&&(a.d+=n.d.slice(r.p+r.d.length-n.p)),i=Math.max(n.p,r.p),s=Math.min(n.p+n.d.length,r.p+r.d.length),n.d.slice(i-n.p,s-n.p)!==r.d.slice(i-r.p,s-r.p))throw new Error("Delete ops delete different text in the same region of the document");""!==a.d&&(a.p=w(a.p,r),e(t,a))}else{if(null==r.c)throw new Error("unknown op type");e(t,n)}else if(null!=n.c)if(null!=r.i)if(n.p<r.p&&r.p<n.p+n.c.length){var l=r.p-n.p,h=n.c.slice(0,+(l-1)+1||void 0)+r.i+n.c.slice(l);e(t,_(n,{c:h}))}else e(t,_(n,{p:w(n.p,r,!0)}));else if(null!=r.d)if(n.p>=r.p+r.d.length)e(t,_(n,{p:n.p-r.d.length}));else if(n.p+n.c.length<=r.p)e(t,n);else{if(a=_(n,{c:""}),n.p<r.p&&(a.c=n.c.slice(0,r.p-n.p)),n.p+n.c.length>r.p+r.d.length&&(a.c+=n.c.slice(r.p+r.d.length-n.p)),i=Math.max(n.p,r.p),s=Math.min(n.p+n.c.length,r.p+r.d.length),n.c.slice(i-n.p,s-n.p)!==r.d.slice(i-r.p,s-r.p))throw new Error("Delete ops delete different text in the same region of the document");a.p=w(a.p,r),e(t,a)}else{if(null==r.c)throw new Error("unknown op type");e(t,n)}return t};p.invert=function(e){return Array.from(e.slice().reverse()).map((function(e){return function(e){return null!=e.i?{d:e.i,p:e.p}:{i:e.d,p:e.p}}(e)}))},d.types||(d.types={}),t(p,n,f,e),d.types.text=p,p.api={provides:{text:!0},getLength:function(){return this.snapshot.length},getText:function(){return this.snapshot},insert:function(e,t,n,r){var o={p:e,i:t};return n&&(o.u=!0),o=[o],this.submitOp(o,r),o},del:function(e,t,n,r){var o={p:e,d:this.snapshot.slice(e,e+t)};return n&&(o.u=!0),o=[o],this.submitOp(o,r),o},_register:function(){return this.on("remoteop",(function(e){var t=this;return function(){var n=[],r=!0,o=!1,s=void 0;try{for(var i,a=Array.from(e)[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var c=i.value;void 0!==c.i?n.push(t.emit("insert",c.p,c.i)):void 0!==c.d?n.push(t.emit("delete",c.p,c.d)):n.push(void 0)}}catch(e){o=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw s}}return n}()}))}};var v=function(e){return setTimeout(e,0)},b=function(){function e(){h(this,e)}return a(e,[{key:"on",value:function(e,t){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),this._events[e].push(t),this}},{key:"removeListener",value:function(e,t){var n=this;this._events||(this._events={});for(var r=this._events[e]||(this._events[e]=[]),o=0;o<r.length;)r[o]===t&&(r[o]=void 0),o++;return v((function(){return n._events[e]=Array.from(n._events[e]).filter((function(e){return e}))})),this}},{key:"emit",value:function(e){if(!(null!=this._events?this._events[e]:void 0))return this;for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=!0,s=!1,i=void 0;try{for(var a,c=Array.from(this._events[e])[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value;l&&l.apply(this,n)}}catch(e){s=!0,i=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw i}}return this}}]),e}();b.mixin=function(e){var t=e.prototype||e;return t.on=b.prototype.on,t.removeListener=b.prototype.removeListener,t.emit=b.prototype.emit,e},d.extendDoc=function(e,t){return y.prototype[e]=t};var y=function(){function e(t,n,r){h(this,e),this.flush=this.flush.bind(this),this.setFlushDelay=this.setFlushDelay.bind(this),this.shout=this.shout.bind(this),this.connection=t,this.name=n,r||(r={}),this.version=r.v,this.lastServerActivity=performance.now(),this.snapshot=r.snaphot,r.type&&this._setType(r.type),this.state="closed",this.autoOpen=!1,this._create=r.create,this.inflightOp=null,this.inflightCallbacks=[],this.inflightSubmittedIds=[],this.pendingOp=null,this.pendingCallbacks=[]}return a(e,[{key:"_xf",value:function(e,t){return this.type.transformX?this.type.transformX(e,t):[this.type.transform(e,t,"left"),this.type.transform(t,e,"right")]}},{key:"_otApply",value:function(e,t,n){var r=this.snapshot;if(this.snapshot=this.type.apply(this.snapshot,e),this.emit("change",e,r,n,t),t)return this.emit("remoteop",e,r,n)}},{key:"_connectionStateChanged",value:function(e,t){switch(e){case"disconnected":this.state="closed",this.inflightOp&&this.inflightSubmittedIds.push(this.connection.id),this.emit("closed");break;case"ok":this.autoOpen&&this.open();break;case"stopped":"function"==typeof this._openCallback&&this._openCallback(t)}return this.emit(e,t)}},{key:"_setType",value:function(e){if("string"==typeof e&&(e=u[e]),!e||!e.compose)throw new Error("Support for types without compose() is not implemented");if(this.type=e,e.api){for(const t of["insert","del","getText","getLength","_register"])this[t]=e.api[t];return"function"==typeof this._register?this._register():void 0}return this.provides={}}},{key:"_onMessage",value:function(e){if(!0===e.open){if(this.state="open",this._create=!1,null==this.created&&(this.created=!!e.create),e.type&&this._setType(e.type),e.create?(this.created=!0,this.snapshot=this.type.create()):(!0!==this.created&&(this.created=!1),void 0!==e.snapshot&&(this.snapshot=e.snapshot)),null!=e.v&&(this.version=e.v),this.inflightOp){var t={doc:this.name,op:this.inflightOp,v:this.version};this.inflightSubmittedIds.length&&(t.dupIfSource=this.inflightSubmittedIds),this.connection.send(t)}else this.flush();return this.emit("open"),"function"==typeof this._openCallback?this._openCallback(null):void 0}if(!1===e.open)return e.error&&(o.$.error("Could not open document: "+e.error),this.emit("error",e.error),"function"==typeof this._openCallback&&this._openCallback(e.error)),this.state="closed",this.emit("closed"),"function"==typeof this._closeCallback&&this._closeCallback(),this._closeCallback=null;if(null!==e.op||"Op already submitted"!==r){if(void 0===e.op&&void 0!==e.v||e.op&&Array.from(this.inflightSubmittedIds).includes(e.meta.source)){if(!e.error)if(void 0===e.op&&void 0!==e.v){if(e.v<this.version)return void(0,i.TB)("/error/client",{body:{error:{message:"out-of-order-ack-ignored"},meta:{msg:e,version:this.version}}})}else e.v<this.version&&(0,i.TB)("/error/client",{body:{error:{message:"out-of-order-self-op-ignored"},meta:{msg:{v:e.v},version:this.version}}});var n=this.inflightOp;this.inflightOp=null,this.inflightSubmittedIds.length=0,null===this.pendingOp&&this.emit("saved");var r=e.error;if(r){if(this.type.invert){var s=this.type.invert(n);if(this.pendingOp){var a=Array.from(this._xf(this.pendingOp,s)),c=l(a,2);this.pendingOp=c[0],s=c[1]}this._otApply(s,!0,e)}else this.emit("error","Op apply failed ("+r+") and the op could not be reverted");var h=!0,d=!1,u=void 0;try{for(var p,g=Array.from(this.inflightCallbacks)[Symbol.iterator]();!(h=(p=g.next()).done);h=!0)(0,p.value)(r)}catch(e){d=!0,u=e}finally{try{!h&&g.return&&g.return()}finally{if(d)throw u}}}else{if(e.v<this.version)return;if(e.v!==this.version)throw new Error("Invalid version from server");this.version++,this.lastServerActivity=performance.now(),this.emit("acknowledge",n);var m=!0,f=!1,_=void 0;try{for(var w,v=Array.from(this.inflightCallbacks)[Symbol.iterator]();!(m=(w=v.next()).done);m=!0)(0,w.value)(null,n)}catch(e){f=!0,_=e}finally{try{!m&&v.return&&v.return()}finally{if(f)throw _}}}return this.delayedFlush()}if(e.op){if(e.v<this.version)return;if(e.doc!==this.name)return this.emit("error","Expected docName '"+this.name+"' but got "+e.doc);if(e.v!==this.version)return this.emit("error","Expected version "+this.version+" but got "+e.v);var b=e.op;if(null!==this.inflightOp){var y=Array.from(this._xf(this.inflightOp,b)),x=l(y,2);this.inflightOp=x[0],b=x[1]}if(null!==this.pendingOp){var k=Array.from(this._xf(this.pendingOp,b)),C=l(k,2);this.pendingOp=C[0],b=C[1]}return this.version++,this.lastServerActivity=performance.now(),this._otApply(b,!0,e)}if(e.meta){var E=e.meta,T=E.path,j=E.value;return"shout"===(null!=T?T[0]:void 0)?this.emit("shout",j):o.$.warn("Unhandled meta op:",e)}return o.$.warn("Unhandled document message:",e)}}},{key:"flush",value:function(){if(this.flushTimeout=null,"ok"===this.connection.state&&null===this.inflightOp&&null!==this.pendingOp){if(this.inflightOp=this.pendingOp,this.inflightCallbacks=this.pendingCallbacks,this.pendingOp=null,this.pendingCallbacks=[],this.emit("flipped_pending_to_inflight"),(0,s.A)("ol-useShareJsHash")||o.v){var e=Date.now(),t=this.__lastSubmitTimestamp&&e-this.__lastSubmitTimestamp;if(!this.__lastSubmitTimestamp||t>5e3||t<0||o.v){const t=this.getText();var n=(0,r.V)("blob "+t.length+"\0"+t);this.__lastSubmitTimestamp=e}}var i=this.__lastVersion;return this.__lastVersion=this.version,this.connection.send({doc:this.name,op:this.inflightOp,v:this.version,lastV:i,hash:n})}}},{key:"submitOp",value:function(e,t){null!=this.type.normalize&&(e=this.type.normalize(e));var n=this.snapshot;return this.snapshot=this.type.apply(this.snapshot,e),null!==this.pendingOp?this.pendingOp=this.type.compose(this.pendingOp,e):this.pendingOp=e,t&&this.pendingCallbacks.push(t),this.emit("change",e,n),this.delayedFlush()}},{key:"delayedFlush",value:function(){if(null==this.flushTimeout)return this.flushTimeout=setTimeout(this.flush,this._flushDelay||0)}},{key:"setFlushDelay",value:function(e){return this._flushDelay=e}},{key:"shout",value:function(e){return this.connection.send({doc:this.name,meta:{path:["shout"],value:e}})}},{key:"open",value:function(e){var t=this;if(this.autoOpen=!0,"closed"===this.state){var n={doc:this.name,open:!0};return void 0===this.snapshot&&(n.snapshot=null),this.type&&(n.type=this.type.name),null!=this.version&&(n.v=this.version),this._create&&(n.create=!0),this.connection.send(n),this.state="opening",this._openCallback=function(n){return t._openCallback=null,"function"==typeof e?e(n):void 0}}}},{key:"close",value:function(e){return this.autoOpen=!1,"closed"===this.state?"function"==typeof e?e():void 0:(this.connection.send({doc:this.name,open:!1}),this.state="closed",this.emit("closing"),this._closeCallback=e)}}]),e}();return b.mixin(y),d.Doc=y,d})(),u=window.sharejs},20593:(e,t,n)=>{const r=n(37603);class UnprocessableError extends r{}e.exports={UnprocessableError,ApplyError:class ApplyError extends UnprocessableError{constructor(e,t,n){super(e),this.operation=t,this.operand=n}},InvalidInsertionError:class InvalidInsertionError extends UnprocessableError{constructor(e,t){super("inserted text contains non BMP characters"),this.str=e,this.operation=t}},TooLongError:class TooLongError extends UnprocessableError{constructor(e,t){super("resulting string would be too long",{resultLength:t}),this.operation=e,this.resultLength=t}}}},22246:(e,t,n)=>{"use strict";n(82438),n(50020);const r=n(99942),o=/[/*\u0000-\u001F\u007F\u0080-\u009F\uD800-\uDFFF]/g,s=/(^\.$)|(^\.\.$)|(^\s+)|(\s+$)/g,i=/^(prototype|constructor|toString|toLocaleString|valueOf|hasOwnProperty|isPrototypeOf|propertyIsEnumerable|__defineGetter__|__lookupGetter__|__defineSetter__|__lookupSetter__|__proto__)$/;function a(e){return e=(e=e.replace(o,"_")).replace(s,(function(e){return new Array(e.length+1).join("_")}))}t.clean=function(e){return t.cleanDebug(e)[0]},t.cleanDebug=function(e){let t=e,n="";function o(r){e!==t&&(n&&(n+=","),n+=r,t=e)}return e=r.normalize(e),o("normalize"),e=e.replace(/\\/g,"/"),o("workaround for IE"),e=e.replace(/\/+/g,"/"),o("no multiple slashes"),e=e.replace(/^(\/.*)$/,"_$1"),o("no leading /"),e=e.replace(/^(.+)\/$/,"$1"),o("no trailing /"),e=e.replace(/^ *(.*)$/,"$1"),o("no leading spaces"),e=e.replace(/^(.*[^ ]) *$/,"$1"),o("no trailing spaces"),0===e.length&&(e="_"),o("empty"),e=e.split("/").map(a).join("/"),o("cleanPart"),e=e.replace(i,"@$1"),o("BLOCKED_FILE_RX"),[e,n]},t.isClean=function(e){return t.isCleanDebug(e)[0]},t.isCleanDebug=function(e){if(e.length>1024)return[!1,"MAX_PATH"];if(0===e.length)return[!1,"empty"];const[n,r]=t.cleanDebug(e);return n!==e?[!1,r]:[!0,""]}},22440:(e,t,n)=>{"use strict";n.d(t,{T:()=>o});var r=n(69954);const o=(e,t)=>{(0,r._)(e,t)}},22743:(e,t,n)=>{"use strict";n.r(t),n.d(t,{SnapshotUpdater:()=>v,buildFileTree:()=>g,createFolder:()=>u,populateSnapshot:()=>_});n(97107),n(82438),n(99819),n(50020),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539);var r=n(58756),o=n(37603),s=n.n(o),i=n(60961),a=n(37858),c=n(64932),l=n(90165),h=n.n(l);const d=10;function u(e,t){return{_id:e,name:t,folders:[],docs:[],fileRefs:[]}}function p(e){const t=e.lastIndexOf("/");return-1===t?["",e]:[e.slice(0,t),e.slice(t+1)]}function g(e){const t=e.getFileMap(),n=u("","");let r="",o=n;const s=e=>{if(""===e)return n;if(r===e&&o)return o;const[t,i]=p(e),a=s(t);let c=a.folders.find((e=>e.name===i));return c||(c=u(e,i),a.folders.push(c)),o=c,r=e,c},i=new Map;for(const[t,{pathname:n}]of Object.entries(e.getV2DocVersions()?.data||{}))i.set(n,t);for(const e of t.getPathnames().sort()){const n=t.getFile(e),[r,o]=p(e),a=s(r),c=n.getMetadata();n.isEditable()&&0===Object.keys(c).length?a.docs.push({_id:i.get(e)||e,name:o}):a.fileRefs.push({_id:e,created:c.importedAt,name:o,hash:n.getHash(),linkedFileData:c})}return n}async function m(e){if((0,c.A)("ol-ro-mirror-on-client-no-local-storage"))throw new Error("indexedDB persistence is disabled");try{await window.navigator.storage.persist()}catch{}return await new Promise(((t,n)=>{const r=window.indexedDB.open(`snapshot-data:${e}`,2);r.onerror=e=>{n(new(s())("failed to open IndexDB",{event:e}))},r.onsuccess=()=>t(r.result),r.onupgradeneeded=()=>{r.result.createObjectStore("blobs")}}))}class NotFoundError extends(s()){}class f{constructor(e,t,n){this.projectId=e,this.db=t,this.signal=n,this.prefetchedBlobs=new Map}async prefetchBlobs(e){const t=h()(d);await Promise.all(Array.from(e).map((e=>t((async()=>{this.prefetchedBlobs.set(e,await this.getString(e))})))))}async getString(e){if(this.prefetchedBlobs.has(e))return this.prefetchedBlobs.get(e);if(this.db)try{return await new Promise(((t,n)=>{const r=this.db.transaction("blobs","readonly").objectStore("blobs").get(e);r.onsuccess=()=>{"string"!=typeof r.result?n(new NotFoundError("blob not cached")):t(r.result)},r.onerror=e=>{n(new(s())("failed to read IndexDB",{event:e}))}}))}catch(e){e instanceof NotFoundError||i.$.error(e)}const t=`/project/${this.projectId}/blob/${e}`,n=await fetch(t,{signal:this.signal,cache:this.db||(0,c.A)("ol-ro-mirror-on-client-no-local-storage")?"no-store":"force-cache"});if(!n.ok)throw new a.fk(n.statusText,t,void 0,n);const r=await n.text();if(this.db)try{await new Promise(((t,n)=>{const o=this.db.transaction("blobs","readwrite").objectStore("blobs").put(r,e);o.onsuccess=()=>t(),o.onerror=e=>{n(new(s())("failed to write IndexDB",{event:e}))}}))}catch(e){i.$.error(e)}return r}async getObject(e){return JSON.parse(await this.getString(e))}}async function _(e){const t=(0,c.A)("ol-project_id");let n;try{n=await m(t)}catch(e){i.$.error(e)}const r="function"==typeof AbortSignal.timeout?AbortSignal.timeout(6e5):void 0;try{const o=new f(t,n,r);await o.prefetchBlobs(w(e)),await e.getFileMap().mapAsync((e=>{if(e&&e.isEditable())return e.load("eager",o)}),d)}finally{n&&n.close()}}function w(e){const t=new Set;return e.getFileMap().map((e=>{if(!e||!e.isEditable())return;const n=e.data;n instanceof r.LazyStringFileData&&(t.add(n.hash),n.rangesHash&&t.add(n.rangesHash))})),t}class v{constructor(e){this.projectId=e,this.ac=new AbortController}async tryFlush(e){try{await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await(0,a.TB)(`/project/${e}/flush`,{signal:t.signal})}(this.projectId,{signal:e})}catch(e){(0,a.Jz)(e)||i.$.error(s().tag(e,"flush history"))}}abort(){this.ac.abort()}resetTimeout(){this.abort(),this.ac=new AbortController;const e=setTimeout((()=>this.ac.abort()),3e4),t=this.ac.signal;return t.addEventListener("abort",(()=>clearTimeout(e))),t}async refresh(){const e=this.resetTimeout();try{return await this.doRefresh(e)}finally{this.abort()}}async doRefresh(e){if(await this.tryFlush(e),this.chunk)for(;;){const{changes:t,latestStartVersion:n}=await(0,a.hm)(`/project/${this.projectId}/changes-in-chunk?since=${this.chunk.getEndVersion()}`,{signal:e});for(const e of t){const t=r.Change.fromRaw(e);t.applyTo(this.chunk.getSnapshot(),{strict:!0}),this.chunk.pushChanges([t])}if(!(n>this.chunk.getStartVersion()))break;this.chunk=new r.Chunk(new r.History(this.chunk.getSnapshot(),[]),this.chunk.getEndVersion())}else{this.chunk=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await(0,a.hm)(`/project/${e}/latest/history`,{signal:t.signal});return r.Chunk.fromRaw(n.chunk)}(this.projectId,{signal:e}),this.chunk.getSnapshot().applyAll(this.chunk.getChanges(),{strict:!0});try{await async function(e){const t=(0,c.A)("ol-project_id"),n=await m(t),r=await new Promise(((e,t)=>{const r=n.transaction("blobs","readonly").objectStore("blobs").getAllKeys();r.onsuccess=()=>e(r.result),r.onerror=e=>t(new(s())("list IndexDB",{event:e}))})),o=w(e),i=[];for(const e of r)o.has(e)||i.push(e);await new Promise(((e,t)=>{const r=n.transaction("blobs","readwrite");for(const e of i)r.objectStore("blobs").delete(e);r.oncomplete=()=>e(),r.onerror=e=>t(new(s())("remove from IndexDB",{event:e}))}))}(this.chunk.getSnapshot())}catch(e){i.$.error(s().tag(e,"purge unused blobs"))}}return{snapshot:this.chunk.getSnapshot(),snapshotVersion:this.chunk.getEndVersion()}}}},23442:(e,t,n)=>{"use strict";n.r(t),n.d(t,{extension:()=>i,previousFixEffect:()=>o,previousFixState:()=>s});var r=n(57195);const o=r.Pe.define(),s=r.sU.define({create:()=>null,update(e,t){for(const n of t.effects)n.is(o)&&(e=n.value);return e}}),i=()=>[s]},23479:(e,t,n)=>{"use strict";n.d(t,{h:()=>h});n(82438),n(57327);var r=n(60961);n(44199);class o{static connect(e,t){return new o}constructor(e){this._socket=e}forceDisconnectWithoutEvent(){}}const s=["connect","disconnect","emit","on","removeListener"];for(const e of s)o.prototype[e]=function(){this._socket[e].apply(this._socket,arguments)};class i extends o{static connect(){return new i}constructor(e){super(e),this.socket={get connected(){return!1},get sessionid(){},get transport(){return{}},connect(){},disconnect(e){}}}connect(){}disconnect(e){}emit(){}on(){}removeListener(){}}class a extends o{static connect(e,t){return new a(io.connect(e,t))}constructor(e){super(e),this.socket=this._socket.socket;const t=this;Object.defineProperty(this.socket,"transport",{get:()=>t._transport,set(e){t.forceDisconnectWithoutEvent(),t._transport=e}})}forceDisconnectWithoutEvent(){clearTimeout(this.socket.heartbeatTimeoutTimer),this._transport&&this.forceCloseTransport(this._transport)}forceCloseTransport(e){if(e.clearTimeouts(),e instanceof io.Transport.websocket){e.websocket.onopen=e.websocket.onmessage=()=>e.websocket.close(),e.websocket.onclose=e.websocket.onerror=()=>{};try{e.websocket.close()}catch{}}else if(e instanceof io.Transport["xhr-polling"]){e.onData=e.onClose=e.get=()=>{};for(const t of[e.xhr,e.sendXHR])if(t){t.onreadystatechange=t.onload=t.onerror=()=>{};try{t.abort()}catch{}}e.xhr=e.sendXHR=null,fetch(e.prepareUrl()+"/?disconnect=1",{keepalive:!0}).then((e=>e.text())).catch((()=>{}))}else{try{e.close()}catch{}r.$.warn("unexpected socket.io transport",e)}}}class c extends o{static connect(e,t){return t.forceNew=t["force new connection"],t.path="/"+t.resource,t.reconnection=t.reconnect,t.timeout=t["connect timeout"],new c(e,t)}static get EVENT_MAP(){const e=["connect_error","connect_timeout","error"];return new Map([["connect_failed",e],["error",e]])}_on(e,t){this._events.has(e)?this._events.get(e).push(t):this._events.set(e,[t]),this._socket.on(e,t)}on(e,t){if(c.EVENT_MAP.has(e))for(const n of c.EVENT_MAP.get(e))this._on(n,t);else this._on(e,t)}_removeListener(e,t){if(this._events.has(e)){const n=this._events.get(e),r=n.indexOf(t);-1!==r&&n.splice(r,1)}this._socket.removeListener(e,t)}removeListener(e,t){if(c.EVENT_MAP.has(e))for(const n of c.EVENT_MAP.get(e))this._removeListener(n,t);else this._removeListener(e,t)}static createNewSocket(e,t){return io.Manager(e,t).socket("/",t)}_replaceSocketWithNewInstance(){const e=this._socket,t=c.createNewSocket(this._url,this._options);this._events.forEach(((n,r)=>{for(const o of n)e.removeListener(r,o),t.on(r,o)})),e.connected&&e.disconnect(),this._socket=t}connect(){this._replaceSocketWithNewInstance()}constructor(e,t){super(c.createNewSocket(e,t)),this._url=e,this._options=t,this._events=new Map;const n=this;function r(){return n._socket.io&&n._socket.io.engine||{}}this.socket={get connected(){return n._socket.connected},get sessionid(){return n._socket.id?n._socket.id:r().id},get transport(){return r().transport},connect(){n._replaceSocketWithNewInstance()},disconnect:e=>n._socket.disconnect(e)}}}let l;"undefined"!=typeof io&&io?"string"==typeof io.version&&"0"===io.version.slice(0,1)?(r.$.log("[socket.io] Shim: detected v0"),l=a):(r.$.log("[socket.io] Shim: detected v2"),l=c):(r.$.log("[socket.io] Shim: socket.io is not loaded, returning noop"),l=i);const h={SocketShimNoop:i,SocketShimV0:a,SocketShimV2:c,current:l,connect:l.connect,stub:()=>new i}},23531:(e,t,n)=>{"use strict";n(97107),n(82438),n(99819),n(57327);const r=n(45250),o=n(11485),s=n(10048),i=n(33101),a=n(8010);e.exports=class{constructor(e,t,n,c){let l=null,h=0;const d=[];let u=null,p=[],g=[];const m=[];function f(){const e=new s(l,p);c.emit("change",e.toRaw()),h=3}function _(){if(null!==u&&l===u)return l+=1,u=null,function(){if(0===p.length)throw new Error("ack complete without outstanding change");if(3!==h)throw new Error("ack complete in state "+h);t.handleChangeAcknowledged(),function(){for(const e in m)Object.prototype.hasOwnProperty.call(m,e)&&(e>l||(m[e].forEach((function(e){e()})),delete m[e]))}(),g.length>0?(p=g,g=[],f()):(p=[],h=2)}(),void _();const e=r.remove(d,(function(e){return e.getBaseVersion()===l}));if(1===e.length)return function(e){if(g.length>0&&0===p.length)throw new Error("pending change without outstanding change");a.transformMultiple(p,e.getOperations()),a.transformMultiple(g,e.getOperations()),t.applyRemoteChange(e)}(e[0].getChange()),l+=1,void _();if(0!==e.length)throw new Error("multiple remote changes in client version "+l)}this.connect=function(){if(0!==h)throw new Error("connect in state "+h);h=1,c.emit("authenticate",{projectId:e,token:"letmein"})},this.getVersion=function(){return l},c.on("load",(function(e){switch(h){case 1:{const n=i.fromRaw(e),r=n.getSnapshot();r.applyAll(n.getChanges(),{strict:!0}),l=n.getEndVersion(),t.load(r).then((function(){h=2}));break}default:throw new Error("loaded in state "+h)}})),this.handleLocalOperation=function(e){switch(h){case 2:!function(e){p.push(e),f()}(e);break;case 3:!function(e){g.push(e)}(e);break;default:throw new Error("local operation in state "+h)}},this.waitForVersion=function(e){return m[e]||(m[e]=[]),new Promise((function(t,n){m[e].push(t)}))},c.on("ack",(function(e){switch(h){case 3:{const t=o.fromRaw(e);u=t.getBaseVersion(),_();break}default:throw new Error("ack in state "+h)}})),c.on("change",(function(e){switch(h){case 2:case 3:!function(e){const t=e.getBaseVersion();if(r.find(d,"baseVersion",t))throw new Error("multiple changes in version "+t);if(t===u)throw new Error("received change that was acked in "+u);d.push(e)}(o.fromRaw(e)),_();break;default:throw new Error("remote change in state "+h)}})),c.on("disconnect",(function(){h=0,console.log("disconnected")}))}}},24731:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var r=n(64932);function o(){const e=(0,r.A)("ol-brandVariation"),{ieeeBrandId:t}=(0,r.A)("ol-ExposedSettings");return e?.brand_id===t}},25133:(e,t,n)=>{"use strict";n.d(t,{K:()=>o});var r=n(64932);const o=e=>new RegExp(`\\.(${(0,r.A)("ol-ExposedSettings").validRootDocExtensions.join("|")})$`,"i").test(e)},26041:(e,t,n)=>{n(97107);const r=n(2085),o=n(61210);class s{constructor(e,t){this.range=e,this.tracking=t}static fromRaw(e){return new s(r.fromRaw(e.range),o.fromRaw(e.tracking))}toRaw(){return{range:this.range.toRaw(),tracking:this.tracking.toRaw()}}canMerge(e){return e instanceof s&&(this.tracking.type===e.tracking.type&&this.tracking.userId===e.tracking.userId&&this.range.touches(e.range)&&this.range.canMerge(e.range))}merge(e){if(!this.canMerge(e))throw new Error("Cannot merge tracked changes");return new s(this.range.merge(e.range),new o(this.tracking.type,this.tracking.userId,this.tracking.ts.getTime()>e.tracking.ts.getTime()?this.tracking.ts:e.tracking.ts))}}e.exports=s},27673:(e,t,n)=>{"use strict";const r=n(8010);e.exports=class extends r{isNoOp(){return!0}}},28252:(e,t,n)=>{"use strict";n.d(t,{K:()=>x});n(82438),n(12266),n(50020);var r=n(73647),o=n(97519),s=n(31085);const i={ALLOWED_TAGS:["#text","p","ol","ul","li","pre","code"],ALLOWED_ATTR:[]},a=e=>{let{message:t}=e;const n=o.A.sanitize((0,r.yt)(t),i);return(0,s.jsx)("div",{className:"ai-error-assistant-output",dangerouslySetInnerHTML:{__html:n}})};var c=n(14041),l=n(29755),h=n(71627),d=n(97434),u=n(96713),p=n(59162);const g=e=>{let{content:t}=e;const{t:n}=(0,d.Bd)(),[r,o]=(0,c.useState)(!1),i=(0,c.useCallback)((()=>{navigator.clipboard.writeText(t).then((()=>{o(!0),window.setTimeout((()=>{o(!1)}),1500)}))}),[t]);return navigator.clipboard?.writeText?(0,s.jsx)(p.A,{id:"ai-error-assistant-copy-code",description:r?`${n("copied")}!`:n("copy"),overlayProps:{delay:r?1e3:250},children:(0,s.jsxs)(h.A,{variant:"ghost",size:"sm",onClick:i,className:"m-2 ai-error-assistant-copy-code-btn",children:[(0,s.jsx)(u.A,{type:r?"check":"content_copy"})," ",n("copy_code")]})}):null},m=(0,c.memo)((e=>{let{suggestion:t,syncToEntry:n,showActions:r=!0}=e;const o=(0,l.b2)(t.from.content,t.to.content),i=(0,c.useCallback)((e=>{if(e){e.textContent="";let n=t.from.content;for(const t of o)if(t.count)if(t.removed){const r=document.createElement("del");r.append(n.substring(0,t.value.length)),e.append(r),n=n.substring(t.value.length)}else if(!t.added){const r=n.substring(0,t.value.length);e.append(r),n=n.substring(t.value.length)}}}),[o,t.from.content]),a=(0,c.useCallback)((e=>{if(e){e.textContent="";let n=t.to.content;for(const t of o)if(t.value.length)if(t.added){const r=document.createElement("ins");r.append(n.substring(0,t.value.length)),e.append(r),n=n.substring(t.value.length)}else if(!t.removed){const r=n.substring(0,t.value.length);e.append(r),n=n.substring(t.value.length)}}}),[o,t.to.content]),h=(0,c.useCallback)((()=>{n({file:t.path,line:t.from.line,column:0})}),[t,n]);return(0,s.jsxs)("div",{className:"ai-error-assistant-suggested-change",children:[(0,s.jsxs)("div",{className:"ai-error-assistant-from",children:[(0,s.jsx)("div",{className:"ai-error-assistant-line-number",children:(0,s.jsx)("button",{onClick:h,children:t.from.line})}),(0,s.jsx)("div",{className:"ai-error-assistant-code",ref:i})]}),(0,s.jsxs)("div",{className:"ai-error-assistant-to",children:[(0,s.jsx)("div",{className:"ai-error-assistant-line-number",children:(0,s.jsx)("button",{onClick:h,children:t.from.line})}),(0,s.jsx)("div",{className:"ai-error-assistant-code",ref:a})]}),r&&(0,s.jsx)("div",{className:"ai-error-assistant-suggested-change-footer",children:(0,s.jsx)(g,{content:t.to.content})})]})}));m.displayName="SuggestedChange";var f=n(8164),_=n(89997),w=n(49438),v=n(69954),b=n(14936),y=n(59722);const x=(0,c.memo)((e=>{let{message:t,view:n,level:r,replaceContent:o}=e;const{t:i}=(0,d.Bd)(),{syncToEntry:l,compiling:u,startCompile:g,recordAction:x}=(0,f.Rf)(),{pathInFolder:k}=(0,_.m8)(),[C]=(0,b.A)("editor.sharejs_doc"),E=(0,y.XW)(),T=Boolean(E?.aiErrorAssistant),j=(0,c.useMemo)((()=>C?.doc_id?k(C.doc_id):null),[C?.doc_id,k]),I=t.tool_calls?.filter((e=>"suggestLineChange"===e.tool)).length,S=(0,c.useCallback)((e=>{const{from:t}=e,r=e.from.line+t.content.split("\n").length-1;if(t.line>0&&r>=t.line&&r<=n.state.doc.lines){const e={from:n.state.doc.line(t.line),to:n.state.doc.line(r)};return n.state.sliceDoc(e.from.from,e.to.to)}}),[n.state]),A=(0,c.useCallback)(((e,t)=>{if(!o)return;const{path:s,from:i,to:a}=e;let c=e.from.line+i.content.split("\n").length-1;if(l({file:s,line:i.line,column:0},!0),j===s){const{doc:e}=n.state;if(i.line>0&&c<=e.length){const n={from:e.line(i.line),to:e.line(c)};i.line<c&&""===n.from.text&&(i.line++,n.from=e.line(i.line)),c>i.line&&""===n.to.text&&(c--,n.to=e.line(c));const s=[{from:n.from.from,to:n.to.to,insert:a.content}];o(s),v._("suggest-apply",{hasAddOn:T}),x(`appliedSuggestionFor${r}`),1===t&&window.setTimeout((()=>{g()}),500)}}}),[j,o,g,l,n.state,r,x,T]);return(0,s.jsxs)("div",{className:"ai-error-assistant-message",children:[t.content&&(0,s.jsx)(a,{message:t.content}),t.tool_calls.length>0&&(0,s.jsx)("ul",{className:"ai-error-assistant-tool-calls",children:t.tool_calls.map((e=>{const{tool:t,toolCallId:n,args:r}=e;if("suggestLineChange"===t){const e=j===r.path,t=e?S(r):void 0,a=e&&t?.includes(r.from.content),c=()=>{if(!o)return null;const t=()=>(0,s.jsx)(h.A,{variant:"secondary",disabled:u||e&&!a,onClick:()=>{A(r,I)},children:e?i("apply_suggestion"):i("open_path",{path:(0,w.I)(r.path,16)})});return!e||a||u?(0,s.jsx)(t,{}):(0,s.jsx)(p.A,{description:i("the_original_text_has_changed"),id:"ai-error-assistant-cannot-apply-tooltip",children:(0,s.jsx)("span",{children:(0,s.jsx)(t,{})})})};return(0,s.jsxs)("li",{children:[(0,s.jsx)(m,{suggestion:r,syncToEntry:l,showActions:!!o}),(0,s.jsx)("div",{className:"ai-error-assistant-actions",children:(0,s.jsx)(c,{})})]},n)}return null}))})]})}));x.displayName="AiErrorAssistantMessage"},28699:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(14041);function o(e){const t=(0,r.useRef)();return(0,r.useEffect)((()=>{t.current=e})),t.current}},29349:(e,t,n)=>{"use strict";n.d(t,{$:()=>o});var r=n(64932);const o=e=>{const t=(0,r.A)("ol-labsExperiments");return Boolean(t?.includes(e))}},30741:(e,t,n)=>{"use strict";n.d(t,{A:()=>h});var r=n(14041);let o,s=!1,i="";function a(e){document.hasFocus()||s||(i=window.document.title,window.document.title=e,s=!0,o=setInterval((function(){window.document.title===i?window.document.title=e:window.document.title=i}),800))}function c(){s&&(clearInterval(o),window.document.title=i,i="",s=!1)}function l(e){s?i=e:window.document.title=e}const h=function(){const[e,t]=(0,r.useState)((()=>document.hasFocus()));return(0,r.useEffect)((()=>{function e(){t(!0)}function n(){t(!1)}return window.addEventListener("focus",e),window.addEventListener("blur",n),()=>{window.removeEventListener("focus",e),window.removeEventListener("blur",n)}}),[]),{hasFocus:e,flashTitle:a,stopFlashingTitle:c,setTitle:l}}},31995:(e,t,n)=>{"use strict";n.d(t,{A:()=>Pe});var r={};n.r(r),n.d(r,{default:()=>b});var o={};n.r(o),n.d(o,{default:()=>se});n(82438),n(50020);var s=n(97434),i=n(14041),a=n(53373),c=n.n(a);const l=function(e,t,n){const r=(0,i.useRef)(),o=(0,i.useCallback)((()=>{r.current=new ResizeObserver((function(e){n(e[0])}))}),[n]);(0,i.useLayoutEffect)((()=>{if("ResizeObserver"in window){const t=e&&e.current;return t&&o(),r.current&&t&&r.current.observe(t),()=>{t&&function(e){r.current&&r.current.unobserve(e)}(t)}}}),[e,t,o])};var h=n(59162),d=n(71627),u=n(96713),p=n(31085);const g=function(e){let{sourceLocation:t,level:n,headerTitle:r,headerIcon:o,logType:a,showSourceLocationLink:g=!0,showCloseButton:m=!1,onSourceLocationClick:f,onClose:_}=e;const{t:w}=(0,s.Bd)(),v=(0,i.useRef)(null),[b,y]=(0,i.useState)(!1);l(v,b,(function(e){const t=e.target,n=t.scrollWidth>t.clientWidth;y(n)}));const x=t?t.file:null,k=t?t.line:null,C=c()("log-entry-header",{"log-entry-header-error":"error"===n,"log-entry-header-warning":"warning"===n,"log-entry-header-info":"info"===n,"log-entry-header-typesetting":"typesetting"===n,"log-entry-header-raw":"raw"===n,"log-entry-header-success":"success"===n}),E=c()("log-entry-header-link",{"log-entry-header-link-error":"error"===n,"log-entry-header-link-warning":"warning"===n,"log-entry-header-link-typesetting":"typesetting"===n,"log-entry-header-link-raw":"raw"===n,"log-entry-header-link-info":"info"===n,"log-entry-header-link-success":"success"===n}),T=w("navigate_log_source",{location:x+(k?`, ${k}`:"")}),j=g&&x?`${x}${k?`, ${k}`:""}`:null,I=j?(0,p.jsxs)(d.A,{variant:"ghost",className:E,"aria-label":T,onClick:f,children:[(0,p.jsx)(u.A,{type:"link"}),(0,p.jsx)("span",{ref:v,className:"log-entry-header-link-location",children:`‪${j}‬`})]}):null,S=a?`${a} ${r}`:r;return(0,p.jsxs)("header",{className:C,children:[o?(0,p.jsx)("div",{className:"log-entry-header-icon-container",children:o}):null,(0,p.jsx)("h3",{className:"log-entry-header-title",children:S}),b&&j&&I?(0,p.jsx)(h.A,{id:j,description:j,overlayProps:{placement:"left"},tooltipProps:{className:"log-location-tooltip"},children:I}):I,m?(0,p.jsx)(d.A,{variant:"link",className:"btn-inline-link log-entry-header-link","aria-label":w("dismiss_error_popup"),onClick:_,children:(0,p.jsx)("span",{"aria-hidden":"true",children:"×"})}):null]})};var m=n(64932),f=n(14936);const _=(0,i.lazy)((()=>Promise.all([n.e(3173),n.e(9276)]).then(n.bind(n,16912)))),w={raw:!1,warning:!0,error:!0,typesetting:!1},v=e=>{let{index:t,logEntry:n}=e;const[r]=(0,f.A)("editor.view");return r&&(0,m.A)("ol-showAiErrorAssistant")&&n.level&&w[n.level]&&n.raw?(0,p.jsx)(i.Suspense,{fallback:null,children:(0,p.jsx)(_,{index:t,logEntry:n,view:r})}):null},b=(0,i.memo)(v);var y=n(68273),x=n(89135);function k(e){let{rawContent:t,collapsedSize:n=0}=e;const[r,o]=(0,i.useState)(!1),[a,l]=(0,i.useState)(!0),{elementRef:h}=(0,y.w)((0,i.useCallback)((e=>{0!==e.scrollHeight&&l(e.scrollHeight>n)}),[n])),{t:u}=(0,s.Bd)();return(0,p.jsxs)("div",{className:"log-entry-content-raw-container",children:[(0,p.jsx)("div",{className:"expand-collapse-container",style:{height:r||!a?"auto":n},children:(0,p.jsx)("pre",{className:"log-entry-content-raw",ref:h,children:t.trim()})}),a&&(0,p.jsx)("div",{className:c()("log-entry-content-button-container",{"log-entry-content-button-container-collapsed":!r}),children:(0,p.jsx)(d.A,{variant:"secondary",size:"sm",onClick:()=>o((e=>!e)),children:r?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(x.A,{type:"angle-up"})," ",u("collapse")]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(x.A,{type:"angle-down"})," ",u("expand")]})})})]})}const C=[{import:r,path:"/overleaf/services/web/modules/ai/frontend/js/components/ai-error-assistant"}];function E(e){let{rawContent:t,formattedContent:n,extraInfoURL:r,index:o,logEntry:i}=e;const{t:a}=(0,s.Bd)();return(0,p.jsxs)("div",{className:"log-entry-content",children:[n&&(0,p.jsx)("div",{className:"log-entry-formatted-content",children:n}),r&&(0,p.jsx)("div",{className:"log-entry-content-link",children:(0,p.jsx)("a",{href:r,target:"_blank",rel:"noopener",children:a("log_hint_extra_info")})}),i&&C.map((e=>{let{import:{default:t},path:n}=e;return(0,p.jsx)(t,{index:o,logEntry:i},n)})),t&&(0,p.jsx)(k,{rawContent:t,collapsedSize:150})]})}n(57327);var T=n(71606);function j(e){let{url:t,children:n}=e;return(0,m.A)("ol-wikiEnabled")?(0,p.jsx)("a",{href:t,target:"_blank",rel:"noopener",children:n}):(0,p.jsx)(p.Fragment,{children:n})}const I={hint_misplaced_alignment_tab_character:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Misplaced_alignment_tab_character_%26",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have placed an alignment tab character '&' in the wrong place. If you want to align something, you must write it inside an align environment such as \\begin","{align}"," … \\end","{align}",", \\begin","{tabular}"," … \\end","{tabular}",", etc. If you want to write an ampersand '&' in text, you must write \\& instead."]})},hint_extra_alignment_tab_has_been_changed:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Extra_alignment_tab_has_been_changed_to_%5Ccr",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have written too many alignment tabs in a table, causing one of them to be turned into a line break. Make sure you have specified the correct number of columns in your"," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/Tables",children:"table"}),"."]})},hint_display_math_should_end_with:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Display_math_should_end_with_$$",formattedContent:()=>(0,p.jsx)(p.Fragment,{children:"You have forgotten a $ sign at the end of 'display math' mode. When writing in display math mode, you must always math write inside $$ … $$. Check that the number of $s match around each math expression."})},hint_missing_inserted:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Missing_$_inserted",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("p",{children:"You need to enclose all mathematical expressions and symbols with special markers. These special markers create a ‘math mode’."}),(0,p.jsxs)("p",{children:["Use ",(0,p.jsx)("code",{children:"$...$"})," for inline math mode, and ",(0,p.jsx)("code",{children:"\\[...\\]"}),"or one of the mathematical environments (e.g. equation) for display math mode."]}),(0,p.jsxs)("p",{children:["This applies to symbols such as subscripts ( ",(0,p.jsx)("code",{children:"_"})," ), integrals ( ",(0,p.jsx)("code",{children:"\\int"})," ), Greek letters ( ",(0,p.jsx)("code",{children:"\\alpha"}),","," ",(0,p.jsx)("code",{children:"\\beta"}),", ",(0,p.jsx)("code",{children:"\\delta"})," ) and modifiers"," ",(0,p.jsx)("code",{children:"(\\vec{x}"}),", ",(0,p.jsxs)("code",{children:["\\tilde{x}",")"]}),"."]})]})},hint_reference_undefined:{extraInfoURL:"https://www.overleaf.com/learn/Errors/There_were_undefined_references",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have referenced something which has not yet been labelled. If you have labelled it already, make sure that what is written inside \\ref","{...}"," is the same as what is written inside \\label","{...}","."]})},hint_there_were_undefined_references:{extraInfoURL:"https://www.overleaf.com/learn/Errors/There_were_undefined_references",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have referenced something which has not yet been labelled. If you have labelled it already, make sure that what is written inside \\ref","{...}"," is the same as what is written inside \\label","{...}","."]})},hint_citation_on_page_undefined_on_input_line:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Citation_XXX_on_page_XXX_undefined_on_input_line_XXX",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have cited something which is not included in your bibliography. Make sure that the citation (\\cite","{...}",") has a corresponding key in your bibliography, and that both are spelled the same way."]})},hint_label_multiply_defined_labels:{extraInfoURL:"https://www.overleaf.com/learn/Errors/There_were_multiply-defined_labels",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have used the same label more than once. Check that each \\label","{...}"," labels only one item."]})},hint_float_specifier_changed:{extraInfoURL:"https://www.overleaf.com/learn/Errors/%60!h%27_float_specifier_changed_to_%60!ht%27",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["The float specifier 'h' is too strict of a demand for LaTeX to place your float in a nice way here. Try relaxing it by using 'ht', or even 'htbp' if necessary. If you want to try keep the float here anyway, check out the"," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/Positioning_of_Figures",children:"float package"}),"."]})},hint_no_positions_in_optional_float_specifier:{extraInfoURL:"https://www.overleaf.com/learn/Errors/No_positions_in_optional_float_specifier",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have forgotten to include a float specifier, which tells LaTeX where to position your figure. To fix this, either insert a float specifier inside the square brackets (e.g. \\begin","{figure}","[h]), or remove the square brackets (e.g. \\begin","{figure}","). Find out more about float specifiers"," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/Positioning_of_Figures",children:"here"}),"."]})},hint_undefined_control_sequence:{formattedContent:e=>{if(e?.length&&T.H.has(e[0])){const t=e[0],n=T.H.get(t);return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("p",{children:["We think you’ve got a missing package! The ",(0,p.jsx)("code",{children:t})," ","command won't work unless you include",(0,p.jsx)("code",{children:n.command})," in your"," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes#The_preamble_of_a_document",children:"document preamble"}),"."," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes#Finding_and_using_LaTeX_packages",children:"Learn more about packages"}),"."]})})}return(0,p.jsxs)(p.Fragment,{children:["The compiler is having trouble understanding a command you have used. Check that the command is spelled correctly. If the command is part of a package, make sure you have included the package in your preamble using ",(0,p.jsx)("code",{children:"\\usepackage"}),"{...}",".",(0,p.jsx)("div",{className:"log-entry-content-link",children:(0,p.jsx)("a",{href:"https://www.overleaf.com/learn/Errors/Undefined_control_sequence",target:"_blank",rel:"noopener",children:"Learn more"})})]})}},hint_undefined_environment:{formattedContent:e=>{if(e?.length&&T.P.has(e[0])){const t=e[0],n=T.P.get(t);return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("p",{children:["We think you’ve got a missing package! The"," ",(0,p.jsx)("code",{children:t})," environment won't work unless you include ",(0,p.jsx)("code",{children:n.command})," in your"," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes#The_preamble_of_a_document",children:"document preamble"}),"."," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes#Finding_and_using_LaTeX_packages",children:"Learn more about packages"}),"."]})})}return(0,p.jsxs)(p.Fragment,{children:["You have created an environment (using \\begin","{…}"," and \\end","{…}"," commands) which is not recognized. Make sure you have included the required package for that environment in your preamble, and that the environment is spelled correctly.",(0,p.jsx)("div",{className:"log-entry-content-link",children:(0,p.jsx)("a",{href:"https://www.overleaf.com/learn/Errors%2FLaTeX%20Error%3A%20Environment%20XXX%20undefined",target:"_blank",rel:"noopener",children:"Learn more"})})]})}},hint_file_not_found:{extraInfoURL:"https://www.overleaf.com/learn/Errors/File_XXX_not_found_on_input_line_XXX",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["The compiler cannot find the file you want to include. Make sure that you have"," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/how-to/Including_images_on_Overleaf",children:"uploaded the file"})," ","and"," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/Errors/File_XXX_not_found_on_input_line_XXX.",children:"specified the file location correctly"}),"."]})},hint_unknown_graphics_extension:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Unknown_graphics_extension:_.XXX",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["The compiler does not recognise the file type of one of your images. Make sure you are using a"," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Unknown_graphics_extension:_.gif.",children:"supported image format"})," ","for your choice of compiler, and check that there are no periods (.) in the name of your image."]})},hint_unknown_float_option_h:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Unknown_float_option_%60H%27",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["The compiler isn't recognizing the float option 'H'. Include \\usepackage","{float}"," in your preamble to fix this."]})},hint_unknown_float_option_q:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Unknown_float_option_%60q%27",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have used a float specifier which the compiler does not understand. You can learn more about the different float options available for placing figures"," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/Positioning_of_Figures",children:"here"})," ","."]})},hint_math_allowed_only_in_math_mode:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_%5Cmathrm_allowed_only_in_math_mode",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have used a font command which is only available in math mode. To use this command, you must be in maths mode (E.g. $ … $ or \\begin","{math}"," … \\end","{math}","). If you want to use it outside of math mode, use the text version instead: \\textrm, \\textit, etc."]})},hint_mismatched_environment:{formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have used \\begin","{...}"," without a corresponding \\end","{...}","."]})},hint_mismatched_brackets:{formattedContent:()=>(0,p.jsx)(p.Fragment,{children:"You have used an open bracket without a corresponding close bracket."})},hint_can_be_used_only_in_preamble:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Can_be_used_only_in_preamble",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have used a command in the main body of your document which should be used in the preamble. Make sure that \\documentclass[…]","{…}"," and all \\usepackage","{…}"," commands are written before \\begin","{document}","."]})},hint_missing_right_inserted:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Missing_%5Cright_insertede",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have started an expression with a \\left command, but have not included a corresponding \\right command. Make sure that your \\left and \\right commands balance everywhere, or else try using \\Biggl and \\Biggr commands instead as shown"," ",(0,p.jsx)(j,{url:"https://www.overleaf.com/learn/Errors/Missing_%5Cright_inserted",children:"here"}),"."]})},hint_double_superscript:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Double_superscript",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have written a double superscript incorrectly as a^b^c, or else you have written a prime with a superscript. Remember to include ","{and}"," ","when using multiple superscripts. Try a^","{b ^ c}"," instead."]})},hint_double_subscript:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Double_subscript",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have written a double subscript incorrectly as a_b_c. Remember to include ","{and}"," when using multiple subscripts. Try a_","{b_c}"," instead."]})},hint_no_author_given:{extraInfoURL:"https://www.overleaf.com/learn/Errors/No_%5Cauthor_given",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have used the \\maketitle command, but have not specified any \\author. To fix this, include an author in your preamble using the \\author","{…}"," command."]})},hint_somethings_wrong_perhaps_a_missing_item:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Something%27s_wrong--perhaps_a_missing_%5Citem",formattedContent:()=>(0,p.jsx)(p.Fragment,{children:"There are no entries found in a list you have created. Make sure you label list entries using the \\item command, and that you have not used a list inside a table."})},hint_misplaced_noalign:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Misplaced_%5Cnoalign",formattedContent:()=>(0,p.jsx)(p.Fragment,{children:"You have used a \\hline command in the wrong place, probably outside a table. If the \\hline command is written inside a table, try including \\\\ before it."})},hint_no_line_here_to_end:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_There%27s_no_line_here_to_end",formattedContent:()=>(0,p.jsx)(p.Fragment,{children:"You have used a \\\\ or \\newline command where LaTeX was not expecting one. Make sure that you only use line breaks after blocks of text, and be careful using linebreaks inside lists and other environments."})},hint_verb_ended_by_end_of_line:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_%5Cverb_ended_by_end_of_line",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have used a \\verb command incorrectly. Try replacling the \\verb command with \\begin","{verbatim}","…\\end","{verbatim}",".\\"]})},hint_illegal_unit_of_measure_pt_inserted:{extraInfoURL:"https://www.overleaf.com/learn/Errors%2FIllegal%20unit%20of%20measure%20(pt%20inserted)",formattedContent:()=>(0,p.jsx)(p.Fragment,{children:"You have written a length, but have not specified the appropriate units (pt, mm, cm etc.). If you have not written a length, check that you have not witten a linebreak \\\\ followed by square brackets […] anywhere."})},hint_extra_right:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Extra_%5Cright",formattedContent:()=>(0,p.jsx)(p.Fragment,{children:"You have written a \\right command without a corresponding \\left command. Check that all \\left and \\right commands balance everywhere."})},hint_missing_begin_document_:{extraInfoURL:"https://www.overleaf.com/learn/Errors%2FLaTeX%20Error%3A%20Missing%20%5Cbegin%20document",formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["No \\begin","{document}"," command was found. Make sure you have included \\begin","{document}"," in your preamble, and that your main document is set correctly."]})},hint_mismatched_environment2:{formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have used \\begin","{}"," without a corresponding \\end","{}","."]})},hint_mismatched_environment3:{formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have used \\begin","{}"," without a corresponding \\end","{}","."]})},hint_mismatched_environment4:{formattedContent:()=>(0,p.jsxs)(p.Fragment,{children:["You have used \\begin","{}"," without a corresponding \\end","{}","."]})}};Object.keys(I);(0,m.A)("ol-wikiEnabled")||Object.keys(I).forEach((e=>{I[e].extraInfoURL=null}));const S=I;var A=n(69954);function L(e){let{ruleId:t,headerTitle:n,headerIcon:r,rawContent:o,logType:s,formattedContent:a,extraInfoURL:l,level:h,sourceLocation:d,showSourceLocationLink:u=!0,showCloseButton:f=!1,entryAriaLabel:_,customClass:w,contentDetails:v,onSourceLocationClick:b,onClose:y,index:x,logEntry:k,id:C}=e;const T=(0,m.A)("ol-showAiErrorAssistant");if(t&&S[t]){const e=S[t];a=e.formattedContent(v),l=e.extraInfoURL}const j=(0,i.useCallback)((e=>{if(e.preventDefault(),b&&d){b(d);const e=d?.file?.split("."),n=e?.length&&e?.length>1?e.pop():"";(0,A._)("log-entry-link-click",{level:h,ruleId:t,extension:n})}}),[h,b,t,d]);return(0,p.jsxs)("div",{className:c()("log-entry",w),"aria-label":_,"data-ruleid":t,"data-log-entry-id":C,children:[(0,p.jsx)(g,{level:h,sourceLocation:d,headerTitle:n,headerIcon:r,logType:s,showSourceLocationLink:u,onSourceLocationClick:j,showCloseButton:f,onClose:y}),(o||a||T)&&(0,p.jsx)(E,{rawContent:o,formattedContent:a,extraInfoURL:l,index:x,logEntry:k})]})}const O=(0,i.memo)(L);function R(e){let{issue:t,name:n}=e;const{t:r}=(0,s.Bd)();switch(n){case"sizeCheck":return(0,p.jsx)(O,{headerTitle:r("project_too_large"),formattedContent:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{children:r("project_too_large_please_reduce")}),(0,p.jsx)("ul",{className:"list-no-margin-bottom",children:t.resources.map((e=>(0,p.jsxs)("li",{children:[e.path," — ",e.kbSize,"kb"]},e.path)))})]}),entryAriaLabel:r("validation_issue_entry_description"),level:"error"});case"conflictedPaths":return(0,p.jsx)(O,{headerTitle:r("conflicting_paths_found"),formattedContent:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{children:r("following_paths_conflict")}),(0,p.jsx)("ul",{className:"list-no-margin-bottom",children:t.map((e=>(0,p.jsxs)("li",{children:["/",e.path]},e.path)))})]}),entryAriaLabel:r("validation_issue_entry_description"),level:"error"});case"mainFile":return(0,p.jsx)(O,{headerTitle:r("main_file_not_found"),formattedContent:r("please_set_main_file"),entryAriaLabel:r("validation_issue_entry_description"),level:"error"});default:return null}}const P=(0,i.memo)(R);var M=n(8164),F=n(41026);function D(){const{t:e}=(0,s.Bd)(),{startCompile:t,setAnimateCompileDropdownArrow:n}=(0,M.Rf)(),{disableStopOnFirstError:r}=(0,F.V)({eventSource:"logs-pane"}),o=(0,i.useCallback)((()=>{r(),t({stopOnFirstError:!1}),n(!0)}),[r,t,n]);return(0,p.jsx)(O,{headerTitle:e("stop_on_first_error_enabled_title"),formattedContent:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(s.x6,{i18nKey:"stop_on_first_error_enabled_description",components:[(0,p.jsx)("strong",{})]})," ",(0,p.jsx)(d.A,{variant:"primary",size:"sm",onClick:o,children:e("disable_stop_on_first_error")})]}),level:"info"})}var N=n(4607);function X(){const{startCompile:e,lastCompileOptions:t,setAnimateCompileDropdownArrow:n,isProjectOwner:r}=(0,M.Rf)(),{enableStopOnFirstError:o}=(0,F.V)({eventSource:"timeout-new"}),s=(0,i.useCallback)((()=>{o(),e({stopOnFirstError:!0}),n(!0)}),[o,e,n]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)($,{isProjectOwner:r}),(0,m.A)("ol-ExposedSettings").enableSubscriptions&&(0,p.jsx)(U,{handleEnableStopOnFirstErrorClick:s,lastCompileOptions:t,isProjectOwner:r})]})}const $=(0,i.memo)((function(e){let{isProjectOwner:t}=e;const{t:n}=(0,s.Bd)();return(0,p.jsx)(O,{headerTitle:n("your_compile_timed_out"),formattedContent:(0,m.A)("ol-ExposedSettings").enableSubscriptions&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("p",{children:n(t?"your_project_exceeded_compile_timeout_limit_on_free_plan":"this_project_exceeded_compile_timeout_limit_on_free_plan")}),t?(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:n("upgrade_for_12x_more_compile_time")})," ",n("plus_additional_collaborators_document_history_track_changes_and_more")]}):(0,p.jsx)(s.x6,{i18nKey:"tell_the_project_owner_and_ask_them_to_upgrade",components:[(0,p.jsx)("strong",{})]}),t&&(0,p.jsx)("p",{className:"text-center",children:(0,p.jsx)(N.A,{source:"compile-timeout",buttonProps:{variant:"primary",className:"w-100"},children:n("start_a_free_trial")})})]}),entryAriaLabel:n("your_compile_timed_out"),level:"error"})})),U=(0,i.memo)((function(e){let{lastCompileOptions:t,handleEnableStopOnFirstErrorClick:n,isProjectOwner:r}=e;const{t:o}=(0,s.Bd)();const i=(0,p.jsx)("a",{"aria-label":o("read_more_about_free_compile_timeouts_servers"),href:"/blog/changes-to-free-compile-timeouts-and-servers",rel:"noopener noreferrer",target:"_blank",onClick:function(){A._("paywall-info-click",{"paywall-type":"compile-timeout",content:"blog"})}});return(0,p.jsx)(O,{headerTitle:o("reasons_for_compile_timeouts"),formattedContent:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("p",{children:[o("common_causes_of_compile_timeouts_include"),":"]}),(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:(0,p.jsx)(s.x6,{i18nKey:"large_or_high-resolution_images_taking_too_long",components:[(0,p.jsx)("a",{href:"/learn/how-to/Optimising_very_large_image_files",rel:"noopener noreferrer",target:"_blank"})]})}),(0,p.jsxs)("li",{children:[(0,p.jsx)(s.x6,{i18nKey:"a_fatal_compile_error_that_completely_blocks_compilation",components:[(0,p.jsx)("a",{href:"/learn/how-to/Fixing_and_preventing_compile_timeouts#Step_3:_Assess_your_project_for_time-consuming_tasks_and_fatal_errors",rel:"noopener noreferrer",target:"_blank"})]}),!t.stopOnFirstError&&(0,p.jsxs)(p.Fragment,{children:[" ",(0,p.jsx)(s.x6,{i18nKey:"enable_stop_on_first_error_under_recompile_dropdown_menu",components:[(0,p.jsx)(d.A,{variant:"link",className:"btn-inline-link fw-bold",size:"sm",onClick:n}),(0,p.jsx)("strong",{})]})," "]})]})]}),(0,p.jsx)("p",{children:(0,p.jsx)(s.x6,{i18nKey:"learn_more_about_other_causes_of_compile_timeouts",components:[(0,p.jsx)("a",{href:"/learn/how-to/Fixing_and_preventing_compile_timeouts",rel:"noopener noreferrer",target:"_blank"})]})}),(0,p.jsx)("p",{children:(0,p.jsx)("em",{children:(0,p.jsx)(p.Fragment,{children:r?(0,p.jsx)(s.x6,{i18nKey:"weve_recently_reduced_the_compile_timeout_limit_which_may_have_affected_your_project",components:[i]}):(0,p.jsx)(s.x6,{i18nKey:"weve_recently_reduced_the_compile_timeout_limit_which_may_have_affected_this_project",components:[i]})})})})]}),entryAriaLabel:o("reasons_for_compile_timeouts"),level:"raw"})})),V=(0,i.memo)(X);n(61412),n(91883),n(70286);function PdfPreviewError(e){let{error:t}=e;const{t:n}=(0,s.Bd)(),{startCompile:r}=(0,M.Rf)();switch(t){case"rendering-error-expected":return(0,p.jsx)(O,{headerTitle:n("pdf_rendering_error"),formattedContent:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(s.x6,{i18nKey:"something_went_wrong_rendering_pdf_expected",components:[(0,p.jsx)(d.A,{variant:"primary",size:"sm",onClick:()=>r()})]}),(0,p.jsx)("br",{}),(0,p.jsx)("br",{}),(0,p.jsx)(s.x6,{i18nKey:"last_resort_trouble_shooting_guide",components:[(0,p.jsx)("a",{href:"/learn/how-to/Resolving_access%2C_loading%2C_and_display_problems",target:"_blank"},"troubleshooting-link")]})]}),level:"warning"});case"rendering-error":return(0,p.jsxs)(H,{title:n("pdf_rendering_error"),children:[n("something_went_wrong_rendering_pdf")," ",(0,p.jsx)(s.x6,{i18nKey:"try_recompile_project_or_troubleshoot",components:[(0,p.jsx)("a",{href:"/learn/how-to/Resolving_access%2C_loading%2C_and_display_problems",target:"_blank"},"troubleshooting-link")]}),(0,m.A)("ol-compilesUserContentDomain")&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("br",{}),(0,p.jsx)("br",{}),(0,p.jsx)(s.x6,{i18nKey:"new_compile_domain_notice",values:{compilesUserContentDomain:new URL((0,m.A)("ol-compilesUserContentDomain")).hostname},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}},components:[(0,p.jsx)("code",{},"domain"),(0,p.jsx)("a",{href:"/learn/how-to/Resolving_access%2C_loading%2C_and_display_problems",target:"_blank"},"troubleshooting-link")]})]})]});case"clsi-maintenance":return(0,p.jsx)(H,{title:n("server_error"),children:n("clsi_maintenance")});case"clsi-unavailable":return(0,p.jsx)(H,{title:n("server_error"),children:n("clsi_unavailable")});case"too-recently-compiled":return(0,p.jsx)(H,{title:n("server_error"),children:n("too_recently_compiled")});case"terminated":return(0,p.jsx)(H,{title:n("terminated"),children:n("compile_terminated_by_user")});case"rate-limited":return(0,p.jsx)(H,{title:n("pdf_compile_rate_limit_hit"),children:n("project_flagged_too_many_compiles")});case"compile-in-progress":return(0,p.jsx)(H,{title:n("pdf_compile_in_progress_error"),children:n("pdf_compile_try_again")});case"autocompile-disabled":return(0,p.jsx)(H,{title:n("autocompile_disabled"),children:n("autocompile_disabled_reason")});case"project-too-large":return(0,p.jsx)(H,{title:n("project_too_large"),children:n("project_too_much_editable_text")});case"timedout":return(0,p.jsx)(W,{});case"failure":return(0,p.jsxs)(H,{title:n("no_pdf_error_title"),children:[n("no_pdf_error_explanation"),(0,p.jsxs)("ul",{className:"my-1 ps-3",children:[(0,p.jsx)("li",{children:n("no_pdf_error_reason_unrecoverable_error")}),(0,p.jsx)("li",{children:(0,p.jsx)(s.x6,{i18nKey:"no_pdf_error_reason_no_content",components:{code:(0,p.jsx)("code",{})}})}),(0,p.jsx)("li",{children:(0,p.jsx)(s.x6,{i18nKey:"no_pdf_error_reason_output_pdf_already_exists",components:{code:(0,p.jsx)("code",{})}})})]})]});case"clear-cache":case"error":default:return(0,p.jsx)(H,{title:n("server_error"),children:n("somthing_went_wrong_compiling")});case"pdf-viewer-loading-error":return(0,p.jsx)(H,{title:n("pdf_rendering_error"),children:(0,p.jsx)(s.x6,{i18nKey:"something_went_wrong_loading_pdf_viewer",components:[(0,p.jsx)("strong",{},"strong-"),(0,p.jsx)("a",{href:"/learn/how-to/Resolving_access%2C_loading%2C_and_display_problems",target:"_blank"},"troubleshooting-link"),(0,p.jsx)("a",{target:"_blank",href:"/contact"},"contact-link")]})});case"validation-problems":return null}}const B=(0,i.memo)(PdfPreviewError);function H(e){let{title:t,headerIcon:n,children:r}=e;const{t:o}=(0,s.Bd)();return(0,p.jsx)(O,{headerTitle:t,headerIcon:n,formattedContent:r,entryAriaLabel:o("compile_error_entry_description"),level:"error"})}function W(){const{t:e}=(0,s.Bd)(),{enableStopOnFirstError:t}=(0,F.V)({eventSource:"timeout"}),{startCompile:n,lastCompileOptions:r,setAnimateCompileDropdownArrow:o}=(0,M.Rf)(),a=(0,i.useCallback)((()=>{t(),n({stopOnFirstError:!0}),o(!0)}),[t,n,o]);return(0,p.jsxs)(H,{title:e("timedout"),children:[(0,p.jsx)("p",{children:e("project_timed_out_intro")}),(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:(0,p.jsx)(s.x6,{i18nKey:"project_timed_out_optimize_images",components:[(0,p.jsx)("a",{href:"https://www.overleaf.com/learn/how-to/Optimising_very_large_image_files"})]})}),(0,p.jsxs)("li",{children:[(0,p.jsx)(s.x6,{i18nKey:"project_timed_out_fatal_error",components:[(0,p.jsx)("a",{href:"https://www.overleaf.com/learn/how-to/Why_do_I_keep_getting_the_compile_timeout_error_message%3F#Fatal_compile_errors_blocking_the_compilation"})]}),!r.stopOnFirstError&&(0,p.jsxs)(p.Fragment,{children:[" ",(0,p.jsx)(s.x6,{i18nKey:"project_timed_out_enable_stop_on_first_error",components:[(0,p.jsx)(d.A,{variant:"primary",size:"sm",onClick:a})]})," "]})]})]}),(0,p.jsx)("p",{children:(0,p.jsx)(s.x6,{i18nKey:"project_timed_out_learn_more",components:[(0,p.jsx)("a",{href:"https://www.overleaf.com/learn/how-to/Why_do_I_keep_getting_the_compile_timeout_error_message%3F"})]})})]})}function z(){const{compiling:e,clearCache:t,clearingCache:n}=(0,M.Rf)(),{t:r}=(0,s.Bd)();return(0,p.jsx)(d.A,{size:"sm",variant:"danger",className:"logs-pane-actions-clear-cache",onClick:()=>t(),isLoading:n,disabled:n||e,leadingIcon:"delete",loadingLabel:r("clear_cached_files"),children:(0,p.jsx)("span",{children:r("clear_cached_files")})})}const J=(0,i.memo)(z);var q=n(61160);function K(e){let{fileList:t}=e;const{t:n}=(0,s.Bd)();if(!t)return null;function r(e){return e.path.split("/").pop()}return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(q.hO,{children:n("other_output_files")}),t.top.map((e=>(0,p.jsx)("li",{role:"menuitem",children:(0,p.jsx)(q.tJ,{role:"link",download:r(e),href:e.downloadURL||e.url,children:e.path})},e.path))),t.other.length>0&&t.top.length>0&&(0,p.jsx)(q.rx,{}),t.other.map((e=>(0,p.jsx)("li",{role:"menuitem",children:(0,p.jsx)(q.tJ,{role:"link",download:r(e),href:e.downloadURL||e.url,children:e.path})},e.path))),void 0!==t.archive?.fileCount&&t.archive?.fileCount>0&&(0,p.jsx)("li",{role:"menuitem",children:(0,p.jsxs)(q.tJ,{role:"link",download:r(t.archive),href:t.archive.url,children:[n("download_all")," (",t.archive.fileCount,")"]})})]})}const G=(0,i.memo)(K);function Y(){const{compiling:e,fileList:t}=(0,M.Rf)(),{t:n}=(0,s.Bd)();return t?(0,p.jsxs)(q.ms,{drop:"up",children:[(0,p.jsx)(q.C,{id:"dropdown-files-logs-pane",variant:"secondary",size:"sm",disabled:e||!t,children:n("other_logs_and_files")}),(0,p.jsx)(q.rI,{id:"dropdown-files-logs-pane-list",children:(0,p.jsx)(G,{fileList:t})})]}):null}const Q=(0,i.memo)(Y);var Z=n(56447),ee=n(32912),te=n(28252),ne=n(23442),re=n(49438);const oe=()=>{const[e,t]=(0,i.useState)(0),[n]=(0,f.A)("editor.view"),{t:r}=(0,s.Bd)(),[o,a]=(0,i.useState)(!1),[c]=(0,i.useState)((()=>n?.state.field(ne.previousFixState,!1))),l=(0,i.useMemo)((()=>{if(c)for(const e of c.messages)if(e.tool_calls)for(const t of e.tool_calls)if("suggestLineChange"===t.tool)return t.args}),[c]);return n&&c?(0,p.jsx)("div",{className:"ai-error-assistant-previous-fix",children:(0,p.jsxs)("div",{className:"ai-error-assistant",children:[(0,p.jsx)("div",{className:"ai-error-assistant-meta",children:(0,p.jsxs)("div",{className:"ai-error-assistant-previous-fix-heading",children:[(0,p.jsxs)("div",{className:"ai-error-assistant-previous-fix-meta",children:[(0,p.jsx)(u.A,{type:"history"}),l?(0,p.jsxs)("span",{children:[(0,p.jsx)("b",{children:r("last_suggested_fix")})," - ",r("line")," ",l.from.line,l.path&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("span",{children:[" ",r("of")," "]}),(0,p.jsx)("span",{children:(0,re.I)(l.path)})]})]}):(0,p.jsx)("span",{children:(0,p.jsx)("b",{children:r("last_suggested_fix")})})]}),!o&&(0,p.jsx)(d.A,{variant:"secondary",size:"sm",onClick:()=>a(!0),children:r("reopen")})]})}),o&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"ai-error-assistant-messages",children:c.messages.map(((e,t)=>"assistant"===e.role&&(0,p.jsx)(te.K,{view:n,level:"previous-fix",message:e},t)))}),(0,p.jsx)(ee.I,{messages:c.messages,logEntry:c.logEntry,applied:c.applied,rating:e,setRating:t,finished:!0})]})]})}):null},se=()=>{const{detachRole:e}=(0,Z.LV)();return e||!(0,m.A)("ol-showAiErrorAssistant")?null:(0,p.jsx)(oe,{})};var ie=n(39067),ae=n.n(ie);function ce(e){let{totalEntries:t,entriesShown:n,hasErrors:r}=e;const{t:o}=(0,s.Bd)(),{startCompile:a,stoppedOnFirstError:c,setAnimateCompileDropdownArrow:l}=(0,M.Rf)(),{enableStopOnFirstError:h}=(0,F.V)({eventSource:"too-many-logs"}),m=o("log_entry_maximum_entries_title",{total:t,displayed:n}),f=(0,i.useCallback)((()=>{h(),a({stopOnFirstError:!0}),l(!0)}),[h,a,l]);return(0,p.jsxs)("div",{className:"log-entry","aria-label":o("log_entry_maximum_entries"),children:[(0,p.jsx)(g,{level:"raw",headerTitle:m}),(0,p.jsx)("div",{className:"log-entry-content",children:(0,p.jsx)("div",{className:"log-entry-formatted-content",children:r&&!c?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("p",{children:[(0,p.jsx)(u.A,{type:"lightbulb",className:"align-middle"})," ",(0,p.jsxs)("strong",{children:[o("tip"),": "]}),(0,p.jsx)(s.x6,{i18nKey:"log_entry_maximum_entries_enable_stop_on_first_error",components:[(0,p.jsx)(d.A,{variant:"primary",size:"sm",onClick:f},"enable-stop-on-first-error"),(0,p.jsx)("a",{href:"https://www.overleaf.com/learn/latex/Questions/Tips_and_Tricks_for_Troubleshooting_LaTeX"},"learn-more")]})," "]}),(0,p.jsx)("p",{children:o("log_entry_maximum_entries_see_full_logs")})]}):(0,p.jsxs)("p",{children:[(0,p.jsx)(u.A,{type:"lightbulb",className:"align-middle"})," ",(0,p.jsxs)("strong",{children:[o("tip"),": "]}),o("log_entry_maximum_entries_see_full_logs")]})})})]})}ce.propTypes={totalEntries:ae().number,entriesShown:ae().number,hasErrors:ae().bool};const le=ce,he=[{import:o,path:"/overleaf/services/web/modules/ai/frontend/js/components/ai-error-assistant-previous-fix"}];function de(e){let{entries:t,hasErrors:n}=e;const{t:r}=(0,s.Bd)(),{syncToEntry:o}=(0,M.Rf)(),i=t.slice(0,100);return(0,p.jsxs)(p.Fragment,{children:[t.length>100&&(0,p.jsx)(le,{totalEntries:t.length,entriesShown:100,hasErrors:n}),he.map((e=>{let{import:{default:t},path:n}=e;return(0,p.jsx)(t,{},n)})),i.map(((e,t)=>(0,p.jsx)(O,{index:t,id:e.key,logEntry:e,ruleId:e.ruleId,headerTitle:e.messageComponent??e.message,rawContent:e.content,logType:e.type,level:e.level,contentDetails:e.contentDetails,entryAriaLabel:r("log_entry_description",{level:e.level}),sourceLocation:{file:e.file,line:e.line,column:e.column},onSourceLocationClick:o},e.key)))]})}const ue=(0,i.memo)(de);var pe=n(67984),ge=n(7174),me=n(22046);function fe(){const{t:e}=(0,s.Bd)();return(0,p.jsx)(me.A,{type:"error",content:e("code_check_failed_explanation"),className:"m-0"})}const _e=(0,i.memo)(fe);var we=n(63815);function ve(){const{startCompile:e,lastCompileOptions:t,setAnimateCompileDropdownArrow:n,isProjectOwner:r}=(0,M.Rf)(),{enableStopOnFirstError:o}=(0,F.V)({eventSource:"timeout-new"}),s=(0,i.useCallback)((()=>{o(),e({stopOnFirstError:!0}),n(!0)}),[o,e,n]);return(0,p.jsxs)("div",{className:"website-redesign timeout-upgrade-paywall-prompt",children:[(0,p.jsx)(be,{isProjectOwner:r}),(0,m.A)("ol-ExposedSettings").enableSubscriptions&&(0,p.jsx)(ye,{handleEnableStopOnFirstErrorClick:s,lastCompileOptions:t,isProjectOwner:r})]})}const be=(0,i.memo)((function(e){let{isProjectOwner:t}=e;const{t:n}=(0,s.Bd)();return(0,i.useEffect)((()=>{A._("paywall-prompt",{"paywall-type":"compile-timeout","paywall-version":"secondary"})}),[]),(0,p.jsx)(O,{headerTitle:n("project_failed_to_compile"),headerIcon:(0,p.jsx)(u.A,{type:"error",className:"log-entry-header-title",size:"2x",unfilled:!0}),formattedContent:(0,m.A)("ol-ExposedSettings").enableSubscriptions&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("p",{className:"compile-timeout-message",children:t?(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{children:n("your_project_need_more_time_to_compile")}),(0,p.jsx)("p",{children:n("upgrade_to_unlock_more_time")})]}):(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{children:n("this_project_need_more_time_to_compile")}),(0,p.jsx)("p",{children:n("upgrade_to_unlock_more_time")})]})}),!1===t&&(0,p.jsx)(s.x6,{i18nKey:"tell_the_project_owner_and_ask_them_to_upgrade",components:[(0,p.jsx)("strong",{})]}),t&&(0,p.jsx)("div",{className:"log-entry-cta-container",children:(0,p.jsx)(N.A,{source:"compile-timeout",buttonProps:{variant:"secondary"},handleClick:function(){A._("paywall-click",{"paywall-type":"compile-timeout","paywall-version":"secondary"})},children:n("try_for_free")})})]}),entryAriaLabel:n("your_compile_timed_out"),level:"error"})})),ye=(0,i.memo)((function(e){let{lastCompileOptions:t,handleEnableStopOnFirstErrorClick:n,isProjectOwner:r}=e;const{t:o}=(0,s.Bd)();return(0,p.jsx)(O,{headerTitle:o("other_causes_of_compile_timeouts"),formattedContent:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:o("large_or_high_resolution_images_taking_too_long_to_process")}),(0,p.jsxs)("li",{children:[(0,p.jsx)(s.x6,{i18nKey:"a_fatal_compile_error_that_completely_blocks_compilation",components:[(0,p.jsx)("a",{href:"/learn/how-to/Fixing_and_preventing_compile_timeouts#Step_3:_Assess_your_project_for_time-consuming_tasks_and_fatal_errors",rel:"noopener noreferrer",target:"_blank"})]}),!t.stopOnFirstError&&(0,p.jsxs)(p.Fragment,{children:[" ",(0,p.jsx)(s.x6,{i18nKey:"enable_stop_on_first_error_under_recompile_dropdown_menu_v2",components:[(0,p.jsx)("strong",{className:"log-bold-text"}),(0,p.jsx)("strong",{className:"log-bold-text"})]})," "]})]})]}),(0,p.jsx)("p",{className:"mb-0",children:(0,p.jsx)(s.x6,{i18nKey:"learn_more_about_compile_timeouts",components:[(0,p.jsx)("a",{href:"/learn/how-to/Fixing_and_preventing_compile_timeouts",rel:"noopener noreferrer",target:"_blank"})]})})]}),entryAriaLabel:o("reasons_for_compile_timeouts"),level:"raw"})})),xe=(0,i.memo)(ve);var ke=n(35722),Ce=n(58874),Ee=n(61157),Te=n(95851),je=n(93443);function Ie(e){let{icon:t,children:n}=e;return(0,p.jsxs)("li",{className:"d-flex align-items-center",children:[(0,p.jsx)("div",{className:"flex-shrink-0",children:(0,p.jsx)(u.A,{type:t})}),(0,p.jsx)("div",{className:"flex-grow-1 ms-2",children:n})]})}function Se(e){let{children:t,itmCampaign:n,onClick:r}=e;return(0,p.jsxs)("a",{href:`/user/subscription/choose-your-plan?itm-campaign=${n}`,target:"_blank",rel:"noreferrer",onClick:r,children:[t,(0,p.jsx)(u.A,{type:"open_in_new"})]},"compare_plans_link")}function Ae(e){let{title:t,summary:n,onClose:r,planPricing:o,itmCampaign:i,isStudent:a=!1,onClickInfoLink:c,onClickPaywall:l}=e;const{t:h}=(0,s.Bd)(),u=a?o.student:o.standard,g=a?"student_free_trial_7_days":"collaborator_free_trial_7_days";return(0,p.jsxs)(je.A,{className:"upgrade-prompt",children:[(0,p.jsx)(Te.A,{className:"justify-content-end",children:(0,p.jsx)(Ce.A,{onClick:()=>r()})}),(0,p.jsxs)(Te.A,{className:"text-center",children:[(0,p.jsx)("h2",{className:"my-0 upgrade-prompt-title",children:t}),(0,p.jsx)("p",{className:"upgrade-prompt-summary",children:n})]}),(0,p.jsxs)(Te.A,{className:"g-3",children:[(0,p.jsx)(Ee.A,{md:6,className:"upgrade-prompt-card-container",children:(0,p.jsxs)("div",{className:"g-0 upgrade-prompt-card upgrade-prompt-card-premium",children:[(0,p.jsxs)(Te.A,{className:"justify-content-between",children:[(0,p.jsx)(Ee.A,{children:(0,p.jsx)("h3",{children:h(a?"student":"standard")})}),(0,p.jsx)(Ee.A,{xs:"auto",children:(0,p.jsx)(ke.A,{className:"badge-premium-gradient",children:h("recommended")})})]}),(0,p.jsx)(Te.A,{children:(0,p.jsxs)("p",{className:"upgrade-prompt-price",children:[(0,p.jsx)("span",{className:"upgrade-prompt-price-number",children:u})," ",h("per_month")]})}),(0,p.jsx)(Te.A,{children:(0,p.jsxs)("ul",{className:"upgrade-prompt-list",children:[(0,p.jsx)(Ie,{icon:"hourglass_top",children:h("12x_more_compile_time")}),(0,p.jsx)(Ie,{icon:"group_add",children:h("collabs_per_proj",{collabcount:a?6:10})}),(0,p.jsx)(Ie,{icon:"history",children:h("unlimited_document_history")})]})}),(0,p.jsx)(Te.A,{className:"mt-auto",children:(0,p.jsx)("a",{className:"btn btn-premium",href:`/user/subscription/new?planCode=${g}&itm-campaign=${i}`,onClick:l,target:"_blank",rel:"noreferrer",children:h("try_for_free")})})]})}),(0,p.jsx)(Ee.A,{md:6,className:"upgrade-prompt-card-container",children:(0,p.jsxs)("div",{className:"g-0 upgrade-prompt-card upgrade-prompt-card-free",children:[(0,p.jsx)(Te.A,{children:(0,p.jsx)("h3",{children:h("free")})}),(0,p.jsx)(Te.A,{children:(0,p.jsxs)("p",{className:"upgrade-prompt-price",children:[(0,p.jsx)("span",{className:"upgrade-prompt-price-number invisible"}),h("your_current_plan")]})}),(0,p.jsx)(Te.A,{children:(0,p.jsxs)("ul",{className:"upgrade-prompt-list",children:[(0,p.jsx)(Ie,{icon:"hourglass_bottom",children:h("basic_compile_time")}),(0,p.jsx)(Ie,{icon:"person",children:h("collabs_per_proj_single",{collabcount:1})}),(0,p.jsx)(Ie,{icon:"history_off",children:h("limited_document_history")})]})}),(0,p.jsx)(Te.A,{className:"mt-auto",children:(0,p.jsx)(d.A,{variant:"secondary",onClick:()=>r(),children:h("continue_with_free_plan")})})]})})]}),(0,p.jsx)(Te.A,{className:"text-center",children:(0,p.jsx)("p",{className:"upgrade-prompt-all-plans",children:(0,p.jsx)(s.x6,{i18nKey:"compare_all_plans",components:[(0,p.jsx)(Se,{onClick:c,itmCampaign:i})]})})})]})}const Le=["High-school student","Undergraduate student","Master's student (e.g. MSc, MA)","Doctoral student (e.g. PhD, MD, EngD)"];const Oe=function(e){let{setIsShowingPrimary:t}=e;const n=(0,m.A)("ol-odcRole"),r=(0,m.A)("ol-paywallPlans"),o=(0,i.useMemo)((()=>Le.includes(n)),[n]),[s,a]=(0,i.useState)(!1);function c(e,t){A._(e,{"paywall-type":"compile-timeout","paywall-version":"primary",...t})}return(0,i.useEffect)((()=>{c("paywall-prompt",{plan:o?"student":"collaborator"}),t(!0)}),[o,t]),(0,p.jsx)("div",{children:s?(0,p.jsx)(xe,{}):(0,p.jsx)(Ae,{title:"Unlock more compile time",summary:"Your project took too long to compile and timed out.",onClose:function(){c("paywall-dismiss"),a(!0),t(!1)},planPricing:{student:r?.student,standard:r?.collaborator},itmCampaign:"compile-timeout",isStudent:o,onClickInfoLink:function(){c("paywall-info-click",{content:"plans"})},onClickPaywall:function(){c("paywall-click",{plan:o?"student":"collaborator"})}})})};function Re(e){let{alwaysVisible:t=!1}=e;const{codeCheckFailed:n,error:r,hasShortCompileTimeout:o,logEntries:a,rawLog:l,validationIssues:h,showLogs:d,stoppedOnFirstError:u,isProjectOwner:g}=(0,M.Rf)(),{loadingError:f}=(0,we.J)(),{t:_}=(0,s.Bd)(),[w,v]=(0,i.useState)(!1),b=(0,m.A)("ol-isPaywallChangeCompileTimeoutEnabled"),y=g&&b;return(0,p.jsx)("div",{className:c()("logs-pane",{hidden:!d&&!t&&!f}),children:(0,p.jsxs)("div",{className:"logs-pane-content",children:[n&&(0,p.jsx)(_e,{}),u&&(0,p.jsx)(D,{}),f&&(0,p.jsx)(B,{error:"pdf-viewer-loading-error"}),o&&"timedout"===r?y?(0,p.jsx)(Oe,{setIsShowingPrimary:v}):(0,p.jsx)(V,{}):(0,p.jsx)(p.Fragment,{children:r&&(0,p.jsx)(B,{error:r})}),h&&Object.entries(h).map((e=>{let[t,n]=e;return(0,p.jsx)(P,{name:t,issue:n},t)})),a?.all&&(0,p.jsx)(ue,{entries:a.all,hasErrors:a.errors.length>0}),l&&(0,p.jsx)(O,{headerTitle:_("raw_logs"),rawContent:l,entryAriaLabel:_("raw_logs_description"),level:"raw"}),!w&&(0,p.jsxs)("div",{className:"logs-pane-actions",children:[(0,p.jsx)(J,{}),(0,p.jsx)(Q,{})]})]})})}const Pe=(0,pe.A)((0,i.memo)(Re),(()=>(0,p.jsx)(ge.A,{type:"logs"})))},32912:(e,t,n)=>{"use strict";n.d(t,{I:()=>E});var r=n(71627),o=(n(82438),n(91020),n(50020),n(14041)),s=n(60961),i=n(96713),a=n(97434),c=n(63003),l=n(12327),h=n(1705),d=n(7829),u=n(96700),p=n(31085);const g=e=>{let{rating:t,setRating:n,messages:r,logEntry:s}=e;const[i,a]=(0,o.useState)(!1),[c,l]=(0,o.useState)(!1);return 1===t?(0,p.jsx)(_,{messages:r,rating:t,logEntry:s,clearRating:()=>n(0),isSending:i,setIsSending:a,isSent:c,setIsSent:l}):-1===t?(0,p.jsx)(w,{messages:r,rating:t,logEntry:s,clearRating:()=>n(0),isSending:i,setIsSending:a,isSent:c,setIsSent:l}):null};let m=1;const f=(e,t)=>`${e}-${t}`,_=e=>{let{rating:t,logEntry:n,messages:u,clearRating:g,isSending:_,setIsSending:w,isSent:x,setIsSent:k}=e;const[C]=(0,o.useState)(String(m++)),{t:E}=(0,a.Bd)(),T=(0,o.useCallback)((async e=>{e.preventDefault(),w(!0);try{const r=new FormData(e.target),o={level:n.level,ruleId:n.ruleId,rating:t,notes:r.get("notes")};r.get("consent")&&(o.rawLog=n.raw,o.messages=b(u)),await y(o)}catch(e){s.$.error(e)}finally{w(!1),k(!0)}}),[n,u,t,w,k]);return x?(0,p.jsx)(v,{clearRating:g}):(0,p.jsxs)(h.A,{onSubmit:T,className:"ai-error-assistant-feedback-form",children:[(0,p.jsxs)("div",{className:"ai-error-assistant-feedback-form-heading",children:[(0,p.jsx)("div",{children:"What did you find most helpful?"}),(0,p.jsx)("button",{"aria-label":"Close",onClick:g,children:(0,p.jsx)(i.A,{type:"close"})})]}),(0,p.jsx)(l.A,{controlId:"aiErrorAssistantFeedbackLatex",children:(0,p.jsx)(d.A,{as:"textarea",name:"notes"})}),(0,p.jsx)(c.A,{name:"consent",id:f("consent",C),label:E("include_the_error_message_and_ai_response")}),(0,p.jsx)("div",{className:"ai-error-assistant-feedback-form-footer",children:(0,p.jsx)(r.A,{variant:"secondary",type:"submit",disabled:_,isLoading:_,children:E("submit_title")})})]})},w=e=>{let{rating:t,logEntry:n,messages:s,clearRating:g,isSending:_,setIsSending:w,isSent:x,setIsSent:k}=e;const{t:C}=(0,a.Bd)(),[E]=(0,o.useState)(String(m++)),T=(0,o.useCallback)((async e=>{e.preventDefault(),w(!0);try{const r=new FormData(e.target),o={level:n.level,ruleId:n.ruleId,rating:t,notes:r.get("notes"),reason:r.get("reason")};r.get("consent")&&(o.rawLog=n.raw,o.messages=b(s)),await y(o)}finally{w(!1),k(!0)}}),[n,s,t,w,k]);return x?(0,p.jsx)(v,{clearRating:g}):(0,p.jsxs)(h.A,{onSubmit:T,className:"ai-error-assistant-feedback-form",children:[(0,p.jsxs)("div",{className:"ai-error-assistant-feedback-form-heading",children:[(0,p.jsx)("div",{children:C("ai_feedback_tell_us_what_was_wrong_so_we_can_improve")}),(0,p.jsx)("button",{"aria-label":"Close",onClick:g,children:(0,p.jsx)(i.A,{type:"close"})})]}),(0,p.jsxs)(l.A,{className:"ai-error-assistant-feedback-form-choices",children:[(0,p.jsx)(c.A,{className:"form-check-inline",type:"radio",name:"reason",id:f("reason",E),value:"error-not-fixed",label:C("ai_feedback_the_suggestion_didnt_fix_the_error")}),(0,p.jsx)(c.A,{className:"form-check-inline",type:"radio",name:"reason",id:f("no-suggested-change",E),value:"no-suggested-change",label:C("ai_feedback_there_was_no_code_fix_suggested")}),(0,p.jsx)(c.A,{className:"form-check-inline",type:"radio",name:"reason",id:f("answer-too-long",E),value:"answer-too-long",label:C("ai_feedback_the_answer_was_too_long")}),(0,p.jsx)(c.A,{className:"form-check-inline",type:"radio",name:"reason",id:f("answer-not-detailed",E),value:"answer-not-detailed",label:C("ai_feedback_the_answer_wasnt_detailed_enough")}),(0,p.jsx)(c.A,{className:"form-check-inline",type:"radio",name:"reason",id:f("answer-not-best-fix",E),value:"answer-not-best-fix",label:C("ai_feedback_the_suggestion_wasnt_the_best_fix_available")}),(0,p.jsx)(c.A,{className:"form-check-inline",type:"radio",name:"reason",id:f("other",E),value:"other",label:C("other")})]}),(0,p.jsxs)(l.A,{controlId:"aiErrorAssistantFeedbackNotes",children:[(0,p.jsx)(u.A,{children:C("ai_feedback_please_provide_more_detail")}),(0,p.jsx)(d.A,{as:"textarea",name:"notes"})]}),(0,p.jsx)(c.A,{name:"consent",id:f("consent",E),label:C("include_the_error_message_and_ai_response")}),(0,p.jsx)("div",{className:"ai-error-assistant-feedback-form-footer",children:(0,p.jsx)(r.A,{type:"submit",disabled:_,variant:"secondary",isLoading:_,children:C("submit_title")})})]})},v=e=>{let{clearRating:t}=e;const{t:n}=(0,a.Bd)();return(0,p.jsx)("div",{className:"ai-error-assistant-feedback-form",children:(0,p.jsxs)("div",{className:"ai-error-assistant-feedback-form-heading",children:[(0,p.jsx)("div",{children:n("thank_you_for_your_feedback")}),(0,p.jsx)("button",{"aria-label":n("close"),onClick:t,children:(0,p.jsx)(i.A,{type:"close"})})]})})},b=e=>e.flatMap((e=>[e.content,...e.tool_calls.map((e=>`${e.tool} ${JSON.stringify(e.args)||""}`))])).join("\n\n"),y=async e=>{const t=await fetch("https://script.google.com/macros/s/AKfycbzReBQ1jUgZVWQ8m0Kiwb_SFcBYTvpBseiwS99P4c0ObZmgQHFntrt0I8JG15tLxUj_/exec",{mode:"no-cors",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return t.ok||s.$.error(await t.text()),t};var x=n(53373),k=n.n(x),C=n(59162);const E=e=>{let{messages:t,finished:n,applied:o=!1,suggestFix:s,logEntry:c,rating:l,setRating:h}=e;const{t:d}=(0,a.Bd)();return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"ai-error-assistant-footer",children:[n?(0,p.jsxs)("div",{className:"ai-error-assistant-feedback",children:[(0,p.jsx)(C.A,{id:"ai-error-assistant-feedback-positive-tooltip",description:d("this_was_helpful"),children:(0,p.jsx)(r.A,{type:"button",variant:"ghost",size:"sm","aria-label":d("this_was_helpful"),onClick:()=>h((e=>1!==e?1:0)),className:k()("ai-error-assistant-feedback-button","ai-error-assistant-feedback-positive",{active:1===l}),children:(0,p.jsx)(i.A,{type:"thumb_up"})})}),(0,p.jsx)(C.A,{id:"ai-error-assistant-feedback-negative-tooltip",description:d("this_wasnt_helpful"),children:(0,p.jsx)(r.A,{type:"button",variant:"ghost",size:"sm","aria-label":d("this_wasnt_helpful"),onClick:()=>h((e=>-1!==e?-1:0)),className:k()("ai-error-assistant-feedback-button","ai-error-assistant-feedback-negative",{active:-1===l}),children:(0,p.jsx)(i.A,{type:"thumb_down"})})}),s&&(0,p.jsx)(C.A,{id:"ai-error-assistant-feedback-retry-tooltip",description:d("suggest_a_different_fix"),children:(0,p.jsx)(r.A,{type:"button",variant:"ghost",size:"sm","aria-label":d("suggest_a_different_fix"),onClick:s,className:"ai-error-assistant-feedback-button",children:(0,p.jsx)(i.A,{type:"refresh"})})})]}):(0,p.jsx)("span",{}),o&&(0,p.jsx)("div",{children:d("suggestion_applied")}),s&&(0,p.jsx)("div",{children:d("ai_can_make_mistakes")})]}),(0,p.jsx)(g,{rating:l,setRating:h,messages:t,logEntry:c},l),(0,p.jsx)("div",{className:"ai-error-assistant-survey",children:(0,p.jsxs)("div",{children:[d("this_is_a_new_feature")," -"," ",(0,p.jsxs)("a",{href:"https://forms.gle/j6wuXQwsqeqngSCS7",target:"_blank",rel:"noopener noreferrer",children:[d("give_your_feedback"),"."]})]})})]})}},33101:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(37603),s=n(97348);class i extends o{constructor(e,t){super("client sent updates with end_version "+e+" but latest chunk has end_version "+t,{clientEndVersion:e,latestEndVersion:t}),this.clientEndVersion=e,this.latestEndVersion=t}}class NotFoundError extends o{constructor(e,t,n){super(t||`no chunks for project ${e}`,n||{projectId:e}),this.projectId=e}}class VersionNotFoundError extends NotFoundError{constructor(e,t){super(e,`chunk for ${e} v ${t} not found`,{projectId:e,version:t}),this.projectId=e,this.version=t}}class BeforeTimestampNotFoundError extends NotFoundError{constructor(e,t){super(e,`chunk for ${e} timestamp ${t} not found`),this.projectId=e,this.timestamp=t}}class NotPersistedError extends NotFoundError{constructor(e){super(e,`chunk for ${e} not persisted yet`),this.projectId=e}}class a{static ConflictingEndVersion=(()=>i)();static NotFoundError=(()=>NotFoundError)();static VersionNotFoundError=(()=>VersionNotFoundError)();static BeforeTimestampNotFoundError=(()=>BeforeTimestampNotFoundError)();static NotPersistedError=(()=>NotPersistedError)();constructor(e,t){r.instance(e,s,"bad history"),r.integer(t,"bad startVersion"),this.history=e,this.startVersion=t}static fromRaw(e){return new a(s.fromRaw(e.history),e.startVersion)}toRaw(){return{history:this.history.toRaw(),startVersion:this.startVersion}}getHistory(){return this.history}getSnapshot(){return this.history.getSnapshot()}getChanges(){return this.history.getChanges()}pushChanges(e){this.history.pushChanges(e)}getEndVersion(){return this.startVersion+this.history.countChanges()}getEndTimestamp(){return this.history.countChanges()?this.history.getChanges().slice(-1)[0].getTimestamp():null}getStartVersion(){return this.startVersion}async loadFiles(e,t){await this.history.loadFiles(e,t)}}e.exports=a},33478:(e,t,n)=>{"use strict";n.d(t,{Hs:()=>u,Ly:()=>c,bu:()=>l,ez:()=>h,lW:()=>d,vp:()=>p});n(82438),n(34840);var r=n(64932),o=n(60961);const s="undefined"!=typeof TextEncoder;s||o.$.warn("TextEncoder is not available. Disabling pdf-caching.");const i=Array.isArray(navigator.userAgentData?.brands)&&navigator.userAgentData.brands.some((e=>"Opera"===e.brand));function a(e){return!!s&&(!i&&"enabled"===(0,r.A)("ol-splitTestVariants")?.[e])}i&&o.$.warn("Browser cache is limited in Opera. Disabling pdf-caching.");const c=a("pdf-caching-cached-url-lookup"),l=a("pdf-caching-prefetching"),h=a("pdf-caching-prefetch-large"),d=a("pdf-caching-mode"),u=a("track-pdf-download"),p=(0,r.A)("ol-projectOwnerHasPremiumOnPageLoad")&&a("populate-clsi-cache")},33755:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(64331);class s extends o{constructor(e,t,n){r.integer(e,"RestoreFileOrigin: bad version"),r.string(t,"RestoreFileOrigin: bad path"),r.date(n,"RestoreFileOrigin: bad timestamp"),super(s.KIND),this.version=e,this.path=t,this.timestamp=n}static fromRaw(e){return new s(e.version,e.path,new Date(e.timestamp))}toRaw(){return{kind:s.KIND,version:this.version,path:this.path,timestamp:this.timestamp.toISOString()}}getVersion(){return this.version}getPath(){return this.path}getTimestamp(){return this.timestamp}}s.KIND="file-restore",e.exports=s},35078:(e,t,n)=>{"use strict";var r;function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(97107),n(82438),n(50020);const s=n(45250),i=n(64347).assert,a=n(90953),c=n(99568),l=n(8010),h=n(64331),d=n(44838),u=n(62293),p=n(65591);class g{constructor(e,t,n,r,o,s,i){this.setOperations(e),this.setTimestamp(t),this.setAuthors(n||[]),this.setOrigin(r),this.setV2Authors(o||[]),this.setProjectVersion(s),this.setV2DocVersions(i)}toRaw(){const e={operations:this.operations.map((function(e){return e.toRaw()})),timestamp:this.timestamp.toISOString(),authors:this.authors};return this.v2Authors&&(e.v2Authors=this.v2Authors),this.origin&&(e.origin=this.origin.toRaw()),this.projectVersion&&(e.projectVersion=this.projectVersion),this.v2DocVersions&&(e.v2DocVersions=this.v2DocVersions.toRaw()),e}static fromRaw(e){if(!e)return null;let t;return i.array.of.object(e.operations,"bad raw.operations"),i.nonEmptyString(e.timestamp,"bad raw.timestamp"),e.authors&&(t=e.authors.map((e=>0===e?null:e))),new g(e.operations.map(l.fromRaw),new Date(e.timestamp),t,e.origin&&h.fromRaw(e.origin),e.v2Authors,e.projectVersion,e.v2DocVersions&&p.fromRaw(e.v2DocVersions))}getOperations(){return this.operations}setOperations(e){i.array.of.object(e,"Change: bad operations"),this.operations=e}getTimestamp(){return this.timestamp}setTimestamp(e){i.date(e,"Change: bad timestamp"),this.timestamp=e}getAuthors(){return this.authors}setAuthors(e){i.array(e,"Change: bad author ids array"),e.length>1&&i.maybe.emptyArray(this.v2Authors,"Change: cannot set v1 authors if v2 authors is set"),c.assertV1(e,"Change: bad author ids"),this.authors=e}getV2Authors(){return this.v2Authors}setV2Authors(e){i.array(e,"Change: bad v2 author ids array"),e.length>1&&i.maybe.emptyArray(this.authors,"Change: cannot set v2 authors if v1 authors is set"),c.assertV2(e,"Change: not a v2 author id"),this.v2Authors=e}getOrigin(){return this.origin}setOrigin(e){i.maybe.instance(e,h,"Change: bad origin"),this.origin=e}getProjectVersion(){return this.projectVersion}setProjectVersion(e){i.maybe.match(e,g.PROJECT_VERSION_RX,"Change: bad projectVersion"),this.projectVersion=e}getV2DocVersions(){return this.v2DocVersions}setV2DocVersions(e){i.maybe.instance(e,p,"Change: bad v2DocVersions"),this.v2DocVersions=e}findBlobHashes(e){for(const t of this.operations)t.findBlobHashes(e)}async loadFiles(e,t){for(const n of this.operations)await n.loadFiles(e,t)}pushOperation(e){return this.getOperations().push(e),this}applyTo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(const n of this.iterativelyApplyTo(e,t));}iterativelyApplyTo(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){i.object(e,"bad snapshot");for(const r of t.operations){try{r.applyTo(e,n)}catch(e){if(!(e instanceof d.EditMissingFileError||e instanceof u.FileNotFoundError)||n.strict)throw e}yield r}t.projectVersion&&e.setProjectVersion(t.projectVersion),t.v2DocVersions&&e.updateV2DocVersions(t.v2DocVersions)}()}transformAfter(e){i.object(e,"bad other");const t=this.getOperations(),n=e.getOperations();for(let e=0;e<n.length;++e)for(let r=0;r<t.length;++r)t[r]=l.transform(t[r],n[e])[0]}clone(){return g.fromRaw(this.toRaw())}async store(e,t){i.maybe.number(t,"bad concurrency");const n=this.toRaw();n.authors=s.uniq(n.authors);const r=await a(this.operations,(t=>t.store(e)),{concurrency:t||1});return n.operations=r,n}canBeComposedWith(e){const t=this.getOperations(),n=e.getOperations();return!(t.length>1||n.length>1)&&t[0].canBeComposedWith(n[0])}}r=g,o(g,"PROJECT_VERSION_RX_STRING","^[0-9]+\\.[0-9]+$"),o(r,"PROJECT_VERSION_RX",new RegExp(r.PROJECT_VERSION_RX_STRING)),e.exports=g},35287:(e,t,n)=>{"use strict";n.d(t,{$X:()=>s,Xk:()=>i,bJ:()=>a,pD:()=>c});n(82438),n(99819),n(50020);var r=n(93852);function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=e.docs.find((e=>e._id===t))||e.fileRefs.find((e=>e._id===t));if(r)return n.concat([r]);for(const r of e.folders){if(r._id===t)return n.concat([r]);{const e=o(r,t,n.concat([r]));if(null!==e)return e}}return null}function s(e,t){return o(e,t)?.map((e=>e.name)).join("/")||null}function i(e,t){if(""===t)return{entity:e,type:"folder"};const n=t.split("/"),r=n.shift(),o=n.join("/");if("."===r)return i(e,o);const s=e.docs.find((e=>e.name===r));if(s)return{entity:s,type:"doc"};const a=e.fileRefs.find((e=>e.name===r));if(a)return{entity:a,type:"fileRef"};for(const t of e.folders)if(t.name===r)return""===o?{entity:t,type:"folder"}:i(t,o);return null}function a(e,t,n){for(const o of["",".png",".jpg",".jpeg",".pdf",".PNG",".JPG",".JPEG",".PDF"]){const s=i(e,n+o);if("fileRef"===s?.type){const{name:e,_id:n,hash:o}=s.entity;return{url:(0,r.i)(t,n,o),extension:e.slice(e.lastIndexOf(".")+1)}}}return null}function c(e,t){const n=s(e,t);return n?.split("/").slice(0,-1).join("/")||null}},35447:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var r=n(14041),o=n(69954),s=n(37858),i=n(60961),a=n(10646);const c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[n,c]=(0,r.useState)(!1),{deactivateTutorial:l,currentPopup:h,setCurrentPopup:d}=(0,a.mi)(),u=(0,r.useCallback)((async n=>{let{event:r="promo-click",action:a="complete",...h}=n;o._(r,{...t,...h});try{await(0,s.TB)(`/tutorial/${e}/${a}`)}catch(e){i.$.error(e)}c(!1),l(e)}),[l,t,e]),p=(0,r.useCallback)((async()=>{await u({event:"promo-dismiss",action:"complete"})}),[u]),g=(0,r.useCallback)((async()=>{await u({event:"promo-click",action:"postpone",button:"maybe-later"})}),[u]),m=(0,r.useCallback)((function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"promo-prompt";return null===h&&(d(e),c(!0),o._(n,t),!0)}),[h,d,e,t]),f=(0,r.useCallback)((()=>{h===e&&(d(null),c(!1))}),[d,c,h,e]),_=(0,r.useCallback)((function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"promo-prompt";d(e),c(!0),o._(n,t)}),[d,c,e,t]),w=(0,r.useCallback)((()=>{f(),l(e)}),[f,l,e]);return{completeTutorial:u,dismissTutorial:p,maybeLater:g,tryShowingPopup:m,clearPopup:f,clearAndShow:_,showPopup:n,hideUntilReload:w}}},35722:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(83681),o=n(31085);const s=function(e){let{bg:t,text:n,...s}=e;return"warning"===t&&(t="warning-light-bg",n="warning"),(0,o.jsx)(r.A,{bg:t,text:n,...s})}},37766:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(14041),o=n(67353);function s(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{scopeEventEmitter:n}=(0,o.nK)();return(0,r.useCallback)((function(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];n.emit(e,t,...o)}),[n,e,t])}},37939:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var r=n(14041),o=n(93588),s=n(64932),i=n(60961);const a=(0,s.A)("ol-debugPdfDetach");function c(e,t,n,s){const[c,l]=(0,r.useState)(t),{role:h,broadcastEvent:d,lastDetachedConnectedAt:u,addEventHandler:p,deleteEventHandler:g}=(0,o.Q2)(),m=`state-${e}`;(0,r.useEffect)((()=>{h===n&&d(m,{value:c})}),[h,n,m,c,d,u]);const f=(0,r.useCallback)((e=>{e.event===m&&h===s&&(a&&i.$.warn(`Set ${e.data.value} for ${m}`),l(e.data.value))}),[h,s,m,l]);return(0,r.useEffect)((()=>(p(f),()=>g(f))),[p,g,f]),[c,l]}},39891:(e,t,n)=>{"use strict";function r(e){const t=e.linkedFileData?.importedAt??e.created;return{_id:e._id,name:e.name,id:e._id,type:"file",selected:!0,linkedFileData:e.linkedFileData,created:t?new Date(t):new Date,hash:e.hash}}function o(e){const t=r(e);return{...t,created:t.created.toISOString()}}n.d(t,{D:()=>r,g:()=>o})},41026:(e,t,n)=>{"use strict";n.d(t,{V:()=>useStopOnFirstError});var r=n(14041),o=n(8164),s=n(86316),i=n(69954);function useStopOnFirstError(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{eventSource:t}=e,{stopOnFirstError:n,setStopOnFirstError:a}=(0,o.Rf)(),{_id:c}=(0,s.O)(),l=(0,r.useCallback)((()=>{if(!n){const e={projectId:c};t&&(e.source=t),i._("stop-on-first-error-enabled",e)}a(!0)}),[t,c,n,a]),h=(0,r.useCallback)((()=>{const e={projectId:c};t&&(e.source=t),n&&i._("stop-on-first-error-disabled",e),a(!1)}),[t,c,n,a]);return{enableStopOnFirstError:l,disableStopOnFirstError:h}}},41416:(e,t,n)=>{"use strict";n.d(t,{Gn:()=>b,l$:()=>y});n(97107);var r=n(14041),o=n(14936),s=n(10646),i=n(14901),a=n(86316);function c(){const[e,t]=(0,o.A)("project"),{_id:n}=(0,a.O)();return async(r,o)=>{if(e){if(e[r]!==o){await(0,i.Y)(n,{[r]:o});const s="rootDocId"===r?"rootDoc_id":r;t({...e,[s]:o})}}}}var l=n(60961);function h(){const[e]=(0,o.A)("project"),t=c(),n=(0,r.useCallback)((e=>{t("compiler",e).catch(l.$.error)}),[t]),a=(0,r.useCallback)((e=>{t("imageName",e).catch(l.$.error)}),[t]),{setRootDocId:h,rootDocId:d}=function(){const[e]=(0,o.A)("project.rootDoc_id"),{permissionsLevel:t}=(0,s.mi)(),n=c(),i=(0,r.useCallback)((async r=>{if(void 0!==e&&"readOnly"!==t)try{await n("rootDocId",r)}catch(e){}}),[t,e,n]);return{rootDocId:e,setRootDocId:i}}(),u=function(){const[e,t]=(0,o.A)("project.spellCheckLanguage"),n=c();return(0,r.useCallback)((r=>{null!=e&&r!==e&&(t(r),n("spellCheckLanguage",r),(0,i.u)("spellCheckLanguage",r))}),[t,e,n])}();return{compiler:e?.compiler,setCompiler:n,imageName:e?.imageName,setImageName:a,rootDocId:d,setRootDocId:h,spellCheckLanguage:e?.spellCheckLanguage,setSpellCheckLanguage:u}}var d=n(66020),u=(n(82438),n(99819),n(45250)),p=n.n(u),g=n(64932),m=n(24731);function f(){const e=function(){const{userSettings:e,setUserSettings:t}=(0,d.dk)();return(n,r)=>{e[n]!==r&&(t({...e,[n]:r}),(0,i.u)(n,r))}}(),{userSettings:t}=(0,d.dk)(),{overallTheme:n,autoComplete:o,autoPairDelimiters:s,syntaxValidation:a,editorTheme:c,mode:l,fontSize:h,fontFamily:u,lineHeight:f,pdfViewer:_,mathPreview:w}=t,v=function(){const{userSettings:e,setUserSettings:t}=(0,d.dk)(),{overallTheme:n}=e,o=(0,r.useCallback)((e=>{t((t=>({...t,overallTheme:e})))}),[t]);return(0,r.useEffect)((()=>{const e="light-"!==n||(0,m.R)()?"default":"light";document.body.dataset.theme=e}),[n]),(0,r.useCallback)((e=>{n!==e&&p().find((0,g.A)("ol-overallThemes"),(t=>t.val===e))&&(o(e),(0,i.u)("overallTheme",e))}),[n,o])}(),b=(0,r.useCallback)((t=>{e("autoComplete",t)}),[e]),y=(0,r.useCallback)((t=>{e("autoPairDelimiters",t)}),[e]),x=(0,r.useCallback)((t=>{e("syntaxValidation",t)}),[e]),k=(0,r.useCallback)((t=>{e("editorTheme",t)}),[e]),C=(0,r.useCallback)((t=>{e("mode",t)}),[e]),E=(0,r.useCallback)((t=>{e("fontSize",t)}),[e]),T=(0,r.useCallback)((t=>{e("fontFamily",t)}),[e]),j=(0,r.useCallback)((t=>{e("lineHeight",t)}),[e]),I=(0,r.useCallback)((t=>{e("pdfViewer",t)}),[e]),S=(0,r.useCallback)((t=>{e("mathPreview",t)}),[e]);return{autoComplete:o,setAutoComplete:b,autoPairDelimiters:s,setAutoPairDelimiters:y,syntaxValidation:a,setSyntaxValidation:x,editorTheme:c,setEditorTheme:k,overallTheme:n,setOverallTheme:v,mode:l,setMode:C,fontSize:h,setFontSize:E,fontFamily:u,setFontFamily:T,lineHeight:f,setLineHeight:j,pdfViewer:_,setPdfViewer:I,mathPreview:w,setMathPreview:S}}var _=n(67353);var w=n(31085);const v=(0,r.createContext)(void 0),b=e=>{let{children:t}=e;const{compiler:n,setCompiler:s,imageName:i,setImageName:a,rootDocId:c,setRootDocId:l,spellCheckLanguage:d,setSpellCheckLanguage:u}=h(),{autoComplete:p,setAutoComplete:g,autoPairDelimiters:m,setAutoPairDelimiters:b,syntaxValidation:y,setSyntaxValidation:x,editorTheme:k,setEditorTheme:C,overallTheme:E,setOverallTheme:T,mode:j,setMode:I,fontSize:S,setFontSize:A,fontFamily:L,setFontFamily:O,lineHeight:R,setLineHeight:P,pdfViewer:M,setPdfViewer:F,mathPreview:D,setMathPreview:N}=f();!function(){const{socket:e}=(0,_.nK)(),[t,n]=(0,o.A)("project"),s=(0,r.useCallback)((e=>{t&&n({...t,compiler:e})}),[t,n]),i=(0,r.useCallback)((e=>{t&&n({...t,imageName:e})}),[t,n]),a=(0,r.useCallback)((e=>{t&&n({...t,spellCheckLanguage:e})}),[t,n]);(0,r.useEffect)((()=>{if(t&&e)return e.on("compilerUpdated",s),e.on("imageNameUpdated",i),e.on("spellCheckLanguageUpdated",a),()=>{e.removeListener("compilerUpdated",s),e.removeListener("imageNameUpdated",i),e.removeListener("spellCheckLanguageUpdated",a)}}),[e,t,s,i,a])}();const X=(0,r.useMemo)((()=>({compiler:n,setCompiler:s,imageName:i,setImageName:a,rootDocId:c,setRootDocId:l,spellCheckLanguage:d,setSpellCheckLanguage:u,autoComplete:p,setAutoComplete:g,autoPairDelimiters:m,setAutoPairDelimiters:b,syntaxValidation:y,setSyntaxValidation:x,editorTheme:k,setEditorTheme:C,overallTheme:E,setOverallTheme:T,mode:j,setMode:I,fontSize:S,setFontSize:A,fontFamily:L,setFontFamily:O,lineHeight:R,setLineHeight:P,pdfViewer:M,setPdfViewer:F,mathPreview:D,setMathPreview:N})),[n,s,i,a,c,l,d,u,p,g,m,b,y,x,k,C,E,T,j,I,S,A,L,O,R,P,M,F,D,N]);return(0,w.jsx)(v.Provider,{value:X,children:t})};function y(){const e=(0,r.useContext)(v);if(!e)throw new Error("useProjectSettingsContext is only available inside ProjectSettingsProvider");return e}},41479:(e,t,n)=>{"use strict";n.d(t,{i:()=>s,p:()=>o});var r=n(6896);function o(e,t){const n=(0,r.lE)(e,t);return n&&"doc"===n.type?n.entity:null}function s(e,t){const n=(0,r.lE)(e,t);return n&&"fileRef"===n.type?n.entity:null}},41546:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(64331);class s extends o{constructor(e,t){r.integer(e,"RestoreOrigin: bad version"),r.date(t,"RestoreOrigin: bad timestamp"),super(s.KIND),this.version=e,this.timestamp=t}static fromRaw(e){return new s(e.version,new Date(e.timestamp))}toRaw(){return{kind:s.KIND,version:this.version,timestamp:this.timestamp.toISOString()}}getVersion(){return this.version}getTimestamp(){return this.timestamp}}s.KIND="restore",e.exports=s},42991:(e,t,n)=>{n(97107),n(82438),n(2989);const{containsNonBmpChars:r}=n(2058),{ApplyError:o,InvalidInsertionError:s,UnprocessableError:i}=n(20593),a=n(93516),c=n(61210);class l{constructor(){if(this.constructor===l)throw new Error("Cannot instantiate abstract class")}applyToLength(e){throw new Error("abstract method")}toJSON(){throw new Error("abstract method")}static fromJSON(e){if(p(e))return d.fromJSON(e);if(g(e))return h.fromJSON(e);if(m(e))return u.fromJSON(e);throw new i(`Invalid ScanOp ${JSON.stringify(e)}`)}equals(e){return!1}canMergeWith(e){return!1}mergeWith(e){throw new Error("abstract method")}toString(){}}class h extends l{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(super(),"string"!=typeof e)throw new s("insertion must be a string");if(r(e))throw new s("insertion contains non-BMP characters");this.insertion=e,this.tracking=t,this.commentIds=n}static fromJSON(e){if("string"==typeof e)return new h(e);if("string"!=typeof e.i)throw new s("insert operation must have a string property");return new h(e.i,e.tracking&&c.fromRaw(e.tracking),e.commentIds)}applyToLength(e){return e.length+=this.insertion.length,e}equals(e){if(!(e instanceof h))return!1;if(this.insertion!==e.insertion)return!1;if(this.tracking){if(!this.tracking.equals(e.tracking))return!1}else if(e.tracking)return!1;return this.commentIds?this.commentIds.length===e.commentIds?.length&&this.commentIds.every((t=>e.commentIds?.includes(t))):!e.commentIds}canMergeWith(e){if(!(e instanceof h))return!1;if(this.tracking){if(!this.tracking.equals(e.tracking))return!1}else if(e.tracking)return!1;return this.commentIds?this.commentIds.length===e.commentIds?.length&&this.commentIds.every((t=>e.commentIds?.includes(t))):!e.commentIds}mergeWith(e){if(!this.canMergeWith(e))throw new Error("Cannot merge with incompatible operation");this.insertion+=e.insertion}toJSON(){if(!this.tracking&&!this.commentIds)return this.insertion;const e={i:this.insertion};return this.tracking&&(e.tracking=this.tracking.toRaw()),this.commentIds&&(e.commentIds=this.commentIds),e}toString(){return`insert '${this.insertion}'`}}class d extends l{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(super(),e<0)throw new Error("length must be non-negative");this.length=e,this.tracking=t}applyToLength(e){if(e.inputCursor+this.length>e.inputLength)throw new o("Operation can't retain more chars than are left in the string.",this.toJSON(),e.inputLength);return e.length+=this.length,e.inputCursor+=this.length,e}static fromJSON(e){if("number"==typeof e)return new d(e);if("number"!=typeof e.r)throw new Error("retain operation must have a number property");if(e.tracking){const t="none"===e.tracking.type?new a:c.fromRaw(e.tracking);return new d(e.r,t)}return new d(e.r)}equals(e){return e instanceof d&&(this.length===e.length&&(this.tracking?this.tracking.equals(e.tracking):!e.tracking))}canMergeWith(e){return e instanceof d&&(this.tracking?this.tracking.equals(e.tracking):!e.tracking)}mergeWith(e){if(!this.canMergeWith(e))throw new Error("Cannot merge with incompatible operation");this.length+=e.length}toJSON(){return this.tracking?{r:this.length,tracking:this.tracking.toRaw()}:this.length}toString(){return`retain ${this.length}`}}class u extends l{constructor(e){if(super(),e<0)throw new Error("length must be non-negative");this.length=e}applyToLength(e){return e.inputCursor+=this.length,e}static fromJSON(e){if("number"!=typeof e||e>0)throw new Error("delete operation must be a negative number");return new u(-e)}equals(e){return e instanceof u&&this.length===e.length}canMergeWith(e){return e instanceof u}mergeWith(e){if(!this.canMergeWith(e))throw new Error("Cannot merge with incompatible operation");this.length+=e.length}toJSON(){return-this.length}toString(){return`remove ${this.length}`}}function p(e){return"number"==typeof e&&e>0||"object"==typeof e&&"r"in e&&"number"==typeof e.r&&e.r>0}function g(e){return"string"==typeof e||"object"==typeof e&&"i"in e&&"string"==typeof e.i}function m(e){return"number"==typeof e&&e<0}e.exports={ScanOp:l,InsertOp:h,RetainOp:d,RemoveOp:u,isRetain:p,isInsert:g,isRemove:m}},43921:(e,t,n)=>{n(97107),n(82438),n(50020);const{RetainOp:r,InsertOp:o,RemoveOp:s}=n(42991),i=n(2085);class a{ranges=[];resolved=!1;constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.id=e,this.resolved=n,this.ranges=this.mergeRanges(t)}applyInsert(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!1;const o=[];for(const s of this.ranges)if(e===s.end)n?(o.push(s.extendBy(t)),r=!0):o.push(s);else if(e===s.start)n?(o.push(s.extendBy(t)),r=!0):o.push(s.moveBy(t));else if(s.startIsAfter(e))o.push(s.moveBy(t));else if(s.containsCursor(e))if(n)o.push(s.extendBy(t)),r=!0;else{const[n,,r]=s.insertAt(e,t);o.push(new i(s.pos,n.length)),o.push(r)}else o.push(s);return n&&!r&&o.push(new i(e,t)),new a(this.id,o,this.resolved)}applyDelete(e){const t=[];for(const n of this.ranges)n.overlaps(e)?t.push(n.subtract(e)):n.startsAfter(e)?t.push(n.moveBy(-e.length)):t.push(n);return new a(this.id,t,this.resolved)}applyTextOperation(e,t){let n=this,a=0;for(const c of e.ops)c instanceof r?a+=c.length:c instanceof o?(n=n.applyInsert(a,c.insertion.length,c.commentIds?.includes(t)),a+=c.insertion.length):c instanceof s&&(n=n.applyDelete(new i(a,c.length)));return n}isEmpty(){return 0===this.ranges.length}toRaw(){const e={id:this.id,ranges:this.ranges.map((e=>e.toRaw()))};return this.resolved&&(e.resolved=!0),e}mergeRanges(e){const t=[],n=[...e].sort(((e,t)=>e.start-t.start));for(const e of n){if(e.isEmpty())continue;const n=t[t.length-1];if(n?.overlaps(e))throw new Error("Ranges cannot overlap");if(e.isEmpty())throw new Error("Comment range cannot be empty");n?.canMerge(e)?t[t.length-1]=n.merge(e):t.push(e)}return t}static fromRaw(e){return new a(e.id,e.ranges.map((e=>i.fromRaw(e))),e.resolved)}}e.exports=a},44167:(e,t,n)=>{"use strict";n.d(t,{Xq:()=>P,Yu:()=>F,c9:()=>M});var r=n(56447),o=n(53373),s=n.n(o),i=n(14041),a=n(8164),c=n(97434),l=n(69954),h=n(59162),d=n(71627),u=n(96713),p=n(237),g=(n(61412),n(91883),n(70286),n(86316)),m=n(37858),f=n(69475),_=n(52155),w=n(37939),v=n(94234),b=n(37664),y=n(60440),x=n(91542),k=n(60961),C=n(89997),E=n(68543),T=n(89139),j=n(25133),I=n(14875);var S=n(31085);const A=(0,i.memo)((function(e){let{syncToCode:t,syncToCodeInFlight:n,isDetachLayout:r}=e;const{t:o}=(0,c.Bd)(),a=s()("synctex-control",{"detach-synctex-control":!!r});let g=null;n?g=(0,S.jsx)(p.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"}):r||(g=(0,S.jsx)(u.A,{type:"arrow_left_alt",className:"synctex-control-icon"}));const m=(0,i.useCallback)((()=>{l._("jump-to-location",{direction:"pdf-location-in-code",method:"arrow"}),t({visualOffset:72})}),[t]),f=(0,i.useMemo)((()=>({placement:r?"bottom":"right"})),[r]);return(0,S.jsx)(h.A,{id:"sync-to-code",description:o("go_to_pdf_location_in_code"),overlayProps:f,children:(0,S.jsxs)(d.A,{variant:"secondary",size:"sm",onClick:m,disabled:n,className:a,"aria-label":o("go_to_pdf_location_in_code"),children:[g,r?(0,S.jsxs)("span",{children:[" ",o("show_in_code")]}):""]})})})),L=(0,i.memo)((function(e){let{syncToPdf:t,syncToPdfInFlight:n,isDetachLayout:r,canSyncToPdf:o}=e;const{t:i}=(0,c.Bd)(),a=r?"bottom":"right",l=s()("synctex-control",{"detach-synctex-control":!!r});let g=null;return n?g=(0,S.jsx)(p.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"}):r||(g=(0,S.jsx)(u.A,{type:"arrow_right_alt",className:"synctex-control-icon"})),(0,S.jsx)(h.A,{id:"sync-to-pdf",description:i("go_to_code_location_in_pdf"),overlayProps:{placement:a},children:(0,S.jsxs)(d.A,{variant:"secondary",size:"sm",onClick:t,disabled:n||!o,className:l,"aria-label":i("go_to_code_location_in_pdf"),children:[g,r?(0,S.jsxs)("span",{children:[" ",i("show_in_pdf")]}):""]})})}));function O(){const{detachRole:e}=(0,r.LV)(),{pdfUrl:t,pdfViewer:n,position:o}=(0,a.Rf)(),{syncToCode:s,syncToPdf:c,syncToCodeInFlight:h,syncToPdfInFlight:d,canSyncToPdf:u}=function(){const{_id:e,rootDocId:t}=(0,g.O)(),{clsiServerId:n,pdfFile:r,position:o,setShowLogs:s,setHighlights:c}=(0,a.Rf)(),{selectedEntities:h}=(0,y.Q)(),{findEntityByPath:d,dirname:u,pathInFolder:p}=(0,C.m8)(),{getCurrentDocumentId:S,openDocWithId:A,openDocName:L}=(0,E.TS)(),[O,R]=(0,i.useState)((()=>{const e=b.A.getItem(`doc.position.${S()}`);return e?e.cursorPosition:null})),P=(0,f.A)(),{signal:M}=(0,_.A)();(0,T.A)("cursor:editor:update",(0,i.useCallback)((e=>R(e.detail)),[]));const[F,D]=(0,i.useState)(!1),[N,X]=(0,w.A)("sync-to-code-inflight",!1,"detacher","detached"),$=(0,i.useCallback)((()=>{const e=S();if(!e||!t)return null;let n=p(e);if(!n)return null;const r=u(t);return r&&(n=n.replace(RegExp(`^${r}`),`${r}/.`)),n}),[u,S,p,t]),U=(0,i.useCallback)(((e,t)=>{if(e){const n=d(e)?.entity;if(n)return void A(n._id,{gotoLine:t})}(0,I.showFileErrorToast)()}),[d,A]),V=(0,i.useCallback)((t=>{D(!0),n&&(t+=`&clsiserverid=${n}`),r?.editorId&&(t+=`&editorId=${r.editorId}`),r?.build&&(t+=`&buildId=${r.build}`),(0,m.hm)(`/project/${e}/sync/code?${t}`,{signal:M}).then((t=>{s(!1),c(t.pdf),t.downloadedFromCache&&(0,l._)("synctex-downloaded-from-cache",{projectId:e,method:"code"})})).catch(k.$.error).finally((()=>{P.current&&D(!1)}))}),[r,n,P,e,s,c,D,M]),B=(0,i.useRef)(O);(0,i.useEffect)((()=>{B.current=O}),[O]);const H=(0,i.useCallback)((()=>{const e=$();if(B.current){const{row:t,column:n}=B.current,r=new URLSearchParams({file:e??"",line:String(t+1),column:String(n)}).toString();l._("jump-to-location",{direction:"code-location-in-pdf",method:"arrow"}),V(r)}}),[$,V]);(0,x.A)("cursor:editor:syncToPdf",(0,i.useCallback)((()=>{H()}),[H]));const W=(0,i.useRef)(o);(0,i.useEffect)((()=>{W.current=o}),[o]);const z=(0,i.useCallback)((t=>{let{position:o=W.current,visualOffset:s=0}=t;if(!o)return;X(!0);const i=o.offset.left;let a=0;o.pageSize?.height?a+=o.pageSize.height-o.offset.top:a+=o.offset.top,a+=s;const c=new URLSearchParams({page:o.page+1,h:i.toFixed(2),v:a.toFixed(2)});n&&c.set("clsiserverid",n),r?.editorId&&c.set("editorId",r.editorId),r?.build&&c.set("buildId",r.build),(0,m.hm)(`/project/${e}/sync/pdf?${c}`,{signal:M}).then((t=>{const[{file:n,line:r}]=t.code;U(n,r),t.downloadedFromCache&&(0,l._)("synctex-downloaded-from-cache",{projectId:e,method:"pdf"})})).catch(k.$.error).finally((()=>{P.current&&X(!1)}))}),[r,n,e,M,P,X,U]),J=(0,v.A)("sync-to-code",z,"detached","detacher");(0,T.A)("synctex:sync-to-position",(0,i.useCallback)((e=>J({position:e.detail})),[J]));const[q,K]=(0,w.A)("has-single-selected-doc",!1,"detacher","detached");(0,i.useEffect)((()=>{1===h.length&&"doc"===h[0].type?K(!0):K(!1)}),[h,K]);const G=q&&O&&L&&(0,j.K)(L);return{syncToCode:J,syncToPdf:H,syncToPdfInFlight:F,syncToCodeInFlight:N,canSyncToPdf:G}}();return o&&t&&"native"!==n?"detacher"===e?(0,S.jsx)(L,{syncToPdf:c,syncToPdfInFlight:d,isDetachLayout:!0,canSyncToPdf:u}):"detached"===e?(0,S.jsx)(A,{syncToCode:s,syncToCodeInFlight:h,isDetachLayout:!0}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(L,{syncToPdf:c,syncToPdfInFlight:d,canSyncToPdf:u}),(0,S.jsx)(A,{syncToCode:s,syncToCodeInFlight:h})]}):null}const R=(0,i.memo)(O);function P(){const{detachRole:e}=(0,r.LV)();return e?null:(0,S.jsx)(R,{})}function M(){const{detachRole:e,detachIsLinked:t}=(0,r.LV)();return"detacher"===e&&t?(0,S.jsx)(R,{}):null}function F(){const{detachRole:e,detachIsLinked:t}=(0,r.LV)();return"detached"===e&&t?(0,S.jsx)(R,{}):null}},44199:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});n(82438),n(12266),n(57327);class r{constructor(){this.events={}}on(e,t){let n;this.events||(this.events={}),[e,n]=Array.from(e.split(".")),this.events[e]||(this.events[e]=[]),this.events[e].push({callback:t,namespace:n})}off(e,t){if(this.events||(this.events={}),e){let n;[e,n]=e.split("."),this.events[e]||(this.events[e]=[]),t?this.events[e]=this.events[e].filter((e=>e.callback!==t)):n?this.events[e]=this.events[e].filter((e=>e.namespace!==n)):delete this.events[e]}else this.events={}}trigger(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.events||(this.events={}),this.events[e]&&this.events[e].forEach((e=>e.callback(...n)))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.trigger(e,...n)}}},44285:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(12628);class s extends o{constructor(e){super(),r.integer(e,"HollowStringFileData: bad stringLength"),r.greaterOrEqual(e,0,"HollowStringFileData: low stringLength"),this.stringLength=e}static fromRaw(e){return new s(e.stringLength)}toRaw(){return{stringLength:this.stringLength}}getStringLength(){return this.stringLength}isEditable(){return!0}async toHollow(){return this}edit(e){this.stringLength=e.applyToLength(this.stringLength)}}e.exports=s},44838:(e,t,n)=>{"use strict";var r;function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(97107),n(82438),n(50020);const s=n(64347).assert,i=n(37603),a=n(62293),c=n(65591);class EditMissingFileError extends i{}class l{static fromRaw(e){return s.object(e.files,"bad raw.files"),new l(a.fromRaw(e.files),e.projectVersion,c.fromRaw(e.v2DocVersions))}toRaw(){const e={files:this.fileMap.toRaw()};return this.projectVersion&&(e.projectVersion=this.projectVersion),this.v2DocVersions&&(e.v2DocVersions=this.v2DocVersions.toRaw()),e}constructor(e,t,n){s.maybe.instance(e,a,"bad fileMap"),this.fileMap=e||new a({}),this.projectVersion=t,this.v2DocVersions=n}getProjectVersion(){return this.projectVersion}setProjectVersion(e){s.maybe.match(e,l.PROJECT_VERSION_RX,"Snapshot: bad projectVersion"),this.projectVersion=e}getV2DocVersions(){return this.v2DocVersions}setV2DocVersions(e){s.maybe.instance(e,c,"Snapshot: bad v2DocVersions"),this.v2DocVersions=e}updateV2DocVersions(e){e.applyTo(this)}getFileMap(){return this.fileMap}getFilePathnames(){return this.fileMap.getPathnames()}getFile(e){return this.fileMap.getFile(e)}addFile(e,t){this.fileMap.addFile(e,t)}moveFile(e,t){this.fileMap.moveFile(e,t),this.v2DocVersions&&this.v2DocVersions.moveFile(e,t)}countFiles(){return this.fileMap.countFiles()}editFile(e,t){const n=this.fileMap.getFile(e);if(!n)throw new l.EditMissingFileError(`can't find file for editing: ${e}`);n.edit(t)}applyAll(e,t){for(const n of e)n.applyTo(this,t)}findBlobHashes(e){this.fileMap.map((function(t){const n=t.getHash(),r=t.getRangesHash();n&&e.add(n),r&&e.add(r)}))}async loadFiles(e,t){return await this.fileMap.mapAsync((function(n){return n.load(e,t)}),50)}async store(e,t){s.maybe.number(t,"bad concurrency");const n=this.projectVersion,r=this.v2DocVersions?this.v2DocVersions.toRaw():void 0;return{files:await this.fileMap.mapAsync((function(t){return t.store(e)}),t),projectVersion:n,v2DocVersions:r}}clone(){return l.fromRaw(this.toRaw())}}r=l,o(l,"PROJECT_VERSION_RX_STRING","^[0-9]+\\.[0-9]+$"),o(r,"PROJECT_VERSION_RX",new RegExp(r.PROJECT_VERSION_RX_STRING)),o(r,"EditMissingFileError",EditMissingFileError),e.exports=l},45317:(e,t,n)=>{"use strict";n(97107),n(82438),n(50020),n(74786),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539);const r=n(2058).containsNonBmpChars,o=n(91810),{RetainOp:s,InsertOp:i,RemoveOp:a,isRetain:c,isInsert:l,isRemove:h}=n(42991),{UnprocessableError:d,ApplyError:u,InvalidInsertionError:p,TooLongError:g}=n(20593),m=n(2085),f=n(93516),_=n(61210);class w extends o{static MAX_STRING_LENGTH=(()=>2*Math.pow(1024,2))();static UnprocessableError=(()=>d)();static ApplyError=(()=>u)();static InvalidInsertionError=(()=>p)();static TooLongError=(()=>g)();constructor(){super(),this.ops=[],this.baseLength=0,this.targetLength=0,this.contentHash=null}equals(e){if(this.baseLength!==e.baseLength)return!1;if(this.targetLength!==e.targetLength)return!1;if(this.ops.length!==e.ops.length)return!1;for(let t=0;t<this.ops.length;t++)if(!this.ops[t].equals(e.ops[t]))return!1;return!0}retain(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===e)return this;if(!c(e))throw new Error("retain expects an integer or a retain object");const n=s.fromJSON(e);if(n.tracking=t.tracking,0===n.length)return this;this.baseLength+=n.length,this.targetLength+=n.length;const r=this.ops[this.ops.length-1];return r?.canMergeWith(n)?r.mergeWith(n):this.ops.push(n),this}insert(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!l(e))throw new Error("insert expects a string or an insert object");const n=i.fromJSON(e);if(n.tracking=t.tracking,n.commentIds=t.commentIds,""===n.insertion)return this;this.targetLength+=n.insertion.length;const r=this.ops,o=this.ops[this.ops.length-1];if(o?.canMergeWith(n))o.mergeWith(n);else if(o instanceof a){const e=r[r.length-2];e?.canMergeWith(n)?e.mergeWith(n):(r[r.length]=r[r.length-1],r[r.length-2]=n)}else r.push(n);return this}remove(e){if("string"==typeof e&&(e=e.length),"number"!=typeof e)throw new Error("remove expects an integer or a string");if(0===e)return this;e>0&&(e=-e);const t=a.fromJSON(e);this.baseLength-=e;const n=this.ops[this.ops.length-1];return n?.canMergeWith(t)?n.mergeWith(t):this.ops.push(t),this}isNoop(){return 0===this.ops.length||1===this.ops.length&&this.ops[0]instanceof s}toString(){return this.ops.map((e=>e.toString())).join(", ")}toJSON(){const e={textOperation:this.ops.map((e=>e.toJSON()))};return null!=this.contentHash&&(e.contentHash=this.contentHash),e}static fromJSON=function(e){let{textOperation:t,contentHash:n}=e;const r=new w;for(const e of t)if(c(e)){const t=s.fromJSON(e);r.retain(t.length,{tracking:t.tracking})}else if(l(e)){const t=i.fromJSON(e);r.insert(t.insertion,{commentIds:t.commentIds,tracking:t.tracking})}else{if(!h(e))throw new d("unknown operation: "+JSON.stringify(e));{const t=a.fromJSON(e);r.remove(-t.length)}}return null!=n&&(r.contentHash=n),r};apply(e){const t=e.getContent(),n=this;if(r(t))throw new w.ApplyError("The string contains non BMP characters.",n,t);if(t.length!==n.baseLength)throw new w.ApplyError("The operation's base length must be equal to the string's length.",n,t);const o=this.ops;let c=0,l="";for(const n of o)if(n instanceof s){if(c+n.length>t.length)throw new u("Operation can't retain more chars than are left in the string.",n.toJSON(),t);e.trackedChanges.applyRetain(l.length,n.length,{tracking:n.tracking}),l+=t.slice(c,c+n.length),c+=n.length}else if(n instanceof i){if(r(n.insertion))throw new p(t,n.toJSON());e.trackedChanges.applyInsert(l.length,n.insertion,{tracking:n.tracking}),e.comments.applyInsert(new m(l.length,n.insertion.length),{commentIds:n.commentIds}),l+=n.insertion}else{if(!(n instanceof a))throw new d("Unknown ScanOp type during apply");e.trackedChanges.applyDelete(l.length,n.length),e.comments.applyDelete(new m(l.length,n.length)),c+=n.length}if(c!==t.length)throw new w.ApplyError("The operation didn't operate on the whole string.",n,t);if(l.length>w.MAX_STRING_LENGTH)throw new w.TooLongError(n,l.length);e.content=l}applyToLength(e){const t=this;if(e!==t.baseLength)throw new w.ApplyError("The operation's base length must be equal to the string's length.",t,e);const{length:n,inputCursor:r}=this.ops.reduce(((e,t)=>t.applyToLength(e)),{length:0,inputCursor:0,inputLength:e});if(r!==e)throw new w.ApplyError("The operation didn't operate on the whole string.",t,e);if(n>w.MAX_STRING_LENGTH)throw new w.TooLongError(t,n);return n}invert(e){const t=e.getContent();let n=0;const r=new w,o=this.ops;for(let c=0,l=o.length;c<l;c++){const l=o[c];if(l instanceof s){const t=n+l.length,o=e.trackedChanges.inRange(new m(n,l.length));let s;l.tracking&&(s=new f);for(const e of o)if(n<e.range.start&&(r.retain(e.range.start-n,{tracking:s}),n=e.range.start),e.range.end<n+l.length&&(r.retain(e.range.length,{tracking:e.tracking}),n=e.range.end),e.range.end!==n){const[t]=e.range.splitAt(n);r.retain(t.length,{tracking:e.tracking}),n=t.end}n<t&&(r.retain(t-n,{tracking:s}),n=t)}else if(l instanceof i)r.remove(l.insertion.length);else{if(!(l instanceof a))throw new d("unknown scanop during inversion");{const o=y(n,l.length,e.comments,e.trackedChanges);for(const e of o)r.insert(t.slice(n,n+e.length),{tracking:e.tracking,commentIds:e.commentIds}),n+=e.length}}}return r}canBeComposedWithForUndo(e){if(!(e instanceof w))return!1;if(this.isNoop()||e.isNoop())return!0;const t=b(this),n=b(e),r=v(this),o=v(e);return!(!r||!o)&&(r instanceof i&&o instanceof i?t+r.insertion.length===n:r instanceof a&&o instanceof a&&(n+o.length===t||t===n))}canBeComposedWith(e){return e instanceof w&&this.targetLength===e.baseLength}compose(e){if(!(e instanceof w))throw new Error(`Trying to compose TextOperation with ${e?.constructor?.name}.`);if(this.targetLength!==e.baseLength)throw new Error("The base length of the second operation has to be the target length of the first operation");const t=new w,n=this.ops,r=e.ops;let o=0,c=0,l=n[o++],h=r[c++];for(;void 0!==l||void 0!==h;)if(l instanceof a)t.remove(-l.length),l=n[o++];else if(h instanceof i)t.insert(h.insertion,{tracking:h.tracking,commentIds:h.commentIds}),h=r[c++];else{if(void 0===l)throw new Error("Cannot compose operations: first operation is too short.");if(void 0===h)throw new Error("Cannot compose operations: first operation is too long.");if(l instanceof s&&h instanceof s){const e=h.tracking??l.tracking;l.length>h.length?(t.retain(h.length,{tracking:e}),l=new s(l.length-h.length,l.tracking),h=r[c++]):l.length===h.length?(t.retain(l.length,{tracking:e}),l=n[o++],h=r[c++]):(t.retain(l.length,{tracking:e}),h=new s(h.length-l.length,h.tracking),l=n[o++])}else if(l instanceof i&&h instanceof a)l.insertion.length>h.length?(l=new i(l.insertion.slice(h.length),l.tracking,l.commentIds),h=r[c++]):l.insertion.length===h.length?(l=n[o++],h=r[c++]):(h=a.fromJSON(l.insertion.length-h.length),l=n[o++]);else if(l instanceof i&&h instanceof s){const e={commentIds:l.commentIds};h.tracking instanceof _?e.tracking=h.tracking:h.tracking instanceof f||(e.tracking=l.tracking),l.insertion.length>h.length?(t.insert(l.insertion.slice(0,h.length),e),l=new i(l.insertion.slice(h.length),l.tracking,l.commentIds),h=r[c++]):l.insertion.length===h.length?(t.insert(l.insertion,e),l=n[o++],h=r[c++]):(t.insert(l.insertion,e),h=new s(h.length-l.insertion.length,h.tracking),l=n[o++])}else{if(!(l instanceof s&&h instanceof a))throw new Error("This shouldn't happen: op1: "+JSON.stringify(l)+", op2: "+JSON.stringify(h));l.length>h.length?(t.remove(-h.length),l=new s(l.length-h.length,l.tracking),h=r[c++]):l.length===h.length?(t.remove(-h.length),l=n[o++],h=r[c++]):(t.remove(l.length),h=a.fromJSON(l.length-h.length),l=n[o++])}}return t}static transform(e,t){if(e.baseLength!==t.baseLength)throw new Error("Both operations have to have the same base length");const n=new w,r=new w,o=e.ops,c=t.ops;let l=0,h=0,d=o[l++],u=c[h++];for(;void 0!==d||void 0!==u;){if(d instanceof i){n.insert(d.insertion,{tracking:d.tracking,commentIds:d.commentIds}),r.retain(d.insertion.length),d=o[l++];continue}if(u instanceof i){n.retain(u.insertion.length),r.insert(u.insertion,{tracking:u.tracking,commentIds:u.commentIds}),u=c[h++];continue}if(void 0===d)throw new Error("Cannot compose operations: first operation is too short.");if(void 0===u)throw new Error("Cannot compose operations: first operation is too long.");let e;if(d instanceof s&&u instanceof s){let t,i;d.tracking?t=d.tracking:i=u.tracking,d.length>u.length?(e=u.length,d=new s(d.length-u.length,d.tracking),u=c[h++]):d.length===u.length?(e=u.length,d=o[l++],u=c[h++]):(e=d.length,u=new s(u.length-d.length,u.tracking),d=o[l++]),n.retain(e,{tracking:t}),r.retain(e,{tracking:i})}else if(d instanceof a&&u instanceof a)d.length>u.length?(d=a.fromJSON(u.length-d.length),u=c[h++]):d.length===u.length?(d=o[l++],u=c[h++]):(u=a.fromJSON(d.length-u.length),d=o[l++]);else if(d instanceof a&&u instanceof s)d.length>u.length?(e=u.length,d=a.fromJSON(u.length-d.length),u=c[h++]):d.length===u.length?(e=u.length,d=o[l++],u=c[h++]):(e=d.length,u=new s(u.length-d.length,u.tracking),d=o[l++]),n.remove(e);else{if(!(d instanceof s&&u instanceof a))throw new Error("The two operations aren't compatible");d.length>u.length?(e=u.length,d=new s(d.length-u.length,d.tracking),u=c[h++]):d.length===u.length?(e=d.length,d=o[l++],u=c[h++]):(e=d.length,u=a.fromJSON(d.length-u.length),d=o[l++]),r.remove(e)}}return[n,r]}}function v(e){const t=e.ops;switch(t.length){case 1:return t[0];case 2:return t[0]instanceof s?t[1]:t[1]instanceof s?t[0]:null;case 3:if(t[0]instanceof s&&t[2]instanceof s)return t[1]}return null}function b(e){return e.ops[0]instanceof s?e.ops[0].length:0}function y(e,t,n,r){const o=new Set,s=e,i=e+t;function a(e){e<s||e>i||o.add(e)}for(const e of n.comments.values())for(const t of e.ranges)a(t.end),a(t.start);for(const e of r.asSorted())a(e.range.start),a(e.range.end);a(s),a(i);const c=Array.from(o).sort(((e,t)=>e-t)),l=[];for(let e=1;e<c.length;e++){const t=c[e-1],o=c[e],s=new m(t,o-t),i=n.idsCoveringRange(s),a=r.propsAtRange(s);l.push({length:s.length,commentIds:i.length>0?i:void 0,tracking:a})}return l}e.exports=w},45330:(e,t,n)=>{"use strict";n.d(t,{j:()=>i});var r=n(29295),o=n(22046),s=n(31085);const i=e=>{let{children:t,modal:n}=e;return(0,s.jsxs)("div",{className:"error-boundary-alert",children:[(0,s.jsx)(o.A,{type:"error",content:t||(0,s.jsx)(r.f,{})}),n]})}},45461:(e,t,n)=>{n(97107),n(82438),n(50020);const r=n(58756),o=n(43921),s=n(2085),i=n(91810);class a extends i{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super();for(const e of t)if(e.isEmpty())throw new Error("AddCommentOperation can't be built with empty ranges");this.commentId=e,this.ranges=t,this.resolved=n}toJSON(){const e={commentId:this.commentId,ranges:this.ranges.map((e=>e.toRaw()))};return this.resolved&&(e.resolved=!0),e}apply(e){e.comments.add(new o(this.commentId,this.ranges,this.resolved))}invert(e){const t=e.comments.getComment(this.commentId);return t?new r.AddCommentOperation(t.id,t.ranges.slice(),t.resolved):new r.DeleteCommentOperation(this.commentId)}canBeComposedWith(e){return e instanceof a&&this.commentId===e.commentId||e instanceof r.DeleteCommentOperation&&this.commentId===e.commentId||e instanceof r.SetCommentStateOperation&&this.commentId===e.commentId}compose(e){if(e instanceof r.DeleteCommentOperation&&e.commentId===this.commentId)return e;if(e instanceof a&&e.commentId===this.commentId)return e;if(e instanceof r.SetCommentStateOperation&&e.commentId===this.commentId)return new a(this.commentId,this.ranges,e.resolved);throw new Error(`Trying to compose AddCommentOperation with ${e?.constructor?.name}.`)}static fromJSON(e){return new a(e.commentId,e.ranges.map(s.fromRaw),e.resolved??!1)}}e.exports=a},49008:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(64331);class s extends o{constructor(e,t){r.integer(e,"RestoreProjectOrigin: bad version"),r.date(t,"RestoreProjectOrigin: bad timestamp"),super(s.KIND),this.version=e,this.timestamp=t}static fromRaw(e){return new s(e.version,new Date(e.timestamp))}toRaw(){return{kind:s.KIND,version:this.version,timestamp:this.timestamp.toISOString()}}getVersion(){return this.version}getTimestamp(){return this.timestamp}}s.KIND="project-restore",e.exports=s},49438:(e,t,n)=>{"use strict";n.d(t,{I:()=>r});const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;return(e=e.replace(/^\.\//,"")).length>t+3&&(e="…"+e.substring(e.length-t).trim()),e}},49791:(e,t,n)=>{"use strict";n.d(t,{M:()=>o});var r=n(14041);const o=()=>{const e=(0,r.useRef)(null);return null===e.current&&"BroadcastChannel"in window&&(e.current=new BroadcastChannel("user")),(0,r.useEffect)((()=>()=>e.current?.close?.()),[]),e.current}},50614:(e,t,n)=>{n(97107);const r=n(98695),o=n(45461),s=n(45317),i=n(85544),a=n(90482);function c(e){return null!==e&&"object"==typeof e&&"textOperation"in e}function l(e){return null!==e&&"object"==typeof e&&"commentId"in e&&"ranges"in e&&Array.isArray(e.ranges)}function h(e){return null!==e&&"object"==typeof e&&"deleteComment"in e}function d(e){return null!==e&&"object"==typeof e&&"commentId"in e&&"resolved"in e&&"boolean"==typeof e.resolved}function u(e){return null!==e&&"object"==typeof e&&"noOp"in e}e.exports=class{static fromJSON(e){if(c(e))return s.fromJSON(e);if(l(e))return o.fromJSON(e);if(h(e))return r.fromJSON(e);if(d(e))return i.fromJSON(e);if(u(e))return a.fromJSON();throw new Error("Unsupported operation in EditOperationBuilder.fromJSON")}static isValid(e){return c(e)||l(e)||h(e)||d(e)||u(e)}}},51275:(e,t,n)=>{"use strict";n.d(t,{$3:()=>c,I_:()=>d,Tv:()=>h});var r=n(33829),o=n(69954),s=n(33478),i=n(60961);const a=9,c=(0,r.A)(),l={viewerId:c};function h(){return l}function d(e,t,n){const{timings:r,pdfCachingMinChunkSize:l}=e,h={compileTimeClientE2E:t,compileTimeServerE2E:r?.compileE2E};let d=!0;return{deliveryLatencies:h,firstRenderDone:function(e){let{latencyFetch:t,latencyRender:r,pdfCachingMetrics:u}=e;d&&(d=!1,h.totalDeliveryTime=Math.ceil(performance.now()-n),h.latencyFetch=t,r&&(h.latencyRender=r),s.Hs&&function(e){const t={version:a,...e,id:c};i.$.log("/event/compile-metrics",JSON.stringify(t)),(0,o._)("compile-metrics-v6",t)}({pdfCachingMinChunkSize:l,...h,...u}))}}}},52036:(e,t,n)=>{"use strict";n.d(t,{E1:()=>f,VH:()=>m});n(97107);var r=n(14041),o=n(13271),s=n(16896),i=n(45250),a=n(60440),c=n(41479),l=n(6599),h=n(60961),d=n(14020),u=n(68543),p=n(31085);const g=(0,r.createContext)(void 0),m=e=>{let{children:t}=e;const{eventEmitter:n}=(0,o.yn)(),{socket:m}=(0,s.FX)(),{currentDocumentId:f}=(0,u.TS)(),{fileTreeData:_}=(0,a.Q)(),[w,v]=(0,r.useState)({}),[b,y]=(0,r.useState)({}),[x,k]=(0,r.useState)([]),[C,E]=(0,r.useState)(0),[T,j]=(0,r.useState)(null),[I,S]=(0,r.useState)(500),A=(0,r.useCallback)((e=>{const t={},n=[],r={};for(const[o,s]of Object.entries(e)){const e={...s},i=s.doc_id;i&&(e.doc=(0,c.p)(_,i)),null!==s.name&&0!==s.name.trim().length||(e.name=s.email?s.email.trim():"Anonymous"),e.initial=s.name?.[0],e.initial&&" "!==e.initial||(e.initial="?"),n.push(e),t[o]=e,null!=i&&null!=s.row&&null!=s.column&&(r[i]||(r[i]=[]),r[i].push({label:s.name,cursor:{row:s.row,column:s.column},hue:(0,d.Om)(s.user_id)}))}return{onlineUsers:t,onlineUsersArray:n,onlineUserCursorHighlights:r,cursorUpdateInterval:n.length>0?500:3e5}}),[_]),L=(0,r.useCallback)((e=>{const t=A(e);v(t.onlineUsers),k(t.onlineUsersArray),E(t.onlineUsersArray.length),y(t.onlineUserCursorHighlights),S(t.cursorUpdateInterval)}),[A,y,v,k,E]);(0,r.useEffect)((()=>{const e=()=>{m.emit("clientTracking.getConnectedUsers",((e,t)=>{if(e)return void h.$.error(e);const n={};for(const e of t)e.client_id!==m.publicId&&(n[e.client_id]={id:e.client_id,user_id:e.user_id,email:e.email,name:`${e.first_name} ${e.last_name}`,doc_id:e.cursorData?.doc_id,row:e.cursorData?.row,column:e.cursorData?.column});L(n)}))};return n.on("project:joined",e),()=>{n.off("project:joined",e)}}),[n,L,v,m]),(0,r.useEffect)((()=>{const e=e=>{let{detail:[t]}=e;t&&j(t)};return n.on("cursor:editor:update",e),()=>{n.off("cursor:editor:update",e)}}),[I,n]),(0,r.useEffect)((()=>{const e=window.setTimeout((()=>{m.emit("clientTracking.updatePosition",{row:T?.row,column:T?.column,doc_id:f})}),I);return()=>{window.clearTimeout(e)}}),[T,I,f,m]);const O=(0,r.useCallback)((e=>{e.id!==m.publicId&&L({...w,[e.id]:e})}),[w,L,m.publicId]);(0,l.A)(m,"clientTracking.clientUpdated",O);const R=(0,r.useCallback)((e=>{L((0,i.omit)(w,e))}),[w,L]);(0,l.A)(m,"clientTracking.clientDisconnected",R);const P=(0,r.useMemo)((()=>({onlineUsers:w,onlineUsersArray:x,onlineUserCursorHighlights:b,onlineUsersCount:C})),[w,x,b,C]);return(0,p.jsx)(g.Provider,{value:P,children:t})};function f(){const e=(0,r.useContext)(g);if(!e)throw new Error("useOnlineUsersContext is only available inside OnlineUsersProvider");return e}},54830:(e,t,n)=>{"use strict";n.d(t,{X:()=>g,i:()=>p});n(97107);var r=n(14041),o=n(37766),s=n(89139),i=n(69954),a=n(25133),c=n(37664),l=n(86316),h=n(68543),d=n(31085);const u=(0,r.createContext)(void 0),p=e=>{let{children:t}=e;const[n,p]=(0,r.useState)(void 0),[g,f]=(0,r.useState)(-1),[_,w]=(0,r.useState)(!1),[v,b]=(0,r.useState)(!1),[y,x]=(0,r.useState)(!1),k=(0,o.A)("editor:gotoLine",!0);(0,s.A)("file-view:file-opened",(0,r.useCallback)((()=>{w(!0)}),[])),(0,s.A)("scroll:editor:update",(0,r.useCallback)((e=>{y?x(!1):f(e.detail+1)}),[y])),(0,s.A)("cursor:editor:update",(0,r.useCallback)((e=>{v?b(!1):f(e.detail.row+1)}),[v])),(0,s.A)("doc:after-opened",(0,r.useCallback)((e=>{e.detail.isNewDoc&&b(!0),w(!1),x(!0)}),[]));const C=(0,r.useCallback)(((e,t)=>{x(!0),k({gotoLine:e,gotoColumn:0,syncToPdf:t}),i._("outline-jump-to-line")}),[k]),E=(0,r.useMemo)((()=>m(n?.items,g)),[n,g]),{openDocName:T}=(0,h.TS)(),j=(0,r.useMemo)((()=>!!T&&(0,a.K)(T)),[T]),{_id:I}=(0,l.O)(),S=`file_outline.expanded.${I}`,[A,L]=(0,r.useState)((()=>!1!==c.A.getItem(S))),O=j&&!_,R=(0,r.useCallback)((()=>{O&&(c.A.setItem(S,!A),i._(A?"outline-collapse":"outline-expand"),L(!A))}),[O,A,S]),P=(0,r.useMemo)((()=>({flatOutline:n,setFlatOutline:p,highlightedLine:E,jumpToLine:C,canShowOutline:O,outlineExpanded:A,toggleOutlineExpanded:R})),[n,E,C,O,A,R]);return(0,d.jsx)(u.Provider,{value:P,children:t})},g=()=>{const e=(0,r.useContext)(u);if(!e)throw new Error("useOutlineProvider is only available inside OutlineProvider");return e},m=(e,t)=>{if(!e)return-1;let n=-1;for(const r of e){if(r.line>t)return n;n=r.line}return n}},56447:(e,t,n)=>{"use strict";n.d(t,{UY:()=>x,LV:()=>k});n(97107);var r=n(14041),o=n(14936),s=n(93588),i=n(64932),a=n(69139),c=n(69954),l=n(28699),h=n(60961);const d=(0,i.A)("ol-debugPdfDetach");var u=n(37664),p=n(37766),g=n(89139),m=n(58528),f=n(94857),_=n(22440),w=n(70569),v=n(31085);const b=(0,i.A)("ol-debugPdfDetach"),y=(0,r.createContext)(void 0);const x=e=>{let{children:t}=e;const[n,i]=(0,o.A)("ui.view"),[x]=(0,o.A)("openFile"),k=(0,p.A)("history:toggle",!0),{isOpen:C,setIsOpen:E}=(0,w.h)(),[T,j]=(0,r.useState)(C),I=(0,r.useCallback)((e=>{i((t=>("history"!==e&&"history"!==t||k(),"history"===e&&(j(C),E(!0)),"history"===t&&E(T),"editor"===e&&x?"file":e)))}),[i,E,x,k,T,j,C]),[S,A]=(0,o.A)("ui.chatOpen"),[L,O]=(0,o.A)("ui.reviewPanelOpen"),[R,P]=(0,o.A)("ui.miniReviewPanelVisible"),[M,F]=(0,o.A)("ui.leftMenuShown"),[D,N]=(0,r.useState)(!1);(0,g.A)("ui.toggle-left-menu",(0,r.useCallback)((e=>{F(e.detail)}),[F])),(0,g.A)("ui.toggle-review-panel",(0,r.useCallback)((()=>{O((e=>!e))}),[O])),(0,g.A)("keydown",(0,r.useCallback)((e=>{(f.c?e.metaKey:e.ctrlKey)&&e.shiftKey&&"KeyF"===e.code&&(0,m.g9)("full-project-search")&&(e.preventDefault(),(0,_.T)("search-open",{searchType:"full-project",method:"keyboard"}),N(!0))}),[]));const[X,$]=(0,o.A)("ui.pdfLayout"),[U,V]=(0,r.useState)(!1),B=(0,r.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"editor";$(e),I("sideBySide"===e?"editor":t),function(e){u.A.setItem("pdf.layout","sideBySide"===e?"split":"flat")}(e)}),[$,I]),{reattach:H,detach:W,isLinking:z,isLinked:J,role:q,isRedundant:K}=function(){const{role:e,setRole:t,broadcastEvent:n,addEventHandler:o,deleteEventHandler:i}=(0,s.Q2)(),[u,p]=(0,r.useState)(!1),[g,m]=(0,r.useState)(!1),[f,_]=(0,r.useState)(!1),w=(0,r.useRef)();(0,r.useEffect)((()=>{d&&h.$.warn("Effect",{isLinked:g}),p(!1)}),[g,p]),(0,r.useEffect)((()=>{d&&h.$.warn("Effect",{role:e,isLinked:g}),"detached"===e&&g&&c._("project-layout-detached")}),[e,g]),(0,r.useEffect)((()=>{w.current&&clearTimeout(w.current),"detacher"===e&&!1===g&&(w.current=setTimeout((()=>{t(null)}),u?6e4:1e4))}),[e,u,g,t]),(0,r.useEffect)((()=>{d&&h.$.warn("Effect",{isLinking:u})}),[u]);const v=(0,l.A)(e);(0,r.useEffect)((()=>{v&&!e&&c._("project-layout-reattached")}),[v,e]);const b=(0,r.useCallback)((()=>{n("reattach"),t(null),m(!1)}),[t,m,n]),y=(0,r.useCallback)((()=>{_(!1),t("detacher"),p(!0),window.open((0,a.Z)("detached").toString(),"_blank")}),[t,p]),x=(0,r.useCallback)((()=>{d&&h.$.warn("Duplicate detacher detected, turning into a regular editor again"),_(!0),m(!1),t(null)}),[t,m]),k=(0,r.useCallback)((e=>{switch(e.event){case"connected":n("up"),m(!0);break;case"up":m(!0);break;case"closed":m(!1)}}),[m,n]),C=(0,r.useCallback)((e=>{switch(e.event){case"connected":n("up"),m(!0);break;case"up":m(!0);break;case"closed":m(!1);break;case"reattach":m(!1),window.close()}}),[m,n]),E=(0,r.useCallback)((e=>{"closed"===e.event&&n("up")}),[n]),T=(0,r.useCallback)((t=>{"detacher"===e?"detacher"===t.role?x():"detached"===t.role&&k(t):"detached"===e&&("detacher"===t.role?C(t):"detached"===t.role&&E(t))}),[e,x,k,C,E]);return(0,r.useEffect)((()=>(o(T),()=>i(T))),[o,i,T]),{reattach:b,detach:y,isLinked:g,isLinking:u,role:e,isRedundant:f}}(),G="sideBySide"===X||"pdf"===n||"detacher"===q;(0,r.useEffect)((()=>{b&&h.$.warn("Layout Effect",{detachIsRedundant:K,detachRole:q,detachIsLinking:z,detachIsLinked:J}),"detacher"===q&&(K?B("sideBySide"):(z||J)&&B("flat","editor"))}),[K,q,z,J,B]);const Y=(0,r.useMemo)((()=>({reattach:H,detach:W,detachIsLinked:J,detachRole:q,changeLayout:B,chatIsOpen:S,leftMenuShown:M,pdfLayout:X,pdfPreviewOpen:G,projectSearchIsOpen:D,setProjectSearchIsOpen:N,reviewPanelOpen:L,miniReviewPanelVisible:R,loadingStyleSheet:U,setChatIsOpen:A,setLeftMenuShown:F,setPdfLayout:$,setReviewPanelOpen:O,setMiniReviewPanelVisible:P,setLoadingStyleSheet:V,setView:I,view:n})),[H,W,J,q,B,S,M,X,G,D,N,L,R,U,A,F,$,O,P,V,I,n]);return(0,v.jsx)(y.Provider,{value:Y,children:t})};function k(){const e=(0,r.useContext)(y);if(!e)throw new Error("useLayoutContext is only available inside LayoutProvider");return e}},58516:(e,t,n)=>{"use strict";n.d(t,{Tg:()=>_,wy:()=>f});n(97107);var r=n(14041),o=n(16896),s=n(10646),i=n(64932),a=n(14936),c=n(5805),l=n(86316),h=n(31085);const d=(0,r.createContext)(void 0),u={readOnly:{read:!0,comment:!0,resolveOwnComments:!1,resolveAllComments:!1,trackedWrite:!1,write:!1,admin:!1,labelVersion:!1},review:{read:!0,comment:!0,resolveOwnComments:!0,resolveAllComments:!1,trackedWrite:!0,write:!1,admin:!1,labelVersion:!0},readAndWrite:{read:!0,comment:!0,resolveOwnComments:!0,resolveAllComments:!0,trackedWrite:!0,write:!0,admin:!1,labelVersion:!0},owner:{read:!0,comment:!0,resolveOwnComments:!0,resolveAllComments:!0,trackedWrite:!0,write:!0,admin:!0,labelVersion:!0}},p={readOnly:{...u.readOnly,comment:!1},readAndWrite:{...u.readAndWrite,comment:!1},review:{...u.review,comment:!1},owner:{...u.owner,comment:!1}},g={readOnly:{...u.readOnly,comment:!1},readAndWrite:u.readAndWrite,review:u.review,owner:u.owner},m={readOnly:u.readOnly,readAndWrite:u.readAndWrite,review:{...u.review,trackedWrite:!1},owner:u.owner},f=e=>{let{children:t}=e;const[n,f]=(0,a.A)("permissions"),{connectionState:_}=(0,o.FX)(),{permissionsLevel:w}=(0,s.mi)(),v=(0,c.A)(),b=(0,i.A)("ol-anonymous"),y=(0,l.O)();return(0,r.useEffect)((()=>{let e;e=v?g:b?p:y.features.trackChanges?u:m,f(e[w])}),[b,w,f,v,y.features.trackChanges]),(0,r.useEffect)((()=>{_.forceDisconnected&&f((e=>({...e,write:!1})))}),[_.forceDisconnected,f]),(0,h.jsx)(d.Provider,{value:n,children:t})};function _(){const e=(0,r.useContext)(d);if(!e)throw new Error("usePermissionsContext is only available inside PermissionsProvider");return e}},58528:(e,t,n)=>{"use strict";n.d(t,{g9:()=>o,qR:()=>s});var r=n(64932);function o(e){return"enabled"===(0,r.A)("ol-splitTestVariants")?.[e]}function s(e,t){return(0,r.A)("ol-splitTestVariants")?.[e]||t}},58756:(e,t,n)=>{const r=n(45461),o=n(10729),s=n(99568),i=n(97277),a=n(35078),c=n(10048),l=n(11485),h=n(33101),d=n(1651),u=n(43921),p=n(98695),g=n(79600),m=n(62293),f=n(97348),_=n(91822),w=n(87520),v=n(84140),b=n(85544),y=n(82927),x=n(90482),k=n(65734),C=n(63821),E=n(27673),T=n(8010),j=n(41546),I=n(33755),S=n(64331),A=n(23531),L=n(45317),O=n(91810),R=n(22246),P=n(44838),M=n(2058),F=n(65591),{InsertOp:D,RemoveOp:N,RetainOp:X,ScanOp:$}=n(42991),U=n(26041),V=n(13376),B=n(61210),H=n(2085),W=n(18452),z=n(82174),J=n(14679),q=n(50614);t.AddCommentOperation=r,t.Author=o,t.AuthorList=s,t.Blob=i,t.Change=a,t.ChangeRequest=c,t.ChangeNote=l,t.Chunk=h,t.ChunkResponse=d,t.Comment=u,t.DeleteCommentOperation=p,t.File=g,t.FileMap=m,t.LazyStringFileData=z,t.StringFileData=J,t.History=f,t.Label=_,t.AddFileOperation=w,t.MoveFileOperation=v,t.SetCommentStateOperation=b,t.EditFileOperation=y,t.EditNoOperation=x,t.EditOperationBuilder=q,t.EditOperationTransformer=k,t.SetFileMetadataOperation=C,t.NoOperation=E,t.Operation=T,t.RestoreOrigin=j,t.RestoreFileOrigin=I,t.Origin=S,t.OtClient=A,t.TextOperation=L,t.EditOperation=O,t.safePathname=R,t.Snapshot=P,t.util=M,t.V2DocVersions=F,t.ScanOp=$,t.InsertOp=D,t.RetainOp=X,t.RemoveOp=N,t.TrackedChangeList=V,t.TrackedChange=U,t.Range=H,t.CommentList=W,t.TrackingProps=B},58874:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var r=n(68380),o=n(97434),s=n(14041),i=n(31085);const a=(0,s.forwardRef)(((e,t)=>{const{t:n}=(0,o.Bd)();return(0,i.jsx)(r.A,{ref:t,"aria-label":n("close"),...e})}));a.displayName="OLCloseButton";const c=a},59084:(e,t,n)=>{"use strict";n.d(t,{A:()=>ye});var r={};n.r(r),n.d(r,{default:()=>w});var o=n(14041);const s=n.p+"images/both-generators-720p-37915caeb13dc49b94d7.mp4";var i=n(75962),a=n(6638),c=n(97434),l=n(96713),h=n(58528),d=n(64932),u=n(35447),p=n(71627),g=n(10646),m=n(85960),f=n(31085);const _="wf-features-moved",w=()=>{const{t:e}=(0,c.Bd)(),t=(0,m.ur)(),{showPopup:n,tryShowingPopup:r,completeTutorial:w}=(0,u.A)(_,{name:"writefull-rebranded-features-notification"}),{inactiveTutorials:v}=(0,g.mi)(),b=v.includes(_),y=(0,o.useCallback)((()=>{w({action:"complete",event:"promo-click"})}),[w]);(0,o.useEffect)((()=>{b||r()}),[r,b]);if(!(0,h.g9)("overleaf-assist-bundle"))return null;const x=(0,d.A)("ol-cannot-use-ai"),k=!0!==t.writefull?.enabled;return!n||x||k?null:(0,f.jsxs)("div",{className:"feature-rebrand-promo-container p-2 px-3 rounded",children:[(0,f.jsxs)("div",{className:"feature-rebrand-promo-title-container gap-3 mb-2",children:[(0,f.jsx)("h3",{className:"feature-rebrand-promo-title-text my-0",children:(0,f.jsx)("strong",{children:(0,f.jsx)(c.x6,{i18nKey:"new_create_tables_and_equations",components:{sparkle:(0,f.jsx)("img",{alt:"sparkle",className:"ol-cm-toolbar-ai-sparkle-white",src:a,"aria-hidden":"true"})}})})}),(0,f.jsx)(i.A,{onDismiss:y,variant:"dark"})]}),(0,f.jsxs)("div",{className:"feature-rebrand-promo-body",children:[(0,f.jsx)("video",{className:"teaser-video",autoPlay:!0,loop:!0,muted:!0,children:(0,f.jsx)("source",{src:s,type:"video/mp4"})}),(0,f.jsxs)("p",{className:"mb-0",children:[e("generate_tables_and_equations")," ",(0,f.jsx)(l.A,{type:"calculate"})," ",(0,f.jsx)(l.A,{type:"table_chart"})]}),(0,f.jsx)("div",{className:"pull-right",children:(0,f.jsx)(p.A,{variant:"secondary",onClick:y,children:e("ok")})})]})]})};var v=n(53373),b=n.n(v),y=n(31995),x=n(8164);const k=(0,o.lazy)((()=>Promise.all([n.e(1865),n.e(6597),n.e(8641),n.e(5460)]).then(n.bind(n,43826))));function C(){const{pdfUrl:e,pdfFile:t,pdfViewer:n}=(0,x.Rf)();return e?"native"===n?(0,f.jsx)("iframe",{title:"PDF Preview",src:e}):(0,f.jsx)(k,{url:e,pdfFile:t}):null}const E=(0,o.memo)(C);var T=n(90214),j=n(98509),I=n(56447),S=n(41026),A=n(69954),L=n(59162),O=n(61160),R=n(71805);const P=/Mac/i.test(navigator.platform)?"Cmd":"Ctrl";function M(e,t,n){A._("recompile-setting-changed",{setting:n,settingVal:e}),t(e)}function F(){const{animateCompileDropdownArrow:e,autoCompile:t,compiling:n,draft:r,hasChanges:o,setAutoCompile:s,setDraft:i,setStopOnValidationError:a,stopOnFirstError:l,stopOnValidationError:h,startCompile:d,stopCompile:u,recompileFromScratch:g}=(0,x.Rf)(),{enableStopOnFirstError:m,disableStopOnFirstError:_}=(0,S.V)({eventSource:"dropdown"}),{t:w}=(0,c.Bd)(),{detachRole:v}=(0,I.LV)(),y=(0,f.jsxs)(f.Fragment,{children:[w("recompile_pdf")," ",(0,f.jsxs)("span",{className:"keyboard-shortcut",children:["(",P," + Enter)"]})]}),k=b()({"detach-compile-button-animate":e,"btn-striped-animated":o},"no-left-border","dropdown-button-toggle"),C=b()("align-items-center py-0 no-left-radius px-3",{"btn-striped-animated":o});return(0,f.jsxs)(O.ms,{as:R.A,className:"compile-button-group",children:[(0,f.jsx)(L.A,{description:y,id:"compile",tooltipProps:{className:"keyboard-tooltip"},overlayProps:{delay:{show:500,hide:0},placement:"detached"===v?"bottom":void 0},children:(0,f.jsx)(p.A,{variant:"primary",disabled:n,isLoading:n,onClick:()=>d(),className:C,loadingLabel:`${w("compiling")}…`,children:w("recompile")})}),(0,f.jsx)(O.C,{as:O.fu,split:!0,variant:"primary",id:"pdf-recompile-dropdown",size:"sm","aria-label":w("toggle_compile_options_menu"),className:k}),(0,f.jsxs)(O.rI,{children:[(0,f.jsx)(O.hO,{children:w("auto_compile")}),(0,f.jsx)("li",{role:"none",children:(0,f.jsx)(O.tJ,{as:"button",onClick:()=>M(!0,s,"auto-compile"),trailingIcon:t?"check":null,children:w("on")})}),(0,f.jsx)("li",{role:"none",children:(0,f.jsx)(O.tJ,{as:"button",onClick:()=>M(!1,s,"auto-compile"),trailingIcon:t?null:"check",children:w("off")})}),(0,f.jsx)(O.rx,{}),(0,f.jsx)(O.hO,{children:w("compile_mode")}),(0,f.jsx)("li",{role:"none",children:(0,f.jsx)(O.tJ,{as:"button",onClick:()=>M(!1,i,"compile-mode"),trailingIcon:r?null:"check",children:w("normal")})}),(0,f.jsx)("li",{role:"none",children:(0,f.jsxs)(O.tJ,{as:"button",onClick:()=>M(!0,i,"compile-mode"),trailingIcon:r?"check":null,children:[w("fast")," ",(0,f.jsx)("span",{className:"subdued",children:"[draft]"})]})}),(0,f.jsx)(O.rx,{}),(0,f.jsx)(O.hO,{children:"Syntax Checks"}),(0,f.jsx)("li",{role:"none",children:(0,f.jsx)(O.tJ,{as:"button",onClick:()=>M(!0,a,"syntax-check"),trailingIcon:h?"check":null,children:w("stop_on_validation_error")})}),(0,f.jsx)("li",{role:"none",children:(0,f.jsx)(O.tJ,{as:"button",onClick:()=>M(!1,a,"syntax-check"),trailingIcon:h?null:"check",children:w("ignore_validation_errors")})}),(0,f.jsx)(O.rx,{}),(0,f.jsx)(O.hO,{children:w("compile_error_handling")}),(0,f.jsx)("li",{role:"none",children:(0,f.jsx)(O.tJ,{as:"button",onClick:m,trailingIcon:l?"check":null,children:w("stop_on_first_error")})}),(0,f.jsx)("li",{role:"none",children:(0,f.jsx)(O.tJ,{as:"button",onClick:_,trailingIcon:l?null:"check",children:w("try_to_compile_despite_errors")})}),(0,f.jsx)(O.rx,{}),(0,f.jsx)("li",{role:"none",children:(0,f.jsx)(O.tJ,{as:"button",onClick:()=>u(),disabled:!n,"aria-disabled":!n,children:w("stop_compile")})}),(0,f.jsx)("li",{role:"none",children:(0,f.jsx)(O.tJ,{as:"button",onClick:()=>{A._("recompile-setting-changed",{setting:"from-scratch"}),g()},disabled:n,"aria-disabled":n,children:w("recompile_from_scratch")})})]})]})}const D=(0,o.memo)(F);const N=function(){const{pdfLayout:e,setView:t,detachRole:n}=(0,I.LV)(),{t:r}=(0,c.Bd)();return n||"sideBySide"===e?null:(0,f.jsxs)(p.A,{variant:"secondary",size:"sm",onClick:function(){t("editor"),window.setTimeout((()=>{window.dispatchEvent(new Event("editor:focus"))}))},children:[(0,f.jsx)(l.A,{type:"code"}),r("switch_to_editor")]})};var X=n(35722);function $(){const{error:e,logEntries:t,toggleLogs:n,showLogs:r,stoppedOnFirstError:s}=(0,x.Rf)(),{t:i}=(0,c.Bd)(),a=(0,o.useCallback)((()=>{r||A._("logs-click"),n()}),[n,r]),h=Number(t?.errors?.length),d=h+Number(t?.warnings?.length);return(0,f.jsx)(L.A,{id:"logs-toggle",description:i("logs_and_output_files"),overlayProps:{placement:"bottom"},children:(0,f.jsxs)(p.A,{variant:"link",disabled:Boolean(e||s),active:r,className:"pdf-toolbar-btn toolbar-item log-btn",onClick:a,style:{position:"relative"},"aria-label":i(r?"view_pdf":"view_logs"),children:[(0,f.jsx)(l.A,{type:"description"}),!r&&d>0&&(0,f.jsx)(X.A,{bg:0===h?"warning":"danger",children:d})]})})}const U=(0,o.memo)($);var V=n(86316);const B=function(){const{pdfDownloadUrl:e}=(0,x.Rf)(),{_id:t}=(0,V.O)(),{t:n}=(0,c.Bd)(),r=n(e?"download_pdf":"please_compile_pdf_before_download");return(0,f.jsx)(L.A,{id:"download-pdf",description:r,overlayProps:{placement:"bottom"},children:(0,f.jsx)(p.A,{onClick:function(e){const n=e;"true"!==n.currentTarget.dataset.disabled?(0,A._)("download-pdf-button-click",{projectId:t,location:"pdf-preview",isSmallDevice:A.mP}):n.preventDefault()},variant:"link",className:"pdf-toolbar-btn",draggable:!1,"data-disabled":!e,disabled:!e,download:!0,href:e||"#",target:"_blank",style:{pointerEvents:"auto"},"aria-label":n("download_pdf"),children:(0,f.jsx)(l.A,{type:"download"})})})};function H(){const{codeCheckFailed:e,error:t,toggleLogs:n}=(0,x.Rf)(),{t:r}=(0,c.Bd)(),s=(0,o.useCallback)((()=>{n()}),[n]);return e?(0,f.jsxs)(p.A,{variant:"danger",size:"sm",disabled:Boolean(t),className:"btn-toggle-logs toolbar-item",onClick:s,children:[(0,f.jsx)(l.A,{type:"warning"}),(0,f.jsx)("span",{className:"toolbar-text",children:r("code_check_failed")})]}):null}const W=(0,o.memo)(H);var z=n(69139),J=n(89753);function q(){const{t:e}=(0,c.Bd)(),t=(0,J.z)(),n=(0,o.useCallback)((()=>{t.assign((0,z.Z)(null).toString())}),[t]);return(0,f.jsx)(p.A,{variant:"primary",size:"sm",onClick:n,children:e("redirect_to_editor")})}const K=(0,o.memo)(q);var G=n(44167),Y=n(237);function Q(){const{detachRole:e,detachIsLinked:t}=(0,I.LV)(),n=(0,o.useRef)(),[r,s]=(0,o.useState)(!1),i=!t&&"detached"===e;(0,o.useEffect)((()=>{n.current&&window.clearTimeout(n.current),i?n.current=window.setTimeout((()=>{s(!0)}),5e3):s(!1)}),[i]);let a=null;return a=r?(0,f.jsx)(ee,{}):i?(0,f.jsx)(te,{}):(0,f.jsx)(Z,{}),(0,f.jsx)(j.A,{className:"toolbar toolbar-pdf toolbar-pdf-hybrid",children:a})}function Z(){return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"toolbar-pdf-left",children:[(0,f.jsx)(D,{}),(0,f.jsx)(U,{}),(0,f.jsx)(B,{})]}),(0,f.jsxs)("div",{className:"toolbar-pdf-right",children:[(0,f.jsx)("div",{className:"toolbar-pdf-controls",id:"toolbar-pdf-controls"}),(0,f.jsx)(W,{}),(0,f.jsx)(N,{}),(0,f.jsx)(G.Yu,{})]})]})}function ee(){const{t:e}=(0,c.Bd)();return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)("div",{className:"toolbar-pdf-orphan",children:[e("tab_no_longer_connected"),(0,f.jsx)(K,{})]})})}function te(){const{t:e}=(0,c.Bd)();return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)("div",{className:"toolbar-pdf-orphan",children:[(0,f.jsx)(Y.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})," ",e("tab_connecting"),"…"]})})}const ne=(0,o.memo)(Q),re=e=>{let{children:t}=e;return(0,f.jsx)("div",{className:"pdf-preview-messages",children:t})};var oe=n(42093),se=n(79953),ie=n(4607);const ae=e=>{let{handleDismissWarning:t}=e;const{t:n}=(0,c.Bd)();return(0,f.jsx)(se.A,{action:(0,f.jsx)(ie.A,{variant:"new-10s",source:"compile-time-warning",buttonProps:{variant:"secondary"},children:n("start_free_trial_without_exclamation")}),ariaLive:"polite",content:(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{children:(0,f.jsx)("span",{children:n("your_project_near_compile_timeout_limit")})}),(0,f.jsx)("strong",{children:n("upgrade_for_12x_more_compile_time")}),". "]}),type:"warning",title:n("took_a_while"),isActionBelowContent:!0,isDismissible:!0,onDismiss:t})};function ce(){const{isProjectOwner:e,deliveryLatencies:t,compiling:n,showLogs:r,error:s}=(0,x.Rf)(),[i,a]=(0,o.useState)(!1),[c,l]=(0,oe.A)("has-dismissed-10s-compile-time-warning-until"),h=(0,o.useCallback)((t=>{a(!1),t>1e4&&e&&(!c||new Date(c)<new Date)&&(a(!0),A._("compile-time-warning-displayed",{time:10,isProjectOwner:e}))}),[e,c]),u=(0,o.useCallback)((()=>{A._("compile-time-warning-dismissed",{time:10,isProjectOwner:e}),a(!1);const t=new Date;t.setDate(t.getDate()+1),l(t)}),[e,l]);return(0,o.useEffect)((()=>{n||s||r||h(t.compileTimeServerE2E)}),[n,s,r,t,h]),(0,d.A)("ol-ExposedSettings").enableSubscriptions?n||s||r?null:i?(0,f.jsx)("div",{children:i&&e&&(0,f.jsx)(ae,{handleDismissWarning:u})}):null:null}const le=(0,o.memo)(ce);var he=n(63815);function de(){return(0,f.jsxs)(j.A,{className:"toolbar toolbar-pdf toolbar-pdf-hybrid",children:[(0,f.jsxs)("div",{className:"toolbar-pdf-left",children:[(0,f.jsx)(D,{}),(0,f.jsx)(B,{})]}),(0,f.jsxs)("div",{className:"toolbar-pdf-right",children:[(0,f.jsx)("div",{className:"toolbar-pdf-controls",id:"toolbar-pdf-controls"}),(0,f.jsx)(N,{}),(0,f.jsx)(G.Yu,{})]})]})}const ue=(0,o.memo)(de);var pe=n(70569),ge=n(97536);const me=function(){const{loadingError:e}=(0,he.J)(),{showLogs:t}=(0,x.Rf)(),{t:n}=(0,c.Bd)(),{openTab:r}=(0,pe.h)();return(0,ge.G)()&&(e||t)?(0,f.jsxs)("div",{className:"pdf-error-state",children:[(0,f.jsxs)("div",{className:"pdf-error-state-top-section",children:[(0,f.jsx)("div",{className:"pdf-error-state-warning-icon",children:(0,f.jsx)(l.A,{type:"warning"})}),(0,f.jsxs)("div",{className:"pdf-error-state-text",children:[(0,f.jsx)("p",{className:"pdf-error-state-label",children:n("pdf_couldnt_compile")}),(0,f.jsx)("p",{className:"pdf-error-state-description",children:n("we_are_unable_to_generate_the_pdf_at_this_time")})]}),(0,f.jsx)(p.A,{variant:"secondary",size:"sm",onClick:()=>{r("errors")},children:n("check_logs")})]}),(0,f.jsxs)("div",{className:"pdf-error-state-info-box",children:[(0,f.jsxs)("div",{className:"pdf-error-state-info-box-title",children:[(0,f.jsx)(l.A,{type:"info",unfilled:!0}),n("why_might_this_happen")]}),(0,f.jsxs)("ul",{className:"pdf-error-state-info-box-text",children:[(0,f.jsx)("li",{children:n("there_is_an_unrecoverable_latex_error")}),(0,f.jsx)("li",{children:n("the_document_environment_contains_no_content")}),(0,f.jsx)("li",{children:n("this_project_contains_a_file_called_output")})]})]})]}):null};function fe(){const{pdfUrl:e,hasShortCompileTimeout:t}=(0,x.Rf)(),n=b()("pdf","full-size",{"pdf-empty":!e}),s=(0,ge.G)(),i=[{import:r,path:"/overleaf/services/web/modules/writefull/frontend/js/components/promotions/feature-rebrand-promotion"}];return(0,f.jsx)("div",{className:n,children:(0,f.jsxs)(he.K,{children:[s?(0,f.jsx)(ue,{}):(0,f.jsx)(ne,{}),(0,f.jsx)(re,{children:t&&(0,f.jsx)(le,{})}),(0,f.jsx)(o.Suspense,{fallback:(0,f.jsx)(T.e,{delay:500}),children:(0,f.jsx)("div",{className:"pdf-viewer",children:(0,f.jsx)(E,{})})}),s?(0,f.jsx)(me,{}):(0,f.jsx)(y.A,{}),i.map((e=>{let{import:{default:t},path:n}=e;return(0,f.jsx)(t,{},n)}))]})})}const _e=(0,o.memo)(fe);var we=n(67984),ve=n(7174);function be(){const{detachRole:e}=(0,I.LV)();return"detacher"===e?null:(0,f.jsx)(_e,{})}const ye=(0,we.A)((0,o.memo)(be),(()=>(0,f.jsx)(ve.A,{type:"preview"})))},59622:(e,t,n)=>{"use strict";n(97107);const r=n(64347).assert,o=n(97277),s=n(12628);class i extends s{constructor(e,t){super(),r.match(e,o.HEX_HASH_RX,"HashFileData: bad hash"),t&&r.match(t,o.HEX_HASH_RX,"HashFileData: bad ranges hash"),this.hash=e,this.rangesHash=t}static fromRaw(e){return new i(e.hash,e.rangesHash)}toRaw(){const e={hash:this.hash};return this.rangesHash&&(e.rangesHash=this.rangesHash),e}getHash(){return this.hash}getRangesHash(){return this.rangesHash}async toEager(e){const t=await this.toLazy(e);return await t.toEager(e)}async toLazy(e){const[t,n]=await Promise.all([e.getBlob(this.hash),this.rangesHash?e.getBlob(this.rangesHash):Promise.resolve(void 0)]);if(null===n)throw new Error("Failed to look up rangesHash in blobStore");if(!t)throw new Error("blob not found: "+this.hash);return s.createLazyFromBlobs(t,n)}async toHollow(e){const t=await e.getBlob(this.hash);if(!t)throw new Error("Failed to look up hash in blobStore");return s.createHollow(t.getByteLength(),t.getStringLength())}async store(){const e={hash:this.hash};return this.rangesHash&&(e.rangesHash=this.rangesHash),e}}e.exports=i},59722:(e,t,n)=>{"use strict";n.d(t,{Wg:()=>h,XW:()=>d});n(97107);var r=n(14041),o=n(85960),s=n(13653),i=n(37858),a=n(10646),c=n(31085);const l=(0,r.createContext)(void 0),h=e=>{let{children:t}=e;const n=(0,o.ur)(),{writefullInstance:h}=(0,a.mi)(),[d,u]=(0,r.useState)(n.features);return(0,s.Q)((0,r.useCallback)((e=>{e?.features&&u(e.features)}),[])),(0,r.useEffect)((()=>{const e=async e=>{let{isPremium:t}=e;if(d?.aiErrorAssistant===t)return;const n=await(0,i.hm)("/user/features");u(n)};return h?.addEventListener("writefull-login-complete",e),()=>{h?.removeEventListener("writefull-login-complete",e)}}),[d?.aiErrorAssistant,h]),(0,c.jsx)(l.Provider,{value:d,children:t})};function d(){const e=(0,r.useContext)(l);if(!e)throw new Error("useUserFeaturesContext is only available inside UserFeaturesContext, or `ol-user` meta is not defined");return e}},60440:(e,t,n)=>{"use strict";n.d(t,{_:()=>T,Q:()=>E});n(97107);var r=n(22743),o=n(14041),s=n(14936),i=(n(82438),n(50020),n(6896));function a(e,t){return l(e,t,((e,t,n)=>[...e.slice(0,n),...e.slice(n+1)]))}function c(e,t,n){const{type:r,...o}=n;if(!r)throw new Error("Entity has no type");const s=`${r}s`;return l(e,t,((e,t,n)=>(e[n]={...t,[s]:[...t[s],o]},e)))}function l(e,t,n){if(!t||e._id===t){const[t]=n([],e,0);return t}for(const r of["docs","fileRefs","folders"])for(let o=0;o<e[r].length;o++){const s=e[r][o];if(s._id===t)return{...e,[r]:n(e[r],s,o)}}const r=e.folders.map((e=>l(e,t,n)));return{...e,folders:r}}var h=n(64932);function d(e){if(!e)return 0;const t=function(e){function t(e){if(null==e)return 0;let n=0;if(e.folders){n+=e.folders.length;for(const r of e.folders)n+=t(r)}return e.docs&&(n+=e.docs.length),e.fileRefs&&(n+=e.fileRefs.length),n}return t(e)}(e),n=(0,h.A)("ol-ExposedSettings").maxEntitiesPerProject,r=function(e,t,n){if(e>=t)return"error";if(e>=t-n)return"warning";return"success"}(t,n,Math.ceil(n/20));return{value:t,status:r,limit:n}}var u=n(45250),p=n.n(u);function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.docs.map((e=>({doc:{id:e._id,name:e.name},path:t+e.name})));for(const r of e.folders)n.push(...g(r,`${t}${r.name}/`));return n}function m(e){const t=g(e);return t.sort((function(e,t){const n=(e.path.match(/\//g)||[]).length,r=(t.path.match(/\//g)||[]).length;return n-r!=0?-(n-r):e.path<t.path?-1:e.path>t.path?1:0})),t}var f=n(76113),_=n(65982),w=n(31085);const{buildFileTree:v,createFolder:b}=r||_.CH,y=(0,o.createContext)(void 0);var x=function(e){return e.RENAME="RENAME",e.RESET="RESET",e.DELETE="DELETE",e.MOVE="MOVE",e.CREATE="CREATE",e}(x||{});function k(e,t){let{fileTreeData:n}=e;switch(t.type){case x.RESET:{const e=t.fileTreeData;return{fileTreeData:e,fileCount:d(e)}}case x.RENAME:{const e=function(e,t,n){let{newName:r}=n;return l(e,t,((e,t,n)=>{const o=Object.assign([],e),s={...t,name:r};return o[n]=s,o}))}(n,t.id,{newName:t.newName});return{fileTreeData:e,fileCount:d(e)}}case x.DELETE:{const e=a(n,t.id);return{fileTreeData:e,fileCount:d(e)}}case x.MOVE:{const e=function(e,t,n){const r=(0,i.k3)(e,t);return r.parentFolderId===n?e:c(a(e,t),n,{...r.entity,type:r.type})}(n,t.entityId,t.toFolderId);return{fileTreeData:e,fileCount:d(e)}}case x.CREATE:{const e=c(n,t.parentFolderId,t.entity);return{fileTreeData:e,fileCount:d(e)}}default:throw new Error(`Unknown mutable file tree action type: ${t.type}`)}}const C=e=>{const t=e?.[0];return{fileTreeData:t,fileCount:d(t)}};function E(){const e=(0,o.useContext)(y);if(!e)throw new Error("useFileTreeData is only available inside FileTreeDataProvider");return e}const T=e=>{let{children:t}=e;const[n]=(0,s.A)("project"),[r]=(0,s.A)("editor.open_doc_id"),[,i]=(0,f.A)("editor.open_doc_name"),[a]=(0,s.A)("permissionsLevel"),{fileTreeFromHistory:c,snapshot:l,snapshotVersion:h}=(0,_.P4)(),d="readOnly"===a||c,[u,g]=(0,o.useState)(n?.rootFolder);(0,o.useEffect)((()=>{c||g(n?.rootFolder)}),[n,c]),(0,o.useEffect)((()=>{c&&(u&&!u?.[0]?._id||g([b("","")]))}),[c,u]),(0,o.useEffect)((()=>{c&&l&&g([v(l)])}),[c,l,h]);const[{fileTreeData:E,fileCount:T},j]=(0,o.useReducer)(k,u,C),[I,S]=(0,o.useState)([]),A=(0,o.useMemo)((()=>E?m(E):void 0),[E]);!function(e,t){const n=(0,o.useRef)();(0,o.useEffect)((()=>{p().isEqual(t,n.current)||(n.current=t,e())}),t)}((()=>{j({type:x.RESET,fileTreeData:u?.[0]})}),[u]);const L=(0,o.useCallback)(((e,t)=>{t.type="folder",j({type:x.CREATE,parentFolderId:e,entity:t})}),[]),O=(0,o.useCallback)(((e,t)=>{t.type="doc",j({type:x.CREATE,parentFolderId:e,entity:t})}),[]),R=(0,o.useCallback)(((e,t)=>{t.type="fileRef",j({type:x.CREATE,parentFolderId:e,entity:t})}),[]),P=(0,o.useCallback)(((e,t)=>{j({type:x.RENAME,newName:t,id:e}),e===r&&i(t)}),[r,i]),M=(0,o.useCallback)((e=>{j({type:x.DELETE,id:e})}),[]),F=(0,o.useCallback)(((e,t)=>{j({type:x.MOVE,entityId:e,toFolderId:t})}),[]),D=(0,o.useMemo)((()=>({dispatchCreateDoc:O,dispatchCreateFile:R,dispatchCreateFolder:L,dispatchDelete:M,dispatchMove:F,dispatchRename:P,fileCount:T,fileTreeData:E,fileTreeReadOnly:d,hasFolders:E?.folders.length>0,selectedEntities:I,setSelectedEntities:S,docs:A})),[O,R,L,M,F,P,T,E,d,I,S,A]);return(0,w.jsx)(y.Provider,{value:D,children:t})}},61210:e=>{class t{constructor(e,t,n){this.type=e,this.userId=t,this.ts=n}static fromRaw(e){return new t(e.type,e.userId,new Date(e.ts))}toRaw(){return{type:this.type,userId:this.userId,ts:this.ts.toISOString()}}equals(e){return e instanceof t&&(this.type===e.type&&this.userId===e.userId&&this.ts.getTime()===e.ts.getTime())}}e.exports=t},62293:(e,t,n)=>{"use strict";n(82438),n(57327);const r=n(45250),o=n(64347).assert,s=n(37603),i=n(90953),a=n(79600),c=n(22246);class PathnameError extends s{}class NonUniquePathnameError extends PathnameError{constructor(e){super("pathnames are not unique",{pathnames:e}),this.pathnames=e}}class BadPathnameError extends PathnameError{constructor(e,t){e.length>10&&(e=e.slice(0,5)+"..."+e.slice(-5)),super("invalid pathname",{reason:t,pathname:e}),this.pathname=e}}class PathnameConflictError extends PathnameError{constructor(e){super("pathname conflicts with another file",{pathname:e}),this.pathname=e}}class FileNotFoundError extends PathnameError{constructor(e){super("file does not exist",{pathname:e}),this.pathname=e}}class l{static PathnameError=(()=>PathnameError)();static NonUniquePathnameError=(()=>NonUniquePathnameError)();static BadPathnameError=(()=>BadPathnameError)();static PathnameConflictError=(()=>PathnameConflictError)();static FileNotFoundError=(()=>FileNotFoundError)();constructor(e){this.files=Object.create(null),r.assign(this.files,e),function(e){if(function(e){const t=r.keys(e);return r.uniqWith(t,h).length===t.length}(e))return;throw new l.NonUniquePathnameError(r.keys(e))}(this.files),function(e){const t=e.getPathnames();t.forEach(d);const n=[];for(let e=0;e<t.length;e++)n[e]=t[e]+"/";n.sort();for(let e=0;e<n.length-1;e++)if(n[e+1].startsWith(n[e])){const t=n[e+1].substr(0,-1);throw new l.PathnameConflictError(t)}}(this)}static fromRaw(e){return o.object(e,"bad raw files"),new l(r.mapValues(e,a.fromRaw))}toRaw(){return r.mapValues(this.files,(function(e){return e.toRaw()}))}addFile(e,t){d(e),o.object(t,"bad file"),u(this,e),g(this.files,e,t)}removeFile(e){d(e);const t=p(this.files,e);if(!t)throw new l.FileNotFoundError(e);delete this.files[t]}moveFile(e,t){if(e===t)return;if(""===t)return this.removeFile(e);d(e),d(t),u(this,t,e);const n=p(this.files,e);if(!n)throw new l.FileNotFoundError(e);const r=this.files[n];delete this.files[n],g(this.files,t,r)}countFiles(){return r.size(this.files)}getFile(e){const t=p(this.files,e);if(t)return this.files[t]}wouldConflict(e,t){d(e),o.maybe.string(t);const n=this.getPathnames(),r=e+"/";for(let o=0;o<n.length;o++){if(n[o].startsWith(r)&&!h(n[o],t))return!0;if(e.startsWith(n[o])&&e.length>n[o].length&&"/"===e[n[o].length]&&!h(n[o],t))return!0}return!1}getPathnames(){return r.keys(this.files)}map(e){return r.mapValues(this.files,e)}async mapAsync(e,t){o.maybe.number(t,"bad concurrency");const n=this.getPathnames(),s=await i(n,(t=>e(this.getFile(t),t,n)),{concurrency:t||1});return r.zipObject(n,s)}}function h(e,t){return e===t}function d(e){o.nonEmptyString(e,"bad pathname");const[t,n]=c.isCleanDebug(e);if(!t)throw new l.BadPathnameError(e,n)}function u(e,t,n){if(e.wouldConflict(t,n))throw new l.PathnameConflictError(t)}function p(e,t){if(t in e)return t}function g(e,t,n){const r=p(e,t);r&&delete e[r],e[t]=n}e.exports=l},63308:()=>{ReadableStream.prototype.values??=function(){let{preventCancel:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.getReader();return{async next(){try{const e=await t.read();return e.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(n){if(e)t.releaseLock();else{const e=t.cancel(n);t.releaseLock(),await e}return{done:!0,value:n}},[Symbol.asyncIterator](){return this}}},ReadableStream.prototype[Symbol.asyncIterator]??=ReadableStream.prototype.values},63815:(e,t,n)=>{"use strict";n.d(t,{J:()=>i,K:()=>a});n(97107);var r=n(14041),o=n(31085);const s=(0,r.createContext)(void 0),i=()=>{const e=(0,r.useContext)(s);if(!e)throw new Error("usePdfPreviewContext is only avalable inside PdfPreviewProvider");return e},a=e=>{let{children:t}=e;const[n,i]=(0,r.useState)(!1),a=(0,r.useMemo)((()=>({loadingError:n,setLoadingError:i})),[n]);return(0,o.jsx)(s.Provider,{value:a,children:t})}},63821:(e,t,n)=>{"use strict";const r=n(45250),o=n(64347).assert,s=n(8010);e.exports=class extends s{constructor(e,t){super(),o.string(e,"SetFileMetadataOperation: bad pathname"),o.object(t,"SetFileMetadataOperation: bad metadata"),this.pathname=e,this.metadata=t}toRaw(){return{pathname:this.pathname,metadata:r.cloneDeep(this.metadata)}}getPathname(){return this.pathname}getMetadata(){return this.metadata}applyTo(e){const t=e.getFile(this.pathname);t&&t.setMetadata(this.metadata)}}},64331:(e,t,n)=>{"use strict";const r=n(64347).assert;let o=null,s=null,i=null;class a{constructor(e){r.string(e,"Origin: bad kind"),this.kind=e}static fromRaw(e){return e?e.kind===o.KIND?o.fromRaw(e):e.kind===s.KIND?s.fromRaw(e):e.kind===i.KIND?i.fromRaw(e):new a(e.kind):null}toRaw(){return{kind:this.kind}}getKind(){return this.kind}}e.exports=a,o=n(41546),s=n(33755),i=n(49008)},65591:(e,t,n)=>{"use strict";const r=n(45250);class o{constructor(e){this.data=e||{}}static fromRaw(e){if(e)return new o(e)}toRaw(){if(!this.data)return null;return r.clone(this.data)}clone(){return o.fromRaw(this.toRaw())}applyTo(e){r.size(this.data)&&(e.v2DocVersions?r.assign(e.v2DocVersions.data,this.data):e.v2DocVersions=this.clone())}moveFile(e,t){for(const[n,r]of Object.entries(this.data))if(r.pathname===e){""===t?delete this.data[n]:r.pathname=t;break}}}e.exports=o},65734:(e,t,n)=>{n(97107);const r=n(58756),o=n(43921),s=n(90482),i=n(45317);function a(e,t,n){return(r,o)=>{if(r instanceof e&&o instanceof t)return n(r,o);if(o instanceof e&&r instanceof t){const[e,t]=n(o,r);return[t,e]}return!1}}function c(e,t){return[e,t]}e.exports=class{static transform(e,t){const{AddCommentOperation:n,DeleteCommentOperation:l,SetCommentStateOperation:h}=r;if(e instanceof s||t instanceof s)return[e,t];const d=[a(i,i,i.transform),a(i,l,c),a(i,h,c),a(i,n,((e,t)=>{const r=new o(t.commentId,t.ranges,t.resolved).applyTextOperation(e,t.commentId);return[e,new n(r.id,r.ranges,r.resolved)]})),a(n,n,((e,t)=>e.commentId===t.commentId?[new s,t]:[e,t])),a(n,l,((e,t)=>e.commentId===t.commentId?[new s,t]:[e,t])),a(n,h,((e,t)=>{if(e.commentId===t.commentId){return[new n(e.commentId,e.ranges,t.resolved),t]}return[e,t]})),a(l,l,((e,t)=>e.commentId===t.commentId?[new s,new s]:[e,t])),a(l,h,((e,t)=>e.commentId===t.commentId?[e,new s]:[e,t])),a(h,h,((e,t)=>{if(e.commentId!==t.commentId)return[e,t];if(e.resolved===t.resolved)return[new s,new s];const n=e.resolved&&t.resolved;return e.resolved===n?[e,new s]:[new s,t]}))];for(const n of d){const r=n(e,t);if(r)return r}throw new Error(`Transform not implemented for ${e.constructor.name}￮${t.constructor.name}`)}}},65982:(e,t,n)=>{"use strict";n.d(t,{CH:()=>c,P4:()=>u,yg:()=>d});n(97107);var r=n(22743),o=n(14041),s=n(86316),i=n(60961),a=n(31085);const c={SnapshotUpdater:class{constructor(e){this.projectId=e}refresh(){throw new Error("not implemented")}abort(){throw new Error("not implemented")}},buildFileTree(e){throw new Error("not implemented")},createFolder(e,t){throw new Error("not implemented")}},{SnapshotUpdater:l}=r||c,h=(0,o.createContext)(void 0),d=e=>{let{children:t}=e;const{_id:n}=(0,s.O)(),[r,c]=(0,o.useState)(""),[d]=(0,o.useState)((()=>new l(n))),[u,p]=(0,o.useState)(),[g,m]=(0,o.useState)(-1),[f,_]=(0,o.useState)(!1);(0,o.useEffect)((()=>{if(!f)return;let e,t=!1;const n=()=>{c("loading"),d.refresh().then((e=>{let{snapshot:t,snapshotVersion:n}=e;p(t),m(n),c("")})).catch((e=>{i.$.error(e),c("error")})).finally((()=>{t||(e=window.setTimeout(n,3e4))}))};return n(),()=>{t=!0,d.abort(),clearInterval(e)}}),[n,f,d]);const w=(0,o.useMemo)((()=>({snapshot:u,snapshotVersion:g,snapshotLoadingState:r,fileTreeFromHistory:f,setFileTreeFromHistory:_})),[u,g,r,f,_]);return(0,a.jsx)(h.Provider,{value:w,children:t})};function u(){const e=(0,o.useContext)(h);if(!e)throw new Error("useSnapshotContext is only available within SnapshotProvider");return e}},66020:(e,t,n)=>{"use strict";n.d(t,{dk:()=>u,wI:()=>d});n(97107);var r=n(14041),o=n(64932),s=n(14936),i=n(7881),a=n(97536),c=n(31085);const l={pdfViewer:"pdfjs",autoComplete:!0,autoPairDelimiters:!0,syntaxValidation:!1,editorTheme:"textmate",overallTheme:"",mode:"default",fontSize:12,fontFamily:"monaco",lineHeight:"normal",mathPreview:!0,referencesSearchMode:"advanced",enableNewEditor:!0},h=(0,r.createContext)(void 0),d=e=>{let{children:t}=e;const[n,d]=(0,r.useState)((()=>(0,o.A)("ol-userSettings")||l)),[,u]=(0,s.A)("settings");(0,r.useEffect)((()=>{const{fontFamily:e,lineHeight:t}=(0,i.e4)(n);u({overallTheme:"light-"===n.overallTheme?"light":"dark",keybindings:"none"===n.mode?"default":n.mode,fontFamily:e,lineHeight:t,fontSize:n.fontSize,isNewEditor:(0,a.x)()&&n.enableNewEditor})}),[u,n]);const p=(0,r.useMemo)((()=>({userSettings:n,setUserSettings:d})),[n,d]);return(0,c.jsx)(h.Provider,{value:p,children:t})};function u(){const e=(0,r.useContext)(h);if(!e)throw new Error("useUserSettingsContext is only available inside UserSettingsProvider");return e}},67353:(e,t,n)=>{"use strict";n.d(t,{Qi:()=>i,nK:()=>a});n(97107);var r=n(14041),o=n(31085);const s=(0,r.createContext)(void 0),i=e=>{let{ide:t,scopeStore:n,scopeEventEmitter:i,children:a}=e;(0,r.useEffect)((()=>{window.overleaf={...window.overleaf,unstable:{...window.overleaf?.unstable,store:n}}}),[n]);const c=(0,r.useMemo)((()=>({...t,scopeStore:n,scopeEventEmitter:i})),[t,n,i]);return(0,o.jsx)(s.Provider,{value:c,children:a})};function a(){const e=(0,r.useContext)(s);if(!e)throw new Error("useIdeContext is only available inside IdeProvider");return e}},68273:(e,t,n)=>{"use strict";n.d(t,{w:()=>o});var r=n(14041);const o=e=>{const t=(0,r.useRef)(null),n=(0,r.useCallback)((n=>{if(n&&"ResizeObserver"in window){t.current&&t.current.observer.unobserve(t.current.element);const r=new ResizeObserver((t=>{let[n]=t;e(n.target)}));t.current={element:n,observer:r},r.observe(n),e(n)}}),[e]);return(0,r.useEffect)((()=>()=>{t.current&&t.current.observer.unobserve(t.current.element)}),[]),{elementRef:n,resizeRef:t}}},68543:(e,t,n)=>{"use strict";n.d(t,{al:()=>H,TS:()=>W});n(97107),n(82438),n(34840),n(99817);var r=n(14041),o=n(69954),s=n(14936),i=n(67353),a=(n(12266),n(50020),n(74786),n(73208)),c=n.n(a),l=n(44199),h=n(18860),d=n(60961);function u(e){return decodeURIComponent(escape(e))}const p="ShareJsDoc";class g{lastReport=null;queue=[];constructor(e){this.onTimeoutHandler=e}getMetaPreferLocal(){for(const e of this.queue)if(e.scope===p)return e;return this.queue.pop()}onTimeout(e){this.queue.push(e),setTimeout((()=>{if(!this.queue.length)return;const e=this.getMetaPreferLocal();this.queue.length=0;const t=Date.now();null!==this.lastReport&&t-this.lastReport<6e4||(this.lastReport=t,this.onTimeoutHandler(e))}))}}class m{lastAck=null;constructor(e){let{parent:t,onTimeoutHandler:n}=e;if(this.scope=t?p:"global",this.timeout=6e4,this.parent=t,t)this.reporter=t.reporter;else{if(!n)throw new Error("No parent or onTimeoutHandler");this.reporter=new g(n)}this.lastAck=null,this.lastUnackedEdit=null}onAck(){this.lastAck=performance.now(),this.parent&&this.parent.onAck()}onEdit(){const e=performance.now();this.lastAck>this.lastUnackedEdit&&(this.lastUnackedEdit=null),this.lastUnackedEdit||(this.lastUnackedEdit=e);const t=e-this.lastUnackedEdit;if(t>this.timeout){const n=Date.now()-e,r={scope:this.scope,delay:t,lastAck:this.lastAck?n+this.lastAck:0,lastUnackedEdit:n+this.lastUnackedEdit};this.log("timedOut",r),this.reporter.onTimeout(r)}}attachToEditor(e){this.log("attach to editor");const t=(e,t)=>{"remote"!==t.origin&&(t.removed||t.inserted)&&this.onEdit()};return e.on("change",t),()=>{this.log("detach from editor"),e.off("change",t)}}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];d.$.log(`[EditorWatchdogManager] ${this.scope}:`,...t)}}var f=n(64932);var _=n(58756);function w(e){const t=_.EditOperationBuilder.fromJSON(e);if(!(t instanceof _.TextOperation))throw new Error(`operation not supported: ${t.constructor.name}`);return t}class v extends l.A{constructor(e){super(),this.api=this,this.snapshot=e}transformX(e,t){const[n,r]=_.TextOperation.transform(w(e[0]),w(t[0]));return[[n.toJSON()],[r.toJSON()]]}apply(e,t){const n=w(t[0]),r=_.StringFileData.fromRaw(e.toRaw());return r.edit(n),this.snapshot=r,r}compose(e,t){return[w(e[0]).compose(w(t[0])).toJSON()]}insert(e,t,n){const r=this.getText(),o=new _.TextOperation;o.retain(e),o.insert(t),o.retain(r.length-e),this.submitOp([o.toJSON()])}del(e,t,n){const r=this.getText(),o=new _.TextOperation;o.retain(e),o.remove(t),o.retain(r.length-e-t),this.submitOp([o.toJSON()])}getText(){return this.snapshot.getContent({filterTrackedDeletes:!0})}getLength(){return this.getText().length}_register(){this.on("remoteop",((e,t)=>{const n=w(e[0]),r=t.getContent();if(r.length!==n.baseLength)throw new _.TextOperation.ApplyError("The operation's base length must be equal to the string's length.",n,r);let o=0,s=0;for(const e of n.ops)e instanceof _.RetainOp?(s+=e.length,o+=e.length):e instanceof _.InsertOp?(this.emit("insert",o,e.insertion,e.insertion.length),o+=e.insertion.length):e instanceof _.RemoveOp&&(this.emit("delete",o,r.slice(s,s+e.length)),s+=e.length);if(s!==r.length)throw new _.TextOperation.ApplyError("The operation didn't operate on the whole string.",n,r)}))}submitOp(e){}}class b extends l.A{track_changes=!1;track_changes_id_seeds=null;lastAcked=null;pendingOpCreatedAt=null;inflightOpCreatedAt=null;queuedMessageTimer=null;queuedMessages=[];detachEditorWatchdogManager=null;_timeoutTimer=null;constructor(e,t,n,r,o,s){var i;let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"sharejs-text-ot";super(),i=this,this.doc_id=e,this.socket=r,this.globalEditorWatchdogManager=o,this.eventEmitter=s,this.type=a;let c,l=h.A.types.text;"history-ot"===this.type?(c=_.StringFileData.fromRaw(t),l=new v(c)):c=t.map((e=>u(e))).join("\n"),this.connection={send:e=>(this.startInflightOpTimeout(e),this.track_changes&&this.track_changes_id_seeds&&(null==e.meta&&(e.meta={}),e.meta.tc=this.track_changes_id_seeds.inflight),this.socket.emit("applyOtUpdate",this.doc_id,e,(e=>{null!=e&&this.handleError(e)}))),state:"ok",id:this.socket.publicId},this._doc=new h.J(this.connection,this.doc_id,{type:l}),this._doc.setFlushDelay(2e3),this._doc.on("change",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[3]||i.pendingOpCreatedAt||(d.$.log("set pendingOpCreatedAt",new Date),i.pendingOpCreatedAt=performance.now()),i.trigger("change",...t)})),this.editorWatchdogManager=new m({parent:o}),this._doc.on("acknowledge",(()=>(this.lastAcked=performance.now(),this.inflightOpCreatedAt=null,d.$.log("unset inflightOpCreatedAt"),this.editorWatchdogManager.onAck(),this.trigger("acknowledge")))),this._doc.on("remoteop",(function(){i._doc.setFlushDelay(500);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.trigger("remoteop",...t)})),this._doc.on("flipped_pending_to_inflight",(()=>(this.inflightOpCreatedAt=this.pendingOpCreatedAt,d.$.log("set inflightOpCreatedAt from pendingOpCreatedAt"),this.pendingOpCreatedAt=null,d.$.log("unset pendingOpCreatedAt"),this.trigger("flipped_pending_to_inflight")))),this._doc.on("saved",(()=>this.trigger("saved"))),this._doc.on("error",(e=>this.handleError(e))),this.bindToDocChanges(this._doc),this.processUpdateFromServer({open:!0,v:n,snapshot:c}),this.removeCarriageReturnCharFromShareJsDoc()}removeCarriageReturnCharFromShareJsDoc(){const e=this._doc;let t;for(;-1!==(t=e.getText().indexOf("\r"));)d.$.log("[ShareJsDoc] remove-carriage-return-char",t),e.del(t,1)}submitOp(e){this._doc.submitOp(e)}isAheadOfExpectedVersion(e){return this._doc.version>0&&e.v>this._doc.version}pushOntoQueue(e){d.$.log(`[processUpdate] push onto queue ${e.v}`),this.queuedMessageTimer||(this.queuedMessageTimer=window.setTimeout((()=>{d.$.log(`[processUpdate] queue timeout fired for ${e.v}`),this.processUpdateFromServer(e)}),5e3)),this.queuedMessages.push(e),this.queuedMessages.sort((function(e,t){return e.v-t.v}))}clearQueue(){this.queuedMessages=[]}processQueue(){if(this.queuedMessages.length>0){const e=this.queuedMessages[0].v;if(e>this._doc.version);else{d.$.log(`[processUpdate] taken from queue ${e}`);const t=this.queuedMessages.shift();t&&this.processUpdateFromServerInOrder(t),0===this.queuedMessages.length&&this.queuedMessageTimer&&(d.$.log("[processUpdate] queue is empty, cleared timeout"),window.clearTimeout(this.queuedMessageTimer),this.queuedMessageTimer=null)}}}processUpdateFromServerInOrder(e){if(this.isAheadOfExpectedVersion(e))return void this.pushOntoQueue(e);const t=this.processUpdateFromServer(e);t instanceof Error&&"Invalid version from server"===t.message?this.clearQueue():this.processQueue()}processUpdateFromServer(e){try{this._doc._onMessage(e)}catch(e){return d.$.log(e),this.handleError(e),e}if("external"===e.meta?.type)return this.trigger("externalUpdate",e)}catchUp(e){return e.map((e=>(e.v=this._doc.version,e.doc=this.doc_id,this.processUpdateFromServer(e))))}getSnapshot(){return this._doc.getText()}getVersion(){return this._doc.version}getTimeSinceLastServerActivity(){return Math.floor(performance.now()-this._doc.lastServerActivity)}getType(){return this.type}clearInflightAndPendingOps(){return this.clearFatalTimeoutTimer(),this._doc.inflightOp=null,this._doc.inflightCallbacks=[],this._doc.pendingOp=null,this._doc.pendingCallbacks=[]}flushPendingOps(){return this._doc.flush()}updateConnectionState(e){d.$.log(`[updateConnectionState] Setting state to ${e}`),this.connection.state=e,this.connection.id=this.socket.publicId,this._doc.autoOpen=!1,this._doc._connectionStateChanged(e),this.lastAcked=null}hasBufferedOps(){return null!=this._doc.inflightOp||null!=this._doc.pendingOp}getInflightOp(){return this._doc.inflightOp}getPendingOp(){return this._doc.pendingOp}getRecentAck(){return null!==this.lastAcked&&performance.now()-this.lastAcked<4e3}getInflightOpCreatedAt(){return this.inflightOpCreatedAt}getPendingOpCreatedAt(){return this.pendingOpCreatedAt}attachEditorWatchdogManager(e){this.detachEditorWatchdogManager=this.editorWatchdogManager.attachToEditor(e)}attachToEditor(e,t){this.attachEditorWatchdogManager(e),t()}maybeDetachEditorWatchdogManager(){this.detachEditorWatchdogManager&&(this.detachEditorWatchdogManager(),this.detachEditorWatchdogManager=null)}attachToCM6(e){this.attachToEditor(e,(()=>{e.attachShareJs(this._doc,(0,f.A)("ol-maxDocLength"))}))}detachFromCM6(){this.maybeDetachEditorWatchdogManager(),this._doc.detach_cm6&&this._doc.detach_cm6()}startInflightOpTimeout(e){this.startFatalTimeoutTimer(e);const t=()=>{if(d.$.log("[inflightOpTimeout] Trying op again"),null!=this._doc.inflightOp){if(e.dupIfSource=[this.connection.id,...Array.from(this._doc.inflightSubmittedIds)],"ok"===this.connection.state)return d.$.log("[inflightOpTimeout] Sending"),this.connection.send(e);d.$.log("[inflightOpTimeout] Not connected, retrying in 0.5s"),window.setTimeout(t,500)}},n=window.setTimeout(t,5e3);return this._doc.inflightCallbacks.push((()=>{this.clearFatalTimeoutTimer(),window.clearTimeout(n)}))}startFatalTimeoutTimer(e){if(null==this._timeoutTimer)return this._timeoutTimer=window.setTimeout((()=>(this.clearFatalTimeoutTimer(),this.trigger("op:timeout",e))),45e3)}clearFatalTimeoutTimer(){if(null!=this._timeoutTimer)return clearTimeout(this._timeoutTimer),this._timeoutTimer=null}handleError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.trigger("error",e,t)}bindToDocChanges(e){const{submitOp:t}=e;e.submitOp=(n,r)=>(function(){const e=(0,f.A)("ol-project_id");(0,o.v4)("document-first-change",{projectId:e,isSmallDevice:o.mP})}(),this.trigger("op:sent",n),e.pendingCallbacks.push((()=>this.trigger("op:acknowledged",n))),t.call(e,n,r));const{flush:n}=e;e.flush=()=>(this.trigger("flush",e.inflightOp,e.pendingOp,e.version),n.call(e))}}var y=n(72607),x=n(37603),k=n.n(x);function C(e){return e.reduce(((e,t)=>e+function(e){return(0,y.Tb)(e)?e.i.length:(0,y.XQ)(e)?e.d.length:0}(t)),0)}class E extends l.A{wantToBeJoined=!1;chaosMonkeyTimer=null;track_changes_as=null;joinCallbacks=[];leaveCallbacks=[];joined=!1;docName="";constructor(e,t,n,r,o){super(),this.doc_id=e,this.socket=t,this.globalEditorWatchdogManager=n,this.ideEventEmitter=r,this.detachDoc=o,this.connected=this.socket.socket.connected,this.bindToEditorEvents(),this.bindToSocketEvents()}attachToCM6(e){this.cm6=e,this.doc&&this.doc.attachToCM6(this.cm6),this.cm6.on("change",this.checkConsistency)}detachFromCM6(){this.doc&&this.doc.detachFromCM6(),this.cm6&&this.cm6.off("change",this.checkConsistency),delete this.cm6,this.clearChaosMonkey(),this.doc&&this.ideEventEmitter.emit("document:closed",this.doc)}submitOp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.doc?.submitOp(t)}checkConsistency=e=>{window.setTimeout((()=>{const t=e?.getValue(),n=this.doc?.getSnapshot();if(t!==n)return this.onError(new Error("Editor text does not match server text"),{},t)}),0)};getSnapshot(){return this.doc?.getSnapshot()}getType(){return this.doc?.getType()}getInflightOp(){return this.doc?.getInflightOp()}getPendingOp(){return this.doc?.getPendingOp()}getRecentAck(){return this.doc?.getRecentAck()}getInflightOpCreatedAt(){return this.doc?.getInflightOpCreatedAt()}getPendingOpCreatedAt(){return this.doc?.getPendingOpCreatedAt()}hasBufferedOps(){return this.doc?.hasBufferedOps()}setTrackingChanges(e){this.doc&&(this.doc.track_changes=e)}getTrackingChanges(){return!!this.doc?.track_changes}setTrackChangesIdSeeds(e){this.doc&&(this.doc.track_changes_id_seeds=e)}onUpdateAppliedHandler=e=>this.onUpdateApplied(e);onErrorHandler=(e,t)=>{t.doc_id===this.doc_id&&this.onError(e,t)};onDisconnectHandler=()=>this.onDisconnect();bindToSocketEvents(){return this.socket.on("otUpdateApplied",this.onUpdateAppliedHandler),this.socket.on("otUpdateError",this.onErrorHandler),this.socket.on("disconnect",this.onDisconnectHandler)}unBindFromSocketEvents(){return this.socket.removeListener("otUpdateApplied",this.onUpdateAppliedHandler),this.socket.removeListener("otUpdateError",this.onErrorHandler),this.socket.removeListener("disconnect",this.onDisconnectHandler)}bindToEditorEvents(){this.ideEventEmitter.on("project:joined",this.onReconnect)}unBindFromEditorEvents(){this.ideEventEmitter.off("project:joined",this.onReconnect)}leaveAndCleanUp(e){return this.leave((t=>{this.cleanUp(),e&&e(t)}))}leaveAndCleanUpPromise(){return new Promise(((e,t)=>{this.leaveAndCleanUp((n=>{n?t(n):e()}))}))}join(e){this.wantToBeJoined=!0,this.cancelLeave(),this.connected?this.joinDoc(e):e&&this.joinCallbacks.push(e)}leave(e){this.flush(),this.wantToBeJoined=!1,this.cancelJoin(),this.doc?.hasBufferedOps()?(d.$.log("[leave] Doc has buffered ops, pushing callback for later"),e&&this.leaveCallbacks.push(e)):this.connected?(d.$.log("[leave] Leaving now"),this.leaveDoc(e)):(d.$.log("[leave] Not connected, returning now"),e?.())}flush(){return this.doc?.flushPendingOps()}chaosMonkey(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"a";const n=t;let r=null,o=0;const s=()=>{null!=r&&r.length||(r=n.slice()+" "+new Date+"\n",e+=Math.random()>.1?1:-2,e<0&&(e=0),o=0),t=r[0],r=r.slice(1),this.cm6&&this.cm6.view.dispatch({changes:{from:Math.min(o,this.cm6.view.state.doc.length),insert:t}}),o+=1,this.chaosMonkeyTimer=window.setTimeout(s,100+(Math.random()<.1?1e3:0))};s()}clearChaosMonkey(){const e=this.chaosMonkeyTimer;e&&(this.chaosMonkeyTimer=null,window.clearTimeout(e))}pollSavedStatus(){let e;const t=this.getInflightOp(),n=this.getPendingOp(),r=this.getRecentAck(),o=n?C(n):0;return null==t&&null==n?(e=!0,d.$.log("[pollSavedStatus] no inflight or pending ops")):t&&t===this.oldInflightOp?(e=!1,d.$.log("[pollSavedStatus] inflight op is same as before")):null!=n&&r&&o<64?(e=!0,d.$.log("[pollSavedStatus] pending op (small with recent ack) assume ok",n,o)):(e=!1,d.$.log(`[pollSavedStatus] assuming not saved (inflightOp?: ${null!=t}, pendingOp?: ${null!=n})`)),this.oldInflightOp=t,e}cancelLeave(){this.leaveCallbacks=[]}cancelJoin(){this.joinCallbacks=[]}onUpdateApplied(e){if(e?.doc===this.doc_id&&null!=this.doc&&(this.doc.processUpdateFromServerInOrder(e),!this.wantToBeJoined))return this.leave()}onDisconnect(){return d.$.log("[onDisconnect] disconnecting"),this.connected=!1,this.joined=!1,null!=this.doc?this.doc.updateConnectionState("disconnected"):void 0}onReconnect=()=>{d.$.log("[onReconnect] reconnected (joined project)"),this.connected=!0,(this.wantToBeJoined||this.doc?.hasBufferedOps())&&(d.$.log(`[onReconnect] Rejoining (wantToBeJoined: ${this.wantToBeJoined} OR hasBufferedOps: ${this.doc?.hasBufferedOps()})`),this.joinDoc((e=>{e?this.onError(e):(this.doc?.updateConnectionState("ok"),this.doc?.flushPendingOps(),this.callJoinCallbacks())})))};callJoinCallbacks(){for(const e of this.joinCallbacks)e();this.joinCallbacks=[]}joinDoc(e){var t=this;if(this.doc)return this.socket.emit("joinDoc",this.doc_id,this.doc.getVersion(),{encodeRanges:!0,age:this.doc.getTimeSinceLastServerActivity(),supportsHistoryV1OT:!0},(function(n,r,o,s,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"sharejs-text-ot";if(n)e?.(n);else{if(t.joined=!0,t.doc?.catchUp(s),t.doc?.getType()!==a)throw new(k())("ot type mismatch",{got:a,want:t.doc?.getType()});"sharejs-text-ot"===a&&(t.decodeRanges(i),t.catchUpRanges(i?.changes,i?.comments)),e?.()}}));this.socket.emit("joinDoc",this.doc_id,{encodeRanges:!0,supportsHistoryV1OT:!0},(function(n,r,o,s,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"sharejs-text-ot";n?e?.(n):(t.joined=!0,t.doc=new b(t.doc_id,r,o,t.socket,t.globalEditorWatchdogManager,t.ideEventEmitter,a),"sharejs-text-ot"===a&&t.decodeRanges(i),t.ranges=new(c())(i?.changes,i?.comments),t.bindToShareJsDocEvents(),e?.())}))}decodeRanges(e){try{if(e.changes)for(const t of e.changes)(0,y.Tb)(t.op)&&(t.op.i=u(t.op.i)),(0,y.XQ)(t.op)&&(t.op.d=u(t.op.d));return e.comments?e.comments.map((e=>null!=e.op.c?e.op.c=u(e.op.c):void 0)):[]}catch(e){d.$.error(e)}}leaveDoc(e){d.$.log("[leaveDoc] Sending leaveDoc request"),this.socket.emit("leaveDoc",this.doc_id,(t=>{if(t)e?.(t);else{this.joined=!1;for(const e of this.leaveCallbacks)d.$.log("[_leaveDoc] Calling buffered callback",e),e(t);this.leaveCallbacks=[],e?.()}}))}cleanUp(){this.hasBufferedOps()?d.$.log(`[cleanUp] Document (${this.doc_id}) has buffered ops, refusing to remove from openDocs`):(this.detachDoc(this.doc_id,this),this.unBindFromEditorEvents(),this.unBindFromSocketEvents())}bindToShareJsDocEvents(){var e=this;if(!this.doc)return;this.doc.on("error",((e,t)=>this.onError(e,t))),this.doc.on("externalUpdate",(e=>this.trigger("externalUpdate",e))),this.doc.on("remoteop",(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.trigger("remoteop",...n)})),this.doc.on("op:sent",(e=>this.trigger("op:sent"))),this.doc.on("op:acknowledged",(e=>(this.ideEventEmitter.emit("ide:opAcknowledged",{doc_id:this.doc_id,op:e}),this.trigger("op:acknowledged")))),this.doc.on("op:timeout",(e=>(this.trigger("op:timeout"),this.onError(new Error("op timed out")))));let t,n=null;this.doc.on("change",((e,t,r)=>{"sharejs-text-ot"===this.getType()&&this.applyOpsToRanges(e,r),n&&window.clearTimeout(n),n=window.setTimeout((()=>{e.some(y.E0)&&(window.dispatchEvent(new CustomEvent("doc:changed",{detail:{id:this.doc_id}})),this.ideEventEmitter.emit("doc:changed",{doc_id:this.doc_id}))}),50)})),this.doc.on("flipped_pending_to_inflight",(()=>this.trigger("flipped_pending_to_inflight"))),this.doc.on("saved",(()=>{t&&window.clearTimeout(t),t=window.setTimeout((()=>{window.dispatchEvent(new CustomEvent("doc:saved",{detail:{id:this.doc_id}})),this.ideEventEmitter.emit("doc:saved",{doc_id:this.doc_id})}),50)}))}onError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;t.doc_id=this.doc_id,d.$.log("ShareJS error",e,t),"no project_id found on client"!==e.message?(this.doc&&this.doc.clearInflightAndPendingOps(),this.trigger("error",e,t,n),this.cleanUp()):d.$.log("ignoring error, will wait to join project")}applyOpsToRanges(e,t){let n,r=null;const o=null!=t;o&&t?.meta.tc?(n=this.ranges.getIdSeed(),this.ranges.setIdSeed(t.meta.tc),r=t.meta.user_id):o||null==this.track_changes_as||(r=this.track_changes_as),this.ranges.track_changes=null!=r;for(const t of this.filterOps(e))this.ranges.applyOp(t,{user_id:r});return null!=n&&this.ranges.setIdSeed(n),o?window.setTimeout((()=>this.emit("ranges:dirty"))):this.emit("ranges:dirty")}catchUpRanges(e,t){null==e&&(e=[]),null==t&&(t=[]),this.emit("ranges:clear"),this.ranges.changes=e,this.ranges.comments=t,this.ranges.track_changes=this.doc?.track_changes??!1;for(const e of this.filterOps(this.doc?.getInflightOp()||[]))this.ranges.setIdSeed(this.doc?.track_changes_id_seeds?.inflight),this.ranges.applyOp(e,{user_id:this.track_changes_as});for(const e of this.filterOps(this.doc?.getPendingOp()||[]))this.ranges.setIdSeed(this.doc?.track_changes_id_seeds?.pending),this.ranges.applyOp(e,{user_id:this.track_changes_as});return this.emit("ranges:redraw")}filterOps(e){return(0,f.A)("ol-isRestrictedTokenMember")?e.filter((e=>!(0,y.H8)(e))):e}}class T{openDocs=(()=>new Map)();constructor(e,t,n){this.socket=e,this.globalEditorWatchdogManager=t,this.events=n}getDocument(e){return this.openDocs.has(e)&&(d.$.log(`[getDocument] Cleaning up existing document instance for ${e}`),this.openDocs.get(e)?.cleanUp()),this.openDocs.has(e)?d.$.log(`[getDocument] Returning existing document instance for ${e}`):(d.$.log(`[getDocument] Creating new document instance for ${e}`),this.createDoc(e)),this.openDocs.get(e)}createDoc(e){const t=new E(e,this.socket,this.globalEditorWatchdogManager,this.events,this.detachDoc.bind(this));this.openDocs.set(e,t)}detachDoc(e,t){this.openDocs.get(e)===t?(d.$.log(`[detach] Removing document with ID (${e}) from openDocs`),this.openDocs.delete(e)):d.$.log(`[_cleanUp] New instance of (${e}) created. Not removing`)}hasUnsavedChanges(){for(const e of this.openDocs.values())if(e.hasBufferedOps())return!0;return!1}flushAll(){for(const e of this.openDocs.values())e.flush()}unsavedDocs(){const e=[];for(const t of this.openDocs.values())t.pollSavedStatus()||e.push(t);return e}async awaitBufferedOps(e){if(this.hasUnsavedChanges()){const{promise:t,resolve:n}=Promise.withResolvers();let r=!1;const o=()=>{this.hasUnsavedChanges()||(d.$.log("saved"),window.removeEventListener("doc:saved",o),r=!0,n())};window.addEventListener("doc:saved",o),e.addEventListener("abort",(()=>{r||(d.$.log("aborted"),window.removeEventListener("doc:saved",o),n())})),this.flushAll(),await t}}}var j=n(13271),I=n(16896),S=n(56447),A=n(60440),L=n(41479),O=n(37766),R=n(83096),P=n(97434),M=n(37664),F=n(89139),D=n(29755);const N=(e,t)=>{const n=(0,r.useRef)(null),o=(0,r.useRef)(null),s=(0,r.useRef)({});(0,r.useEffect)((()=>{n.current=t}),[t]),(0,r.useEffect)((()=>{o.current=e}),[e]);const i=(0,r.useMemo)((()=>async()=>await async function(e,t,n){if(d.$.debug("tryGetDiffSize"),!t)return d.$.debug("tryGetDiffSize: missing projectId"),null;if(!e)return d.$.debug("tryGetDiffSize: missing currentContents"),null;if(!n)return d.$.debug("tryGetDiffSize: missing docId"),null;try{const r=await fetch(`/Project/${t}/doc/${n}/download`,{signal:AbortSignal.timeout(5e3)}),o=await r.text(),s=(0,D.JJ)(o,e);let i=0;for(const e of s)(e.added||e.removed)&&(i+=e.value.length);return i}catch{return d.$.debug("tryGetDiffSize: fetch failed"),null}}(n.current?.getSnapshot(),o.current,n.current?.doc_id)),[]);return{createDebugDiff:i,debugTimers:s}};var X=n(10646),$=n(76113),U=n(39891),V=n(31085);const B=(0,r.createContext)(void 0),H=e=>{let{children:t}=e;const{t:n}=(0,P.Bd)(),{scopeStore:a}=(0,i.nK)(),{reportError:c,eventEmitter:l,projectId:h}=(0,j.yn)(),{setOutOfSync:u}=(0,X.mi)(),{socket:p,closeConnection:g,connectionState:f}=(0,I.FX)(),{view:_,setView:w}=(0,S.LV)(),{showGenericMessageModal:v,genericModalVisible:b,showOutOfSyncModal:y}=(0,R.T)(),[x,k]=(0,s.A)("editor.showSymbolPalette"),[C]=(0,s.A)("editor.showVisual"),[E,D]=(0,s.A)("editor.sharejs_doc"),[H,W]=(0,s.A)("editor.open_doc_id"),[z,J]=(0,s.A)("editor.open_doc_name"),[q,K]=(0,s.A)("editor.opening"),[G,Y]=(0,s.A)("editor.error_state"),[Q,Z]=(0,s.A)("editor.trackChanges"),[ee,te]=(0,s.A)("editor.wantTrackChanges"),ne=(0,r.useRef)(ee);(0,r.useEffect)((()=>{ne.current=ee}),[ee]);const re=(0,O.A)("editor:gotoLine"),{fileTreeData:oe}=(0,A.Q)(),[se,ie]=(0,r.useState)(!1),{createDebugDiff:ae,debugTimers:ce}=N(h,E),[le]=(0,r.useState)((()=>new m({onTimeoutHandler:e=>{let t=null;ae().then((e=>{t=e})).finally((()=>{(0,o._)("losing-edits",{...e,diffSize:t,timers:ce.current}),c("losing-edits",{...e,diffSize:t,timers:ce.current})}))}}))),[he,de]=(0,r.useState)(null),[ue,pe]=(0,r.useState)(!1);(0,r.useEffect)((()=>{b||pe(!1)}),[b]);const[ge]=(0,r.useState)((()=>new T(p,le,l))),me=`doc.open_id.${h}`;(0,r.useEffect)((()=>{H&&M.A.setItem(me,H)}),[H,me]);const fe=(0,r.useRef)(0);(0,r.useEffect)((()=>{a.set("editor.toggleSymbolPalette",(()=>{k((e=>{const t=!e;return(0,o._)(t?"symbol-palette-show":"symbol-palette-hide"),t}))}))}),[a,k]);const _e=(0,r.useCallback)((()=>E?C?"cm6-rich-text":"cm6":null),[E,C]),we=(0,r.useCallback)((()=>E?.getSnapshot()??null),[E]),ve=(0,r.useCallback)((()=>H),[H]),be=(0,r.useCallback)((e=>{re(e)}),[re]),ye=(0,r.useCallback)(((e,t)=>{t.on("error",((n,r,o)=>{de({doc:e,document:t,error:n,meta:r,editorContent:o})}))}),[]),xe=(0,r.useRef)(se);(0,r.useEffect)((()=>{xe.current=se}),[se]);const ke=(0,r.useCallback)(((e,t)=>{ye(e,t),t.on("externalUpdate",(e=>{xe.current||"external"===e.meta.type&&"git-bridge"===e.meta.source||"file-restore"!==e.meta.origin?.kind&&"project-restore"!==e.meta.origin?.kind&&v(n("document_updated_externally"),n("document_updated_externally_detail"))}))}),[ye,v,n]),Ce=(0,r.useRef)(null),Ee=(0,r.useCallback)((e=>{if(!e)return;Ce.current&&(window.clearTimeout(Ce.current),Ce.current=null);const t=ne.current,n=e.getTrackingChanges();if(t===n)return void Z(t);const r=()=>{null==e.getInflightOp()&&null==e.getPendingOp()?(e.setTrackingChanges(t),Z(t)):Ce.current=window.setTimeout(r,100)};r()}),[Z]),Te=(0,r.useCallback)((e=>new Promise(((t,n)=>{d.$.log("[doOpenNewDocument] Opening...");const r=ge.getDocument(e._id);if(!r)return d.$.error(`No open document with ID '${e._id}' found`),void n(new Error("no open document found"));const o=++fe.current;r.join((s=>s?(d.$.log(`[doOpenNewDocument] error joining doc ${e._id}`,s),void n(s)):fe.current!==o?(d.$.log(`[doOpenNewDocument] editorOpenDocEpoch mismatch ${fe.current} vs ${o}`),r.leaveAndCleanUp(),void n(new Error("another document was loaded"))):(ke(e,r),void t(r))))}))),[ke,ge]),je=(0,r.useCallback)((async e=>{const t=E?.doc_id,n=E&&E.hasBufferedOps();if(E&&t!==e._id||n){d.$.log("[openNewDocument] Leaving existing open doc..."),E.off(),ye(e,E);const n=++fe.current;try{await E.leaveAndCleanUpPromise()}catch(e){throw d.$.log(`[openNewDocument] error leaving doc ${t}`,e),e}if(fe.current!==n)throw d.$.log(`[openNewDocument] editorOpenDocEpoch mismatch ${fe.current} vs ${n}`),new Error("another document was loaded")}return Te(e)}),[ye,Te,E]),Ie=(0,r.useRef)(H);(0,r.useEffect)((()=>{Ie.current=H}),[H]);const Se=(0,r.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d.$.log(`[openDoc] Opening ${e._id}`);const{promise:r,resolve:o,reject:s}=Promise.withResolvers();"editor"===_&&l.emit("store-doc-position"),t.keepCurrentView||w("editor");const i=n=>{window.dispatchEvent(new CustomEvent("doc:after-opened",{detail:{isNewDoc:n,docId:e._id}})),window.dispatchEvent(new CustomEvent("entity:opened",{detail:e._id})),!function(e){return"number"==typeof e.gotoLine}(t)?function(e){return"number"==typeof e.gotoOffset}(t)&&window.setTimeout((()=>{l.emit("editor:gotoOffset",t)})):(window.setTimeout((()=>be(t))),n&&window.addEventListener("editor:scroll-position-restored",(()=>be(t)),{once:!0})),o(e)};if(e._id!==Ie.current||t.forceReopen){Ie.current=e._id,W(e._id),J(e.name),K(!0);try{const t=await je(e);Ee(t),K(!1),D(t),i(!0)}catch(t){if("another document was loaded"===t?.message)return void d.$.log(`[openDoc] another document was loaded while ${e._id} was loading`);d.$.error("Error opening document",t),v(n("error_opening_document"),n("error_opening_document_detail")),s(t)}return r}i(!1)}),[l,be,je,D,W,J,K,w,v,Ee,n,_]),Ae=(0,r.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=(0,L.p)(oe,e);n&&Se(n,t)}),[oe,Se]),[,Le]=(0,$.A)("openFile"),Oe=(0,r.useCallback)((e=>{const t=(0,L.i)(oe,e);t&&(Le((0,U.D)(t)),window.dispatchEvent(new CustomEvent("entity:opened",{detail:t._id})))}),[oe,Le]),Re=(0,r.useCallback)((e=>{const t=M.A.getItem(me)||e;t&&Ae(t)}),[me,Ae]);(0,r.useEffect)((()=>{if(he){const{doc:e,document:t,error:r,meta:o}=he;let{editorContent:s}=he;const i="string"==typeof r?r:r?.message??"";if(de(null),i.includes("maxDocLength")){Se(e,{forceReopen:!0});const r=null!=t.ranges&&t.ranges.changes.some((e=>"d"in e.op))?`${n("document_too_long_detail")} ${n("document_too_long_tracked_deletes")}`:n("document_too_long_detail");v(n("document_too_long"),r),pe(!0)}else if(/too many comments or tracked changes/.test(i))v(n("too_many_comments_or_tracked_changes"),n("too_many_comments_or_tracked_changes_detail"));else if(!ue)return t.off("error"),s="string"==typeof s?s:t.getSnapshot(),t.doc&&t.doc.clearInflightAndPendingOps(),t.leaveAndCleanUp(),g("out-of-sync"),c(r,o),Y(!0),u(!0),void y(s||"");const a=()=>{Se(e,{forceReopen:!0})};return l.once("project:joined",a),()=>{l.off("project:joined",a)}}}),[g,he,ue,l,Se,c,Y,v,y,u,n]),(0,F.A)("editor:insert-symbol",(0,r.useCallback)((()=>{(0,o._)("symbol-palette-insert")}),[])),(0,F.A)("blur",(0,r.useCallback)((()=>{ge.flushAll()}),[ge])),(0,r.useEffect)((()=>{f.forceDisconnected&&ge.flushAll()}),[f.forceDisconnected,ge]);const Pe=(0,r.useRef)(ee);(0,r.useEffect)((()=>{E&&ee!==Pe.current&&(Pe.current=ee,Ee(E))}),[E,Ee,ee]);const Me=Boolean((!E||q)&&!G&&H),Fe=(0,r.useMemo)((()=>({getEditorType:_e,showSymbolPalette:x,currentDocument:E,currentDocumentId:H,getCurrentDocValue:we,getCurrentDocumentId:ve,setIgnoringExternalUpdates:ie,openDocWithId:Ae,openDoc:Se,openDocs:ge,openDocName:z,setOpenDocName:J,trackChanges:Q,isLoading:Me,openFileWithId:Oe,openInitialDoc:Re,jumpToLine:be,wantTrackChanges:ee,setWantTrackChanges:te,debugTimers:ce})),[_e,x,E,H,we,ve,ie,Ae,Se,ge,Oe,Re,z,J,Q,Me,be,ee,te,ce]);return(0,V.jsx)(B.Provider,{value:Fe,children:t})};function W(){const e=(0,r.useContext)(B);if(!e)throw new Error("useEditorManagerContext is only available inside EditorManagerProvider");return e}},69139:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});n(61412),n(91883),n(70286);function r(e){return function(e,t){let n=e.pathname.replace(/\/(detached|detacher)\/?$/,"").replace(/\/$/,"");t&&(n+=`/${t}`);return e.pathname=n,e}(new URL(window.location.href),e)}},70569:(e,t,n)=>{"use strict";n.d(t,{S:()=>c,h:()=>l});n(97107);var r=n(79184),o=n(89139),s=n(14041),i=n(31085);const a=(0,s.createContext)(void 0),c=e=>{let{children:t}=e;const[n,c]=(0,s.useState)(!0),[l,h]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null),p=(0,s.useCallback)((e=>{u(e)}),[]),g=(0,s.useRef)(null);(0,r.A)(n,g);const m=(0,s.useCallback)((()=>{c((e=>!e))}),[]),f=(0,s.useCallback)((()=>{c(!0)}),[]),_=(0,s.useCallback)((()=>{c(!1)}),[]),[w,v]=(0,s.useState)("file-tree"),b=(0,s.useCallback)((e=>{v(e),c(!0)}),[c,v]);(0,o.A)("ui.toggle-review-panel",(0,s.useCallback)((()=>{n&&"review-panel"===w?_():b("review-panel")}),[_,w,n,b]));const y=(0,s.useMemo)((()=>({selectedTab:w,isOpen:n,setIsOpen:c,panelRef:g,togglePane:m,handlePaneExpand:f,handlePaneCollapse:_,resizing:l,setResizing:h,activeModal:d,setActiveModal:p,openTab:b})),[w,n,c,g,m,f,_,l,h,d,p,b]);return(0,i.jsx)(a.Provider,{value:y,children:t})},l=()=>{const e=(0,s.useContext)(a);if(!e)throw new Error("useRailContext is only available inside RailProvider");return e}},70915:(e,t,n)=>{"use strict";n.d(t,{e:()=>o});n(82438),n(34840);const r=/^[^%]*\\documentclass/,o=e=>e.split("\n").some((e=>r.test(e)))},71606:(e,t,n)=>{"use strict";n.d(t,{H:()=>r,P:()=>o});const r=new Map([["\\includegraphics",{name:"graphicx",command:"\\usepackage{graphicx}"}],["\\toprule",{name:"booktabs",command:"\\usepackage{booktabs}"}],["\\midrule",{name:"booktabs",command:"\\usepackage{booktabs}"}],["\\bottomrule",{name:"booktabs",command:"\\usepackage{booktabs}"}],["\\cmidrule",{name:"booktabs",command:"\\usepackage{booktabs}"}],["\\multirow",{name:"multirow",command:"\\usepackage{multirow}"}],["\\justifying",{name:"ragged2e",command:"\\usepackage{ragged2e}"}],["\\tag",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\notag",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\text",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\boldsymbol",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\eqref",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\iint",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\iiint",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\nmid",{name:"amssymb",command:"\\usepackage{amssymb}"}],["\\varnothing",{name:"amssymb",command:"\\usepackage{amssymb}"}],["\\Box",{name:"amssymb",command:"\\usepackage{amssymb}"}],["\\citep",{name:"natbib",command:"\\usepackage{natbib}"}],["\\citet",{name:"natbib",command:"\\usepackage{natbib}"}],["\\citepalias",{name:"natbib",command:"\\usepackage{natbib}"}],["\\citetalias",{name:"natbib",command:"\\usepackage{natbib}"}],["\\url",{name:"url",command:"\\usepackage{url}"}],["\\href",{name:"hyperref",command:"\\usepackage{hyperref}"}],["\\texorpdfstring",{name:"hyperref",command:"\\usepackage{hyperref}"}],["\\phantomsection",{name:"hyperref",command:"\\usepackage{hyperref}"}],["\\arraybackslash",{name:"array",command:"\\usepackage{array}"}]]),o=new Map([["justify",{name:"ragged2e",command:"\\usepackage{ragged2e}"}],["align",{name:"amsmath",command:"\\usepackage{amsmath}"}],["align*",{name:"amsmath",command:"\\usepackage{amsmath}"}],["split",{name:"amsmath",command:"\\usepackage{amsmath}"}],["gather",{name:"amsmath",command:"\\usepackage{amsmath}"}],["cases",{name:"amsmath",command:"\\usepackage{amsmath}"}],["matrix",{name:"amsmath",command:"\\usepackage{amsmath}"}],["pmatrix",{name:"amsmath",command:"\\usepackage{amsmath}"}],["bmatrix",{name:"amsmath",command:"\\usepackage{amsmath}"}],["subequations",{name:"amsmath",command:"\\usepackage{amsmath}"}]])},71879:(e,t,n)=>{"use strict";n(57182);"function"!=typeof AbortSignal.timeout&&(AbortSignal.timeout=e=>{const t=new AbortController;t.signal.addEventListener("abort",(function e(){window.clearTimeout(n),t.signal.removeEventListener("abort",e)}));const n=window.setTimeout((function(){t.abort(new DOMException("Timed out","TimeoutError"))}),e);return t.signal}),"function"!=typeof AbortSignal.any&&(AbortSignal.any=e=>{const t=new AbortController;for(const n of e)if(n.aborted)return t.abort(n.reason),t.signal;function n(){t.abort(),function(){for(const t of e)t.removeEventListener("abort",n)}()}for(const t of e)t.addEventListener("abort",n);return t.signal})},72607:(e,t,n)=>{"use strict";n.d(t,{A8:()=>l,E0:()=>i,H8:()=>o,Tb:()=>r,XQ:()=>s,YL:()=>a,sm:()=>c});const r=e=>"i"in e,o=e=>"c"in e,s=e=>"d"in e,i=e=>r(e)||s(e),a=e=>r(e.op),c=e=>s(e.op),l=e=>o(e)?e.c.length:r(e)?e.i.length:0},73208:(e,t,n)=>{n(97107),n(82438),n(12266),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539);class r{constructor(e,t){null==e&&(e=[]),this.changes=e,null==t&&(t=[]),this.comments=t,this.track_changes=!1,this.id_seed=r.generateIdSeed(),this.id_increment=0,this._dirtyState={comment:{moved:{},removed:{},added:{}},change:{moved:{},removed:{},added:{}}}}getIdSeed(){return this.id_seed}setIdSeed(e){this.id_seed=e,this.id_increment=0}static generateIdSeed(){const e=Math.floor(32767*Math.random()).toString(16),t=Math.floor(16777216*Math.random()).toString(16),n=Math.floor((new Date).valueOf()/1e3).toString(16);return"00000000".substr(0,8-n.length)+n+"000000".substr(0,6-t.length)+t+"0000".substr(0,4-e.length)+e}static generateId(){return this.generateIdSeed()+"000001"}newId(){this.id_increment++;const e=this.id_increment.toString(16);return this.id_seed+"000000".substr(0,6-e.length)+e}getComment(e){let t=null;for(const n of this.comments)if(n.id===e){t=n;break}return t}removeCommentId(e){const t=this.getComment(e);null!=t&&(this.comments=this.comments.filter((t=>t.id!==e)),this._markAsDirty(t,"comment","removed"))}moveCommentId(e,t,n){for(const r of this.comments)r.id===e&&(r.op.p=t,r.op.c=n,this._markAsDirty(r,"comment","moved"))}getChange(e){let t=null;for(const n of this.changes)if(n.id===e){t=n;break}return t}getChanges(e){const t=new Set(e);return this.changes.filter((e=>t.has(e.id)))}removeChangeId(e){this.removeChangeIds([e])}removeChangeIds(e){if(null==e||0===e.length)return;const t=new Set(e),n=[];for(const e of this.changes)t.has(e.id)?this._markAsDirty(e,"change","removed"):n.push(e);this.changes=n}validate(e){let t;for(const n of this.changes)if(null!=n.op.i&&(t=e.slice(n.op.p,n.op.p+n.op.i.length),t!==n.op.i))throw new Error("insertion does not match text in document");for(const n of this.comments)if(t=e.slice(n.op.p,n.op.p+n.op.c.length),t!==n.op.c)throw new Error("comment does not match text in document")}applyOp(e,t){if(null==t&&(t={}),null==t.ts&&(t.ts=new Date),null!=e.i)this.applyInsertToChanges(e,t),this.applyInsertToComments(e);else if(null!=e.d)this.applyDeleteToChanges(e,t),this.applyDeleteToComments(e);else{if(null==e.c)throw new Error("unknown op type");this.addComment(e,t)}}applyOps(e,t){null==t&&(t={});for(const n of e)this.applyOp(n,t)}addComment(e,t){if(null!=this.getComment(e.t))this.moveCommentId(e.t,e.p,e.c);else{let n;this.comments.push(n={id:e.t||this.newId(),op:{c:e.c,p:e.p,t:e.t},metadata:t}),this._markAsDirty(n,"comment","added")}}applyInsertToComments(e){for(const t of this.comments)if(e.p<=t.op.p)t.op.p+=e.i.length,this._markAsDirty(t,"comment","moved");else if(e.p<t.op.p+t.op.c.length){const n=e.p-t.op.p;t.op.c=t.op.c.slice(0,+(n-1)+1||void 0)+e.i+t.op.c.slice(n),this._markAsDirty(t,"comment","moved")}}applyDeleteToComments(e){const t=e.p,n=e.d.length,r=e.p+n;for(const o of this.comments){const s=o.op.p,i=o.op.p+o.op.c.length,a=i-s;if(r<=s)o.op.p-=n,this._markAsDirty(o,"comment","moved");else if(t>=i);else{let n,c;c=t<=s?"":o.op.c.slice(0,t-s),n=r>=i?"":o.op.c.slice(r-s);const l=o.op.c.slice(c.length,a-n.length),h=Math.max(0,s-t);if(l!==e.d.slice(h).slice(0,l.length))throw new Error("deleted content does not match comment content");o.op.p=Math.min(s,t),o.op.c=c+n,this._markAsDirty(o,"comment","moved")}}}applyInsertToChanges(e,t){let n;const r=e.p,o=e.i.length,s=e.p+o,i=!!e.u;let a=!1,c=null;const l=[],h=[],d=[],u=[];for(let p=0;p<this.changes.length;p++){n=this.changes[p];const g=n.op.p;if(null!=n.op.d){if(r<g)n.op.p+=o,l.push(n);else if(r===g)if(!a&&i&&n.op.d.length>=e.i.length&&n.op.d.slice(0,e.i.length)===e.i){n.op.d=n.op.d.slice(e.i.length),n.op.p+=e.i.length,""===n.op.d?h.push(n):l.push(n),a=!0;for(const e of u)e.op.p-=o}else n.op.p+=o,l.push(n),a||u.push(n)}else if(null!=n.op.i){let h;const u=g+n.op.i.length,m=r>=g&&r<=u,f=t.user_id===n.metadata.user_id,_=this.changes[p+1],w=null!=_&&null!=_.op.d&&e.p===u&&_.op.p===e.p,v=i&&w&&_.op.d.slice(0,e.i.length)===e.i,b=null!=c&&null!=c.op.d&&c.op.p===s;if(this.track_changes&&m&&!b&&!a&&!v&&f)h=r-g,n.op.i=n.op.i.slice(0,h)+e.i+n.op.i.slice(h),n.metadata.ts=t.ts,a=!0,l.push(n);else if(r<=g)n.op.p+=o,l.push(n);else if((!f||!this.track_changes)&&g<r&&r<u){h=r-g;const e=n.op.i.slice(0,h),t=n.op.i.slice(h);n.op.i=e,l.push(n);const s={op:{i:t,p:g+h+o},metadata:{}};for(const e in n.metadata){const t=n.metadata[e];s.metadata[e]=t}d.push(s)}}c=n}for({op:e,metadata:t}of(this.track_changes&&!a&&this._addOp(e,t),d))this._addOp(e,t);for(n of h)this._removeChange(n);for(n of l)this._markAsDirty(n,"change","moved")}applyDeleteToChanges(e,t){const n=e.p,r=e.d.length,o=e.p+r,s=[];let i=[];const a=[];for(const t of this.changes){let c;if(null!=t.op.i){c=t.op.p;const l=c+t.op.i.length;if(o<=c)t.op.p-=r,i.push(t);else if(n>=l);else{let r,h,d,u;n>=c?(h="",u=t.op.i.slice(0,n-c)):(h=e.d.slice(0,c-n),u=""),o<=l?(r="",d=t.op.i.slice(o-c)):(r=e.d.slice(l-n),d="");const p=u+d;p.length>0?(t.op.i=p,t.op.p=Math.min(c,n),i.push(t)):s.push(t);const g=e.d.length-h.length-r.length,m=h.length,f={d:e.d.slice(m,m+g),p:m};f.d.length>0&&a.push(f)}}else if(null!=t.op.d)if(c=t.op.p,o<c||!this.track_changes&&o===c)t.op.p-=r,i.push(t);else if(n<=c&&c<=o)if(this.track_changes){const e=c-n;a.push({i:t.op.d,p:e}),s.push(t)}else t.op.p=n,i.push(t)}e={p:e.p,d:this._applyOpModifications(e.d,a)};for(const n of s)e.d.length>0&&null!=n.op.d&&e.p<=n.op.p&&n.op.p<=e.p+e.d.length?(n.op.p=e.p,n.op.d=e.d,n.metadata=t,i.push(n),e.d=""):this._removeChange(n);if(this.track_changes&&e.d.length>0)this._addOp(e,t);else{const e=this._scanAndMergeAdjacentUpdates();i=i.concat(e.movedChanges);for(const t of e.removeChanges)this._removeChange(t),i=i.filter((e=>e!==t))}for(const e of i)this._markAsDirty(e,"change","moved")}_addOp(e,t){e=this._clone(e);const n={id:this.newId(),op:e,metadata:this._clone(t)};this.changes.push(n),this.changes.sort((function(e,t){const n=e.op.p-t.op.p;return 0!==n?n:null!=e.op.i&&null!=t.op.d?1:null!=e.op.d&&null!=t.op.i?-1:0})),this._markAsDirty(n,"change","added")}_removeChange(e){this.changes=this.changes.filter((t=>t!==e)),this._markAsDirty(e,"change","removed")}_applyOpModifications(e,t){t.sort((function(e,t){const n=t.p-e.p;return 0!==n?n:null!=e.i&&null!=t.d?1:null!=e.d&&null!=t.i?-1:0}));for(const n of t)if(null!=n.i)e=e.slice(0,n.p)+n.i+e.slice(n.p);else if(null!=n.d){if(e.slice(n.p,n.p+n.d.length)!==n.d)throw new Error("deletion does not match text in document");e=e.slice(0,n.p)+e.slice(n.p+n.d.length)}return e}_scanAndMergeAdjacentUpdates(){let e=null;const t=[],n=[];for(const r of this.changes)if(null!=e?.op.i&&null!=r.op.i){const o=e.op.p+e.op.i.length,s=e.metadata.user_id,i=r.op.p,a=r.metadata.user_id;o===i&&s===a&&(t.push(r),e.op.i+=r.op.i,n.push(e))}else null!=e?.op.d&&null!=r.op.d&&e?.op.p===r.op.p?(e.op.d+=r.op.d,t.push(r),n.push(e)):e=r;return{movedChanges:n,removeChanges:t}}resetDirtyState(){this._dirtyState={comment:{moved:{},removed:{},added:{}},change:{moved:{},removed:{},added:{}}}}getDirtyState(){return this._dirtyState}getTrackedDeletesLength(){let e=0;for(const t of this.changes)null!=t.op.d&&(e+=t.op.d.length);return e}_markAsDirty(e,t,n){this._dirtyState[t][n][e.id]=e}_clone(e){const t={};for(const n in e){const r=e[n];t[n]=r}return t}}e.exports=r},76113:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(14041),o=n(67353),s=n(45250),i=n.n(s);function a(e,t){const{scopeStore:n}=(0,o.nK)(),[s,a]=(0,r.useState)(t);return[s,(0,r.useCallback)((t=>{a((r=>{const o=i().isFunction(t)?t(r):t;return n.set(e,o),o}))}),[e,n])]}},79184:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(14041);function o(e,t){(0,r.useEffect)((()=>{const n=t.current;n&&(e?n.expand():n.collapse())}),[e,t])}},79600:(e,t,n)=>{"use strict";const r=n(45250),o=n(64347).assert,s=n(37603),i=n(12628),a=n(59622),c=n(14679);class NotEditableError extends s{constructor(){super("File is not editable")}}class l{static EMPTY_FILE_HASH="e69de29bb2d1d6434b8b29ae775ad8c2e48c5391";static NotEditableError=(()=>NotEditableError)();constructor(e,t){o.instance(e,i,"File: bad data"),this.data=e,this.metadata={},this.setMetadata(t||{})}static fromRaw(e){return e?new l(i.fromRaw(e),e.metadata):null}static fromHash(e,t,n){return new l(new a(e,t),n)}static fromString(e,t){return new l(new c(e),t)}static createHollow(e,t,n){return new l(i.createHollow(e,t),n)}static createLazyFromBlobs(e,t,n){return new l(i.createLazyFromBlobs(e,t),n)}toRaw(){const e=this.data.toRaw();return h(this.metadata,e),e}getHash(){return this.data.getHash()}getRangesHash(){return this.data.getRangesHash()}getContent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.data.getContent(e)}isEditable(){return this.data.isEditable()}getByteLength(){return this.data.getByteLength()}getStringLength(){return this.data.getStringLength()}getMetadata(){return this.metadata}setMetadata(e){o.object(e,"File: bad metadata"),this.metadata=e}edit(e){if(!this.data.isEditable())throw new l.NotEditableError;this.data.edit(e)}getComments(){return this.data.getComments()}getTrackedChanges(){return this.data.getTrackedChanges()}clone(){return l.fromRaw(this.toRaw())}async load(e,t){const n=await this.data.load(e,t);return this.data=n,this}async store(e){const t=await this.data.store(e);return h(this.metadata,t),t}}function h(e,t){r.isEmpty(e)||(t.metadata=r.cloneDeep(e))}e.exports=l},80760:(e,t,n)=>{"use strict";n.d(t,{eS:()=>fe,tB:()=>_e});n(97107);var r=n(14041),o=n(14936),s=n(76113),i=n(42093),a=n(52155),c=(n(61412),n(91883),n(70286),n(70915)),l=n(64932),h=n(37858),d=n(45250),u=n(51275),p=n(33478),g=n(60961),m=n(87776);const f=new URLSearchParams(window.location.search);class _{constructor(e){let{compilingRef:t,projectId:n,setChangedAt:r,setCompiling:o,setData:s,setFirstRenderDone:i,setDeliveryLatencies:a,setError:c,cleanupCompileResult:l,signal:h,openDocs:u}=e;this.compilingRef=t,this.projectId=n,this.setChangedAt=r,this.setCompiling=o,this.setData=s,this.setFirstRenderDone=i,this.setDeliveryLatencies=a,this.setError=c,this.cleanupCompileResult=l,this.signal=h,this.openDocs=u,this.projectRootDocId=null,this.clsiServerId=null,this.currentDoc=null,this.error=void 0,this.timer=0,this.defaultOptions={draft:!1,stopOnFirstError:!1},this.debouncedAutoCompile=(0,d.debounce)((()=>{this.compile({isAutoCompileOnChange:!0})}),2500,{maxWait:5e3})}async compile(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e={...this.defaultOptions,...e},e.isAutoCompileOnLoad&&(0,l.A)("ol-preventCompileOnLoad"))return;const t=this.compilingRef.current;if(this.setCompiling(!0),t)e.isAutoCompileOnChange&&this.debouncedAutoCompile();else try{await this.openDocs.awaitBufferedOps((0,m.E)(this.signal,1e4)),this.setChangedAt(0),this.validationIssues=void 0;const t=this.buildCompileParams(e),n=performance.now(),r=this.getRootDocOverrideId(),o={rootDoc_id:r,draft:e.draft,check:"silent",incrementalCompilesEnabled:!this.error,stopOnFirstError:e.stopOnFirstError,editorId:u.$3,clsiCacheSharded:!0},s=await(0,h.TB)(`/project/${this.projectId}/compile?${t}`,{body:o,signal:this.signal}),i=Math.ceil(performance.now()-n),{deliveryLatencies:a,firstRenderDone:c}=(0,u.I_)(s,i,n);this.setDeliveryLatencies((()=>a)),this.setFirstRenderDone((()=>c)),this.setError(void 0),s.options=e,s.rootDocId=r,s.clsiServerId&&(this.clsiServerId=s.clsiServerId),this.setData(s)}catch(e){g.$.error(e),this.cleanupCompileResult(),this.setError(429===e.info?.statusCode?"rate-limited":"error")}finally{this.setCompiling(!1)}}getRootDocOverrideId(){if(this.currentDoc&&this.currentDoc.doc_id!==this.projectRootDocId){const e=this.currentDoc.getSnapshot();if(e&&(0,c.e)(e))return this.currentDoc.doc_id}return null}buildPostCompileParams(){const e=new URLSearchParams;return this.clsiServerId&&e.set("clsiserverid",this.clsiServerId),e}buildCompileParams(e){const t=new URLSearchParams;return(e.isAutoCompileOnLoad||e.isAutoCompileOnChange)&&t.set("auto_compile","true"),p.lW&&t.set("enable_pdf_caching","true"),"true"===f.get("file_line_errors")&&(t.file_line_errors="true"),t}stopCompile(){const e=this.buildPostCompileParams();return(0,h.TB)(`/project/${this.projectId}/compile/stop?${e}`,{signal:this.signal}).catch((e=>{g.$.error(e),this.setError("error")})).finally((()=>{this.setCompiling(!1)}))}clearCache(){const e=this.buildPostCompileParams();return(0,h.Un)(`/project/${this.projectId}/output?${e}`,{signal:this.signal}).catch((e=>{g.$.error(e),this.setError("clear-cache")}))}setOption(e,t){this.defaultOptions[e]=t}}var w=n(69954);n(82438),n(12266),n(99819),n(57327),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539);const v=/^LaTeX(?:3| Font)? Warning: (.*)$/,b=/^(Over|Under)full \\(v|h)box/,y=/^((?:Package|Class|Module) \b.+\b Warning:.*)$/,x=/lines? ([0-9]+)/,k=/^(?:Package|Class|Module) (\b.+\b) Warning/,C=/^([./].*):(\d+): (.*)/,E=0,T=1;class j{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.state=E,this.fileBaseNames=t.fileBaseNames||[/compiles/,/\/usr\/local/],this.ignoreDuplicates=t.ignoreDuplicates,this.data=[],this.fileStack=[],this.currentFileList=this.rootFileList=[],this.openParens=0,this.latexWarningRegex=v,this.packageWarningRegex=y,this.packageRegex=k,this.log=new I(e)}parse(){for(;!1!==(this.currentLine=this.log.nextLine());)if(this.state===E&&(this.currentLineIsError()?(this.state=T,this.currentError={line:null,file:this.currentFilePath,level:"error",message:this.currentLine.slice(2),content:"",raw:this.currentLine+"\n"}):this.currentLineIsFileLineError()?(this.state=T,this.parseFileLineError()):this.currentLineIsRunawayArgument()?this.parseRunawayArgumentError():this.currentLineIsWarning()?this.parseSingleWarningLine(this.latexWarningRegex):this.currentLineIsHboxWarning()?this.parseHboxLine():this.currentLineIsPackageWarning()?this.parseMultipleWarningLine():this.parseParensForFilenames()),this.state===T){this.currentError.content+=this.log.linesUpToNextMatchingLine(/^l\.[0-9]+/).join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine(!0).join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine(!0).join("\n"),this.currentError.raw+=this.currentError.content;const e=this.currentError.raw.match(/l\.([0-9]+)/);e&&null===this.currentError.line&&(this.currentError.line=parseInt(e[1],10)),this.data.push(this.currentError),this.state=E}return this.postProcess(this.data)}currentLineIsError(){return"!"===this.currentLine[0]&&"!  ==> Fatal error occurred, no output PDF file produced!"!==this.currentLine}currentLineIsFileLineError(){return C.test(this.currentLine)}currentLineIsRunawayArgument(){return this.currentLine.match(/^Runaway argument/)}currentLineIsWarning(){return!!this.currentLine.match(this.latexWarningRegex)}currentLineIsPackageWarning(){return!!this.currentLine.match(this.packageWarningRegex)}currentLineIsHboxWarning(){return!!this.currentLine.match(b)}parseFileLineError(){const e=this.currentLine.match(C);this.currentError={line:e[2],file:e[1],level:"error",message:e[3],content:"",raw:this.currentLine+"\n"}}parseRunawayArgumentError(){this.currentError={line:null,file:this.currentFilePath,level:"error",message:this.currentLine,content:"",raw:this.currentLine+"\n"},this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.raw+=this.currentError.content;const e=this.currentError.raw.match(/l\.([0-9]+)/);return e&&(this.currentError.line=parseInt(e[1],10)),this.data.push(this.currentError)}parseSingleWarningLine(e){const t=this.currentLine.match(e);if(!t)return;const n=t[1],r=n.match(x),o=r?parseInt(r[1],10):null;this.data.push({line:o,file:this.currentFilePath,level:"warning",message:n,raw:n})}parseMultipleWarningLine(){let e=this.currentLine.match(this.packageWarningRegex);if(!e)return;const t=[e[1]];let n=this.currentLine.match(x),r=n?parseInt(n[1],10):null;const o=this.currentLine.match(this.packageRegex)[1],s=new RegExp("(?:\\("+o+"\\))*[\\s]*(.*)","i");for(;this.currentLine=this.log.nextLine();)n=this.currentLine.match(x),r=n?parseInt(n[1],10):r,e=this.currentLine.match(s),t.push(e[1]);const i=t.join(" ");this.data.push({line:r,file:this.currentFilePath,level:"warning",message:i,raw:i})}parseHboxLine(){const e=this.currentLine.match(x),t=e?parseInt(e[1],10):null;this.data.push({line:t,file:this.currentFilePath,level:"typesetting",message:this.currentLine,raw:this.currentLine})}parseParensForFilenames(){const e=this.currentLine.search(/[()]/);if(-1!==e){const t=this.currentLine[e];if(this.currentLine=this.currentLine.slice(e+1),"("===t){const e=this.consumeFilePath();if(e){this.currentFilePath=e;const t={path:e,files:[]};this.fileStack.push(t),this.currentFileList.push(t),this.currentFileList=t.files}else this.openParens++}else if(")"===t)if(this.openParens>0)this.openParens--;else if(this.fileStack.length>1){this.fileStack.pop();const e=this.fileStack[this.fileStack.length-1];this.currentFilePath=e.path,this.currentFileList=e.files}this.parseParensForFilenames()}}consumeFilePath(){if(!this.currentLine.match(/^\/?([^ ()\\]+\/)+/))return!1;let e,t=this.currentLine.search(/[ ()\\]/);for(;-1!==t&&" "===this.currentLine[t];){const e=this.currentLine.slice(0,t);if(/\.\w+$/.test(e))break;const n=this.currentLine.slice(t+1);if(/^\s*["()[\]]/.test(n))break;const r=n.search(/[ "()[\]]/);-1===r?t=-1:t+=r+1}return-1===t?(e=this.currentLine,this.currentLine=""):(e=this.currentLine.slice(0,t),this.currentLine=this.currentLine.slice(t)),e}postProcess(e){const t=[],n={error:[],warning:[],typesetting:[]},r=new Set;return e.forEach((e=>{const o=e.raw;this.ignoreDuplicates&&r.has(o)||(n[e.level]?.push(e),t.push(e),r.add(o))})),{errors:n.error,warnings:n.warning,typesetting:n.typesetting,all:t,files:this.rootFileList}}}class I{constructor(e){this.text=e.replace(/(\r\n)|\r/g,"\n");const t=this.text.split("\n");this.lines=[t[0]];for(let e=1;e<t.length;e++){const n=t[e-1],r=t[e];79===n.length&&"..."!==n.slice(-3)&&"!"!==r.charAt(0)?this.lines[this.lines.length-1]+=r:this.lines.push(r)}this.row=0}nextLine(){return this.row++,!(this.row>=this.lines.length)&&this.lines[this.row]}rewindLine(){this.row--}linesUpToNextWhitespaceLine(e){return this.linesUpToNextMatchingLine(/^ *$/,e)}linesUpToNextMatchingLine(e,t){const n=[];for(;;){const r=this.nextLine();if(!1===r)break;if(t&&r.match(/^! /)){this.rewindLine();break}if(n.push(r),r.match(e))break}return n}}var S=n(71606),A=n(31085);const L=[...[{ruleId:"hint_misplaced_alignment_tab_character",regexToMatch:/Misplaced alignment tab character &/},{ruleId:"hint_extra_alignment_tab_has_been_changed",regexToMatch:/Extra alignment tab has been changed to \\cr/},{ruleId:"hint_display_math_should_end_with",regexToMatch:/Display math should end with \$\$/},{ruleId:"hint_missing_inserted",regexToMatch:/Missing [{$] inserted\./},{ruleId:"hint_reference_undefined",regexToMatch:/Reference.+undefined/},{ruleId:"hint_there_were_undefined_references",regexToMatch:/There were undefined references/},{ruleId:"hint_citation_on_page_undefined_on_input_line",regexToMatch:/Citation .+ on page .+ undefined on input line .+/},{ruleId:"hint_label_multiply_defined_labels",regexToMatch:/(Label .+)? multiply[ -]defined( labels)?/},{ruleId:"hint_float_specifier_changed",regexToMatch:/`!?h' float specifier changed to `!?ht/},{ruleId:"hint_no_positions_in_optional_float_specifier",regexToMatch:/No positions in optional float specifier/},{ruleId:"hint_undefined_control_sequence",regexToMatch:/Undefined control sequence/,contentRegex:/^[^\n]*(\\\S+)\s*[\n]/,improvedTitle:(e,t)=>{if(t?.length&&S.H.has(t[0])){const e=t[0],n=S.H.get(e);return[`Is ${n.command} missing?`,(0,A.jsxs)("span",{children:["Is ",(0,A.jsx)("code",{children:n.command})," missing?"]})]}return e},highlightCommand:e=>e[0]},{ruleId:"hint_undefined_environment",regexToMatch:/LaTeX Error: Environment .+ undefined/,contentRegex:/\\begin\{(\S+)\}/,improvedTitle:(e,t)=>{if(t?.length&&S.P.has(t[0])){const e=t[0],n=S.P.get(e);return[`Is ${n.command} missing?`,(0,A.jsxs)("span",{children:["Is ",(0,A.jsx)("code",{children:n.command})," missing?"]})]}return e}},{ruleId:"hint_file_not_found",regexToMatch:/File .+ not found/},{ruleId:"hint_unknown_graphics_extension",regexToMatch:/LaTeX Error: Unknown graphics extension: \..+/},{ruleId:"hint_unknown_float_option_h",regexToMatch:/LaTeX Error: Unknown float option `H/},{ruleId:"hint_unknown_float_option_q",regexToMatch:/LaTeX Error: Unknown float option `q/},{ruleId:"hint_math_allowed_only_in_math_mode",regexToMatch:/LaTeX Error: \\math.+ allowed only in math mode/},{ruleId:"hint_mismatched_environment",types:["environment"],regexToMatch:/Error: `([^']{2,})' expected, found `([^']{2,})'.*/,newMessage:"Error: environment does not match \\begin{$1} ... \\end{$2}"},{ruleId:"hint_mismatched_brackets",types:["environment"],regexToMatch:/Error: `([^a-zA-Z0-9])' expected, found `([^a-zA-Z0-9])'.*/,newMessage:"Error: brackets do not match, found '$2' instead of '$1'"},{ruleId:"hint_can_be_used_only_in_preamble",regexToMatch:/LaTeX Error: Can be used only in preamble/},{ruleId:"hint_missing_right_inserted",regexToMatch:/Missing \\right inserted/},{ruleId:"hint_double_superscript",regexToMatch:/Double superscript/},{ruleId:"hint_double_subscript",regexToMatch:/Double subscript/},{ruleId:"hint_no_author_given",regexToMatch:/No \\author given/},{ruleId:"hint_somethings_wrong_perhaps_a_missing_item",regexToMatch:/LaTeX Error: Something's wrong--perhaps a missing \\item/},{ruleId:"hint_misplaced_noalign",regexToMatch:/Misplaced \\noalign/},{ruleId:"hint_no_line_here_to_end",regexToMatch:/LaTeX Error: There's no line here to end/},{ruleId:"hint_verb_ended_by_end_of_line",regexToMatch:/LaTeX Error: \\verb ended by end of line/},{ruleId:"hint_illegal_unit_of_measure_pt_inserted",regexToMatch:/Illegal unit of measure (pt inserted)/},{ruleId:"hint_extra_right",regexToMatch:/Extra \\right/},{ruleId:"hint_missing_begin_document",regexToMatch:/Missing \\begin{document}/},{ruleId:"hint_mismatched_environment2",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Error: `\\end\{([^\}]+)\}' expected but found `\\end\{([^\}]+)\}'.*/,newMessage:"Error: environments do not match: \\begin{$1} ... \\end{$2}"},{ruleId:"hint_mismatched_environment3",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Warning: No matching \\end found for `\\begin\{([^\}]+)\}'.*/,newMessage:"Warning: No matching \\end found for \\begin{$1}"},{ruleId:"hint_mismatched_environment4",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Error: Found `\\end\{([^\}]+)\}' without corresponding \\begin.*/,newMessage:"Error: found \\end{$1} without a corresponding \\begin{$1}"}],{ruleId:"hint_character_invalid_at_this_point",regexToMatch:/^Package calc error: `(.+?)' invalid at this point/,package:"calc"},{ruleId:"hint_command_allowed_only_in_math_mode",regexToMatch:/^Package amsmath error: (.+?) allowed only in math mode/,package:"amsmath"},{ruleId:"hint_command_undefined",regexToMatch:/^LaTeX error: (.+?) undefined/,package:"LaTeX"},{ruleId:"hint_lt_in_mid_line",regexToMatch:/^LaTeX error: \\< in mid line/,package:"LaTeX"},{ruleId:"hint_a_box_was_supposed_to_be_here",regexToMatch:/^A <Box> was supposed to be here/i,package:"TeX"},{ruleId:"hint_accent_not_provided_by_font_family",regexToMatch:/^Package textcomp error: Accent (.+?) not provided by font family (.+)/,package:"textcomp"},{ruleId:"hint_argument_of_has_an_extra",regexToMatch:/^Argument of (.+?) has an extra }/,package:"TeX"},{ruleId:"hint_bad_line_or_vector_argument",regexToMatch:/^LaTeX error: Bad \\line or \\vector argument/,package:"LaTeX"},{ruleId:"hint_bad_math_environment_delimiter",regexToMatch:/^LaTeX error: Bad math environment delimiter/,package:"LaTeX"},{ruleId:"hint_begin_env_allowed_only_in_paragraph_mode",regexToMatch:/^Package amsmath error: \\begin{(.+?)} allowed only in paragraph mode/,package:"amsmath"},{ruleId:"hint_begin_env_on_input_line_x_ended_by_end_x",regexToMatch:/^LaTeX error: \\begin{(.+?)} on input line (.+?) ended by \\end{(.+?)}/,package:"LaTeX"},{ruleId:"hint_begin_split_wont_work_here",regexToMatch:/^Package amsmath error: \\begin{split} won't work here/,package:"amsmath"},{ruleId:"hint_can_be_used_only_in_preamble",regexToMatch:/^LaTeX error: Can be used only in preamble/,package:"LaTeX"},{ruleId:"hint_cannot_be_used_in_preamble",regexToMatch:/^LaTeX error: Cannot be used in preamble/,package:"LaTeX"},{ruleId:"hint_unicode_character",regexToMatch:/^LaTeX Error: Unicode character /,package:"LaTeX"},{ruleId:"hint_cannot_define_unicode_char_value_lt_00a0",regexToMatch:/^Package inputenc error: Cannot define Unicode char value < 00A0/,package:"inputenc"},{ruleId:"hint_cannot_determine_size_of_graphic_in_file",regexToMatch:/^Package (graphics|graphicx) error: Cannot determine size of graphic in (.+)/,package:"graphics/graphicx"},{ruleId:"hint_cannot_include_graphics_of_type",regexToMatch:/^Package (graphics|graphicx) error: Cannot include graphics of type\s*: (.+)/,package:"graphics/graphicx"},{ruleId:"hint_caption_outside_float",regexToMatch:/^LaTeX error: \\caption outside float/,package:"LaTeX"},{ruleId:"hint_command_already_defined",regexToMatch:/^LaTeX error: Command (.+?) already defined/,package:"LaTeX"},{ruleId:"hint_command_invalid_in_math_mode",regexToMatch:/^LaTeX error: Command (.+?) invalid in math mode/,package:"LaTeX"},{ruleId:"hint_command_not_defined_as_a_math_alphabet",regexToMatch:/^LaTeX error: Command (.+?) not defined as a math alphabet/,package:"LaTeX"},{ruleId:"hint_corrupted_nfss_tables",regexToMatch:/^LaTeX error: Corrupted NFSS tables/,package:"LaTeX"},{ruleId:"hint_counter_too_large",regexToMatch:/^LaTeX error: Counter too large/,package:"LaTeX"},{ruleId:"hint_dimension_too_large",regexToMatch:/^Dimension too large/,package:"TeX"},{ruleId:"hint_displaybreak_cannot_be_applied_here",regexToMatch:/^Package amsmath error: \\displaybreak cannot be applied here/,package:"amsmath"},{ruleId:"hint_division_by_0",regexToMatch:/^Package (graphics|graphicx) error: Division by 0/,package:"graphics/graphicx"},{ruleId:"hint_double_subscript",regexToMatch:/^Double subscript/,package:"TeX"},{ruleId:"hint_double_superscript",regexToMatch:/^Double superscript/,package:"TeX"},{ruleId:"hint_encoding_file_not_found",regexToMatch:/^Package fontenc error: Encoding file `(.+?)' not found/,package:"fontenc"},{ruleId:"hint_encoding_scheme_unknown",regexToMatch:/^LaTeX error: Encoding scheme `(.+?)' unknown/,package:"LaTeX"},{ruleId:"hint_environment_undefined",regexToMatch:/^LaTeX error: Environment (.+?) undefined/,package:"LaTeX"},{ruleId:"hint_erroneous_nesting_of_equation_structures",regexToMatch:/^Package amsmath error: Erroneous nesting of equation structures/,package:"amsmath"},{ruleId:"hint_extra_on_this_line",regexToMatch:/^Package amsmath error: Extra & on this line/,package:"amsmath"},{ruleId:"hint_extra_alignment_tab_has_been_changed_to_cr",regexToMatch:/^Extra alignment tab has been changed to \\cr/,package:"TeX"},{ruleId:"hint_extra_endgroup",regexToMatch:/^Extra \\endgroup/,package:"TeX"},{ruleId:"hint_extra_or",regexToMatch:/^Extra \\or/,package:"TeX"},{ruleId:"hint_extra_right",regexToMatch:/^Extra \\right/,package:"TeX"},{ruleId:"hint_extra_or_forgotten",regexToMatch:/^Extra }, or forgotten \$/,package:"TeX"},{ruleId:"hint_extra_or_forgotten_endgroup",regexToMatch:/^Extra }, or forgotten \\endgroup/,package:"TeX"},{ruleId:"hint_file_not_found",regexToMatch:/^LaTeX error: File `(.+?)' not found/,package:"LaTeX"},{ruleId:"hint_file_ended_while_scanning",regexToMatch:/^File ended while scanning (.+)/,package:"TeX"},{ruleId:"hint_float_lost",regexToMatch:/^LaTeX error: Float\(s\) lost/,package:"LaTeX"},{ruleId:"hint_font_family_unknown",regexToMatch:/^LaTeX error: Font family `(.+?)\+(.+?)' unknown/,package:"LaTeX"},{ruleId:"hint_font_not_found",regexToMatch:/^LaTeX error: Font (.+?) not found/,package:"LaTeX"},{ruleId:"hint_font_not_loaded_not_enough_room_left",regexToMatch:/^Font (.+?)=(.+?) not loaded: Not enough room left/,package:"TeX"},{ruleId:"hint_font_shape_not_found",regexToMatch:/^LaTeX error: Font shape (.+?) not found/,package:"LaTeX"},{ruleId:"hint_i_cant_find_file",regexToMatch:/^I can't find file `(.+?)'/,package:"TeX"},{ruleId:"hint_i_cant_write_on_file",regexToMatch:/^I can't write on file `(.+?)'/,package:"TeX"},{ruleId:"hint_illegal_character_in_array_arg",regexToMatch:/^LaTeX error: Illegal character in array arg/,package:"LaTeX"},{ruleId:"hint_illegal_parameter_number_in_definition_of",regexToMatch:/^Illegal parameter number in definition of (.+)/,package:"TeX"},{ruleId:"hint_illegal_unit_of_measure_pt_inserted",regexToMatch:/^Illegal unit of measure \(pt inserted\)/,package:"TeX"},{ruleId:"hint_improper_argument_for_math_accent",regexToMatch:/^Package amsmath error: Improper argument for math accent/,package:"amsmath"},{ruleId:"hint_improper_discretionary_list",regexToMatch:/^Improper discretionary list/,package:"TeX"},{ruleId:"hint_improper_hyphenation",regexToMatch:/^Improper \\hyphenation/,package:"TeX"},{ruleId:"hint_improper_prevdepth",regexToMatch:/^Improper \\prevdepth/,package:"TeX"},{ruleId:"hint_improper_spacefactor",regexToMatch:/^Improper \\spacefactor/,package:"TeX"},{ruleId:"hint_include_cannot_be_nested",regexToMatch:/^LaTeX error: \\include cannot be nested/,package:"LaTeX"},{ruleId:"hint_incompatible_list_cant_be_unboxed",regexToMatch:/^Incompatible list can't be unboxed/,package:"TeX"},{ruleId:"hint_incomplete_all_text_was_ignored_after_line",regexToMatch:/^Incomplete (.+?); all text was ignored after line (.+)/,package:"TeX"},{ruleId:"hint_infinite_glue_shrinkage_found",regexToMatch:/^Infinite glue shrinkage found (.+)/,package:"TeX"},{ruleId:"hint_interruption",regexToMatch:/^Interruption/,package:"TeX"},{ruleId:"hint_invalid_use_of_commande",regexToMatch:/^Package amsmath error: Invalid use of (.+)/,package:"amsmath"},{ruleId:"hint_keyboard_character_used_is_undefined_in_input_encoding",regexToMatch:/^Package inputenc error: Keyboard character used is undefined in input encoding (.+)/,package:"inputenc"},{ruleId:"hint_language_definition_file_not_found",regexToMatch:/^Package babel error: Language definition file (.+?)\.ldf not found /,package:"babel"},{ruleId:"hint_limit_controls_must_follow_a_math_operator",regexToMatch:/^Limit controls must follow a math operator/,package:"TeX"},{ruleId:"hint_loadclass_in_package_file",regexToMatch:/^LaTeX error: \\LoadClass in package file/,package:"LaTeX"},{ruleId:"hint_lonely_item_perhaps_a_missing_list_environment",regexToMatch:/^LaTeX error: Lonely \\item--perhaps a missing list environment/,package:"LaTeX"},{ruleId:"hint_math_alphabet_identifier_is_undefined_in_math_version",regexToMatch:/^LaTeX error: Math alphabet identifier (.+?) is undefined in math version (.+)/,package:"LaTeX"},{ruleId:"hint_math_version_is_not_defined",regexToMatch:/^LaTeX error: Math version (.+?) is not defined/,package:"LaTeX"},{ruleId:"hint_misplaced_alignment_tab_character",regexToMatch:/^Misplaced alignment tab character &/,package:"TeX"},{ruleId:"hint_misplaced_cr",regexToMatch:/^Misplaced \\cr/,package:"TeX"},{ruleId:"hint_misplaced_crcr",regexToMatch:/^Misplaced \\crcr/,package:"TeX"},{ruleId:"hint_misplaced_noalign",regexToMatch:/^Misplaced \\noalign/,package:"TeX"},{ruleId:"hint_misplaced_omit",regexToMatch:/^Misplaced \\omit/,package:"TeX"},{ruleId:"hint_missing_begin_document",regexToMatch:/^LaTeX error: Missing \\begin{document}/,package:"LaTeX"},{ruleId:"hint_missing_control_sequence_inserted",regexToMatch:/^Missing control sequence inserted/,package:"TeX"},{ruleId:"hint_missing_cr_inserted",regexToMatch:/^Missing \\cr inserted/,package:"TeX"},{ruleId:"hint_missing_delimiter_inserted",regexToMatch:/^Missing delimiter \(. inserted\)/,package:"TeX"},{ruleId:"hint_missing_endcsname_inserted",regexToMatch:/^Missing \\endcsname inserted/,package:"TeX"},{ruleId:"hint_missing_number_treated_as_zero",regexToMatch:/^Missing number, treated as zero/,package:"TeX"},{ruleId:"hint_missing_p_arg_in_array_arg",regexToMatch:/^LaTeX error: Missing p-arg in array arg/,package:"LaTeX"},{ruleId:"hint_missing_exp_in_array_arg",regexToMatch:/^LaTeX error: Missing @-exp in array arg/,package:"LaTeX"},{ruleId:"hint_missing_inserted_in_alignment_preamble",regexToMatch:/^Missing # inserted in alignment preamble/,package:"TeX"},{ruleId:"hint_missing_inserted_for_ifnum",regexToMatch:/^Missing = inserted for \\ifnum/,package:"TeX"},{ruleId:"hint_missing_inserted_for_ifdim",regexToMatch:/^Missing = inserted for \\ifdim/,package:"TeX"},{ruleId:"hint_missing_inserted",regexToMatch:/^Missing \$ inserted/,package:"TeX"},{ruleId:"hint_missing_endgroup_inserted",regexToMatch:/^Missing \\endgroup inserted/,package:"TeX"},{ruleId:"hint_missing_right_inserted",regexToMatch:/^Missing \\right\. inserted/,package:"TeX"},{ruleId:"hint_missing_inserted",regexToMatch:/^Missing \{ inserted/,package:"TeX"},{ruleId:"hint_missing_inserted",regexToMatch:/^Missing } inserted/,package:"TeX"},{ruleId:"hint_multiple_labels_label_tiquette_will_be_lost",regexToMatch:/^Package amsmath error: Multiple \\label's: label (.+?) will be lost/,package:"amsmath"},{ruleId:"hint_multiple_tag",regexToMatch:/^Package amsmath error: Multiple \\tag/,package:"amsmath"},{ruleId:"hint_no_counter_defined",regexToMatch:/^LaTeX error: No counter '(.+?)' defined/,package:"LaTeX"},{ruleId:"hint_no_cyrillic_encoding_definition_files_were_found",regexToMatch:/^Package babel error: No Cyrillic encoding definition files were found/,package:"babel"},{ruleId:"hint_no_declaration_for_shape",regexToMatch:/^LaTeX error: No declaration for shape (.+)/,package:"LaTeX"},{ruleId:"hint_no_driver_specified",regexToMatch:/^Package (color|graphics|graphicx) error: No driver specified/,package:"color/graphics/graphicx"},{ruleId:"hint_no_room_for_a_new_register",regexToMatch:/^No room for a new (.+)/,package:"TeX"},{ruleId:"hint_no_title_given",regexToMatch:/^LaTeX error: No \\title given/,package:"LaTeX"},{ruleId:"hint_not_a_letter",regexToMatch:/^Not a letter/,package:"TeX"},{ruleId:"hint_not_in_outer_par_mode",regexToMatch:/^LaTeX error: Not in outer par mode/,package:"LaTeX"},{ruleId:"hint_number_too_big",regexToMatch:/^Number too big/,package:"TeX"},{ruleId:"hint_ok_see_the_transcript_file",regexToMatch:/^OK \(see the transcript file\)/,package:"TeX"},{ruleId:"hint_old_form_should_be_begin",regexToMatch:/^Package amsmath error: Old form (.+?) should be \\begin{(.+?)} /,package:"amsmath"},{ruleId:"hint_only_one_is_allowed_per_tab",regexToMatch:/^Only one # is allowed per tab/,package:"TeX"},{ruleId:"hint_option_clash_for_package",regexToMatch:/^LaTeX error: Option clash for package (.+)/,package:"LaTeX"},{ruleId:"hint_page_height_already_too_large",regexToMatch:/^LaTeX error: Page height already too large/,package:"LaTeX"},{ruleId:"hint_paragraph_ended_before_command_was_complete",regexToMatch:/^Paragraph ended before (.+?) was complete/,package:"TeX"},{ruleId:"hint_please_type_a_command_or_say_end",regexToMatch:/^\(Please type a command or say `\\end'\)/,package:"TeX"},{ruleId:"hint_pushtabs_and_poptabs_dont_match",regexToMatch:/^LaTeX error: \\pushtabs and \\poptabs don't match/,package:"LaTeX"},{ruleId:"hint_requirepackage_or_loadclass_in_options_section",regexToMatch:/^LaTeX error: \\RequirePackage or \\LoadClass in Options Section/,package:"LaTeX"},{ruleId:"hint_rotation_not_supported",regexToMatch:/^Package (graphics|graphicx) error: Rotation not supported/,package:"graphics/graphicx"},{ruleId:"hint_runaway",regexToMatch:/^Runaway (.+)/,package:"TeX"},{ruleId:"hint_you_havent_specified_a_language_option",regexToMatch:/^Package babel error: You haven't specified a language option/,package:"babel"},{ruleId:"hint_calculating_math_sizes_for_size",regexToMatch:/^LaTeX (Font )?(Warning|Info): Calculating math sizes for size (.+)/,package:"LaTeX"},{ruleId:"hint_checking_defaults_for",regexToMatch:/^LaTeX (Font )?(Warning|Info): Checking defaults for (.+)/,package:"LaTeX"},{ruleId:"hint_citation_on_page_undefined",regexToMatch:/^LaTeX (Font )?(Warning|Info): Citation `(.+?)' on page (.+?) undefined/,package:"LaTeX"},{ruleId:"hint_command_invalid_in_math_mode",regexToMatch:/^LaTeX (Font )?(Warning|Info): Command (.+?) invalid in math mode/,package:"LaTeX"},{ruleId:"hint_document_class",regexToMatch:/^LaTeX (Font )?(Warning|Info): Document Class\s*: (.+)/,package:"LaTeX"},{ruleId:"hint_empty_thebibliography_environment",regexToMatch:/^LaTeX (Font )?(Warning|Info): Empty `thebibliography' environment/,package:"LaTeX"},{ruleId:"hint_encoding_has_changed_to_for",regexToMatch:/^LaTeX (Font )?(Warning|Info): Encoding (.+?) has changed to (.+?) for/,package:"LaTeX"},{ruleId:"hint_end_occurred_inside_a_group_at_level",regexToMatch:/^\(\\end occurred inside a group at level (.+)\)/,package:"TeX"},{ruleId:"hint_when_condition_on_line_was_incomplete",regexToMatch:/^\(\\end occurred when (.+?) on line (.+) was incomplete\)/,package:"TeX"},{ruleId:"hint_external_font_loaded_for_size",regexToMatch:/^LaTeX (Font )?(Warning|Info): External font (.+?) loaded for size (.+)/,package:"LaTeX"},{ruleId:"hint_faking_for_font_family_in_ts1_encoding",regexToMatch:/^Package TeXtcomp (Warning|Info): Faking (.+?) for font family (.+?) in TS1 encoding/,package:"TeXtcomp"},{ruleId:"hint_file_already_exists_on_the_system_not_generating_it_from_this_source",regexToMatch:/^LaTeX (Font )?(Warning|Info): File `(.+?)' already exists on the system\.\nNot generating it from this source\./,package:"LaTeX"},{ruleId:"hint_file",regexToMatch:/^LaTeX (Font )?(Warning|Info): File\s*: (.+)/,package:"LaTeX"},{ruleId:"hint_file_font_definition",regexToMatch:/^LaTeX (Font )?(Warning|Info): File\s*: (.+?)\.fd (.+)/,package:"LaTeX"},{ruleId:"hint_float_too_large_for_page_by",regexToMatch:/^LaTeX (Font )?(Warning|Info): Float too large for page by (.+)/,package:"LaTeX"},{ruleId:"hint_font_shape_in_size_not_available_external_font_used",regexToMatch:/^LaTeX (Font )?(Warning|Info): Font shape (.+?) in size (.+?) not available\nexternal font (.+?) used/,package:"LaTeX"},{ruleId:"hint_font_shape_in_size_not_available_size_substituted",regexToMatch:/^LaTeX (Font )?(Warning|Info): Font shape (.+?) in size (.+?) not available\nsize (.+?) substituted/,package:"LaTeX"},{ruleId:"hint_font_shape_in_size_not_available_shape_forme_tried",regexToMatch:/^LaTeX (Font )?(Warning|Info): Font shape (.+?) in size (.+?) not available\nshape (.+?) tried/,package:"LaTeX"},{ruleId:"hint_font_shape_forme_undefined_using_autre_forme_instead",regexToMatch:/^LaTeX (Font )?(Warning|Info): Font shape (.+?) undefined\. Using `(.+?)' instead/,package:"LaTeX"},{ruleId:"hint_font_shape_forme_will_be_scaled_to_size_taille_",regexToMatch:/^LaTeX (Font )?(Warning|Info): Font shape (.+?) will be scaled to size (.+)/,package:"LaTeX"},{ruleId:"hint_foreign_command",regexToMatch:/^Package amsmath (Warning|Info): Foreign command (.+?);/,package:"amsmath"},{ruleId:"hint_form_feed_has_been_converted_to_blank_line",regexToMatch:/^LaTeX (Font )?(Warning|Info): Form feed has been converted to Blank Line/,package:"LaTeX"},{ruleId:"hint_float_specifier_changed",regexToMatch:/^LaTeX (Font )?(Warning|Info): `(.+?)' float specifier changed to `(.+?)'/,package:"LaTeX"},{ruleId:"hint_ignoring_text_after_end",regexToMatch:/^LaTeX (Font )?(Warning|Info): Ignoring text `(.+?)' after \\end{(.+?)}/,package:"LaTeX"},{ruleId:"hint_label_multiply_defined",regexToMatch:/^LaTeX (Font )?(Warning|Info): Label `(.+?)' multiply defined/,package:"LaTeX"},{ruleId:"hint_labels_may_have_changed_rerun_to_get_cross_references_right",regexToMatch:/^LaTeX (Font )?(Warning|Info): Label\(s\) may have changed\. Rerun to get cross-references right\./,package:"LaTeX"},{ruleId:"hint_loose_hbox_badness",regexToMatch:/^Loose \\hbox \(badness (.+?)\) (.+)/,package:"TeX"},{ruleId:"hint_loose_vbox_badness",regexToMatch:/^Loose \\vbox \(badness (.+?)\) (.+)/,package:"TeX"},{ruleId:"hint_making_an_active_character",regexToMatch:/^Package babel (Warning|Info): Making (.+?) an active character/,package:"babel"},{ruleId:"hint_marginpar_on_page_moved",regexToMatch:/^LaTeX (Font )?(Warning|Info): Marginpar on page (.+?) moved/,package:"LaTeX"},{ruleId:"hint_missing_character_there_is_no_in_font",regexToMatch:/^Missing character\s*: There is no (.+?) in font (.+?)!/,package:"TeX"},{ruleId:"hint_no_author_given",regexToMatch:/^LaTeX (Font )?(Warning|Info): No \\author given/,package:"LaTeX"},{ruleId:"hint_no_auxiliary_output_files",regexToMatch:/^LaTeX (Font )?(Warning|Info): No auxiliary output files/,package:"LaTeX"},{ruleId:"hint_no_characters_defined_by_input_encoding_change_to",regexToMatch:/^LaTeX (Font )?(Warning|Info): No characters defined by input encoding change to (.+)/,package:"LaTeX"},{ruleId:"hint_no_file",regexToMatch:/^LaTeX (Font )?(Warning|Info): No file (.+)/,package:"LaTeX"},{ruleId:"hint_no_hyphenation_patterns_were_loaded_for_the_language",regexToMatch:/^Package babel (Warning|Info): No hyphenation patterns were loaded for the language `(.+?)'/,package:"babel"},{ruleId:"hint_no_input_encoding_specified_for_language",regexToMatch:/^Package babel (Warning|Info): No input encoding specified for (.+?) language/,package:"babel"},{ruleId:"hint_no_positions_in_optional_float_specifier",regexToMatch:/^LaTeX (Font )?(Warning|Info): No positions in optional float specifier\./,package:"LaTeX"},{ruleId:"hint_oldstyle_digits_unavailable_for_family",regexToMatch:/^LaTeX (Font )?(Warning|Info): Oldstyle digits unavailable for family (.+)/,package:"Textcomp"},{ruleId:"hint_optional_argument_of_twocolumn_too_tall_on_page",regexToMatch:/^LaTeX (Font )?(Warning|Info): Optional argument of \\twocolumn too tall on page (.+)/,package:"LaTeX"},{ruleId:"hint_oval_circle_or_line_size_unavailable",regexToMatch:/^LaTeX (Font )?(Warning|Info): \\oval, \\circle, or \\line size unavailable/,package:"LaTeX"},{ruleId:"hint_overfull_hbox_too_wide_quelque_part_",regexToMatch:/^Overfull \\hbox \((.+?)pt too wide\) (.+)/,package:"TeX"},{ruleId:"hint_overfull_vbox_pt_too_wide",regexToMatch:/^Overfull \\vbox \((.+?)pt too wide\)\) (.+)/,package:"TeX"},{ruleId:"hint_overwriting_encoding_scheme_quelque_chose_defaults",regexToMatch:/^LaTeX (Font )?(Warning|Info): Overwriting encoding scheme (.+?) defaults/,package:"LaTeX"},{ruleId:"hint_overwriting_in_version",regexToMatch:/^LaTeX (Font )?(Warning|Info): Overwriting (.+?) in version `(.+)'/,package:"LaTeX"},{ruleId:"hint_package",regexToMatch:/^LaTeX (Font )?(Warning|Info): Package: (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_font_encoding",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring font encoding (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_math_accent",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring math accent (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_math_alphabet",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring math alphabet (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_math_symbol",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring math symbol (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_math_version",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring math version (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_symbol_font",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring symbol font (.+)/,package:"LaTeX"},{ruleId:"hint_reference_on_page_undefined",regexToMatch:/^LaTeX (Font )?(Warning|Info): Reference `(.+?)' on page (.+?) undefined/,package:"LaTeX"},{ruleId:"hint_size_substitutions_with_differences_up_to_have_occurred",regexToMatch:/^LaTeX (Font )?(Warning|Info): Size substitutions with differences up to (.+?) have occurred/,package:"LaTeX"},{ruleId:"hint_some_font_shapes_were_not_available_defaults_substituted",regexToMatch:/^LaTeX (Font )?(Warning|Info): Some font shapes were not available, defaults substituted/,package:"LaTeX"},{ruleId:"hint_tab_has_been_converted_to_blank_space",regexToMatch:/^LaTeX (Font )?(Warning|Info): Tab has been converted to Blank Space/,package:"LaTeX"},{ruleId:"hint_text_page_contains_only_floats",regexToMatch:/^LaTeX (Font )?(Warning|Info): text page (.+?) contains only floats/,package:"LaTeX"},{ruleId:"hint_there_were_multiply_defined_labels",regexToMatch:/^LaTeX (Font )?(Warning|Info): There were multiply-defined labels/,package:"LaTeX"},{ruleId:"hint_there_were_undefined_references",regexToMatch:/^LaTeX (Font )?(Warning|Info): There were undefined references/,package:"LaTeX"},{ruleId:"hint_tight_hbox_badness",regexToMatch:/^Tight \\hbox \(badness (.+?)\) (.+)/,package:"TeX"},{ruleId:"hint_tight_vbox_badness",regexToMatch:/^Tight \\vbox \(badness (.+?)\) (.+)/,package:"TeX"},{ruleId:"hint_try_loading_font_information_for",regexToMatch:/^LaTeX (Font )?(Warning|Info): Try loading font information for (.+?)\+(.+)/,package:"LaTeX"},{ruleId:"hint_unable_to_redefine_math_accent",regexToMatch:/^Package amsmath (Warning|Info): Unable to redefine math accent (.+)/,package:"amsmath"},{ruleId:"hint_hbox_badness_detected_at_line",regexToMatch:/^Underfull \\hbox \(badness (.+?)\) (.+?) detected at line (.+)/,package:"TeX"},{ruleId:"hint_hbox_badness_has_occurred_while_output_is_active",regexToMatch:/^Underfull \\hbox \(badness (.+?)\) (.+?) has occurred while \\output is active/,package:"TeX"},{ruleId:"hint_hbox_badness_in_alignment_at_lines",regexToMatch:/^Underfull \\hbox \(badness (.+?)\) (.+?) in alignment at lines (.+)/,package:"TeX"},{ruleId:"hint_hbox_badness_in_paragraph_at_lines",regexToMatch:/^Underfull \\hbox \(badness (.+?)\) (.+?) in paragraph at lines (.+)/,package:"TeX"},{ruleId:"hint_vbox_badness_detected_at_line",regexToMatch:/^Underfull \\vbox \(badness (.+?)\) (.+?) detected at line (.+)/,package:"TeX"},{ruleId:"hint_vbox_badness_has_occurred_while_output_is_active",regexToMatch:/^Underfull \\vbox \(badness (.+?)\) (.+?) has occurred while \\output is active/,package:"TeX"},{ruleId:"hint_vbox_badness_in_alignment_at_lines",regexToMatch:/^Underfull \\vbox \(badness (.+?)\) (.+?) in alignment at lines (.+)/,package:"TeX"},{ruleId:"hint_unused_global_options",regexToMatch:/^LaTeX (Font )?(Warning|Info): Unused global option\(s\)\s*: \[(.+?)]/,package:"LaTeX"},{ruleId:"hint_writing_file",regexToMatch:/^LaTeX (Font )?(Warning|Info): Writing file `(.+?)'/,package:"LaTeX"},{ruleId:"hint_writing_text_before_end_as_last_line_of",regexToMatch:/^LaTeX (Font )?(Warning|Info): Writing text `(.+?)' before \\end{(.+?)} as last line of (.+)/,package:"LaTeX"},{ruleId:"hint_you_have_more_than_once_selected_the_attribute_for_language",regexToMatch:/^Package babel (Warning|Info): You have more than once selected the attribute `(.+?)' for language (.+)/,package:"babel"},{ruleId:"hint_you_have_requested_package_or_class_but_the_package_or_class_provides",regexToMatch:/^LaTeX (Font )?(Warning|Info): You have requested (package|class) `(.+?)', but the (package|class) provides `(.+?)'/,package:"LaTeX"},{ruleId:"hint_you_have_requested_release_date_of_latex_but_only_release_ancienne_date_is_available",regexToMatch:/^LaTeX (Font )?(Warning|Info): You have requested release `(.+?)' of LaTeX, but only release `(.+?)' is available/,package:"LaTeX"},{ruleId:"hint_you_have_requested_on_line_version_of_but_only_version_is_available",regexToMatch:/^LaTeX (Font )?(Warning|Info): You have requested, on line (.+?), version `(.+?)' of (.+?), but only version `(.+?)' is available/,package:"LaTeX"}],O={parse(e,t){const n="string"==typeof e?new j(e,t).parse():e,r={};for(const e of n.all){const t=L.find((t=>t.regexToMatch.test(e.message)));if(t){if(t.ruleId&&(e.ruleId=t.ruleId),t.newMessage&&(e.message=e.message.replace(t.regexToMatch,t.newMessage)),t.contentRegex){const n=e.content.match(t.contentRegex);n&&(e.contentDetails=n.slice(1))}if(e.contentDetails&&t.improvedTitle){const n=t.improvedTitle(e.message,e.contentDetails);Array.isArray(n)?e.message=n[0]:e.message=n}if(e.contentDetails&&t.highlightCommand&&(e.command=t.highlightCommand(e.contentDetails)),t.cascadesFrom)for(const n of t.cascadesFrom)r[n]&&(e.suppressed=!0);if(t.types)for(const e of t.types)r[e]=!0}}for(const[e,t]of Object.entries(n))"object"==typeof t&&t.length>0&&(n[e]=Array.from(t).filter((e=>!e.suppressed)));return n}};n(74786);const R=/^\[(\d+)].*>\s(INFO|WARN|ERROR)\s-\s(.*)$/,P=/^Warning--(.+)\n--line (\d+) of file (.+)$/m,M=/^Warning--(.+)$/m,F=/^(.*)---line (\d+) of file (.*)\n([^]+?)\nI'm skipping whatever remains of this entry$/m,D=/^(A bad cross reference---entry ".+?"\nrefers to entry.+?, which doesn't exist)$/m,N=/^(.*)\n?---line (\d+) of file (.*)\n([^]+?)\nI'm skipping whatever remains of this command$/m,X=/^(.*?)\nwhile executing---line (\d+) of file (.*)/m,$={INFO:"info",WARN:"warning",ERROR:"error"},U=function(e){return function(t,n){const[r,o]=t,[s,i]=n,[a,c]=function(t,n,r){let o,s=t;const i=[];let a=0;for(;o=n.exec(s);){a++;const t=r(o);if(null!=e&&a>=e)return[i,""];i.push(t),s=o.input.slice(0,o.index)+o.input.slice(o.index+o[0].length+1,o.input.length)}return[i,s]}(o,s,i);return[r.concat(a),c]}};class V{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)throw new Error("BibLogParser Error: text parameter must be a string");this.text=e.replace(/(\r\n)|\r/g,"\n"),this.options=t,this.lines=e.split("\n"),this.warningParsers=[[P,function(e){const[t,n,r,o]=e;return{file:o,level:"warning",message:n,line:r,raw:t}}],[M,function(e){const[t,n]=e;return{file:"",level:"warning",message:n,line:"",raw:t}}]],this.errorParsers=[[F,function(e){const[t,n,r,o,s]=e;return{file:o,level:"error",message:n+"\n"+s,line:r,raw:t}}],[D,function(e){const[t,n]=e;return{file:"",level:"error",message:n,line:"",raw:t}}],[N,function(e){const[t,n,r,o,s]=e;return{file:o,level:"error",message:n+"\n"+s,line:r,raw:t}}],[X,function(e){const[t,n,r,o]=e;return{file:o,level:"error",message:n,line:r,raw:t}}]]}parseBibtex(){const[e,t]=this.warningParsers.reduce(U(this.options.maxErrors),[[],this.text]),[n]=this.errorParsers.reduce(U(this.options.maxErrors),[[],t]);return{all:e.concat(n),errors:n,warnings:e,files:[],typesetting:[]}}parseBiber(){const e={all:[],errors:[],warnings:[],files:[],typesetting:[]};return this.lines.forEach((function(t){const n=t.match(R);if(n){const[t,,r,o]=n,s={file:"",level:$[r]||"INFO",message:o,line:"",raw:t},i=s.message.match(/^BibTeX subsystem: \/.+\/(\w+\.\w+)_.+, line (\d+), (.+)$/);if(i){const[,e,t,n]=i;s.file=e,s.line=t,s.message=n}switch(e.all.push(s),s.level){case"error":return e.errors.push(s);case"warning":return e.warnings.push(s)}}})),e}parse(){const e=this.lines[0];if(e.match(/^.*INFO - This is Biber.*$/))return this.parseBiber();if(e.match(/^This is BibTeX, Version.+$/))return this.parseBibtex();throw new Error("BibLogParser Error: cannot determine whether text is biber or bibtex output")}}var B=n(35287);n(63308);const H=/^(Reference|Citation).+undefined on input line/,W=1048576,z=W;let J=1;const q=async(e,t,n)=>{const r={log:null,logEntries:{errors:[],warnings:[],typesetting:[]}};function o(e,t){for(const n in r.logEntries)if(e[n]){for(const r of e[n])t&&(r.type=e.type),r.file&&(r.file=G(r.file)),r.key="compile-log-entry-"+J++;r.logEntries[n].push(...e[n])}}const s=e.get("output.log");if(s){r.log=await Y(K(s,t.pdfDownloadDomain),n,W);try{let{errors:e,warnings:n,typesetting:s}=O.parse(r.log,{ignoreDuplicates:!0});"stopped-on-first-error"===t.status&&(n=n.filter((e=>!function(e){return H.test(e.message)}(e)))),o({errors:e,warnings:n,typesetting:s})}catch(e){g.$.warn(e)}}const i=[];for(const[t,n]of e)t.endsWith(".blg")&&i.push(n);for(const e of i){const r=await Y(K(e,t.pdfDownloadDomain),n,z);try{const{errors:e,warnings:t}=new V(r,{maxErrors:100}).parse();o({errors:e,warnings:t},"BibTeX:")}catch(e){}}return r.logEntries.all=[...r.logEntries.errors,...r.logEntries.warnings,...r.logEntries.typesetting],r};function K(e,t){return e.build&&t?`${t}${e.url}`:`${window.origin}${e.url}`}function G(e,t){return e=(e=(e=e.replace(/\/\//g,"/")).replace(/^.*\/compiles\/[0-9a-f]{24}(-[0-9a-f]{24})?\/(\.\/)?/,"")).replace(/^\/compile\//,""),t&&(e=e.replace(/^\.\//,t+"/")),e}async function Y(e,t,n){let r="";try{const o=new AbortController;t.addEventListener("abort",(()=>{o.abort()}));const s=await fetch(e,{signal:o.signal});if(!s.ok)throw new Error("Failed to fetch log file");const i=s.body.pipeThrough(new TextDecoderStream);for await(const e of i)r+=e,r.length>n&&o.abort()}catch(e){g.$.warn(e)}return r}var Q=n(86316),Z=n(10646);const ee=["bbl","gls","ind"],te=["output.fls","output.fdb_latexmk"];var ne=n(56447),re=n(85960),oe=n(60440),se=n(93588),ie=n(89997),ae=n(66020),ce=n(17112),le=n(68543),he=n(37664);var de=n(58528),ue=n(9155),pe=n(37603),ge=n.n(pe);const me=(0,r.createContext)(void 0),fe=e=>{let{children:t}=e;const{hasPremiumCompile:n,isProjectOwner:c}=(0,Z.mi)(),{openDocWithId:d,openDocs:m,currentDocument:f}=(0,le.TS)(),{role:v}=(0,se.Q2)(),{_id:b,rootDocId:y,joinedOnce:x,imageName:k,compiler:C}=(0,Q.O)(),{pdfPreviewOpen:E}=(0,ne.LV)(),{features:T,alphaProgram:j,labsProgram:I}=(0,re.ur)(),{fileTreeData:S}=(0,oe.Q)(),{findEntityByPath:L}=(0,ie.m8)(),[O,R]=(0,r.useState)(!1),[P,M]=(0,r.useState)(!1),[F,D]=(0,r.useState)(!1),[N,X]=(0,s.A)("pdf.logEntries"),[$,U]=(0,o.A)("pdf.logEntryAnnotations"),{userSettings:V}=(0,ae.dk)(),{pdfViewer:H,syntaxValidation:W}=V,[,z]=(0,s.A)("pdf.downloadUrl"),[,J]=(0,s.A)("pdf.url"),[Y,pe]=(0,r.useState)();(0,r.useEffect)((()=>{z(Y?.pdfDownloadUrl),J(Y?.pdfUrl)}),[Y,z,J]);const[fe,_e]=(0,o.A)("pdf.uncompiled"),[we,ve]=(0,r.useState)(!1),[be,ye]=(0,r.useState)(),[xe,ke]=(0,r.useState)(),Ce=xe?xe.rootDocId??y:null,[Ee,Te]=(0,r.useState)((()=>()=>{})),[je,Ie]=(0,r.useState)({}),[Se,Ae]=(0,r.useState)(!1),[Le,Oe]=(0,r.useState)((0,l.A)("ol-projectOwnerHasPremiumOnPageLoad")&&(0,de.g9)("populate-clsi-cache")&&"detached"!==v),[Re,Pe]=(0,r.useState)(!1),[Me,Fe]=(0,r.useState)(),[De,Ne]=(0,r.useState)(!1),[Xe,$e]=(0,r.useState)(!1),[Ue,Ve]=(0,r.useState)(!1),Be=(0,r.useCallback)((()=>{$e((e=>(e||(0,w.JY)("ide-open-logs-once"),!e)))}),[$e]),[He,We]=(0,r.useState)(),[ze,Je]=(0,r.useState)(),[qe,Ke]=(0,r.useState)(),[Ge,Ye]=(0,r.useState)(),[Qe,Ze]=(0,r.useState)(),[et,tt]=(e=>{const[t,n]=(0,r.useState)(),o=(0,r.useRef)(e);(0,r.useEffect)((()=>{o.current=e}),[e]);const s=(0,r.useRef)(null);return(0,r.useEffect)((()=>{if(e){const t=he.A.getItem(`pdf.position.${e}`);t&&(g.$.log("loaded position for",e,t),s.current=t,n(t))}}),[e]),(0,r.useEffect)((()=>{o.current&&t&&t!==s.current&&(g.$.log("storing position for",o.current,t),he.A.setItem(`pdf.position.${o.current}`,t))}),[t]),[t,n]})(Ce),[nt,rt]=(0,i.A)(`autocompile_enabled:${b}`,!1,!0),[ot,st]=(0,i.A)(`draft:${b}`,!1,!0),[it,at]=(0,i.A)(`stop_on_first_error:${b}`,!1,!0),[ct,lt]=(0,r.useState)(!1),[ht,dt]=(0,i.A)(`stop_on_validation_error:${b}`,!0,!0),[ut,pt]=(0,o.A)("hasLintingError"),[gt,mt]=(0,r.useState)(0),{signal:ft}=(0,a.A)(),_t=(0,r.useCallback)((()=>{pe(void 0),X(null),U({})}),[pe,X,U]),wt=(0,r.useRef)(!1);(0,r.useEffect)((()=>{wt.current=O}),[O]);const vt=(0,r.useCallback)((e=>function(e,t,n){const r=(0,B.pD)(t,n),o={},s={};for(const n of e)if(n.file){n.file=G(n.file,r);const e=(0,B.Xk)(t,n.file)?.entity;if(e){e._id in o||(o[e._id]=[]);const t={id:n.key,entryIndex:o[e._id].length,row:n.line-1,type:"error"===n.level?"error":"warning",text:n.message,source:"compile",ruleId:n.ruleId,command:n.command};"typesetting"!==n.level&&(s[n.line]||(t.firstOnLine=!0,s[n.line]=!0)),o[e._id].push(t)}}return o}(e,S,Ce)),[S,Ce]),bt=(0,r.useRef)(vt);(0,r.useEffect)((()=>{bt.current=vt}),[vt]);const[yt]=(0,r.useState)((()=>new _({projectId:b,setChangedAt:mt,setCompiling:R,setData:ke,setFirstRenderDone:Te,setDeliveryLatencies:Ie,setError:We,cleanupCompileResult:_t,compilingRef:wt,signal:ft,openDocs:m})));(0,r.useEffect)((()=>{yt.currentDoc=f}),[yt,f]),(0,r.useEffect)((()=>{yt.projectRootDocId=y}),[yt,y]),(0,r.useEffect)((()=>{yt.setOption("draft",ot)}),[yt,ot]),(0,r.useEffect)((()=>{yt.setOption("stopOnFirstError",it)}),[yt,it]),(0,r.useEffect)((()=>{_e(gt>0)}),[_e,gt]),(0,r.useEffect)((()=>{ve(gt>0)}),[ve,gt]),(0,r.useEffect)((()=>{Le&&!Re&&(Pe(!0),(0,h.hm)(`/project/${b}/output/cached/output.overleaf.json`).then((e=>{Fe(e)})).catch((()=>{Oe(!1),Pe(!1)})))}),[b,Le,Re]),(0,r.useEffect)((()=>{if(!Me)return;if(!x)return;if(!f)return;if(Se)return;let e=!1;try{Me.rootDocId=L(Me.options?.rootResourcePath||"")?.entity?._id;e=(yt.getRootDocOverrideId()||y)===Me.rootDocId&&Me.options.imageName===k&&Me.options.compiler===C&&Me.options.draft===ot&&!!Me.options.stopOnFirstError>=it}catch(e){(0,ue.C)(ge().tag(e,"validate compile options",{options:Me.options}))}e&&((0,w._)("compile-from-cache",{projectId:b}),ke(Me),Ae(!0)),Fe(void 0),Oe(!1),Pe(!1)}),[b,Me,x,f,Se,y,L,yt,C,k,it,ot]),(0,r.useEffect)((()=>{Se||!f||Le||Re||(Ae(!0),yt.compile({isAutoCompileOnLoad:!0}))}),[Se,f,Le,Re,yt]),(0,r.useEffect)((()=>{D(void 0!==T?.compileTimeout&&T.compileTimeout<=60)}),[T]),(0,r.useEffect)((()=>{if(F&&O&&c){const e=window.setTimeout((()=>{M(!0)}),3e4);return()=>{window.clearTimeout(e)}}}),[O,c,F]);const xt=(0,ce.u)("compile-log-events"),kt=(0,r.useRef)(null),Ct=(0,r.useRef)({}),Et=(0,r.useCallback)((e=>{Ct.current[e]=!0}),[]);(0,r.useEffect)((()=>{if(!x)return;const e=new AbortController,t=Ct.current;if(Ct.current={},xe){if(xe.clsiServerId&&ye(xe.clsiServerId),xe.outputFiles){const n=new Map;for(const e of xe.outputFiles)n.set(e.path,{...e});"success"===xe.status&&pe(function(e,t,n){const r=e.get("output.pdf");if(!r)return null;r.editorId=r.editorId||u.$3,r.clsiCacheShard=n.clsiCacheShard||"cache";const o=new URLSearchParams;return n.compileGroup&&o.set("compileGroup",n.compileGroup),n.clsiServerId&&o.set("clsiserverid",n.clsiServerId),p.lW&&o.set("enable_pdf_caching","true"),r.pdfUrl=`${K(r,n.pdfDownloadDomain)}?${o}`,n.fromCache?r.pdfDownloadUrl=r.downloadURL:(o.set("popupDownload","true"),r.pdfDownloadUrl=`/download/project/${t}/build/${r.build}/output/output.pdf?${o}`),r}(n,b,xe)),Je(function(e,t){let{clsiServerId:n,clsiCacheShard:r,compileGroup:o,outputFilesArchive:s,fromCache:i=!1}=t;const a={top:[],other:[]};if(e){const t=new URLSearchParams;i?t.set("clsiserverid",r||"cache"):n&&t.set("clsiserverid",n),o&&t.set("compileGroup",o);const c=t.toString(),l=[];for(const t of e.values())te.includes(t.path)||(t.main=t.path.startsWith("output."),c.length&&(t.url+=`?${c}`),l.push(t));l.sort(((e,t)=>e.main&&!t.main?-1:t.main&&!e.main?1:e.path.localeCompare(t.path,void 0,{numeric:!0})));for(const e of l)ee.includes(e.type)?a.top.push(e):"pdf"===e.type&&!0===e.main||a.other.push(e);const h=[...a.top,...a.other];s&&h.length>0&&(h.forEach((e=>t.append("files",e.path))),a.archive={...s,fileCount:h.length,url:`${s.url}?${t.toString()}`})}return a}(n,xe)),U(null),X(null),Ke(void 0),q(n,xe,e.signal).then((e=>{if(Ke(e.log),X(e.logEntries),U(bt.current(e.logEntries.all)),!j&&(["success","stopped-on-first-error"].includes(xe.status)&&(0,w.MY)("compile-result",{errors:e.logEntries.errors.length,warnings:e.logEntries.warnings.length,typesetting:e.logEntries.typesetting.length,newPdfPreview:!0,stopOnFirstError:xe.options.stopOnFirstError},.01),xt||I)){const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t={};for(const n of e){const e=`${n.level}_${n.ruleId}`;t[e]=t[e]?t[e]+1:1}return t}(e.logEntries.all),r=xe.rootDocId||yt.projectRootDocId,o=kt.current;kt.current={ruleCounts:n,rootDocId:r};const s=o&&o.rootDocId===r?((e,t)=>{const n={};for(const[r,o]of Object.entries(e)){const e=t[r]??0;n[`delta_${r}`]=o-e}for(const[r,o]of Object.entries(t))r in e||(n[r]=0,n[`delta_${r}`]=-o);return n})(n,o.ruleCounts):{};(0,w._)("compile-log-entries",{status:xe.status,stopOnFirstError:xe.options.stopOnFirstError,isAutoCompileOnLoad:!!xe.options.isAutoCompileOnLoad,isAutoCompileOnChange:!!xe.options.isAutoCompileOnChange,rootDocId:r,...t,...n,...s})}}))}switch(xe.status){case"success":We(void 0),$e(!1);break;case"stopped-on-first-error":We(void 0),$e(!0);break;case"clsi-maintenance":case"compile-in-progress":case"exited":case"failure":case"project-too-large":case"rate-limited":case"terminated":case"too-recently-compiled":We(xe.status);break;case"timedout":We("timedout"),!n&&c&&(0,w.tN)("subscription-funnel","editor-click-feature","compile-timeout");break;case"autocompile-backoff":xe.options.isAutoCompileOnLoad||(We("autocompile-disabled"),rt(!1));break;case"unavailable":We("clsi-unavailable");break;case"validation-problems":We("validation-problems"),Ye(xe.validationProblems);break;default:We("error")}lt("stopped-on-first-error"===xe.status)}return()=>{e.abort()}}),[x,xe,j,I,T,xt,n,c,b,rt,ye,X,U,pe,yt]),(0,r.useEffect)((()=>{He&&$e(!0)}),[He]);const Tt=Boolean(nt&&W&&ut),jt=ht&&Tt,It=Boolean(nt&&E&&!jt),St=Boolean(It&&fe&&Se);(0,r.useEffect)((()=>{It?gt>0&&yt.debouncedAutoCompile():yt.debouncedAutoCompile.cancel()}),[yt,It,gt]),(0,r.useEffect)((()=>()=>{yt.debouncedAutoCompile.cancel()}),[yt]);const At=(0,r.useCallback)((e=>{Ae(!0),yt.compile(e)}),[yt,Ae]),Lt=(0,r.useCallback)((()=>{yt.stopCompile()}),[yt]),Ot=(0,r.useCallback)((()=>(Ne(!0),yt.clearCache().then((()=>{Je(void 0),pe(void 0)})).finally((()=>{Ne(!1)})))),[yt]),Rt=(0,r.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=L(e.file);n&&"doc"===n.type&&d(n.entity._id,{gotoLine:e.line??void 0,gotoColumn:e.column??void 0,keepCurrentView:t})}),[L,d]),Pt=(0,r.useCallback)((()=>{Ot().then((()=>{yt.compile()}))}),[Ot,yt]),Mt=(0,r.useMemo)((()=>xe?.options||{}),[xe]);(0,r.useEffect)((()=>{const e=e=>{$e(e.detail)};return window.addEventListener("editor:show-logs",e),()=>{window.removeEventListener("editor:show-logs",e)}}),[]);const Ft=(0,r.useMemo)((()=>({animateCompileDropdownArrow:Ue,autoCompile:nt,clearCache:Ot,clearingCache:De,clsiServerId:be,codeCheckFailed:jt,compiling:O,deliveryLatencies:je,draft:ot,editedSinceCompileStarted:we,error:He,fileList:ze,hasChanges:St,hasShortCompileTimeout:F,highlights:Qe,isProjectOwner:c,lastCompileOptions:Mt,logEntryAnnotations:$,logEntries:N,pdfDownloadUrl:Y?.pdfDownloadUrl,pdfFile:Y,pdfUrl:Y?.pdfUrl,pdfViewer:H,position:et,rawLog:qe,recompileFromScratch:Pt,setAnimateCompileDropdownArrow:Ve,setAutoCompile:rt,setCompiling:R,setDraft:st,setError:We,setHasLintingError:pt,setHighlights:Ze,setPosition:tt,showCompileTimeWarning:P,setShowCompileTimeWarning:M,setShowLogs:$e,toggleLogs:Be,setStopOnFirstError:at,setStopOnValidationError:dt,showLogs:Xe,startCompile:At,stopCompile:Lt,stopOnFirstError:it,stopOnValidationError:ht,stoppedOnFirstError:ct,uncompiled:fe,validationIssues:Ge,firstRenderDone:Ee,setChangedAt:mt,cleanupCompileResult:_t,syncToEntry:Rt,recordAction:Et})),[Ue,nt,Ot,De,be,jt,O,je,ot,we,He,ze,St,F,Qe,c,Mt,N,$,et,Y,H,qe,Pt,Ve,rt,st,We,pt,Ze,tt,M,at,dt,P,Xe,At,Lt,it,ht,ct,fe,Ge,Ee,mt,_t,$e,Be,Rt,Et]);return(0,A.jsx)(me.Provider,{value:Ft,children:t})};function _e(){const e=(0,r.useContext)(me);if(!e)throw new Error("useLocalCompileContext is only available inside LocalCompileProvider");return e}},81714:()=>{},82174:(e,t,n)=>{"use strict";n(82438),n(50020);const r=n(45250),o=n(64347).assert,s=n(97277),i=n(12628),a=n(14679),c=n(91810),l=n(50614);class h extends i{constructor(e,t,n,r){super(),o.match(e,s.HEX_HASH_RX),t&&o.match(t,s.HEX_HASH_RX),o.greaterOrEqual(n,0),o.maybe.array.of.instance(r,c),this.hash=e,this.rangesHash=t,this.stringLength=n,this.operations=r||[]}static fromRaw(e){return new h(e.hash,e.rangesHash,e.stringLength,e.operations&&r.map(e.operations,l.fromJSON))}toRaw(){const e={hash:this.hash,stringLength:this.stringLength};return this.rangesHash&&(e.rangesHash=this.rangesHash),this.operations.length&&(e.operations=r.map(this.operations,(function(e){return e.toJSON()}))),e}getHash(){return this.operations.length?null:this.hash}getRangesHash(){return this.operations.length?null:this.rangesHash}isEditable(){return!0}getByteLength(){return this.stringLength}getStringLength(){return this.stringLength}getOperations(){return this.operations}async toEager(e){const[t,n]=await Promise.all([e.getString(this.hash),this.rangesHash?e.getObject(this.rangesHash):Promise.resolve(void 0)]),o=new a(t,n?.comments,n?.trackedChanges);return function(e,t){r.each(e,(e=>e.apply(t)))}(this.operations,o),o}async toLazy(){return this}async toHollow(){return i.createHollow(null,this.stringLength)}edit(e){this.stringLength=e.applyToLength(this.stringLength),this.operations.push(e)}async store(e){if(0===this.operations.length){const e={hash:this.hash};return this.rangesHash&&(e.rangesHash=this.rangesHash),e}const t=await this.toEager(e);return this.operations.length=0,await t.store(e)}}e.exports=h},82927:(e,t,n)=>{"use strict";const r=n(8010),o=n(50614);class s extends r{constructor(e,t){super(),this.pathname=e,this.operation=t}toRaw(){return{pathname:this.pathname,...this.operation.toJSON()}}static fromRaw(e){return new s(e.pathname,o.fromJSON(e))}getPathname(){return this.pathname}getOperation(){return this.operation}applyTo(e){e.editFile(this.pathname,this.operation)}canBeComposedWithForUndo(e){return this.canBeComposedWith(e)&&this.operation.canBeComposedWithForUndo(e.operation)}canBeComposedWith(e){return e instanceof s&&(this.getPathname()===e.getPathname()&&this.operation.canBeComposedWith(e.operation))}compose(e){return new s(this.pathname,this.operation.compose(e.operation))}}e.exports=s},83096:(e,t,n)=>{"use strict";n.d(t,{B:()=>f,T:()=>_});n(97107);var r=n(14041),o=n(97434),s=n(28812),i=n(71627),a=n(31085);function c(e){let{title:t,message:n,...r}=e;const{t:c}=(0,o.Bd)();return(0,a.jsxs)(s.Ay,{...r,children:[(0,a.jsx)(s.IK,{closeButton:!0,children:(0,a.jsx)(s.rA,{children:t})}),(0,a.jsx)(s.$8,{className:"modal-body-share",children:n}),(0,a.jsx)(s.E9,{children:(0,a.jsx)(i.A,{variant:"secondary",onClick:()=>r.onHide(),children:c("ok")})})]})}const l=(0,r.memo)(c);var h=n(89753);function d(e){let{editorContent:t,show:n,onHide:c}=e;const{t:l}=(0,o.Bd)(),d=(0,h.z)(),[u,p]=(0,r.useState)(!1),g=(t.match(/\n/g)?.length||0)+1;function m(){c(),d.reload()}return(0,a.jsxs)(s.Ay,{show:n,onHide:m,className:"out-of-sync-modal",backdrop:!1,keyboard:!1,children:[(0,a.jsx)(s.IK,{closeButton:!0,children:(0,a.jsx)(s.rA,{children:l("out_of_sync")})}),(0,a.jsx)(s.$8,{className:"modal-body-share",children:(0,a.jsx)(o.x6,{i18nKey:"out_of_sync_detail",components:[(0,a.jsx)("br",{}),(0,a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"/learn/Kb/Editor_out_of_sync_problems"})]})}),(0,a.jsxs)(s.$8,{children:[(0,a.jsx)(i.A,{variant:"secondary",onClick:()=>p((e=>!e)),children:l(u?"hide_local_file_contents":"show_local_file_contents")}),u?(0,a.jsx)("div",{className:"text-preview",children:(0,a.jsx)("textarea",{className:"scroll-container",readOnly:!0,rows:g,value:t})}):null]}),(0,a.jsx)(s.E9,{children:(0,a.jsx)(i.A,{variant:"secondary",onClick:m,children:l("reload_editor")})})]})}const u=(0,r.memo)(d);function p(e){let{title:t,message:n,confirmLabel:r,primaryVariant:c="primary",...l}=e;const{t:h}=(0,o.Bd)(),d=l.onConfirm;return(0,a.jsxs)(s.Ay,{...l,children:[(0,a.jsx)(s.IK,{closeButton:!0,children:(0,a.jsx)(s.rA,{children:t})}),(0,a.jsx)(s.$8,{className:"modal-generic-confirm",children:n}),(0,a.jsxs)(s.E9,{children:[(0,a.jsx)(i.A,{variant:"secondary",onClick:()=>l.onHide(),children:h("cancel")}),(0,a.jsx)(i.A,{variant:c,onClick:d,children:r||h("ok")})]})]})}const g=(0,r.memo)(p),m=(0,r.createContext)(void 0),f=e=>{let{children:t}=e;const[n,o]=(0,r.useState)(!1),[s,i]=(0,r.useState)(!1),[c,h]=(0,r.useState)({title:"",message:""}),[d,p]=(0,r.useState)({title:"",message:"",onConfirm:()=>{}}),[f,_]=(0,r.useState)(!1),[w,v]=(0,r.useState)({editorContent:""}),b=(0,r.useCallback)((()=>{o(!1)}),[]),y=(0,r.useCallback)((()=>{i(!1)}),[]),x=(0,r.useCallback)((()=>{d.onConfirm(),i(!1)}),[d]),k=(0,r.useCallback)(((e,t)=>{h({title:e,message:t}),o(!0)}),[]),C=(0,r.useCallback)((e=>{p(e),i(!0)}),[]),E=(0,r.useCallback)((()=>{_(!1)}),[]),T=(0,r.useCallback)((e=>{v({editorContent:e}),_(!0)}),[]),j=(0,r.useMemo)((()=>({showGenericMessageModal:k,showGenericConfirmModal:C,genericModalVisible:n,showOutOfSyncModal:T})),[k,C,n,T]);return(0,a.jsxs)(m.Provider,{value:j,children:[t,(0,a.jsx)(l,{show:n,onHide:b,...c}),(0,a.jsx)(g,{show:s,onHide:y,...d,onConfirm:x}),(0,a.jsx)(u,{...w,show:f,onHide:E})]})};function _(){const e=(0,r.useContext)(m);if(!e)throw new Error("useModalsContext is only available inside ModalsContextProvider");return e}},83681:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(79907),o=n(31085);const s=function(e){let{prepend:t,children:n,badgeContentRef:s,...i}=e;return(0,o.jsxs)(r.A,{...i,children:[t&&(0,o.jsx)("span",{className:"badge-prepend",children:t}),(0,o.jsx)("span",{className:"badge-content",ref:s,children:n})]})}},84140:(e,t,n)=>{"use strict";const r=n(8010);e.exports=class extends r{constructor(e,t){super(),this.pathname=e,this.newPathname=t}toRaw(){return{pathname:this.pathname,newPathname:this.newPathname}}getPathname(){return this.pathname}getNewPathname(){return this.newPathname}isRemoveFile(){return""===this.getNewPathname()}applyTo(e){e.moveFile(this.getPathname(),this.getNewPathname())}}},85544:(e,t,n)=>{n(97107);const r=n(58756),o=n(43921),s=n(90482),i=n(91810);class a extends i{constructor(e,t){super(),this.commentId=e,this.resolved=t}toJSON(){return{resolved:this.resolved,commentId:this.commentId}}apply(e){const t=e.comments.getComment(this.commentId);if(t){const n=new o(t.id,t.ranges,this.resolved);e.comments.add(n)}}invert(e){const t=e.comments.getComment(this.commentId);return t?new a(this.commentId,t.resolved):new s}canBeComposedWith(e){return e instanceof a&&this.commentId===e.commentId||e instanceof r.DeleteCommentOperation&&this.commentId===e.commentId}compose(e){if(e instanceof a&&e.commentId===this.commentId)return e;if(e instanceof r.DeleteCommentOperation&&e.commentId===this.commentId)return e;throw new Error(`Trying to compose SetCommentStateOperation with ${e?.constructor?.name}.`)}static fromJSON(e){return new a(e.commentId,e.resolved)}}e.exports=a},86040:(e,t,n)=>{"use strict";n.d(t,{Wz:()=>i,vO:()=>a});n(97107);var r=n(14041),o=n(31085);const s=(0,r.createContext)(void 0),i=e=>{let{children:t}=e;const[n,i]=(0,r.useState)(!1);return(0,o.jsx)(s.Provider,{value:{showSwitcherModal:n,setShowSwitcherModal:i},children:t})},a=()=>{const e=(0,r.useContext)(s);if(!e)throw new Error("useIdeRedesignSwitcherContext is only available inside IdeRedesignSwitcherProvider");return e}},86316:(e,t,n)=>{"use strict";n.d(t,{N:()=>_,O:()=>m});n(97107),n(82438),n(50020);var r=n(14041),o=n(14936),s=n(64932),i=(n(12266),n(90165)),a=n.n(i),c=n(58756),l=n(37858);class h{constructor(e){this.projectId=e,this.snapshot=new c.Snapshot,this.version=0,this.refreshPromise=Promise.resolve(),this.initialized=!1,this.refreshing=!1,this.queued=!1,this.blobStore=new d(this.projectId)}async refresh(){this.queued?await this.refreshPromise:this.refreshing?(this.refreshPromise=this.queueRefresh(),await this.refreshPromise):(this.refreshPromise=this.startRefresh(),await this.refreshPromise)}getDocPaths(){return this.snapshot.getFilePathnames().filter((e=>this.snapshot.getFile(e)?.isEditable()))}getDocContents(e){const t=this.snapshot.getFile(e);return null==t?null:t.getContent({filterTrackedDeletes:!0})??null}async startRefresh(){this.refreshing=!0;try{this.initialized?await this.loadChanges():await this.initialize()}finally{this.refreshing=!1}}async queueRefresh(){this.queued=!0;try{await this.refreshPromise}catch{}this.queued=!1,await this.startRefresh()}async initialize(){await u(this.projectId);const e=await async function(e){const t=await(0,l.hm)(`/project/${e}/latest/history`);return c.Chunk.fromRaw(t.chunk)}(this.projectId);this.snapshot=e.getSnapshot(),this.snapshot.applyAll(e.getChanges()),this.version=e.getEndVersion(),await this.loadDocs(),this.initialized=!0}async loadChanges(){await u(this.projectId);const e=await async function(e,t){return(await(0,l.hm)(`/project/${e}/changes?since=${t}`)).map(c.Change.fromRaw).filter((e=>null!=e))}(this.projectId,this.version);this.snapshot.applyAll(e),this.version+=e.length,await this.loadDocs()}async loadDocs(){const e=this.getDocPaths(),t=a()(10);await Promise.all(e.map((e=>t((async()=>{const t=this.snapshot.getFile(e);await(t?.load("eager",this.blobStore))})))))}}class d{constructor(e){this.projectId=e}async getString(e){return await async function(e,t){const n=`/project/${e}/blob/${t}`,r=await fetch(n);if(!r.ok)throw new l.fk("Failed to fetch blob",n,void 0,r);return await r.text()}(this.projectId,e)}async getObject(e){const t=await this.getString(e);return JSON.parse(t)}}async function u(e){await(0,l.TB)(`/project/${e}/flush`)}var p=n(31085);const g=(0,r.createContext)(void 0);function m(){const e=(0,r.useContext)(g);if(!e)throw new Error("useProjectContext is only available inside ProjectProvider");return e}const f={_id:(0,s.A)("ol-project_id"),name:"",features:{}},_=e=>{let{children:t}=e;const[n]=(0,o.A)("project"),i=!!n,{_id:a,compiler:c,imageName:l,name:d,rootDoc_id:u,members:m,invites:_,features:w,publicAccesLevel:v,owner:b,trackChangesState:y,mainBibliographyDoc_id:x}=n||f,[k]=(0,r.useState)((()=>new h(a))),C=(0,r.useMemo)((()=>((0,s.A)("ol-projectTags")||[]).map((e=>({...e,name:e.name??""})))),[]),E=(0,r.useMemo)((()=>({_id:a,compiler:c,imageName:l,name:d,rootDocId:u,members:m,invites:_,features:w,publicAccessLevel:v,owner:b,tags:C,trackChangesState:y,mainBibliographyDocId:x,projectSnapshot:k,joinedOnce:i})),[a,c,l,d,u,m,_,w,v,b,C,y,x,k,i]);return(0,p.jsx)(g.Provider,{value:E,children:t})}},87520:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(79600),s=n(8010);class i extends s{constructor(e,t){super(),r.string(e,"bad pathname"),r.object(t,"bad file"),this.pathname=e,this.file=t}getPathname(){return this.pathname}static fromRaw(e){return new i(e.pathname,o.fromRaw(e.file))}toRaw(){return{pathname:this.pathname,file:this.file.toRaw()}}getFile(){return this.file}findBlobHashes(e){const t=this.file.getHash();t&&e.add(t)}async loadFiles(e,t){return await this.file.load(e,t)}async store(e){const t=await this.file.store(e);return{pathname:this.pathname,file:t}}applyTo(e){e.addFile(this.pathname,this.file.clone())}}e.exports=i},87776:(e,t,n)=>{"use strict";n.d(t,{E:()=>r});n(71879);const r=(e,t)=>AbortSignal.any([e,AbortSignal.timeout(t)])},88495:(e,t,n)=>{"use strict";n.d(t,{A:()=>a,c:()=>i});var r=n(14041),o=n(89139),s=n(94234);const i=e=>{if(e.shiftKey||e.altKey)return!1;if(e.ctrlKey){if("s"===e.key||"Enter"===e.key||"."===e.key)return!0;if("S"===e.key&&!e.shiftKey)return!0}else if(e.metaKey){if("s"===e.key||"Enter"===e.key)return!0;if("S"===e.key&&!e.shiftKey)return!0}};function a(e,t){const n=(0,r.useCallback)((t=>{i(t)&&(t.preventDefault(),e())}),[e]),a=(0,r.useCallback)((()=>{e()}),[e]);(0,o.A)("pdf:recompile",a),(0,r.useEffect)((()=>(document.body.addEventListener("keydown",n),()=>{document.body.removeEventListener("keydown",n)})),[n]);const c=(0,s.A)("set-changed-at",t,"detacher","detached"),l=(0,r.useCallback)((()=>{c(Date.now())}),[c]);(0,o.A)("doc:changed",l)}},89135:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(53373),o=n.n(r),s=n(31085);const i=function(e){let{type:t,spin:n,fw:r,modifier:i,className:a="",accessibilityLabel:c,...l}=e;const h=o()("fa",`fa-${t}`,{"fa-spin":n,"fa-fw":r,[`fa-${i}`]:i},a);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("i",{className:h,"aria-hidden":"true",...l}),c&&(0,s.jsx)("span",{className:"visually-hidden",children:c})]})}},89139:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(14041);function o(e,t){(0,r.useEffect)((()=>(window.addEventListener(e,t),()=>{window.removeEventListener(e,t)})),[e,t])}},89997:(e,t,n)=>{"use strict";n.d(t,{m8:()=>h,rL:()=>l});n(97107);var r=n(14041),o=n(60440),s=n(64932),i=n(35287),a=n(31085);const c=(0,r.createContext)(void 0),l=e=>{let{children:t}=e;const{fileTreeData:n}=(0,o.Q)(),l=(0,s.A)("ol-project_id"),h=(0,r.useCallback)((e=>(0,i.$X)(n,e)),[n]),d=(0,r.useCallback)((e=>(0,i.Xk)(n,e)),[n]),u=(0,r.useCallback)((e=>(0,i.bJ)(n,l,e)),[n,l]),p=(0,r.useCallback)((e=>(0,i.pD)(n,e)),[n]),g=(0,r.useMemo)((()=>({pathInFolder:h,findEntityByPath:d,previewByPath:u,dirname:p})),[h,d,u,p]);return(0,a.jsx)(c.Provider,{value:g,children:t})};function h(){const e=(0,r.useContext)(c);if(!e)throw new Error("useFileTreePathContext is only available inside FileTreePathProvider");return e}},90482:(e,t,n)=>{const r=n(91810);class o extends r{apply(e){}toJSON(){return{noOp:!0}}static fromJSON(){return new o}}e.exports=o},91542:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(14041),o=n(67353);function s(e,t){const{scopeEventEmitter:n}=(0,o.nK)();(0,r.useEffect)((()=>n.on(e,t)),[n,e,t])}},91810:(e,t,n)=>{n(97107);class r{constructor(){if(this.constructor===r)throw new Error("Cannot instantiate abstract class")}toJSON(){throw new Error("Abstract method not implemented")}apply(e){throw new Error("Abstract method not implemented")}applyToLength(e){return e}invert(e){throw new Error("Abstract method not implemented")}canBeComposedWith(e){return!1}canBeComposedWithForUndo(e){return!1}compose(e){throw new Error("Abstract method not implemented")}}e.exports=r},91822:(e,t,n)=>{"use strict";const r=n(64347).assert;class o{constructor(e,t,n,o){r.string(e,"bad text"),r.maybe.integer(t,"bad author id"),r.date(n,"bad timestamp"),r.integer(o,"bad version"),this.text=e,this.authorId=t,this.timestamp=n,this.version=o}static fromRaw(e){return new o(e.text,e.authorId,new Date(e.timestamp),e.version)}toRaw(){return{text:this.text,authorId:this.authorId,timestamp:this.timestamp.toISOString(),version:this.version}}getText(){return this.text}getAuthorId(){return this.authorId}getTimestamp(){return this.timestamp}getVersion(){return this.version}}e.exports=o},93516:e=>{class t{constructor(){this.type="none"}equals(e){return e instanceof t}toRaw(){return{type:"none"}}}e.exports=t},93588:(e,t,n)=>{"use strict";n.d(t,{lt:()=>u,Q2:()=>p});n(97107);var r=n(14041),o=n(64932),s=n(69139);n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539);var i=n(60961),a=n(31085);const c=(0,r.createContext)(void 0),l=(0,o.A)("ol-debugPdfDetach"),h=(0,o.A)("ol-project_id"),d="BroadcastChannel"in window?new BroadcastChannel(`detach-${h}`):void 0,u=e=>{let{children:t}=e;const[n,h]=(0,r.useState)(),[u,p]=(0,r.useState)((()=>(0,o.A)("ol-detachRole")||null)),{addHandler:g,deleteHandler:m,callHandlers:f}=function(){const e=(0,r.useRef)(new Set),t=(0,r.useCallback)((t=>{e.current.add(t)}),[]),n=(0,r.useCallback)((t=>{e.current.delete(t)}),[]),o=(0,r.useCallback)((function(){for(const t of e.current)t(...arguments)}),[]);return{addHandler:t,deleteHandler:n,callHandlers:o}}();(0,r.useEffect)((()=>{l&&i.$.warn("Effect",{role:u}),window.history.replaceState({},"",(0,s.Z)(u).toString())}),[u]),(0,r.useEffect)((()=>{if(d){const e=e=>{l&&i.$.warn("Receiving:",e.data),f(e.data)};return d.addEventListener("message",e),()=>{d.removeEventListener("message",e)}}}),[f]);const _=(0,r.useCallback)(((e,t)=>{if(!u)return void(l&&i.$.warn("Not Broadcasting (no role)",{role:u,event:e,data:t}));l&&i.$.warn("Broadcasting",{role:u,event:e,data:t});const n={role:u,event:e};t&&(n.data=t),d?.postMessage(n)}),[u]);(0,r.useEffect)((()=>{_("connected")}),[_]),(0,r.useEffect)((()=>{const e=()=>_("closed");return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)}),[_]),(0,r.useEffect)((()=>{const e=e=>{"detached"===e.role&&"connected"===e.event&&h(new Date)};return g(e),()=>m(e)}),[g,m]);const w=(0,r.useMemo)((()=>({role:u,setRole:p,broadcastEvent:_,lastDetachedConnectedAt:n,addEventHandler:g,deleteEventHandler:m})),[u,p,_,n,g,m]);return(0,a.jsx)(c.Provider,{value:w,children:t})};function p(){const e=(0,r.useContext)(c);if(!e)throw new Error("useDetachContext is only available inside DetachProvider");return e}},93852:(e,t,n)=>{"use strict";n.d(t,{i:()=>o});const r=(0,n(64932).A)("ol-projectHistoryBlobsEnabled");function o(e,t,n){return r&&n?`/project/${e}/blob/${n}?fallback=${t}`:`/project/${e}/file/${t}`}},94012:(e,t,n)=>{"use strict";n.d(t,{B4:()=>m,iH:()=>g});n(97107),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539);var r=n(5804),o=n(14041),s=n(13271),i=n(16896),a=n(37858),c=n(60440),l=n(41479),h=n(60961),d=n(89139),u=n(31085);const p=(0,o.createContext)(void 0),g=e=>{let{children:t}=e;const{fileTreeData:n}=(0,c.Q)(),{eventEmitter:g,projectId:m}=(0,s.yn)(),{socket:f}=(0,i.FX)(),[_,w]=(0,o.useState)(new Set),[v,b]=(0,o.useState)({}),y=(0,o.useCallback)((async e=>(0,a.TB)(`/project/${m}/references/indexAll`,{body:{shouldBroadcast:e}}).then((e=>{w(new Set(e.keys))})).catch((e=>{h.$.error(e)}))),[m]),x=(0,o.useCallback)(((e,t)=>{const n=e.doc_id,o=e.getSnapshot(),s=Date.now(),i=(0,r.V)("blob "+o.length+"\0"+o),a=v[n];a&&a.timestamp>s-216e5&&a.hash===i||(y(t),b((e=>({...e,[n]:{hash:i,timestamp:s}}))))}),[v,y]);(0,o.useEffect)((()=>{const e=e=>{let{detail:[t]}=e;t.doc_id&&(0,l.p)(n,t.doc_id)?.name?.endsWith(".bib")&&x(t,!0)};return g.on("document:closed",e),()=>{g.off("document:closed",e)}}),[g,n,x]),(0,d.A)("reference:added",(0,o.useCallback)((()=>{y(!0)}),[y])),(0,o.useEffect)((()=>{const e=()=>{f.on("references:keys:updated",((e,t)=>{w((n=>t?new Set(e):new Set([...n,...e])))})),y(!1)};return g.once("project:joined",e),()=>{g.off("project:joined",e)}}),[g,y,f]);const k=(0,o.useMemo)((()=>({referenceKeys:_,indexAllReferences:y})),[y,_]);return(0,u.jsx)(p.Provider,{value:k,children:t})};function m(){const e=(0,o.useContext)(p);if(!e)throw new Error("useReferencesContext is only available inside ReferencesProvider");return e}},94234:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var r=n(14041),o=n(93588),s=n(64932),i=n(60961);const a=(0,s.A)("ol-debugPdfDetach");function c(e,t,n,s){const{role:c,broadcastEvent:l,addEventHandler:h,deleteEventHandler:d}=(0,o.Q2)(),u=`action-${e}`,p=(0,r.useCallback)((function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];c===n?l(u,{args:r}):t(...r)}),[c,n,u,t,l]),g=(0,r.useCallback)((e=>{e.event===u&&c===s&&(a&&i.$.warn(`Do ${t.name} on event ${u}`),t(...e.data.args))}),[c,s,u,t]);return(0,r.useEffect)((()=>(h(g),()=>d(g))),[h,d,g]),p}},94857:(e,t,n)=>{"use strict";n.d(t,{c:()=>r});const r=/Mac/.test(window.navigator?.platform)},96837:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(12628);class s extends o{constructor(e){super(),r.integer(e,"HollowBinaryFileData: bad byteLength"),r.greaterOrEqual(e,0,"HollowBinaryFileData: low byteLength"),this.byteLength=e}static fromRaw(e){return new s(e.byteLength)}toRaw(){return{byteLength:this.byteLength}}getByteLength(){return this.byteLength}isEditable(){return!1}async toHollow(){return this}}e.exports=s},97277:(e,t,n)=>{"use strict";var r;function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(97107);const s=n(64347).assert,i=n(37603),a=n(45317);class NotFoundError extends i{constructor(e){super(`blob ${e} not found`,{hash:e}),this.hash=e}}class c{constructor(e,t,n){this.setHash(e),this.setByteLength(t),this.setStringLength(n)}static fromRaw(e){return e?new c(e.hash,e.byteLength,e.stringLength):null}toRaw(){return{hash:this.hash,byteLength:this.byteLength,stringLength:this.stringLength}}getHash(){return this.hash}setHash(e){s.match(e,c.HEX_HASH_RX,"bad hash"),this.hash=e}getByteLength(){return this.byteLength}setByteLength(e){s.integer(e,"bad byteLength"),this.byteLength=e}getStringLength(){return this.stringLength}setStringLength(e){s.maybe.integer(e,"bad stringLength"),this.stringLength=e}}r=c,o(c,"HEX_HASH_RX_STRING","^[0-9a-f]{40,40}$"),o(r,"HEX_HASH_RX",new RegExp(r.HEX_HASH_RX_STRING)),o(r,"MAX_EDITABLE_BYTE_LENGTH_BOUND",3*a.MAX_STRING_LENGTH),o(r,"NotFoundError",NotFoundError),e.exports=c},97348:(e,t,n)=>{"use strict";n(82438),n(57327),n(50020);const r=n(64347).assert,o=n(90953),s=n(35078),i=n(44838);class a{constructor(e,t){r.instance(e,i,"bad snapshot"),r.maybe.array.of.instance(t,s,"bad changes"),this.snapshot=e,this.changes=t||[]}static fromRaw(e){return new a(i.fromRaw(e.snapshot),e.changes.map(s.fromRaw))}toRaw(){return{snapshot:this.snapshot.toRaw(),changes:this.changes.map((function(e){return e.toRaw()}))}}getSnapshot(){return this.snapshot}getChanges(){return this.changes}countChanges(){return this.changes.length}pushChanges(e){this.changes.push.apply(this.changes,e)}findBlobHashes(e){this.snapshot.findBlobHashes(e),this.changes.forEach((function(t){t.findBlobHashes(e)}))}async loadFiles(e,t){await Promise.all([this.snapshot.loadFiles(e,t),async function(n){for(const r of n)await r.loadFiles(e,t)}(this.changes)])}async store(e,t){r.maybe.number(t,"bad concurrency");const[n,s]=await Promise.all([this.snapshot.store(e,t),o(this.changes,(async function(n){return await n.store(e,t)}),{concurrency:t||1})]);return{snapshot:n,changes:s}}}e.exports=a},97536:(e,t,n)=>{"use strict";n.d(t,{G:()=>i,x:()=>s});var r=n(66020),o=n(29349);const s=()=>(0,o.$)("editor-redesign"),i=()=>{const{userSettings:e}=(0,r.dk)(),t=s(),n=e.enableNewEditor;return t&&n}},98695:(e,t,n)=>{const r=n(58756),o=n(90482),s=n(91810);class i extends s{constructor(e){super(),this.commentId=e}toJSON(){return{deleteComment:this.commentId}}apply(e){e.comments.delete(this.commentId)}invert(e){const t=e.comments.getComment(this.commentId);return t?new r.AddCommentOperation(t.id,t.ranges.slice(),t.resolved):new o}static fromJSON(e){return new i(e.deleteComment)}}e.exports=i},99568:(e,t,n)=>{"use strict";n(82438),n(12266);const r=n(45250),o=n(64347),s=n(10729);e.exports={assertV1:function(e,t){const n=e.filter((function(e){return null!=e}));if(n.length>0){const e=o.integer(n[0])?o.assert.integer:r.partial(o.assert.instance,r,s);r.each(n,(function(n){e(n,t)}))}},assertV2:function(e,t){r.each(e,(function(e){o.assert.maybe.match(e,/^[0-9a-f]{24}$/,t)}))}}},99806:(e,t,n)=>{"use strict";n.d(t,{k_:()=>C,vd:()=>E});n(97107),n(61412),n(91883),n(70286);var r=n(14041),o=n(33829),s=n(85960),i=n(86316),a=n(37858);n(27534),n(82438),n(57327);const c=3e5;function l(e,t,n){if(n.includes(t.id))return{messages:e,uniqueMessageIds:n};(n=n.slice(0)).push(t.id);const r=e[e.length-1];return{messages:e=r&&t&&t.user&&t.user.id&&t.user.id===r.user.id&&t.timestamp-r.timestamp<c?e.slice(0,e.length-1).concat({...r,id:t.id,timestamp:t.timestamp,contents:r.contents.concat(t.content)}):e.slice(0).concat({id:t.id,user:t.user,timestamp:t.timestamp,contents:[t.content]}),uniqueMessageIds:n}}function h(e,t,n){const r=e.slice(0);return n=n.slice(0),t.slice(0).reverse().forEach((e=>{if(n.includes(e.id))return;n.push(e.id);const t=r[0];t&&e&&e.user&&e.user.id===t.user.id&&t.timestamp-e.timestamp<c?(t.id=e.id,t.timestamp=e.timestamp,t.contents=[e.content].concat(t.contents)):r.unshift({id:e.id,user:e.user,timestamp:e.timestamp,contents:[e.content]})})),{messages:r,uniqueMessageIds:n}}var d=n(30741),u=n(56447),p=n(67353),g=n(64932),m=n(60961),f=n(70569),_=n(97536),w=n(31085);const v=()=>(0,o.A)();let b=1;function y(e,t){switch(t.type){case"INITIAL_FETCH_MESSAGES":return{...e,status:"pending",initialMessagesLoaded:!0};case"FETCH_MESSAGES":return{...e,status:"pending"};case"FETCH_MESSAGES_SUCCESS":return{...e,status:"idle",...h(e.messages,t.messages,e.uniqueMessageIds),lastTimestamp:t.messages[0]?t.messages[0].timestamp:null,atEnd:t.messages.length<50};case"SEND_MESSAGE":return{...e,...l(e.messages,{id:""+b++,user:t.user,content:t.content,timestamp:Date.now()},e.uniqueMessageIds)};case"RECEIVE_MESSAGE":return{...e,...l(e.messages,t.message,e.uniqueMessageIds),unreadMessageCount:e.unreadMessageCount+1};case"MARK_MESSAGES_AS_READ":return{...e,unreadMessageCount:0};case"CLEAR":return{...x};case"ERROR":return{...e,status:"error",error:t.error};default:throw new Error("Unknown action")}}const x={status:"idle",messages:[],initialMessagesLoaded:!1,lastTimestamp:null,atEnd:!1,unreadMessageCount:0,error:null,uniqueMessageIds:[]},k=(0,r.createContext)(void 0),C=e=>{let{children:t}=e;const n=(0,g.A)("ol-chatEnabled"),o=(0,r.useRef)();void 0===o.current&&(o.current=v());const c=(0,s.ur)(),{_id:l}=(0,i.O)(),{chatIsOpen:h}=(0,u.LV)(),{selectedTab:b,isOpen:C}=(0,f.h)(),E=(0,_.G)()?"chat"===b&&C:h,{hasFocus:T,flashTitle:j,stopFlashingTitle:I}=(0,d.A)(),[S,A]=(0,r.useReducer)(y,x),{loadInitialMessages:L,loadMoreMessages:O,reset:R}=(0,r.useMemo)((()=>{function e(){if(S.atEnd)return;const e={limit:String(50)};S.lastTimestamp&&(e.before=String(S.lastTimestamp));const t=new URLSearchParams(e),n=`/project/${l}/messages?${t.toString()}`;(0,a.hm)(n).then((function(){A({type:"FETCH_MESSAGES_SUCCESS",messages:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reverse()})})).catch((e=>{A({type:"ERROR",error:e})}))}return{loadInitialMessages:function(){n?S.initialMessagesLoaded||(A({type:"INITIAL_FETCH_MESSAGES"}),e()):m.$.warn("chat is disabled, won't load initial messages")},loadMoreMessages:function(){n?(A({type:"FETCH_MESSAGES"}),e()):m.$.warn("chat is disabled, won't load messages")},reset:function(){n?(A({type:"CLEAR"}),e()):m.$.warn("chat is disabled, won't reset chat")}}}),[n,l,S.atEnd,S.initialMessagesLoaded,S.lastTimestamp]),P=(0,r.useCallback)((e=>{if(!n)return void m.$.warn("chat is disabled, won't send message");if(!e)return;A({type:"SEND_MESSAGE",user:c,content:e});const t=`/project/${l}/messages`;(0,a.TB)(t,{body:{content:e,client_id:o.current}}).catch((e=>{A({type:"ERROR",error:e})}))}),[n,l,c]),M=(0,r.useCallback)((()=>{n?A({type:"MARK_MESSAGES_AS_READ"}):m.$.warn("chat is disabled, won't mark messages as read")}),[n]),{socket:F}=(0,p.nK)();(0,r.useEffect)((()=>{if(n&&F)return F.on("new-chat-message",e),()=>{F&&F.removeListener("new-chat-message",e)};function e(e){e.clientId!==o.current&&A({type:"RECEIVE_MESSAGE",message:e})}}),[n,F]),(0,r.useEffect)((()=>{T&&(I(),E&&M()),!T&&S.unreadMessageCount>0&&j("New Message")}),[T,E,S.unreadMessageCount,j,I,M]);const D=(0,r.useMemo)((()=>({status:S.status,messages:S.messages,initialMessagesLoaded:S.initialMessagesLoaded,atEnd:S.atEnd,unreadMessageCount:S.unreadMessageCount,loadInitialMessages:L,loadMoreMessages:O,reset:R,sendMessage:P,markMessagesAsRead:M,error:S.error})),[L,O,M,R,P,S.atEnd,S.error,S.initialMessagesLoaded,S.messages,S.status,S.unreadMessageCount]);return(0,w.jsx)(k.Provider,{value:D,children:t})};function E(){const e=(0,r.useContext)(k);if(!e)throw new Error("useChatContext is only available inside ChatProvider");return e}}}]);